var Re=Object.defineProperty,Me=Object.defineProperties;var Ae=Object.getOwnPropertyDescriptors;var me=Object.getOwnPropertySymbols;var $e=Object.prototype.hasOwnProperty,Fe=Object.prototype.propertyIsEnumerable;var xe=(l,c,y)=>c in l?Re(l,c,{enumerable:!0,configurable:!0,writable:!0,value:y}):l[c]=y,Y=(l,c)=>{for(var y in c||(c={}))$e.call(c,y)&&xe(l,y,c[y]);if(me)for(var y of me(c))Fe.call(c,y)&&xe(l,y,c[y]);return l},z=(l,c)=>Me(l,Ae(c));import{M as q,a9 as De,g as ee,f as se,U as Z,aa as je,T as W,O as fe,h as Q,j as e,F as ce,X as ie,c as J,i as te,r as k,a8 as ae,Z as Ie,E as Ne,s as de,ab as Pe,e as K,a2 as He,C as le,b as ne,R as ye,w as Ee,ac as Oe,W as Ge,ad as Ue,a7 as Ye,v as ze}from"./react-vendor-BrAkf1Ej.js";import{C as V,j as P,k as H,B as M,d as G,c as R,D as Be,S as _e,f as We,g as Ke,h as Xe,i as Ze,I as he,v as Qe,w as Je,x as qe,y as et,r as we,s as Le,t as _,Y as U,u as X,Z as tt,_ as st,$ as at,a0 as rt}from"./ui-components-_bEsYxhv.js";import{f as I,c as $}from"./utils-hni-AijI.js";import{c as D}from"./dashboard-classes-CN6A505j.js";import{R as ue,L as lt,C as ge,X as ve,Y as pe,T as oe,b as nt,B as ot,c as it,P as ct,d as dt,e as mt,a as xt}from"./chart-vendor-CfJT7qML.js";import{m as F,A as be}from"./animation-vendor-Cz-8KeDB.js";const ft=({filters:l,onFiltersChange:c,uniqueValues:y})=>{var u,w,v,t,a,s,r,m,i;const g=(d,N)=>{const S=[...l[d]],x=S.includes(N)?S.filter(h=>h!==N):[...S,N];c(z(Y({},l),{[d]:x}))},j=d=>{c(z(Y({},l),{dateRange:{start:d.from?d.from.toISOString():"",end:d.to?d.to.toISOString():""}}))},f=()=>{const d=new Date,N=new Date(d.getFullYear(),d.getMonth()-1,1),S=new Date(d.getFullYear(),d.getMonth(),0),x=b=>{const L=b.getFullYear(),A=String(b.getMonth()+1).padStart(2,"0"),p=String(b.getDate()).padStart(2,"0");return`${L}-${A}-${p}`},h={start:x(N),end:x(S)};c({dateRange:h,location:[],source:[],stage:[],status:[],associate:[],channel:[],trialStatus:[],conversionStatus:[],retentionStatus:[],minLTV:void 0,maxLTV:void 0})},n=(((u=l.location)==null?void 0:u.length)||0)+(((w=l.source)==null?void 0:w.length)||0)+(((v=l.stage)==null?void 0:v.length)||0)+(((t=l.status)==null?void 0:t.length)||0)+(((a=l.associate)==null?void 0:a.length)||0)+(((s=l.channel)==null?void 0:s.length)||0)+(((r=l.trialStatus)==null?void 0:r.length)||0)+(((m=l.conversionStatus)==null?void 0:m.length)||0)+(((i=l.retentionStatus)==null?void 0:i.length)||0)+(l.minLTV?1:0)+(l.maxLTV?1:0),o=[{key:"location",label:"Location",icon:q,options:y.locations,values:l.location},{key:"source",label:"Source",icon:De,options:y.sources,values:l.source},{key:"stage",label:"Stage",icon:ee,options:y.stages,values:l.stage},{key:"status",label:"Status",icon:se,options:y.statuses,values:l.status},{key:"associate",label:"Associate",icon:Z,options:y.associates,values:l.associate},{key:"channel",label:"Channel",icon:je,options:y.channels,values:l.channel},{key:"trialStatus",label:"Trial Status",icon:W,options:y.trialStatuses,values:l.trialStatus},{key:"conversionStatus",label:"Conversion",icon:fe,options:y.conversionStatuses,values:l.conversionStatus},{key:"retentionStatus",label:"Retention",icon:Q,options:y.retentionStatuses,values:l.retentionStatus}];return e.jsxs(V,{className:"bg-white/95 backdrop-blur-sm border border-slate-200 shadow-lg",children:[e.jsx(P,{className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-t-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(H,{className:"flex items-center gap-2 text-white",children:[e.jsx(ce,{className:"w-5 h-5"}),"Lead Filters",n>0&&e.jsxs(M,{className:"bg-white/20 text-white border-white/30",children:[n," Active"]})]}),e.jsxs(G,{variant:"outline",size:"sm",onClick:f,disabled:n===0,className:"bg-white/10 border-white/30 text-white hover:bg-white/20",children:[e.jsx(ie,{className:"w-4 h-4 mr-1"}),"Clear All"]})]})}),e.jsxs(R,{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4 text-blue-600"}),"Date Range"]}),e.jsx(Be,{value:{from:l.dateRange.start?new Date(l.dateRange.start):void 0,to:l.dateRange.end?new Date(l.dateRange.end):void 0},onChange:j})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:o.map(d=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(d.icon,{className:"w-4 h-4 text-blue-600"}),d.label,d.values.length>0&&e.jsx(M,{variant:"secondary",className:"text-xs bg-blue-100 text-blue-700",children:d.values.length})]}),e.jsxs(_e,{value:"",onValueChange:N=>g(d.key,N),children:[e.jsx(We,{className:"h-9",children:e.jsx(Ke,{placeholder:`Select ${d.label.toLowerCase()}`})}),e.jsx(Xe,{className:"bg-white z-50 max-h-48",children:d.options.map(N=>e.jsx(Ze,{value:N,className:"text-sm",children:N},N))})]}),d.values.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1",children:[d.values.slice(0,3).map(N=>e.jsxs(M,{variant:"secondary",className:"text-xs cursor-pointer hover:bg-red-100 bg-slate-100 text-slate-700",onClick:()=>g(d.key,N),children:[N,e.jsx(ie,{className:"w-3 h-3 ml-1"})]},N)),d.values.length>3&&e.jsxs(M,{variant:"outline",className:"text-xs",children:["+",d.values.length-3," more"]})]})]},d.key))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-slate-200",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4 text-blue-600"}),"Min LTV"]}),e.jsx(he,{type:"number",placeholder:"₹0",value:l.minLTV||"",onChange:d=>c(z(Y({},l),{minLTV:d.target.value?parseFloat(d.target.value):void 0})),className:"h-9"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-semibold text-slate-700 flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4 text-blue-600"}),"Max LTV"]}),e.jsx(he,{type:"number",placeholder:"₹100000",value:l.maxLTV||"",onChange:d=>c(z(Y({},l),{maxLTV:d.target.value?parseFloat(d.target.value):void 0})),className:"h-9"})]})]})]})]})},Nt=({data:l,onCardClick:c})=>{const[y,g]=k.useState(null),j=k.useMemo(()=>{if(!l||!l.length)return{leadsReceived:0,trialsCompleted:0,trialsScheduled:0,proximityIssues:0,convertedLeads:0,trialToMemberConversion:0,leadToTrialConversion:0,leadToMemberConversion:0,avgLTV:0,avgVisitsPerLead:0,pipelineHealth:0};const n=l.length,o=l.filter(S=>S.stage==="Trial Completed").length,u=l.filter(S=>{var x;return(x=S.stage)==null?void 0:x.includes("Trial")}).length,w=l.filter(S=>{var x,h;return((x=S.stage)==null?void 0:x.includes("Proximity"))||((h=S.remarks)==null?void 0:h.toLowerCase().includes("proximity"))}).length,v=l.filter(S=>S.conversionStatus==="Converted").length,t=o>0?v/o*100:0,a=n>0?u/n*100:0,s=n>0?v/n*100:0,r=l.reduce((S,x)=>S+(x.ltv||0),0),m=n>0?r/n:0,i=l.reduce((S,x)=>S+(x.visits||0),0),d=n>0?i/n:0,N=Math.min(100,Math.round(a*.3+t*.4+d*10*.2+(n-w)/n*100*.1));return{leadsReceived:n,trialsCompleted:o,trialsScheduled:u,proximityIssues:w,convertedLeads:v,trialToMemberConversion:t,leadToTrialConversion:a,leadToMemberConversion:s,avgLTV:m,avgVisitsPerLead:d,pipelineHealth:N}},[l]),f=({id:n,title:o,value:u,icon:w,color:v,subtitle:t,trend:a,format:s="number",tooltip:r})=>{const m=d=>{switch(s){case"currency":return I(d);case"percentage":return`${d.toFixed(1)}%`;default:return d.toLocaleString("en-IN")}},i=y===n;return e.jsx(Qe,{children:e.jsxs(Je,{children:[e.jsx(qe,{asChild:!0,children:e.jsxs(V,{className:D("group relative overflow-hidden transition-all duration-500 cursor-pointer transform-gpu","bg-gradient-to-br from-white via-slate-50 to-white border-0 shadow-lg hover:shadow-2xl",i?"scale-105 -translate-y-2":"hover:scale-102"),onMouseEnter:()=>g(n),onMouseLeave:()=>g(null),onClick:()=>c==null?void 0:c(o,l,n),children:[e.jsx("div",{className:D("absolute inset-0 opacity-0 transition-opacity duration-500",i&&"opacity-10",v.replace("from-","bg-gradient-to-br from-").replace("to-","to-"))}),e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:D("absolute w-2 h-2 rounded-full opacity-20 transition-all duration-1000",i?"animate-bounce":"transform translate-y-0",v.replace("from-","bg-").split(" ")[0].replace("-400","-300")),style:{top:"20%",left:"80%",animationDelay:i?"0s":"unset"}}),e.jsx("div",{className:D("absolute w-1 h-1 rounded-full opacity-30 transition-all duration-1000",i?"animate-pulse":"opacity-20",v.replace("to-","bg-").split(" ")[1].replace("-600","-400")),style:{top:"60%",left:"15%",animationDelay:i?"0.5s":"unset"}}),e.jsx("div",{className:D("absolute w-1.5 h-1.5 rounded-full opacity-25 transition-all duration-1000",i?"animate-ping":"opacity-15",v.replace("from-","bg-").split(" ")[0].replace("-400","-200")),style:{top:"80%",left:"70%",animationDelay:i?"1s":"unset"}})]}),e.jsxs(R,{className:"p-6 relative z-10",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:D("p-3 rounded-xl transition-all duration-500 shadow-lg",v.replace("from-","bg-").replace("-400","-100").split(" ")[0],v.replace("to-","text-").replace("-600","-600").split(" ")[1],i&&"rotate-12 scale-110"),children:e.jsx(w,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700 leading-tight",children:o}),t&&e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:t})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:D("text-3xl font-black transition-all duration-500",v.replace("to-","text-").replace("-600","-700").split(" ")[1],i&&"scale-110"),children:m(u)}),a!==void 0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:D("w-4 h-4 transition-colors duration-300",a>0?"text-green-600":a<0?"text-red-600":"text-slate-600")}),e.jsxs("span",{className:D("text-sm font-semibold",a>0?"text-green-600":a<0?"text-red-600":"text-slate-600"),children:[a>0?"+":"",a.toFixed(1),"%"]}),e.jsx("span",{className:"text-xs text-slate-500",children:"vs last period"})]})]})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(Pe,{className:"w-4 h-4 text-slate-400"})})]}),s==="percentage"&&e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"w-full bg-slate-200 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:D("h-2 rounded-full transition-all duration-1000 ease-out",v.replace("from-","bg-gradient-to-r from-").replace("to-","to-")),style:{width:i?`${Math.min(u,100)}%`:"0%",transitionDelay:"200ms"}})})})]})]})}),e.jsx(et,{side:"top",className:"max-w-xs",children:e.jsx("p",{className:"text-sm",children:r})})]})})};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(f,{id:"leadsReceived",title:"Leads Received",value:j.leadsReceived,icon:Z,color:"from-blue-400 to-blue-600",subtitle:"Total incoming leads",tooltip:"Total number of leads received in the selected period"}),e.jsx(f,{id:"trialsCompleted",title:"Trials Completed",value:j.trialsCompleted,icon:ae,color:"from-green-400 to-green-600",subtitle:"Successful trial sessions",tooltip:"Number of trial sessions that were successfully completed"}),e.jsx(f,{id:"trialsScheduled",title:"Trials Scheduled",value:j.trialsScheduled,icon:J,color:"from-purple-400 to-purple-600",subtitle:"Scheduled trial sessions",tooltip:"Total number of trial sessions scheduled"}),e.jsx(f,{id:"proximityIssues",title:"Proximity Issues",value:j.proximityIssues,icon:q,color:"from-red-400 to-red-600",subtitle:"Location-related concerns",tooltip:"Leads lost due to location or proximity concerns"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(f,{id:"convertedLeads",title:"Converted Leads",value:j.convertedLeads,icon:W,color:"from-emerald-400 to-emerald-600",subtitle:"Successfully converted",tooltip:"Number of leads successfully converted to paying members"}),e.jsx(f,{id:"trialToMemberRate",title:"Trial → Member Rate",value:j.trialToMemberConversion,icon:Q,color:"from-cyan-400 to-cyan-600",subtitle:"Trial conversion efficiency",format:"percentage",tooltip:"Percentage of completed trials that converted to memberships"}),e.jsx(f,{id:"leadToTrialRate",title:"Lead → Trial Rate",value:j.leadToTrialConversion,icon:ee,color:"from-indigo-400 to-indigo-600",subtitle:"Lead engagement rate",format:"percentage",tooltip:"Percentage of leads that scheduled and completed trials"}),e.jsx(f,{id:"leadToMemberRate",title:"Lead → Member Rate",value:j.leadToMemberConversion,icon:Ie,color:"from-yellow-400 to-yellow-600",subtitle:"Overall conversion rate",format:"percentage",tooltip:"Overall percentage of leads converted to paying members"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(f,{id:"avgLTV",title:"Average LTV",value:j.avgLTV,icon:te,color:"from-green-400 to-green-600",subtitle:"Lifetime value per lead",format:"currency",tooltip:"Average lifetime value generated per lead"}),e.jsx(f,{id:"avgVisitsPerLead",title:"Avg Visits/Lead",value:j.avgVisitsPerLead,icon:Ne,color:"from-orange-400 to-orange-600",subtitle:"Engagement frequency",tooltip:"Average number of visits per lead during the funnel process"}),e.jsx(f,{id:"pipelineHealth",title:"Pipeline Health",value:j.pipelineHealth,icon:j.pipelineHealth>=70?ae:j.pipelineHealth>=50?se:de,color:j.pipelineHealth>=70?"from-green-400 to-green-600":j.pipelineHealth>=50?"from-yellow-400 to-yellow-600":"from-red-400 to-red-600",subtitle:"Overall funnel performance",format:"percentage",tooltip:"Composite score based on conversion rates, engagement, and lead quality"})]})]})},yt=({data:l})=>{const[c,y]=k.useState("source"),[g,j]=k.useState("volume"),f=k.useMemo(()=>{if(!l||!l.length)return[];switch(c){case"source":{const v=l.reduce((t,a)=>{const s=a.source||"Unknown";return t[s]||(t[s]={name:s,leads:0,converted:0,totalLTV:0}),t[s].leads+=1,a.conversionStatus==="Converted"&&(t[s].converted+=1),t[s].totalLTV+=a.ltv||0,t},{});return Object.values(v).map(t=>({name:t.name,volume:t.leads,conversion:t.leads>0?t.converted/t.leads*100:0,ltv:t.leads>0?t.totalLTV/t.leads:0})).sort((t,a)=>a.volume-t.volume).slice(0,10)}case"stage":{const v=l.reduce((t,a)=>{const s=a.stage||"Unknown";return t[s]||(t[s]={name:s,leads:0,converted:0,totalLTV:0}),t[s].leads+=1,a.conversionStatus==="Converted"&&(t[s].converted+=1),t[s].totalLTV+=a.ltv||0,t},{});return Object.values(v).map(t=>({name:t.name,volume:t.leads,conversion:t.leads>0?t.converted/t.leads*100:0,ltv:t.leads>0?t.totalLTV/t.leads:0})).sort((t,a)=>a.volume-t.volume)}case"timeline":{const v=l.reduce((t,a)=>{if(!a.createdAt)return t;const s=new Date(a.createdAt);if(isNaN(s.getTime()))return t;const r=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}`;return t[r]||(t[r]={name:r,leads:0,converted:0,totalLTV:0}),t[r].leads+=1,a.conversionStatus==="Converted"&&(t[r].converted+=1),t[r].totalLTV+=a.ltv||0,t},{});return Object.values(v).map(t=>({name:t.name,volume:t.leads,conversion:t.leads>0?t.converted/t.leads*100:0,ltv:t.leads>0?t.totalLTV/t.leads:0})).sort((t,a)=>t.name.localeCompare(a.name)).slice(-12)}default:return[]}},[l,c]),n=k.useMemo(()=>{if(!l||!l.length)return[];const v=l.reduce((a,s)=>{const r=s.conversionStatus||"Unknown";return a[r]=(a[r]||0)+1,a},{}),t=["#10b981","#f59e0b","#ef4444","#8b5cf6","#06b6d4"];return Object.entries(v).map(([a,s],r)=>({name:a,value:s,percentage:(s/l.length*100).toFixed(1),color:t[r%t.length]})).sort((a,s)=>s.value-a.value)},[l]),o=()=>{switch(g){case"volume":return"Lead Volume";case"conversion":return"Conversion Rate (%)";case"ltv":return"Average LTV (₹)";default:return"Lead Volume"}},u=({active:v,payload:t,label:a})=>v&&t&&t.length?e.jsxs("div",{className:"bg-white p-4 border border-slate-200 rounded-lg shadow-xl backdrop-blur-sm",children:[e.jsx("p",{className:"font-semibold text-slate-800 mb-2",children:a}),e.jsxs("p",{className:"text-sm text-slate-600",children:[o(),": ",g==="ltv"?I(t[0].value):g==="conversion"?`${t[0].value.toFixed(1)}%`:t[0].value.toLocaleString("en-IN")]})]}):null,w=({active:v,payload:t})=>{if(v&&t&&t.length){const a=t[0].payload;return e.jsxs("div",{className:"bg-white p-4 border border-slate-200 rounded-lg shadow-xl backdrop-blur-sm",children:[e.jsx("p",{className:"font-semibold text-slate-800 mb-2",children:a.name}),e.jsxs("p",{className:"text-sm text-slate-600",children:["Count: ",a.value.toLocaleString("en-IN")," (",a.percentage,"%)"]})]})}return null};return!l||!l.length?e.jsx(V,{className:"w-full bg-white/90 backdrop-blur-sm border-0 shadow-xl",children:e.jsx(R,{className:"p-12",children:e.jsxs("div",{className:"text-center py-8 text-slate-500",children:[e.jsx(K,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"No data available for charts"}),e.jsx("p",{className:"text-sm",children:"Adjust your filters to see analytics"})]})})}):e.jsxs("div",{className:"space-y-8",children:[e.jsxs(V,{className:"w-full bg-white/95 backdrop-blur-sm border-0 shadow-2xl overflow-hidden",children:[e.jsxs(P,{className:"bg-gradient-to-r from-slate-900 via-blue-900 to-indigo-900 text-white border-0",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs(H,{className:"flex items-center gap-3 text-white text-xl font-bold",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-xl backdrop-blur-sm",children:e.jsx(K,{className:"w-6 h-6 text-white"})}),c==="source"?"Lead Source Analytics":c==="stage"?"Funnel Stage Analytics":"Timeline Trend Analysis"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(G,{variant:c==="source"?"secondary":"outline",size:"sm",onClick:()=>y("source"),className:D("text-xs font-semibold transition-all duration-200",c==="source"?"bg-white/30 text-white border-white/40 hover:bg-white/40":"bg-white/10 text-white/80 border-white/20 hover:bg-white/20"),children:[e.jsx(Z,{className:"w-3 h-3 mr-1"}),"Sources"]}),e.jsxs(G,{variant:c==="stage"?"secondary":"outline",size:"sm",onClick:()=>y("stage"),className:D("text-xs font-semibold transition-all duration-200",c==="stage"?"bg-white/30 text-white border-white/40 hover:bg-white/40":"bg-white/10 text-white/80 border-white/20 hover:bg-white/20"),children:[e.jsx(W,{className:"w-3 h-3 mr-1"}),"Stages"]}),e.jsxs(G,{variant:c==="timeline"?"secondary":"outline",size:"sm",onClick:()=>y("timeline"),className:D("text-xs font-semibold transition-all duration-200",c==="timeline"?"bg-white/30 text-white border-white/40 hover:bg-white/40":"bg-white/10 text-white/80 border-white/20 hover:bg-white/20"),children:[e.jsx(J,{className:"w-3 h-3 mr-1"}),"Timeline"]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-4",children:[e.jsx(M,{variant:g==="volume"?"secondary":"outline",className:D("cursor-pointer transition-all duration-200 hover:scale-105",g==="volume"?"bg-white/30 text-white border-white/40":"bg-white/10 text-white/70 border-white/30 hover:bg-white/20"),onClick:()=>j("volume"),children:"Volume"}),e.jsx(M,{variant:g==="conversion"?"secondary":"outline",className:D("cursor-pointer transition-all duration-200 hover:scale-105",g==="conversion"?"bg-white/30 text-white border-white/40":"bg-white/10 text-white/70 border-white/30 hover:bg-white/20"),onClick:()=>j("conversion"),children:"Conversion"}),e.jsx(M,{variant:g==="ltv"?"secondary":"outline",className:D("cursor-pointer transition-all duration-200 hover:scale-105",g==="ltv"?"bg-white/30 text-white border-white/40":"bg-white/10 text-white/70 border-white/30 hover:bg-white/20"),onClick:()=>j("ltv"),children:"LTV"})]})]}),e.jsx(R,{className:"p-8 bg-gradient-to-br from-slate-50 to-white",children:e.jsxs("div",{className:"h-96 relative",children:[e.jsx("div",{className:"absolute top-0 right-0 text-xs text-slate-500 font-medium",children:o()}),e.jsx(ue,{width:"100%",height:"100%",children:c==="timeline"?e.jsxs(lt,{data:f,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"lineGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#dc2626",stopOpacity:.4}),e.jsx("stop",{offset:"50%",stopColor:"#ea580c",stopOpacity:.2}),e.jsx("stop",{offset:"95%",stopColor:"#f97316",stopOpacity:.1})]})}),e.jsx(ge,{strokeDasharray:"2 4",stroke:"#f1f5f9"}),e.jsx(ve,{dataKey:"name",stroke:"#475569",fontSize:11,fontWeight:500,tickFormatter:v=>String(v).slice(-5)}),e.jsx(pe,{stroke:"#475569",fontSize:11,fontWeight:500}),e.jsx(oe,{content:e.jsx(u,{})}),e.jsx(nt,{type:"monotone",dataKey:g,stroke:"#dc2626",strokeWidth:4,dot:{fill:"#dc2626",strokeWidth:3,r:6},activeDot:{r:10,fill:"#b91c1c",stroke:"#ffffff",strokeWidth:3},fill:"url(#lineGradient)"})]}):e.jsxs(ot,{data:f,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"barGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#dc2626",stopOpacity:.9}),e.jsx("stop",{offset:"50%",stopColor:"#ea580c",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#f97316",stopOpacity:.7})]})}),e.jsx(ge,{strokeDasharray:"2 4",stroke:"#f1f5f9"}),e.jsx(ve,{dataKey:"name",stroke:"#475569",fontSize:11,fontWeight:500,angle:-45,textAnchor:"end",height:80}),e.jsx(pe,{stroke:"#475569",fontSize:11,fontWeight:500}),e.jsx(oe,{content:e.jsx(u,{})}),e.jsx(it,{dataKey:g,fill:"url(#barGradient)",radius:[8,8,0,0]})]})})]})})]}),e.jsxs(V,{className:"w-full bg-white/95 backdrop-blur-sm border-0 shadow-2xl overflow-hidden",children:[e.jsx(P,{className:"bg-gradient-to-r from-orange-800 via-red-800 to-red-900 text-white border-0",children:e.jsxs(H,{className:"flex items-center gap-3 text-white text-xl font-bold",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-xl backdrop-blur-sm",children:e.jsx(He,{className:"w-6 h-6 text-white"})}),"Conversion Status Distribution"]})}),e.jsx(R,{className:"p-8 bg-gradient-to-br from-slate-50 to-white",children:e.jsx("div",{className:"h-96",children:e.jsx(ue,{width:"100%",height:"100%",children:e.jsxs(ct,{children:[e.jsx(dt,{data:n,cx:"50%",cy:"50%",innerRadius:90,outerRadius:150,paddingAngle:4,dataKey:"value",animationBegin:0,animationDuration:1500,children:n.map((v,t)=>e.jsx(mt,{fill:v.color,stroke:"#ffffff",strokeWidth:3},`cell-${t}`))}),e.jsx(oe,{content:e.jsx(w,{})}),e.jsx(xt,{verticalAlign:"bottom",height:70,wrapperStyle:{fontSize:"14px",fontWeight:600},formatter:(v,t)=>e.jsxs("span",{style:{color:t.color,fontWeight:700},children:[v," (",t.payload.percentage,"%)"]})})]})})})})]})]})},wt=({data:l})=>{const[c,y]=k.useState("total"),[g,j]=k.useState("desc"),[f,n]=k.useState(null),[o,u]=k.useState(8),w=x=>{c===x?j(g==="asc"?"desc":"asc"):(y(x),j("desc"))},v=x=>new Intl.NumberFormat().format(x),t=x=>`${x>=0?"+":""}${x.toFixed(1)}%`,a=x=>x>0?e.jsx(Q,{className:"w-3 h-3 text-green-500"}):x<0?e.jsx(Ee,{className:"w-3 h-3 text-red-500"}):e.jsx(Oe,{className:"w-3 h-3 text-gray-400"}),s=x=>x>10||x>0?"text-green-600 bg-green-50":x<-10||x<0?"text-red-600 bg-red-50":"text-gray-600 bg-gray-50",r=k.useMemo(()=>{const x=new Map;return l.forEach(h=>{const b=h.source||"Unknown";x.has(b)||x.set(b,{source:b,months:new Map,total:0});const L=x.get(b),A=`${h.year}-${String(h.month).padStart(2,"0")}`;L.months.set(A,{leads:h.total_leads||0,conversions:h.total_conversions||0,conversionRate:h.conversion_rate||0}),L.total+=h.total_leads||0}),Array.from(x.values()).map(h=>{const b=Array.from(h.months.entries()).sort(),L=b[b.length-1],A=b[b.length-2];let p=0;if(L&&A){const E=L[1].leads,T=A[1].leads;T>0&&(p=(E-T)/T*100)}return z(Y({},h),{recentLeads:L?L[1].leads:0,monthOnMonthGrowth:p,months:h.months})}).sort((h,b)=>c==="source"?g==="asc"?h.source.localeCompare(b.source):b.source.localeCompare(h.source):c==="total"?g==="asc"?h.total-b.total:b.total-h.total:g==="asc"?h.recentLeads-b.recentLeads:b.recentLeads-h.recentLeads)},[l,c,g]),m=k.useMemo(()=>{const x=new Set;return l.forEach(h=>{const b=`${h.year}-${String(h.month).padStart(2,"0")}`;x.add(b)}),Array.from(x).sort()},[l]),i=r.slice(0,o),d={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.6}}},N={hidden:{opacity:0,y:-10},visible:{opacity:1,y:0,transition:{duration:.4,delay:.2}}},S={hidden:{opacity:0,x:-20},visible:{opacity:1,x:0,transition:{duration:.4}}};return e.jsx(F.div,{variants:d,initial:"hidden",animate:"visible",className:"w-full",children:e.jsxs(V,{className:"w-full bg-gradient-to-br from-white via-red-50/30 to-red-100/40 backdrop-blur-sm border-red-200/50 shadow-xl shadow-red-100/20",children:[e.jsxs(P,{className:"pb-4",children:[e.jsxs(F.div,{variants:N,className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-red-500 to-red-600 rounded-lg shadow-lg",children:e.jsx(K,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Funnel Source Performance"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Month-on-month lead generation by source"})]})]}),e.jsxs(M,{variant:"outline",className:"bg-gradient-to-r from-red-500/10 to-orange-500/10 text-red-700 border-red-300/50 backdrop-blur-sm",children:[e.jsx(J,{className:"w-3 h-3 mr-1"}),"Historical Analysis"]})]}),e.jsxs(F.div,{variants:N,className:"flex items-center gap-2 text-xs text-slate-600 mt-2",children:[e.jsx(ce,{className:"w-3 h-3"}),e.jsxs("span",{children:["Showing ",r.length," sources across ",m.length," months"]})]})]}),e.jsxs(R,{className:"pt-0",children:[e.jsx(F.div,{className:"overflow-x-auto",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-red-200/50",children:[e.jsx("th",{className:"text-left py-3 px-4",children:e.jsxs(G,{variant:"ghost",size:"sm",onClick:()=>w("source"),className:"hover:bg-red-50/50 font-medium text-gray-700",children:["Source",c==="source"&&(g==="asc"?e.jsx(le,{className:"w-4 h-4 ml-1"}):e.jsx(ne,{className:"w-4 h-4 ml-1"}))]})}),e.jsx("th",{className:"text-right py-3 px-4",children:e.jsxs(G,{variant:"ghost",size:"sm",onClick:()=>w("total"),className:"hover:bg-red-50/50 font-medium text-gray-700",children:["Total Leads",c==="total"&&(g==="asc"?e.jsx(le,{className:"w-4 h-4 ml-1"}):e.jsx(ne,{className:"w-4 h-4 ml-1"}))]})}),e.jsx("th",{className:"text-right py-3 px-4",children:e.jsxs(G,{variant:"ghost",size:"sm",onClick:()=>w("recent"),className:"hover:bg-red-50/50 font-medium text-gray-700",children:["Recent Month",c==="recent"&&(g==="asc"?e.jsx(le,{className:"w-4 h-4 ml-1"}):e.jsx(ne,{className:"w-4 h-4 ml-1"}))]})}),e.jsx("th",{className:"text-right py-3 px-4 font-medium text-gray-700",children:"Month-on-Month"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:e.jsx(be,{children:i.map((x,h)=>e.jsxs(ye.Fragment,{children:[e.jsxs(F.tr,{variants:S,initial:"hidden",animate:"visible",exit:"hidden",className:"hover:bg-red-50/30 transition-colors duration-200 border-b border-red-100/30",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"font-medium text-gray-900",children:x.source})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsx("span",{className:"font-medium text-gray-900",children:v(x.total)})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsx("span",{className:"font-medium text-gray-900",children:v(x.recentLeads)})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[a(x.monthOnMonthGrowth),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s(x.monthOnMonthGrowth)}`,children:t(x.monthOnMonthGrowth)})]})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx(G,{variant:"ghost",size:"sm",onClick:()=>n(f===x.source?null:x.source),className:"hover:bg-red-50/50",children:e.jsx(Ne,{className:"w-4 h-4"})})})]}),e.jsx(be,{children:f===x.source&&e.jsx(F.tr,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},children:e.jsx("td",{colSpan:5,className:"py-4 px-4 bg-gradient-to-r from-red-50/30 to-orange-50/30",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:m.slice(-6).map(b=>{const L=x.months.get(b);return L?e.jsxs(F.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2},className:"p-3 bg-white rounded-lg border border-red-200/30 shadow-sm",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:new Date(b+"-01").toLocaleDateString("en-US",{month:"short",year:"numeric"})}),e.jsxs("div",{className:"text-lg font-semibold text-gray-900",children:[v(L.leads)," leads"]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[L.conversions," conversions (",L.conversionRate.toFixed(1),"%)"]})]},b):null})})})})})]},x.source))})})]})}),r.length>o&&e.jsx(F.div,{className:"mt-4 text-center",initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},children:e.jsx(G,{variant:"outline",onClick:()=>u(x=>x>=r.length?8:r.length),className:"border-red-200 text-red-700 hover:bg-red-50",children:o>=r.length?"Show Less":`Show All (${r.length})`})})]})]})})},Lt=({allData:l,onDrillDown:c})=>{var m;const[y,g]=k.useState("totalLeads"),j={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.6}}},f={hidden:{opacity:0,y:-10},visible:{opacity:1,y:0,transition:{duration:.4,delay:.2}}},n=k.useMemo(()=>{if(!l.length)return[];const i=l.reduce((h,b)=>{var A;const L=b.source||"Unknown";if(h[L]||(h[L]={}),b.createdAt){const p=new Date(b.createdAt),E=p.getFullYear(),T=p.getMonth()+1,B=`${E}-${String(T).padStart(2,"0")}`;h[L][B]||(h[L][B]={totalLeads:0,trialsCompleted:0,trialsScheduled:0,proximityIssues:0,convertedLeads:0,totalLTV:0,totalVisits:0});const O=h[L][B];O.totalLeads+=1,b.stage==="Trial Completed"&&(O.trialsCompleted+=1),(A=b.stage)!=null&&A.includes("Trial")&&(O.trialsScheduled+=1),b.stage==="Proximity Issues"&&(O.proximityIssues+=1),b.conversionStatus==="Converted"&&(O.convertedLeads+=1),O.totalLTV+=b.ltv||0,O.totalVisits+=b.visits||0}return h},{}),d=new Date,N=d.getFullYear(),S=d.getMonth()+1,x=[];for(let h=S;h>=1;h--){const b=new Date(2025,h-1).toLocaleString("default",{month:"short"});x.push({month:h,name:b,current:`${N}-${String(h).padStart(2,"0")}`,previous:`${N-1}-${String(h).padStart(2,"0")}`})}return Object.keys(i).map(h=>{const b=i[h],L={source:h};return x.forEach(A=>{const p=b[A.current]||{totalLeads:0,trialsCompleted:0,trialsScheduled:0,proximityIssues:0,convertedLeads:0,totalLTV:0,totalVisits:0},E=b[A.previous]||{totalLeads:0,trialsCompleted:0,trialsScheduled:0,proximityIssues:0,convertedLeads:0,totalLTV:0,totalVisits:0},T=C=>{const re=C.trialsCompleted>0?C.convertedLeads/C.trialsCompleted*100:0,Te=C.totalLeads>0?C.trialsCompleted/C.totalLeads*100:0,Se=C.totalLeads>0?C.convertedLeads/C.totalLeads*100:0,Ce=C.totalLeads>0?C.totalLTV/C.totalLeads:0,ke=C.totalLeads>0?C.totalVisits/C.totalLeads:0,Ve=C.totalLeads>0?(C.totalLeads-C.proximityIssues)/C.totalLeads*100:0;return{totalLeads:C.totalLeads,trialsCompleted:C.trialsCompleted,trialsScheduled:C.trialsScheduled,proximityIssues:C.proximityIssues,convertedLeads:C.convertedLeads,trialToMemberRate:re,leadToTrialRate:Te,leadToMemberRate:Se,ltv:Ce,avgVisits:ke,pipelineHealth:Ve}},B=T(p),O=T(E);L[`${A.name}_${N}`]=B,L[`${A.name}_${N-1}`]=O}),L}).filter(h=>x.some(b=>{var L,A;return((L=h[`${b.name}_${N}`])==null?void 0:L.totalLeads)>0||((A=h[`${b.name}_${N-1}`])==null?void 0:A.totalLeads)>0}))},[l]),o=k.useMemo(()=>{const i=new Date,d=i.getFullYear(),N=i.getMonth()+1,S=[];for(let h=N;h>=1;h--){const b=new Date(2025,h-1).toLocaleString("default",{month:"short"});S.push({month:h,name:b})}const x={source:"TOTALS"};return S.forEach(h=>{const b=n.reduce((p,E)=>{const T=E[`${h.name}_${d}`]||{};return p.totalLeads+=T.totalLeads||0,p.trialsCompleted+=T.trialsCompleted||0,p.trialsScheduled+=T.trialsScheduled||0,p.proximityIssues+=T.proximityIssues||0,p.convertedLeads+=T.convertedLeads||0,p.totalLTV+=(T.ltv||0)*(T.totalLeads||0),p.totalVisits+=(T.avgVisits||0)*(T.totalLeads||0),p},{totalLeads:0,trialsCompleted:0,trialsScheduled:0,proximityIssues:0,convertedLeads:0,totalLTV:0,totalVisits:0}),L=n.reduce((p,E)=>{const T=E[`${h.name}_${d-1}`]||{};return p.totalLeads+=T.totalLeads||0,p.trialsCompleted+=T.trialsCompleted||0,p.trialsScheduled+=T.trialsScheduled||0,p.proximityIssues+=T.proximityIssues||0,p.convertedLeads+=T.convertedLeads||0,p.totalLTV+=(T.ltv||0)*(T.totalLeads||0),p.totalVisits+=(T.avgVisits||0)*(T.totalLeads||0),p},{totalLeads:0,trialsCompleted:0,trialsScheduled:0,proximityIssues:0,convertedLeads:0,totalLTV:0,totalVisits:0}),A=p=>{const E=p.trialsCompleted>0?p.convertedLeads/p.trialsCompleted*100:0,T=p.totalLeads>0?p.trialsCompleted/p.totalLeads*100:0,B=p.totalLeads>0?p.convertedLeads/p.totalLeads*100:0,O=p.totalLeads>0?p.totalLTV/p.totalLeads:0,C=p.totalLeads>0?p.totalVisits/p.totalLeads:0,re=p.totalLeads>0?(p.totalLeads-p.proximityIssues)/p.totalLeads*100:0;return{totalLeads:p.totalLeads,trialsCompleted:p.trialsCompleted,trialsScheduled:p.trialsScheduled,proximityIssues:p.proximityIssues,convertedLeads:p.convertedLeads,trialToMemberRate:E,leadToTrialRate:T,leadToMemberRate:B,ltv:O,avgVisits:C,pipelineHealth:re}};x[`${h.name}_${d}`]=A(b),x[`${h.name}_${d-1}`]=A(L)}),x},[n]),u=(i,d)=>{if(typeof i!="object"||!i)return"-";const N=i[d];if(N===void 0||N===0)return"-";switch(d){case"ltv":return N<1e3?`₹${Math.round(N)}`:I(N);case"trialToMemberRate":case"leadToTrialRate":case"leadToMemberRate":case"pipelineHealth":return`${N.toFixed(1)}%`;case"avgVisits":return N.toFixed(1);default:return N.toLocaleString("en-IN")}},w=[{value:"totalLeads",label:"Total Leads"},{value:"trialsCompleted",label:"Trials Completed"},{value:"trialsScheduled",label:"Trials Scheduled"},{value:"proximityIssues",label:"Proximity Issues"},{value:"convertedLeads",label:"Converted Leads"},{value:"trialToMemberRate",label:"Trial → Member Rate"},{value:"leadToTrialRate",label:"Lead → Trial Rate"},{value:"leadToMemberRate",label:"Lead → Member Rate"},{value:"ltv",label:"Average LTV"},{value:"avgVisits",label:"Avg Visits/Lead"},{value:"pipelineHealth",label:"Pipeline Health"}],v=new Date,t=v.getFullYear(),a=v.getMonth()+1,s=[];for(let i=a;i>=1;i--){const d=new Date(2025,i-1).toLocaleString("default",{month:"short"});s.push({month:i,name:d})}const r=[{key:"source",header:"Source",render:i=>e.jsx("div",{className:"font-semibold text-slate-800 min-w-[120px] truncate",children:i}),align:"left"},...s.flatMap(i=>[{key:`${i.name}_${t}`,header:`${i.name} ${t}`,render:d=>e.jsx("div",{className:"text-center font-medium text-xs my-0 py-0 mx-[20px]",children:u(d,y)}),align:"center"},{key:`${i.name}_${t-1}`,header:`${i.name} ${t-1}`,render:(d,N)=>{const S=N[`${i.name}_${t}`],x=d;let h=null;if(S&&x){const b=S[y],L=x[y];b&&L&&L!==0&&(h=(b-L)/L*100)}return e.jsxs("div",{className:"text-center group",children:[e.jsx("div",{className:"font-medium text-slate-600 text-xs text-center mx-[20px]",children:u(d,y)}),h!==null&&Math.abs(h)>.1]})},align:"center"}])];return e.jsx(F.div,{variants:j,initial:"hidden",animate:"visible",className:"w-full",children:e.jsxs(V,{className:"w-full bg-gradient-to-br from-white via-red-50/30 to-red-100/40 backdrop-blur-sm border-red-200/50 shadow-xl shadow-red-100/20",children:[e.jsxs(P,{className:"pb-4",children:[e.jsxs(F.div,{variants:f,className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-red-500 to-red-600 rounded-lg shadow-lg",children:e.jsx(K,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Year-on-Year Source Performance"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Historical comparison across years by source"})]})]}),e.jsxs(M,{variant:"outline",className:"bg-gradient-to-r from-red-500/10 to-orange-500/10 text-red-700 border-red-300/50 backdrop-blur-sm",children:[e.jsx(J,{className:"w-3 h-3 mr-1"}),"Historical Analysis"]})]}),e.jsxs(F.div,{variants:f,className:"flex items-center gap-2 text-xs text-slate-600 mt-2",children:[e.jsx(ce,{className:"w-3 h-3"}),e.jsxs("span",{children:["Showing ",n.length," sources across ",s.length," months"]})]})]}),e.jsxs(R,{className:"pt-0",children:[e.jsxs(F.div,{className:"p-4 mb-4 border border-red-200/50 rounded-lg bg-gradient-to-r from-red-50/30 to-orange-50/30 backdrop-blur-sm",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},children:[e.jsx(we,{value:y,onValueChange:i=>g(i),children:e.jsx(Le,{className:"grid w-full grid-cols-4 lg:grid-cols-6 gap-1 h-auto p-1 bg-white/80 backdrop-blur-sm",children:w.map(i=>e.jsx(_,{value:i.value,className:"text-xs p-2 data-[state=active]:bg-gradient-to-r data-[state=active]:from-red-500 data-[state=active]:to-red-600 data-[state=active]:text-white transition-all duration-200",children:i.label},i.value))})}),e.jsx("div",{className:"mt-3 flex items-center gap-2",children:e.jsxs(M,{variant:"outline",className:"bg-gradient-to-r from-red-500/10 to-orange-500/10 text-red-700 border-red-300/50",children:[e.jsx(K,{className:"w-3 h-3 mr-1"}),(m=w.find(i=>i.value===y))==null?void 0:m.label]})})]}),e.jsx(F.div,{className:"max-h-[500px] overflow-auto rounded-lg border border-red-200/50",initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},children:e.jsx(U,{data:n,columns:r,loading:!1,stickyHeader:!0,showFooter:!0,footerData:o,maxHeight:"400px",className:"rounded-lg",headerGradient:"from-red-500 to-red-600",onRowClick:i=>{const d=l.filter(N=>N.source===i.source);c==null||c(`Source: ${i.source} - Year Analysis`,d,"year-source")}})})]})]})})},Tt=({data:l})=>{const c=k.useMemo(()=>{if(!l||l.length===0)return{sources:[],stages:[]};const g=new Map;l.forEach(o=>{const u=o.source||"Unknown";g.has(u)||g.set(u,{name:u,count:0,converted:0,revenue:0,conversionRate:0});const w=g.get(u);w.count+=1,o.conversionStatus==="Converted"&&(w.converted+=1),w.revenue+=o.ltv||0});const j=Array.from(g.values()).map(o=>z(Y({},o),{conversionRate:o.count>0?o.converted/o.count*100:0,avgRevenue:o.count>0?o.revenue/o.count:0})).sort((o,u)=>u.count-o.count),f=new Map;l.forEach(o=>{const u=o.stage||"Unknown";f.has(u)||f.set(u,{name:u,count:0,converted:0,revenue:0,conversionRate:0});const w=f.get(u);w.count+=1,o.conversionStatus==="Converted"&&(w.converted+=1),w.revenue+=o.ltv||0});const n=Array.from(f.values()).map(o=>z(Y({},o),{conversionRate:o.count>0?o.converted/o.count*100:0,avgRevenue:o.count>0?o.revenue/o.count:0,percentage:o.count>0?o.count/l.length*100:0})).sort((o,u)=>u.count-o.count);return{sources:j,stages:n}},[l]);l!=null&&l.length;const y=({title:g,items:j,type:f,icon:n,gradient:o})=>e.jsx(F.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs(V,{className:"bg-white/95 backdrop-blur-sm shadow-xl border-0 overflow-hidden h-full",children:[e.jsx(P,{className:`bg-gradient-to-r ${o} text-white`,children:e.jsxs(H,{className:"flex items-center gap-3 text-lg font-bold",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-xl",children:e.jsx(n,{className:"w-5 h-5"})}),g]})}),e.jsx(R,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-slate-800 mb-3 flex items-center gap-2",children:[e.jsx(Ge,{className:"w-4 h-4 text-yellow-500"}),"Top Performers"]}),e.jsx("div",{className:"space-y-3",children:j.slice(0,5).map((u,w)=>e.jsxs(F.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:w*.1},className:"flex items-center justify-between p-3 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(M,{variant:"secondary",className:`
                          ${w===0?"bg-yellow-100 text-yellow-800 border-yellow-300":""}
                          ${w===1?"bg-gray-100 text-gray-800 border-gray-300":""}
                          ${w===2?"bg-orange-100 text-orange-800 border-orange-300":""}
                          ${w>2?"bg-blue-100 text-blue-800 border-blue-300":""}
                        `,children:["#",w+1]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-slate-800 text-sm",children:u.name}),e.jsxs("div",{className:"text-xs text-slate-500",children:[u.conversionRate.toFixed(1),"% conversion"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-bold text-green-700 text-lg",children:$(u.count)}),e.jsx("div",{className:"text-xs text-slate-500",children:f==="stage"?`${u.percentage.toFixed(1)}% of funnel`:I(u.avgRevenue)})]})]},`top-${u.name}`))})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-slate-800 mb-3 flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-red-500"}),"Needs Attention"]}),e.jsx("div",{className:"space-y-3",children:j.slice(-3).reverse().map((u,w)=>e.jsxs(F.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:w*.1},className:"flex items-center justify-between p-3 bg-gradient-to-r from-red-50 to-pink-50 rounded-xl border border-red-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(M,{variant:"destructive",className:"bg-red-100 text-red-800 border-red-300",children:["#",j.length-2+w]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-slate-800 text-sm",children:u.name}),e.jsxs("div",{className:"text-xs text-slate-500",children:[u.conversionRate.toFixed(1),"% conversion"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-bold text-red-700 text-lg",children:$(u.count)}),e.jsx("div",{className:"text-xs text-slate-500",children:f==="stage"?`${u.percentage.toFixed(1)}% of funnel`:I(u.avgRevenue)})]})]},`bottom-${u.name}`))})]}),e.jsxs("div",{className:"mt-6 p-4 bg-slate-50 rounded-xl",children:[e.jsxs("h4",{className:"font-bold text-slate-800 mb-3 flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4 text-indigo-600"}),"Performance Overview"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-indigo-600",children:j.length}),e.jsxs("div",{className:"text-xs text-slate-600",children:["Total ",f==="source"?"Sources":"Stages"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[(j.reduce((u,w)=>u+w.conversionRate,0)/j.length).toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-slate-600",children:"Avg Conversion"})]})]})]})]})})]})});return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(F.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},children:e.jsx(V,{className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white",children:e.jsxs(R,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:c.sources.length}),e.jsx("div",{className:"text-sm text-blue-100",children:"Active Sources"})]})})}),e.jsx(F.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.1},children:e.jsx(V,{className:"bg-gradient-to-br from-purple-500 to-purple-600 text-white",children:e.jsxs(R,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:c.stages.length}),e.jsx("div",{className:"text-sm text-purple-100",children:"Funnel Stages"})]})})}),e.jsx(F.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.2},children:e.jsx(V,{className:"bg-gradient-to-br from-green-500 to-green-600 text-white",children:e.jsxs(R,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-xl font-bold",children:I(c.sources.reduce((g,j)=>g+j.revenue,0))}),e.jsx("div",{className:"text-sm text-green-100",children:"Total Revenue"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsx(y,{title:"Lead Source Rankings",items:c.sources,type:"source",icon:Z,gradient:"from-blue-600 to-indigo-700"}),e.jsx(y,{title:"Funnel Stage Rankings",items:c.stages,type:"stage",icon:W,gradient:"from-purple-600 to-pink-700"})]})]})},St=({data:l})=>{const c=k.useMemo(()=>{if(!l.length)return[];const n=l.length,o=l.filter(r=>{var m;return(m=r.stage)==null?void 0:m.includes("Trial")}).length,u=l.filter(r=>r.stage==="Trial Completed").length,w=l.filter(r=>r.conversionStatus==="Converted").length;l.filter(r=>r.status==="Lost").length;const v=l.filter(r=>r.stage==="Proximity Issues").length,t=l.filter(r=>r.followUp1Date||r.followUp2Date||r.followUp3Date).length,a=l.reduce((r,m)=>r+(m.ltv||0),0),s=l.reduce((r,m)=>r+(m.visits||0),0);return[{metric:"Lead Volume Health",value:n,benchmark:1e3,status:n>=1e3?"Excellent":n>=500?"Good":"Needs Attention",description:"Total leads generated in period"},{metric:"Trial Scheduling Rate",value:n>0?o/n*100:0,benchmark:60,status:o/n*100>=60?"Excellent":o/n*100>=40?"Good":"Needs Attention",description:"Percentage of leads scheduling trials"},{metric:"Trial Completion Rate",value:o>0?u/o*100:0,benchmark:80,status:u/o*100>=80?"Excellent":u/o*100>=60?"Good":"Needs Attention",description:"Trials completed vs scheduled"},{metric:"Conversion Efficiency",value:n>0?w/n*100:0,benchmark:25,status:w/n*100>=25?"Excellent":w/n*100>=15?"Good":"Needs Attention",description:"Overall lead to member conversion"},{metric:"Proximity Issue Rate",value:n>0?v/n*100:0,benchmark:10,status:v/n*100<=10?"Excellent":v/n*100<=20?"Good":"Needs Attention",description:"Leads lost due to location issues"},{metric:"Follow-up Coverage",value:n>0?t/n*100:0,benchmark:70,status:t/n*100>=70?"Excellent":t/n*100>=50?"Good":"Needs Attention",description:"Leads receiving follow-up actions"},{metric:"Average LTV",value:n>0?a/n:0,benchmark:5e3,status:a/n>=5e3?"Excellent":a/n>=3e3?"Good":"Needs Attention",description:"Revenue quality per lead"},{metric:"Engagement Level",value:n>0?s/n:0,benchmark:3,status:s/n>=3?"Excellent":s/n>=2?"Good":"Needs Attention",description:"Average visits per lead"}]},[l]),y=n=>n.metric.includes("Rate")||n.metric.includes("Coverage")||n.metric.includes("Efficiency")?`${n.value.toFixed(1)}%`:n.metric.includes("LTV")?I(n.value):n.metric.includes("Volume")?$(n.value):n.value.toFixed(1),g=n=>{switch(n){case"Excellent":return e.jsx(M,{className:"w-24 justify-center bg-green-600 text-white hover:bg-green-700 font-bold",children:"Excellent"});case"Good":return e.jsx(M,{className:"w-24 justify-center bg-yellow-500 text-white hover:bg-yellow-600 font-bold",children:"Good"});default:return e.jsx(M,{className:"w-24 justify-center bg-red-600 text-white hover:bg-red-700 font-bold",children:"Needs Fix"})}},j=[{key:"metric",header:"Health Metric",render:n=>e.jsx("div",{className:"font-semibold text-slate-800 min-w-[200px] text-left",children:n}),align:"left"},{key:"value",header:"Current Value",render:(n,o)=>e.jsx("div",{className:"text-center font-bold text-blue-600",children:y(o)}),align:"center"},{key:"benchmark",header:"Benchmark",render:(n,o)=>e.jsx("div",{className:"text-center font-medium text-slate-600",children:o.metric.includes("Rate")||o.metric.includes("Coverage")||o.metric.includes("Efficiency")?`${n}%`:o.metric.includes("LTV")?I(n):n.toLocaleString("en-IN")}),align:"center"},{key:"status",header:"Status",render:n=>e.jsx("div",{className:"text-center",children:g(n)}),align:"center"},{key:"description",header:"Description",render:n=>e.jsx("div",{className:"text-sm text-slate-600 max-w-[200px]",children:n}),align:"left"}],f=k.useMemo(()=>{const n=c.map(o=>{switch(o.status){case"Excellent":return 100;case"Good":return 70;default:return 30}});return n.length>0?Math.round(n.reduce((o,u)=>o+u,0)/n.length):0},[c]);return e.jsxs(V,{className:"w-full bg-white/90 backdrop-blur-sm border-0 shadow-xl",children:[e.jsx(P,{className:"bg-gradient-to-r from-red-50 to-pink-50 border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(H,{className:"flex items-center gap-2 text-slate-800",children:[e.jsx(Ue,{className:"w-6 h-6 text-red-600 animate-pulse"}),"Funnel Health Metrics"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-slate-600",children:"Overall Health:"}),e.jsxs(M,{className:D("text-lg px-4 py-2 font-black",f>=85?"bg-green-600 text-white":f>=70?"bg-yellow-500 text-white":"bg-red-600 text-white"),children:[f,"%"]})]})]})}),e.jsxs(R,{className:"p-0",children:[e.jsx("div",{className:"max-h-[600px] overflow-auto",children:e.jsx(U,{data:c,columns:j,loading:!1,stickyHeader:!0,maxHeight:"500px",className:"rounded-none"})}),e.jsxs("div",{className:"p-6 bg-slate-50 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ae,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"font-semibold text-slate-800",children:"Health Assessment"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ae,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"font-semibold text-green-800",children:"Strengths"})]}),e.jsxs("div",{className:"text-sm text-green-600",children:[c.filter(n=>n.status==="Excellent").length," metrics excellent"]})]}),e.jsxs("div",{className:"p-4 bg-yellow-50 rounded-lg border border-yellow-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Q,{className:"w-4 h-4 text-yellow-600"}),e.jsx("span",{className:"font-semibold text-yellow-800",children:"Opportunities"})]}),e.jsxs("div",{className:"text-sm text-yellow-600",children:[c.filter(n=>n.status==="Good").length," metrics good"]})]}),e.jsxs("div",{className:"p-4 bg-red-50 rounded-lg border border-red-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ye,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"font-semibold text-red-800",children:"Action Needed"})]}),e.jsxs("div",{className:"text-sm text-red-600",children:[c.filter(n=>n.status==="Needs Attention").length," metrics need attention"]})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-white rounded-lg border",children:[e.jsx("h4",{className:"font-semibold text-slate-800 mb-2",children:"Quick Recommendations:"}),e.jsxs("ul",{className:"text-sm text-slate-600 space-y-1",children:[f<70&&e.jsx("li",{children:"• Focus on improving trial completion rates"}),c.find(n=>n.metric==="Proximity Issue Rate"&&n.status==="Needs Attention")&&e.jsx("li",{children:"• Address location accessibility concerns"}),c.find(n=>n.metric==="Follow-up Coverage"&&n.status==="Needs Attention")&&e.jsx("li",{children:"• Implement systematic follow-up processes"}),f>=85&&e.jsx("li",{children:"• Excellent funnel health - maintain current strategies"})]})]})]})]})]})},Ct=({data:l,onDrillDown:c})=>{const[y,g]=k.useState(null),j=k.useMemo(()=>{const t=l.reduce((a,s)=>{var m,i;const r=s.source||"Unknown";return a[r]||(a[r]={totalLeads:0,trialsScheduled:0,trialsCompleted:0,converted:0,totalLTV:0,totalVisits:0,proximityIssues:0}),a[r].totalLeads+=1,(m=s.stage)!=null&&m.includes("Trial")&&(a[r].trialsScheduled+=1),s.stage==="Trial Completed"&&(a[r].trialsCompleted+=1),s.conversionStatus==="Converted"&&(a[r].converted+=1),(i=s.stage)!=null&&i.includes("Proximity")&&(a[r].proximityIssues+=1),a[r].totalLTV+=s.ltv||0,a[r].totalVisits+=s.visits||0,a},{});return Object.entries(t).map(([a,s])=>({source:a,totalLeads:s.totalLeads,trialsScheduled:s.trialsScheduled,trialsCompleted:s.trialsCompleted,converted:s.converted,conversionRate:s.totalLeads>0?s.converted/s.totalLeads*100:0,trialToMemberRate:s.trialsCompleted>0?s.converted/s.trialsCompleted*100:0,avgLTV:s.totalLeads>0?s.totalLTV/s.totalLeads:0,avgVisits:s.totalLeads>0?s.totalVisits/s.totalLeads:0,proximityIssues:s.proximityIssues,leadQuality:(s.converted*.4+s.trialsCompleted*.3+(s.totalLeads-s.proximityIssues)*.3)/s.totalLeads*100})).sort((a,s)=>s.totalLeads-a.totalLeads)},[l]),f=k.useMemo(()=>{const t=l.reduce((a,s)=>{const r=s.stage||"Unknown";return a[r]||(a[r]={totalLeads:0,converted:0,totalLTV:0,avgDaysInStage:0,retained:0}),a[r].totalLeads+=1,s.conversionStatus==="Converted"&&(a[r].converted+=1),s.retentionStatus==="Retained"&&(a[r].retained+=1),a[r].totalLTV+=s.ltv||0,a},{});return Object.entries(t).map(([a,s])=>({stage:a,totalLeads:s.totalLeads,converted:s.converted,conversionRate:s.totalLeads>0?s.converted/s.totalLeads*100:0,retentionRate:s.totalLeads>0?s.retained/s.totalLeads*100:0,avgLTV:s.totalLeads>0?s.totalLTV/s.totalLeads:0,stageEfficiency:(s.converted*.5+s.retained*.3+s.totalLeads*.2)/s.totalLeads*100})).sort((a,s)=>s.totalLeads-a.totalLeads)},[l]),n=k.useMemo(()=>[{label:"0-7 days",min:0,max:7},{label:"8-14 days",min:8,max:14},{label:"15-30 days",min:15,max:30},{label:"31-60 days",min:31,max:60},{label:"60+ days",min:61,max:1/0}].map(a=>{const s=l.filter(m=>{if(!m.createdAt||!m.convertedToCustomerAt)return!1;const i=new Date(m.createdAt),d=new Date(m.convertedToCustomerAt),N=Math.ceil((d.getTime()-i.getTime())/(1e3*60*60*24));return N>=a.min&&N<=a.max}),r=s.filter(m=>m.conversionStatus==="Converted");return{timeRange:a.label,totalLeads:s.length,converted:r.length,conversionRate:s.length>0?r.length/s.length*100:0,avgLTV:r.length>0?r.reduce((m,i)=>m+(i.ltv||0),0)/r.length:0,efficiency:s.length>0?(r.length*.6+s.length*.4)/s.length*100:0}}),[l]),o=k.useMemo(()=>[{label:"₹0",min:0,max:0},{label:"₹1-5k",min:1,max:5e3},{label:"₹5k-15k",min:5001,max:15e3},{label:"₹15k-30k",min:15001,max:3e4},{label:"₹30k+",min:30001,max:1/0}].map(a=>{const s=l.filter(m=>{const i=m.ltv||0;return i>=a.min&&i<=a.max}),r=s.filter(m=>m.conversionStatus==="Converted");return{ltvRange:a.label,totalLeads:s.length,converted:r.length,conversionRate:s.length>0?r.length/s.length*100:0,avgVisits:s.length>0?s.reduce((m,i)=>m+(i.visits||0),0)/s.length:0,totalRevenue:s.reduce((m,i)=>m+(i.ltv||0),0),valueScore:r.length>0?r.reduce((m,i)=>m+(i.ltv||0),0)/r.length*(r.length/s.length):0}}),[l]),u=k.useMemo(()=>{const t=l.reduce((a,s)=>{const r=s.stage||"Unknown";return a[r]||(a[r]={count:0,converted:0,avgLTV:0,totalLTV:0}),a[r].count+=1,s.conversionStatus==="Converted"&&(a[r].converted+=1),a[r].totalLTV+=s.ltv||0,a},{});return Object.entries(t).map(([a,s])=>({stage:a,leadCount:s.count,percentage:s.count/s.length*100,converted:s.converted,conversionRate:s.count>0?s.converted/s.count*100:0,avgLTV:s.count>0?s.totalLTV/s.count:0,stagePopularity:s.count/s.length*100})).sort((a,s)=>s.leadCount-a.leadCount).slice(0,10)},[l]),w=k.useMemo(()=>{const a=l.filter(s=>{var r,m,i,d;return((r=s.stage)==null?void 0:r.includes("Proximity"))||((m=s.remarks)==null?void 0:m.toLowerCase().includes("proximity"))||((i=s.remarks)==null?void 0:i.toLowerCase().includes("location"))||((d=s.remarks)==null?void 0:d.toLowerCase().includes("distance"))}).reduce((s,r)=>{const m=r.center||"Unknown";return s[m]||(s[m]={count:0,totalLeads:0}),s[m].count+=1,s},{});return l.forEach(s=>{const r=s.center||"Unknown";a[r]?a[r].totalLeads+=1:a[r]={count:0,totalLeads:1}}),Object.entries(a).map(([s,r])=>({location:s,proximityIssues:r.count,totalLeads:r.totalLeads,proximityRate:r.totalLeads>0?r.count/r.totalLeads*100:0,impactScore:r.count*(r.count/r.totalLeads)*100})).sort((s,r)=>r.proximityIssues-s.proximityIssues)},[l]),v=(t,a)=>{if(!c)return;let s=[],r="";switch(t){case"source":s=l.filter(m=>m.source===a.source),r=`Source: ${a.source}`;break;case"stage":s=l.filter(m=>m.stage===a.stage),r=`Stage: ${a.stage}`;break;case"ltv":r=`LTV Range: ${a.ltvRange}`,s=l;break;case"proximity":s=l.filter(m=>m.center===a.location),r=`Location: ${a.location}`;break;default:s=l,r="Funnel Analytics"}c(r,s,t)};return e.jsx("div",{className:"space-y-6",children:e.jsxs(we,{defaultValue:"source",className:"w-full",children:[e.jsxs(Le,{className:"grid w-full grid-cols-6 bg-gradient-to-r from-red-50 to-orange-50 p-2 rounded-2xl h-auto gap-2",children:[e.jsxs(_,{value:"source",className:"rounded-xl px-4 py-3 font-semibold text-sm",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"By Source"]}),e.jsxs(_,{value:"stage",className:"rounded-xl px-4 py-3 font-semibold text-sm",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"By Stage"]}),e.jsxs(_,{value:"span",className:"rounded-xl px-4 py-3 font-semibold text-sm",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Conv. Span"]}),e.jsxs(_,{value:"ltv",className:"rounded-xl px-4 py-3 font-semibold text-sm",children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"LTV Analysis"]}),e.jsxs(_,{value:"stages",className:"rounded-xl px-4 py-3 font-semibold text-sm",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Top Stages"]}),e.jsxs(_,{value:"proximity",className:"rounded-xl px-4 py-3 font-semibold text-sm",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Proximity"]})]}),e.jsx(X,{value:"source",className:"mt-6",children:e.jsxs(V,{className:"bg-white/95 backdrop-blur-sm border-0 shadow-xl",children:[e.jsx(P,{className:"bg-gradient-to-r from-red-600 via-red-700 to-red-800",children:e.jsxs(H,{className:"text-white flex items-center gap-2 text-lg font-bold",children:[e.jsx(W,{className:"w-5 h-5"}),"Conversion by Source"]})}),e.jsx(R,{className:"p-0",children:e.jsx(U,{data:j,showFooter:!0,footerData:{source:"TOTALS",totalLeads:j.reduce((t,a)=>t+a.totalLeads,0),converted:j.reduce((t,a)=>t+a.converted,0),conversionRate:j.length>0?j.reduce((t,a)=>t+a.converted,0)/j.reduce((t,a)=>t+a.totalLeads,0)*100:0,avgLTV:j.length>0?j.reduce((t,a)=>t+a.avgLTV*a.totalLeads,0)/j.reduce((t,a)=>t+a.totalLeads,0):0},columns:[{key:"source",header:"Source",render:t=>e.jsx("div",{className:"font-semibold text-slate-800 min-w-[120px]",children:t})},{key:"totalLeads",header:"Total Leads",align:"center",render:t=>e.jsx("div",{className:"font-medium text-blue-600",children:$(t)})},{key:"converted",header:"Converted",align:"center",render:t=>e.jsx("div",{className:"font-medium text-green-600",children:$(t)})},{key:"conversionRate",header:"Conv. Rate",align:"center",render:(t,a)=>e.jsxs("div",{className:"relative group",onMouseEnter:()=>g(`${a.source}-conv`),onMouseLeave:()=>g(null),children:[e.jsxs(M,{variant:"outline",className:`${t>=15?"text-green-600 border-green-200":t>=8?"text-yellow-600 border-yellow-200":"text-red-600 border-red-200"}`,children:[t.toFixed(1),"%"]}),y===`${a.source}-conv`&&e.jsx("div",{className:"absolute z-10 -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded",children:t>=15?"🔥 Excellent":t>=8?"👍 Good":"⚠️ Needs Improvement"})]})},{key:"avgLTV",header:"Avg LTV",align:"right",render:t=>e.jsx("span",{className:"font-semibold text-emerald-600",children:I(t)})}],onRowClick:t=>v("source",t),headerGradient:"from-red-600 to-red-700",maxHeight:"400px"})})]})}),e.jsx(X,{value:"stage",className:"mt-6",children:e.jsxs(V,{className:"bg-white/95 backdrop-blur-sm border-0 shadow-xl",children:[e.jsx(P,{className:"bg-gradient-to-r from-red-700 via-red-800 to-orange-700",children:e.jsxs(H,{className:"text-white flex items-center gap-2 text-lg font-bold",children:[e.jsx(ee,{className:"w-5 h-5"}),"Conversion by Stage"]})}),e.jsx(R,{className:"p-0",children:e.jsx(U,{data:f,showFooter:!0,footerData:{stage:"TOTALS",totalLeads:f.reduce((t,a)=>t+a.totalLeads,0),converted:f.reduce((t,a)=>t+a.converted,0),conversionRate:f.length>0?f.reduce((t,a)=>t+a.converted,0)/f.reduce((t,a)=>t+a.totalLeads,0)*100:0,avgLTV:f.length>0?f.reduce((t,a)=>t+a.avgLTV*a.totalLeads,0)/f.reduce((t,a)=>t+a.totalLeads,0):0},columns:[{key:"stage",header:"Stage",render:t=>e.jsx("div",{className:"font-semibold text-slate-800 min-w-[150px]",children:t})},{key:"totalLeads",header:"Total Leads",align:"center",render:t=>$(t)},{key:"converted",header:"Converted",align:"center",render:t=>e.jsx("span",{className:"font-medium text-green-600",children:$(t)})},{key:"conversionRate",header:"Conv. Rate",align:"center",render:t=>e.jsxs(M,{variant:"outline",className:"text-purple-600 border-purple-200",children:[t.toFixed(1),"%"]})},{key:"avgLTV",header:"Avg LTV",align:"right",render:t=>I(t)}],onRowClick:t=>v("stage",t),headerGradient:"from-red-700 to-orange-700",maxHeight:"400px"})})]})}),e.jsx(X,{value:"span",className:"mt-6",children:e.jsxs(V,{className:"bg-white/95 backdrop-blur-sm border-0 shadow-xl",children:[e.jsx(P,{className:"bg-gradient-to-r from-orange-600 via-red-600 to-pink-600",children:e.jsxs(H,{className:"text-white flex items-center gap-2 text-lg font-bold",children:[e.jsx(se,{className:"w-5 h-5"}),"Conversion Span Analysis"]})}),e.jsx(R,{className:"p-0",children:e.jsx(U,{data:n,columns:[{key:"timeRange",header:"Time Range",render:t=>e.jsx("div",{className:"font-semibold text-slate-800",children:t})},{key:"totalLeads",header:"Total Leads",align:"center",render:t=>$(t)},{key:"converted",header:"Converted",align:"center",render:t=>$(t)},{key:"conversionRate",header:"Conv. Rate",align:"center",render:t=>`${t.toFixed(1)}%`},{key:"avgLTV",header:"Avg LTV",align:"right",render:t=>I(t)}],headerGradient:"from-orange-600 to-pink-600",maxHeight:"400px"})})]})}),e.jsx(X,{value:"ltv",className:"mt-6",children:e.jsxs(V,{className:"bg-white/95 backdrop-blur-sm border-0 shadow-xl",children:[e.jsx(P,{className:"bg-gradient-to-r from-green-600 via-emerald-600 to-teal-600",children:e.jsxs(H,{className:"text-white flex items-center gap-2 text-lg font-bold",children:[e.jsx(te,{className:"w-5 h-5"}),"LTV Analysis"]})}),e.jsx(R,{className:"p-0",children:e.jsx(U,{data:o,columns:[{key:"ltvRange",header:"LTV Range",render:t=>e.jsx("div",{className:"font-semibold text-slate-800",children:t})},{key:"totalLeads",header:"Total Leads",align:"center",render:t=>$(t)},{key:"converted",header:"Converted",align:"center",render:t=>$(t)},{key:"totalRevenue",header:"Total Revenue",align:"right",render:t=>I(t)},{key:"avgVisits",header:"Avg Visits",align:"center",render:t=>t.toFixed(1)}],onRowClick:t=>v("ltv",t),headerGradient:"from-green-600 to-emerald-600",maxHeight:"400px"})})]})}),e.jsx(X,{value:"stages",className:"mt-6",children:e.jsxs(V,{className:"bg-white/95 backdrop-blur-sm border-0 shadow-xl",children:[e.jsx(P,{className:"bg-gradient-to-r from-indigo-600 via-blue-600 to-cyan-600",children:e.jsxs(H,{className:"text-white flex items-center gap-2 text-lg font-bold",children:[e.jsx(K,{className:"w-5 h-5"}),"Most Common Stages"]})}),e.jsx(R,{className:"p-0",children:e.jsx(U,{data:u,columns:[{key:"stage",header:"Stage",render:t=>e.jsx("div",{className:"font-semibold text-slate-800",children:t})},{key:"leadCount",header:"Lead Count",align:"center",render:t=>$(t)},{key:"converted",header:"Converted",align:"center",render:t=>$(t)},{key:"conversionRate",header:"Conv. Rate",align:"center",render:t=>`${t.toFixed(1)}%`},{key:"avgLTV",header:"Avg LTV",align:"right",render:t=>I(t)}],headerGradient:"from-indigo-600 to-blue-600",maxHeight:"400px"})})]})}),e.jsx(X,{value:"proximity",className:"mt-6",children:e.jsxs(V,{className:"bg-white/95 backdrop-blur-sm border-0 shadow-xl",children:[e.jsx(P,{className:"bg-gradient-to-r from-red-600 via-orange-600 to-yellow-600",children:e.jsxs(H,{className:"text-white flex items-center gap-2 text-lg font-bold",children:[e.jsx(de,{className:"w-5 h-5"}),"Proximity Issues Analysis"]})}),e.jsx(R,{className:"p-0",children:e.jsx(U,{data:w,columns:[{key:"location",header:"Location",render:t=>e.jsxs("div",{className:"font-semibold text-slate-800 flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4 text-gray-400"}),t]})},{key:"proximityIssues",header:"Proximity Issues",align:"center",render:t=>e.jsx("span",{className:"font-medium text-red-600",children:$(t)})},{key:"totalLeads",header:"Total Leads",align:"center",render:t=>$(t)},{key:"proximityRate",header:"Proximity Rate",align:"center",render:t=>e.jsxs(M,{variant:"outline",className:`${t>=20?"text-red-600 border-red-200":t>=10?"text-yellow-600 border-yellow-200":"text-green-600 border-green-200"}`,children:[t.toFixed(1),"%"]})},{key:"impactScore",header:"Impact Score",align:"right",render:t=>e.jsx("span",{className:"font-medium text-orange-600",children:t.toFixed(1)})}],onRowClick:t=>v("proximity",t),headerGradient:"from-red-600 to-orange-600",maxHeight:"400px"})})]})})]})})},kt=({isOpen:l,onClose:c,title:y,data:g,type:j})=>{const f=[{key:"fullName",header:"Name",className:"min-w-[150px]",render:(o,u)=>e.jsxs("div",{className:"font-medium text-gray-900",children:[e.jsx("div",{className:"text-sm font-semibold",children:o}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(je,{className:"w-3 h-3"}),u.phone]})]})},{key:"email",header:"Email",className:"min-w-[200px]",render:o=>e.jsx("div",{className:"text-sm text-gray-600 truncate",title:o,children:o})},{key:"source",header:"Source",align:"center",render:o=>e.jsx(M,{variant:"outline",className:"text-blue-600 border-blue-200 bg-blue-50",children:o||"Unknown"})},{key:"stage",header:"Stage",align:"center",render:o=>e.jsx(M,{variant:"outline",className:`${o!=null&&o.includes("Trial")?"text-purple-600 border-purple-200 bg-purple-50":o!=null&&o.includes("Proximity")?"text-red-600 border-red-200 bg-red-50":"text-gray-600 border-gray-200 bg-gray-50"}`,children:o||"Unknown"})},{key:"conversionStatus",header:"Conversion",align:"center",render:o=>e.jsx(M,{variant:o!=null&&o.toLowerCase().includes("converted")?"default":"secondary",className:o!=null&&o.toLowerCase().includes("converted")?"bg-green-100 text-green-800":"",children:o||"Pending"})},{key:"ltv",header:"LTV",align:"right",render:o=>e.jsx("span",{className:"font-semibold text-emerald-600",children:I(o||0)})},{key:"visits",header:"Visits",align:"center",render:o=>e.jsx("div",{className:"text-sm font-medium text-gray-700",children:$(o||0)})},{key:"center",header:"Location",className:"min-w-[150px]",render:o=>e.jsxs("div",{className:"text-sm text-gray-600 truncate flex items-center gap-1",title:o,children:[e.jsx(q,{className:"w-3 h-3 text-gray-400"}),o||"Unknown"]})}],n=ye.useMemo(()=>{const o=g.length,u=g.filter(r=>r.stage==="Trial Completed").length,w=g.filter(r=>{var m;return(m=r.stage)==null?void 0:m.includes("Trial")}).length,v=g.filter(r=>r.conversionStatus==="Converted").length,t=g.filter(r=>{var m,i;return((m=r.stage)==null?void 0:m.includes("Proximity"))||((i=r.remarks)==null?void 0:i.toLowerCase().includes("proximity"))}).length,a=g.reduce((r,m)=>r+(m.ltv||0),0),s=g.reduce((r,m)=>r+(m.visits||0),0);return{totalLeads:o,trialsCompleted:u,trialsScheduled:w,convertedLeads:v,proximityIssues:t,conversionRate:o>0?v/o*100:0,trialConversionRate:u>0?v/u*100:0,avgLTV:o>0?a/o:0,avgVisits:o>0?s/o:0,totalLTV:a}},[g]);return e.jsx(tt,{open:l,onOpenChange:c,children:e.jsxs(st,{className:"max-w-7xl max-h-[90vh] overflow-y-auto",children:[e.jsx(at,{className:"pb-4 border-b bg-gradient-to-r from-blue-50 to-purple-50 -m-6 p-6 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(rt,{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5 text-blue-600"}),y," - Detailed Analysis"]}),e.jsx(G,{variant:"ghost",size:"sm",onClick:c,className:"hover:bg-white/50",children:e.jsx(ie,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-6",children:[e.jsx(V,{className:"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-700",children:$(n.totalLeads)}),e.jsx("div",{className:"text-xs text-blue-600",children:"Total Leads"})]})]})})}),e.jsx(V,{className:"bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-green-700",children:$(n.convertedLeads)}),e.jsx("div",{className:"text-xs text-green-600",children:"Converted"})]})]})})}),e.jsx(V,{className:"bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4 text-purple-600"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-700",children:[n.conversionRate.toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-purple-600",children:"Conv. Rate"})]})]})})}),e.jsx(V,{className:"bg-gradient-to-br from-emerald-50 to-emerald-100 border-emerald-200",children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4 text-emerald-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-700",children:I(n.avgLTV)}),e.jsx("div",{className:"text-xs text-emerald-600",children:"Avg LTV"})]})]})})}),e.jsx(V,{className:"bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200",children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-700",children:n.avgVisits.toFixed(1)}),e.jsx("div",{className:"text-xs text-orange-600",children:"Avg Visits"})]})]})})})]}),e.jsxs(V,{children:[e.jsx(P,{children:e.jsxs(H,{className:"text-lg flex items-center gap-2",children:[e.jsx(ze,{className:"w-5 h-5 text-blue-600"}),"Lead Details (",$(g.length)," leads)"]})}),e.jsx(R,{className:"p-0",children:e.jsx(U,{data:g,columns:f,headerGradient:"from-blue-600 to-purple-600",maxHeight:"400px"})})]})]})})};export{Tt as E,ft as F,Nt as a,yt as b,Ct as c,wt as d,Lt as e,St as f,kt as g};
