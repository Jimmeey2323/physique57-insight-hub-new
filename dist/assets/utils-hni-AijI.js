var he=Object.defineProperty,ge=Object.defineProperties;var ye=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var ne=(a,s,i)=>s in a?he(a,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[s]=i,v=(a,s)=>{for(var i in s||(s={}))se.call(s,i)&&ne(a,i,s[i]);if(F)for(var i of F(s))re.call(s,i)&&ne(a,i,s[i]);return a},_=(a,s)=>ge(a,ye(s));var oe=(a,s)=>{var i={};for(var r in a)se.call(a,r)&&s.indexOf(r)<0&&(i[r]=a[r]);if(a!=null&&F)for(var r of F(a))s.indexOf(r)<0&&re.call(a,r)&&(i[r]=a[r]);return i};var N=(a,s,i)=>new Promise((r,I)=>{var g=d=>{try{n(i.next(d))}catch(e){I(e)}},y=d=>{try{n(i.throw(d))}catch(e){I(e)}},n=d=>d.done?r(d.value):Promise.resolve(d.value).then(g,y);n((i=i.apply(a,s)).next())});import{r as D,bR as Te}from"./react-vendor-BrAkf1Ej.js";import{bt as Ie,bu as Ee}from"./vendor-CTzDTTNf.js";import{f as V}from"./utils-vendor-J2la9FRB.js";import{u as De}from"./dashboard-executive-BGxMPz5n.js";import{u as be}from"./dashboard-classes-CN6A505j.js";const Se=1,Ce=1e6;let X=0;function Ne(){return X=(X+1)%Number.MAX_SAFE_INTEGER,X.toString()}const Z=new Map,ce=a=>{if(Z.has(a))return;const s=setTimeout(()=>{Z.delete(a),x({type:"REMOVE_TOAST",toastId:a})},Ce);Z.set(a,s)},Pe=(a,s)=>{switch(s.type){case"ADD_TOAST":return _(v({},a),{toasts:[s.toast,...a.toasts].slice(0,Se)});case"UPDATE_TOAST":return _(v({},a),{toasts:a.toasts.map(i=>i.id===s.toast.id?v(v({},i),s.toast):i)});case"DISMISS_TOAST":{const{toastId:i}=s;return i?ce(i):a.toasts.forEach(r=>{ce(r.id)}),_(v({},a),{toasts:a.toasts.map(r=>r.id===i||i===void 0?_(v({},r),{open:!1}):r)})}case"REMOVE_TOAST":return s.toastId===void 0?_(v({},a),{toasts:[]}):_(v({},a),{toasts:a.toasts.filter(i=>i.id!==s.toastId)})}},q=[];let z={toasts:[]};function x(a){z=Pe(z,a),q.forEach(s=>{s(z)})}function ve(s){var a=oe(s,[]);const i=Ne(),r=g=>x({type:"UPDATE_TOAST",toast:_(v({},g),{id:i})}),I=()=>x({type:"DISMISS_TOAST",toastId:i});return x({type:"ADD_TOAST",toast:_(v({},a),{id:i,open:!0,onOpenChange:g=>{g||I()}})}),{id:i,dismiss:I,update:r}}function je(){const[a,s]=D.useState(z);return D.useEffect(()=>(q.push(s),()=>{const i=q.indexOf(s);i>-1&&q.splice(i,1)}),[a]),_(v({},a),{toast:ve,dismiss:i=>x({type:"DISMISS_TOAST",toastId:i})})}const ie={sales:{name:"Sales Analytics",heroGradient:"from-slate-900 via-blue-900 to-slate-800",activeTabGradient:"from-blue-600 to-blue-800",accentColors:{primary:"blue-600",secondary:"blue-500",light:"blue-100",dark:"blue-800"},metricCardBorder:"border-blue-200",tableHeaderGradient:"from-blue-700 to-blue-900",badgeColors:"bg-blue-100 text-blue-800"},discounts:{name:"Discounts & Promotions",heroGradient:"from-stone-900 via-amber-900 to-stone-800",activeTabGradient:"from-orange-600 to-amber-600",accentColors:{primary:"orange-600",secondary:"amber-500",light:"orange-100",dark:"orange-800"},metricCardBorder:"border-orange-200",tableHeaderGradient:"from-orange-700 to-amber-800",badgeColors:"bg-orange-100 text-orange-800"},funnel:{name:"Lead Funnel",heroGradient:"from-slate-900 via-violet-900 to-slate-800",activeTabGradient:"from-red-600 to-rose-700",accentColors:{primary:"red-600",secondary:"rose-500",light:"red-100",dark:"red-800"},metricCardBorder:"border-red-200",tableHeaderGradient:"from-red-700 to-rose-800",badgeColors:"bg-red-100 text-red-800"},retention:{name:"Client Retention",heroGradient:"from-gray-900 via-purple-900 to-gray-800",activeTabGradient:"from-purple-600 to-violet-700",accentColors:{primary:"purple-600",secondary:"violet-500",light:"purple-100",dark:"purple-800"},metricCardBorder:"border-purple-200",tableHeaderGradient:"from-purple-700 to-violet-800",badgeColors:"bg-purple-100 text-purple-800"},attendance:{name:"Class Attendance",heroGradient:"from-gray-900 via-purple-900 to-gray-800",activeTabGradient:"from-purple-600 to-violet-700",accentColors:{primary:"purple-600",secondary:"violet-500",light:"purple-100",dark:"purple-800"},metricCardBorder:"border-purple-200",tableHeaderGradient:"from-purple-700 to-violet-800",badgeColors:"bg-purple-100 text-purple-800"},powercycle:{name:"PowerCycle vs Barre",heroGradient:"from-zinc-900 via-cyan-900 to-zinc-800",activeTabGradient:"from-cyan-600 to-teal-700",accentColors:{primary:"cyan-600",secondary:"teal-500",light:"cyan-100",dark:"cyan-800"},metricCardBorder:"border-cyan-200",tableHeaderGradient:"from-cyan-700 to-teal-800",badgeColors:"bg-cyan-100 text-cyan-800"},expiration:{name:"Expiration Analytics",heroGradient:"from-neutral-900 via-red-900 to-neutral-800",activeTabGradient:"from-red-600 to-pink-700",accentColors:{primary:"red-600",secondary:"pink-500",light:"red-100",dark:"red-800"},metricCardBorder:"border-red-200",tableHeaderGradient:"from-red-700 to-pink-800",badgeColors:"bg-red-100 text-red-800"},cancellations:{name:"Late Cancellations",heroGradient:"from-stone-900 via-rose-900 to-stone-800",activeTabGradient:"from-rose-600 to-pink-700",accentColors:{primary:"rose-600",secondary:"pink-500",light:"rose-100",dark:"rose-800"},metricCardBorder:"border-rose-200",tableHeaderGradient:"from-rose-700 to-pink-800",badgeColors:"bg-rose-100 text-rose-800"},analytics:{name:"Analytics & Performance",heroGradient:"from-zinc-900 via-indigo-900 to-zinc-800",activeTabGradient:"from-indigo-600 to-indigo-800",accentColors:{primary:"indigo-600",secondary:"indigo-500",light:"indigo-100",dark:"indigo-800"},metricCardBorder:"border-indigo-200",tableHeaderGradient:"from-indigo-700 to-indigo-800",badgeColors:"bg-indigo-100 text-indigo-800"},summary:{name:"Executive Summary",heroGradient:"from-slate-900 via-teal-900 to-slate-800",activeTabGradient:"from-blue-600 to-purple-600",accentColors:{primary:"blue-600",secondary:"purple-500",light:"blue-100",dark:"blue-800"},metricCardBorder:"border-blue-200",tableHeaderGradient:"from-blue-700 to-purple-800",badgeColors:"bg-blue-100 text-blue-800"}},de=a=>ie[a]||ie.summary,He=a=>`text-slate-600 data-[state=active]:bg-gradient-to-r data-[state=active]:${de(a).activeTabGradient} data-[state=active]:text-white data-[state=active]:shadow-lg hover:text-slate-800`,Ye=a=>`bg-gradient-to-r ${de(a).tableHeaderGradient} text-white`,Ke=Te()(Ie((a,s)=>({isLoading:!1,loadingMessage:"Loading...",progress:0,loadingStartTime:null,setLoading:(i,r="Loading...")=>{a({isLoading:i,loadingMessage:r,loadingStartTime:i?Date.now():null,progress:i?0:100})},setProgress:i=>a({progress:Math.min(Math.max(i,0),100)}),resetProgress:()=>a({progress:0})}))),qe=()=>{D.useEffect(()=>{const a=()=>{["/executive-summary","/sales-analytics","/funnel-leads","/client-retention","/trainer-performance"].forEach(g=>{const y=document.createElement("link");y.rel="prefetch",y.href=g,document.head.appendChild(y)})};"requestIdleCallback"in window?requestIdleCallback(a):setTimeout(a,100);let s=null;const i=[];if("PerformanceObserver"in window){s=new PerformanceObserver(I=>{I.getEntries().forEach(g=>{g.entryType==="longtask"&&g.duration>100})});try{s.observe({entryTypes:["longtask"]})}catch(I){}}return(()=>{document.querySelectorAll('img[loading="lazy"]').forEach(g=>{if("IntersectionObserver"in window){const y=new IntersectionObserver(n=>{n.forEach(d=>{if(d.isIntersecting){const e=d.target;e.dataset.src&&(e.src=e.dataset.src,e.removeAttribute("data-src"),y.unobserve(e))}})});y.observe(g),i.push(y)}})})(),()=>{s&&s.disconnect(),i.forEach(I=>{I.disconnect()})}},[])},ze=()=>{const a=new Date,s=new Date(a.getFullYear(),a.getMonth()-1,1),i=new Date(a.getFullYear(),a.getMonth(),0),r=g=>{const y=g.getFullYear(),n=String(g.getMonth()+1).padStart(2,"0"),d=String(g.getDate()).padStart(2,"0");return`${y}-${n}-${d}`};return{start:r(s),end:r(i)}},Xe=a=>{if(!a||a.trim()==="")return null;try{if(a.includes("/")){const r=a.split(" ")[0].trim().split("/");if(r.length===3){const I=parseInt(r[0]),g=parseInt(r[1]),y=parseInt(r[2]);if(!isNaN(y)&&!isNaN(g)&&!isNaN(I))return new Date(y,g-1,I)}}if(a.includes("-")){const i=new Date(a);if(!isNaN(i.getTime()))return i}const s=new Date(a);return isNaN(s.getTime())?null:s}catch(s){return null}},Ze=()=>{const a=new Date,s=new Date(a.getFullYear(),a.getMonth()-1,1);return`${s.toLocaleDateString("en-US",{month:"long"})} ${s.getFullYear()}`},$={CLIENT_ID:"416630995185-007ermh3iidknbbtdmu5vct207mdlbaa.apps.googleusercontent.com",CLIENT_SECRET:"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",REFRESH_TOKEN:"1//04w4V2xMUIMzACgYIARAAGAQSNwF-L9Ir5__pXDmZVYaHKOSqyauTDVmTvrCvgaL2beep4gmp8_lVED0ppM9BPWDDimHyQKk50EY",TOKEN_URL:"https://oauth2.googleapis.com/token"},_e="11_i8_iflhhdHZ-oKQU6UsPOfsM3MdOOUwSc8McpuXaU",me=()=>{const[a,s]=D.useState([]),[i,r]=D.useState(!0),[I,g]=D.useState(null),y=()=>N(void 0,null,function*(){try{return(yield(yield fetch($.TOKEN_URL,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:$.CLIENT_ID,client_secret:$.CLIENT_SECRET,refresh_token:$.REFRESH_TOKEN,grant_type:"refresh_token"})})).json()).access_token}catch(e){throw e}}),n=e=>{if(typeof e=="number")return e;if(!e||e==="")return 0;const m=e.toString().replace(/,/g,""),T=parseFloat(m);return isNaN(T)?0:T},d=()=>N(void 0,null,function*(){try{r(!0),g(null);const e=yield y(),m=yield fetch(`https://sheets.googleapis.com/v4/spreadsheets/${_e}/values/Sales?alt=json`,{headers:{Authorization:`Bearer ${e}`}});if(!m.ok)throw new Error("Failed to fetch data");const p=(yield m.json()).values||[];if(p.length<2){s([]);return}const l=p[0],t=100,f=[],h=(E,c)=>{const P=p.slice(E,c).map(A=>{const u={};return l.forEach((M,O)=>{u[M]=A[O]||""}),{memberId:u["Member ID"]||u.memberId||"",customerName:u["Customer Name"]||u.customerName||"",customerEmail:u["Customer Email"]||u.customerEmail||"",saleItemId:u["Sale Item ID"]||u.saleItemId||"",paymentCategory:u["Payment Category"]||u.paymentCategory||"",membershipType:u["Membership Type"]||u.membershipType||"",paymentDate:u["Payment Date"]||u.paymentDate||"",paymentValue:n(u["Payment Value"]||u.paymentValue||0),paidInMoneyCredits:n(u["Paid in Money Credits"]||u["Paid In Money Credits"]||u.paidInMoneyCredits||0),paymentVAT:n(u["Payment VAT"]||u.paymentVAT||0),paymentItem:u["Payment Item"]||u.paymentItem||"",paymentStatus:u["Payment Status"]||u.paymentStatus||"",paymentMethod:u["Payment Method"]||u.paymentMethod||"",paymentTransactionId:u["Payment Transaction ID"]||u.paymentTransactionId||"",stripeToken:u["Stripe Token"]||u.stripeToken||"",soldBy:u["Sold By"]||u.soldBy||"",saleReference:u["Sale Reference"]||u.saleReference||"",calculatedLocation:u["Calculated Location"]||u.calculatedLocation||"",cleanedProduct:u["Cleaned Product"]||u.cleanedProduct||"",cleanedCategory:u["Cleaned Category"]||u.cleanedCategory||"",netRevenue:n(u["Payment Value"]||u.paymentValue||0)-n(u["Payment VAT"]||u.paymentVAT||0),vat:n(u["Payment VAT"]||u.paymentVAT||0),grossRevenue:n(u["Payment Value"]||u.paymentValue||0),mrpPreTax:n(u["Mrp - Pre Tax"]||u["MRP Pre Tax"]||u.MRP_Pre_Tax||u.mrpPreTax||u.MrpPreTax||u["Pre Tax MRP"]||0),mrpPostTax:n(u["Mrp - Post Tax"]||u["MRP Post Tax"]||u.MRP_Post_Tax||u.mrpPostTax||u.MrpPostTax||u["Post Tax MRP"]||0),discountAmount:n(u["Discount Amount -Mrp- Payment Value"]||u["Discount Amount"]||u.discount_amount||u.discountAmount||u.DiscountAmount||u.Discount_Amount||u["Total Discount"]||0),discountPercentage:n(u["Discount Percentage - discount amount/mrp*100"]||u["Discount Percentage"]||u.discount_percentage||u.discountPercentage||u.DiscountPercentage||u.Discount_Percentage||u["Discount %"]||u.Discount_Percent||0),hostId:u["Host Id"]||u["Host ID"]||u.hostId||""}});f.push(...P)},o=p.length-1;for(let E=1;E<=o;E+=t){const c=Math.min(E+t,o+1);E>1&&(yield new Promise(P=>setTimeout(P,0))),h(E,c)}s(f),g(null)}catch(e){g("Failed to load sales data")}finally{r(!1)}});return D.useEffect(()=>{d()},[]),{data:a,loading:i,error:I,refetch:d}},Qe={card:{shadow:"shadow-[0_4px_20px_rgba(0,0,0,0.08)]",border:"border border-slate-200/60",background:"bg-white/95 backdrop-blur-md",radius:"rounded-2xl"},table:{header:"bg-gradient-to-r from-slate-50 to-slate-100 border-b-2 border-slate-200",headerText:"text-xs font-bold text-slate-700 uppercase tracking-wider",row:"hover:bg-slate-50/80 transition-colors border-b border-slate-100",cell:"px-4 py-2 text-sm text-slate-800 font-medium whitespace-nowrap overflow-hidden text-ellipsis"}},k=a=>{if(a==null||isNaN(a))return"₹0";const s=Math.abs(a);return s<1e3?`₹${Math.round(a)}`:s>=1e7?`₹${(a/1e7).toFixed(1)}Cr`:s>=1e5?`₹${(a/1e5).toFixed(1)}L`:s>=1e3?`₹${(a/1e3).toFixed(1)}K`:`₹${a.toLocaleString("en-IN")}`},We=a=>{if(a==null||isNaN(a))return"₹0";const s=Math.abs(a);return s<1e3?`₹${Math.round(a)}`:s>=1e7?`₹${(a/1e7).toFixed(1)}Cr`:s>=1e5?`₹${(a/1e5).toFixed(1)}L`:s>=1e3?`₹${(a/1e3).toFixed(1)}K`:`₹${a.toLocaleString("en-IN")}`},le=a=>a==null||isNaN(a)?"0.0%":`${a.toFixed(1)}%`,w=a=>a==null||isNaN(a)?"0":a.toLocaleString("en-IN"),Je=()=>{const{data:a,loading:s,error:i}=me();return{data:a,loading:s,error:i,isLoading:s}},B={CLIENT_ID:"416630995185-g7b0fm679lb4p45p5lou070cqscaalaf.apps.googleusercontent.com",CLIENT_SECRET:"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",REFRESH_TOKEN:"1//0gT2uoYBlNdGXCgYIARAAGBASNwF-L9IrBK_ijYwpce6-TdqDfji4GxYuc4uxIBKasdgoZBPm-tu_EU0xS34cNirqfLgXbJ8_NMk",TOKEN_URL:"https://oauth2.googleapis.com/token"},Re="1i5GcTahIchSF6pLn0c2ZgqtQVYBG-Fqt7rGxIzD7qrA",et=()=>{const[a,s]=D.useState([]),[i,r]=D.useState(!0),[I,g]=D.useState(null),y=()=>N(void 0,null,function*(){try{return(yield(yield fetch(B.TOKEN_URL,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:B.CLIENT_ID,client_secret:B.CLIENT_SECRET,refresh_token:B.REFRESH_TOKEN,grant_type:"refresh_token"})})).json()).access_token}catch(e){throw e}}),n=e=>{if(typeof e=="number")return e;if(!e||e==="")return 0;const m=e.toString().replace(/,/g,""),T=parseFloat(m);return isNaN(T)?0:T},d=()=>N(void 0,null,function*(){try{r(!0);const e=yield y(),m=yield fetch(`https://sheets.googleapis.com/v4/spreadsheets/${Re}/values/Sessions?alt=json`,{headers:{Authorization:`Bearer ${e}`}});if(!m.ok)throw new Error("Failed to fetch sessions data");const p=(yield m.json()).values||[];if(p.length<2){s([]);return}const l=p.slice(1).map(t=>{const f=n(t[6]),h=n(t[7]),o=f>0?h/f*100:0;return{trainerId:t[0]||"",trainerFirstName:t[1]||"",trainerLastName:t[2]||"",trainerName:t[3]||"",sessionId:t[4]||"",sessionName:t[5]||"",capacity:f,checkedInCount:h,lateCancelledCount:n(t[8]),bookedCount:n(t[9]),complimentaryCount:n(t[10]),location:t[11]||"",date:t[12]||"",dayOfWeek:t[13]||"",time:t[14]||"",totalPaid:n(t[15]),nonPaidCount:n(t[16]),uniqueId1:t[17]||"",uniqueId2:t[18]||"",checkedInsWithMemberships:n(t[19]),checkedInsWithPackages:n(t[20]),checkedInsWithIntroOffers:n(t[21]),checkedInsWithSingleClasses:n(t[22]),classType:t[23]||"",cleanedClass:t[24]||"",classes:n(t[25]),fillPercentage:o,revenue:n(t[15]),uniqueId:t[17]||""}});s(l),g(null)}catch(e){g("Failed to load sessions data")}finally{r(!1)}});return D.useEffect(()=>{d()},[]),{data:a,loading:i,error:I,refetch:d}},U={CLIENT_ID:"416630995185-g7b0fm679lb4p45p5lou070cqscaalaf.apps.googleusercontent.com",CLIENT_SECRET:"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",REFRESH_TOKEN:"1//0gT2uoYBlNdGXCgYIARAAGBASNwF-L9IrBK_ijYwpce6-TdqDfji4GxYuc4uxIBKasdgoZBPm-tu_EU0xS34cNirqfLgXbJ8_NMk",TOKEN_URL:"https://oauth2.googleapis.com/token"},ke="1i5GcTahIchSF6pLn0c2ZgqtQVYBG-Fqt7rGxIzD7qrA",tt=()=>{const[a,s]=D.useState([]),[i,r]=D.useState(!0),[I,g]=D.useState(null),y=()=>N(void 0,null,function*(){try{return(yield(yield fetch(U.TOKEN_URL,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:U.CLIENT_ID,client_secret:U.CLIENT_SECRET,refresh_token:U.REFRESH_TOKEN,grant_type:"refresh_token"})})).json()).access_token}catch(e){throw e}}),n=e=>{if(typeof e=="number")return e;if(!e||e==="")return 0;const m=e.toString().replace(/,/g,""),T=parseFloat(m);return isNaN(T)?0:T},d=()=>N(void 0,null,function*(){try{r(!0);const e=yield y(),m=yield fetch(`https://sheets.googleapis.com/v4/spreadsheets/${ke}/values/Payroll?alt=json`,{headers:{Authorization:`Bearer ${e}`}});if(!m.ok)throw new Error(`Failed to fetch payroll data: ${m.status} ${m.statusText}`);const p=(yield m.json()).values||[];if(p.length<2){s([]);return}const l=p.slice(1).map(t=>({teacherId:t[0]||"",teacherName:t[1]||"",teacherEmail:t[2]||"",location:t[3]||"",cycleSessions:n(t[4]),emptyCycleSessions:n(t[5]),nonEmptyCycleSessions:n(t[6]),cycleCustomers:n(t[7]),cyclePaid:n(t[8]),strengthSessions:n(t[9]),emptyStrengthSessions:n(t[10]),nonEmptyStrengthSessions:n(t[11]),strengthCustomers:n(t[12]),strengthPaid:n(t[13]),barreSessions:n(t[14]),emptyBarreSessions:n(t[15]),nonEmptyBarreSessions:n(t[16]),barreCustomers:n(t[17]),barrePaid:n(t[18]),totalSessions:n(t[19]),totalEmptySessions:n(t[20]),totalNonEmptySessions:n(t[21]),totalCustomers:n(t[22]),totalPaid:n(t[23]),monthYear:t[24]||"",unique:t[25]||"",converted:n(t[26]),conversion:n(t[27]).toString()+"%",retained:n(t[28]),retention:n(t[29]).toString()+"%",new:n(t[30]),classAverageInclEmpty:n(t[22])>0?n(t[19])/n(t[22]):0,classAverageExclEmpty:n(t[21])>0?n(t[22])/n(t[21]):0}));s(l),g(null)}catch(e){g("Failed to load payroll data")}finally{r(!1)}});return D.useEffect(()=>{d()},[]),{data:a,isLoading:i,error:I,refetch:d}},j={CLIENT_ID:"416630995185-g7b0fm679lb4p45p5lou070cqscaalaf.apps.googleusercontent.com",CLIENT_SECRET:"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",REFRESH_TOKEN:"1//0gT2uoYBlNdGXCgYIARAAGBASNwF-L9IrBK_ijYwpce6-TdqDfji4GxYuc4uxIBKasdgoZBPm-tu_EU0xS34cNirqfLgXbJ8_NMk",TOKEN_URL:"https://oauth2.googleapis.com/token"},Ae="1i5GcTahIchSF6pLn0c2ZgqtQVYBG-Fqt7rGxIzD7qrA",at=()=>{const[a,s]=D.useState([]),[i,r]=D.useState(!0),[I,g]=D.useState(null),[y,n]=D.useState(!1),d=()=>N(void 0,null,function*(){try{return(yield(yield fetch(j.TOKEN_URL,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:j.CLIENT_ID,client_secret:j.CLIENT_SECRET,refresh_token:j.REFRESH_TOKEN,grant_type:"refresh_token"})})).json()).access_token}catch(p){throw p}}),e=(p,l)=>{if(!p||!l)return 0;let t,f;if(p.includes("/")){const[E,c,P]=p.split(" ")[0].split("/");t=new Date(parseInt(P),parseInt(c)-1,parseInt(E))}else t=new Date(p);if(l.includes("/")){const[E,c,P]=l.split(" ")[0].split("/");f=new Date(parseInt(P),parseInt(c)-1,parseInt(E))}else f=new Date(l);if(isNaN(t.getTime())||isNaN(f.getTime()))return 0;const h=f.getTime()-t.getTime(),o=Math.ceil(h/(1e3*60*60*24));return Math.max(0,o)},m=(p="")=>{if(!p)return"";let l;if(p.includes("/")){const h=p.split(",")[0].trim(),[o,E,c]=h.split("/");l=new Date(parseInt(c),parseInt(E)-1,parseInt(o))}else l=new Date(p);if(isNaN(l.getTime()))return"";const t=l.getFullYear(),f=(l.getMonth()+1).toString().padStart(2,"0");return`${t}-${f}`},T=()=>N(void 0,null,function*(){try{y&&r(!0);const p=yield d(),l=yield fetch(`https://sheets.googleapis.com/v4/spreadsheets/${Ae}/values/New?alt=json`,{headers:{Authorization:`Bearer ${p}`}});if(!l.ok)throw new Error("Failed to fetch new client data");const f=(yield l.json()).values||[];if(f.length<2){s([]);return}const h=f.slice(1).map(o=>{const E=o[5]||"";return{memberId:o[0]||"",firstName:o[1]||"",lastName:o[2]||"",email:o[3]||"",phoneNumber:o[4]||"",firstVisitDate:E,firstVisitEntityName:o[6]||"",firstVisitType:o[7]||"",firstVisitLocation:o[8]||"",paymentMethod:o[9]||"",membershipUsed:o[10]||"",homeLocation:o[11]||"",classNo:parseFloat(o[12])||0,trainerName:o[13]||"",isNew:o[14]||"",visitsPostTrial:parseFloat(o[15])||0,membershipsBoughtPostTrial:o[16]||"",purchaseCountPostTrial:parseFloat(o[17])||0,ltv:parseFloat(o[18])||0,retentionStatus:o[19]||"",conversionStatus:o[20]||"",period:o[21]||"",unique:o[22]||"",firstPurchase:o[23]||"",conversionSpan:e(E,o[23]||""),monthYear:m(E)}});s(h),g(null),n(!0)}catch(p){g("Failed to load new client data"),n(!0)}finally{r(!1)}});return D.useEffect(()=>{y||T()},[y]),{data:a,loading:i,error:I,refetch:T}},H={CLIENT_ID:"416630995185-g7b0fm679lb4p45p5lou070cqscaalaf.apps.googleusercontent.com",CLIENT_SECRET:"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",REFRESH_TOKEN:"1//0gT2uoYBlNdGXCgYIARAAGBASNwF-L9IrBK_ijYwpce6-TdqDfji4GxYuc4uxIBKasdgoZBPm-tu_EU0xS34cNirqfLgXbJ8_NMk",TOKEN_URL:"https://oauth2.googleapis.com/token"},we="1dQMNF69WnXVQdhlLvUZTig3kL97NA21k6eZ9HRu6xiQ",L=a=>{if(!a||a.trim()===""||a==="-")return"";try{let s;const i=new Date;if(a.includes("/")){const r=a.split("/");if(r.length===3){const I=parseInt(r[0]),g=parseInt(r[1]),y=parseInt(r[2]);!isNaN(y)&&!isNaN(g)&&!isNaN(I)&&(s=new Date(y,g-1,I))}}else a.includes("-")?s=new Date(a):s=new Date(a);return!s||isNaN(s.getTime())||s>i||s.getFullYear()<2020?"":s.toISOString()}catch(s){return""}},b=(a,s)=>a&&a[s]!==void 0&&a[s]!==null?String(a[s]).trim():"",Le=(a,s)=>{const i=b(a,s),r=parseFloat(i);return isNaN(r)?0:r},ue=(a,s)=>{const i=b(a,s),r=parseInt(i);return isNaN(r)?0:r},nt=()=>{const[a,s]=D.useState([]),[i,r]=D.useState(!0),[I,g]=D.useState(null),y=()=>N(void 0,null,function*(){try{const d=yield fetch(H.TOKEN_URL,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:H.CLIENT_ID,client_secret:H.CLIENT_SECRET,refresh_token:H.REFRESH_TOKEN,grant_type:"refresh_token"})});if(!d.ok)throw new Error(`Token request failed: ${d.statusText}`);const e=yield d.json();if(!e.access_token)throw new Error("No access token received");return e.access_token}catch(d){throw d}}),n=()=>N(void 0,null,function*(){try{r(!0),g(null);const d=yield y(),e=yield fetch(`https://sheets.googleapis.com/v4/spreadsheets/${we}/values/◉ Leads?alt=json`,{headers:{Authorization:`Bearer ${d}`}});if(!e.ok)throw new Error(`Failed to fetch leads data: ${e.statusText}`);const T=(yield e.json()).values||[];if(T.length<2){s([]);return}const p=T.slice(1).map((l,t)=>{try{return!l||l.length===0?null:{id:b(l,0),fullName:b(l,1),phone:b(l,2),email:b(l,3),createdAt:L(b(l,4)),sourceId:b(l,5),source:b(l,6),memberId:b(l,7),convertedToCustomerAt:L(b(l,8)),stage:b(l,9),associate:b(l,10),remarks:b(l,11),followUp1Date:L(b(l,12)),followUpComments1:b(l,13),followUp2Date:L(b(l,14)),followUpComments2:b(l,15),followUp3Date:L(b(l,16)),followUpComments3:b(l,17),followUp4Date:L(b(l,18)),followUpComments4:b(l,19),center:b(l,20),classType:b(l,21),hostId:b(l,22),status:b(l,23),channel:b(l,24),period:b(l,25),purchasesMade:ue(l,26),ltv:Le(l,27),visits:ue(l,28),trialStatus:b(l,29),conversionStatus:b(l,30),retentionStatus:b(l,31)}}catch(f){return null}}).filter(l=>l!==null);s(p),g(null)}catch(d){g(d instanceof Error?d.message:"Failed to load leads data")}finally{r(!1)}});return D.useEffect(()=>{n()},[]),{data:a,loading:i,error:I,refetch:n}},st=()=>{const{data:a,loading:s,error:i}=me(),[r,I]=D.useState([]);D.useEffect(()=>{if(a&&a.length>0)try{const y=e=>{if(e==null||e==="")return 0;const m=e.toString().replace(/[₹,]/g,"").trim(),T=parseFloat(m);return isNaN(T)?0:T},n=e=>{if(!e)return"";try{if(e.includes("/")){const m=e.split(",")[0].trim(),[T,p,l]=m.split("/");if(T&&p&&l){const t=`${l}-${p.padStart(2,"0")}-${T.padStart(2,"0")}`;return new Date(t).toISOString().split("T")[0]}}if(e.includes("-")){const m=new Date(e);if(!isNaN(m.getTime()))return m.toISOString().split("T")[0]}return""}catch(m){return""}},d=a.map(e=>{var p,l,t,f,h,o;const m=y(e.discountAmount||e["Discount Amount -Mrp- Payment Value"]||0),T=y(e.discountPercentage||e["Discount Percentage - discount amount/mrp*100"]||0);return{memberId:e.memberId||((p=e["Member ID"])==null?void 0:p.toString())||"",customerName:e.customerName||e["Customer Name"]||"",customerEmail:e.customerEmail||e["Customer Email"]||"",saleItemId:e.saleItemId||((l=e["Sale Item ID"])==null?void 0:l.toString())||"",paymentCategory:e.paymentCategory||e["Payment Category"]||"",paymentDate:n(e.paymentDate||e["Payment Date"]||""),paymentValue:y(e.paymentValue||e["Payment Value"]||0),paidInMoneyCredits:y(e.paidInMoneyCredits||e["Paid In Money Credits"]||0),paymentVat:y(e.paymentVat||e["Payment VAT"]||0),paymentItem:e.paymentItem||e["Payment Item"]||"",paymentMethod:e.paymentMethod||e["Payment Method"]||"",paymentStatus:e.paymentStatus||e["Payment Status"]||"",paymentTransactionId:e.paymentTransactionId||((t=e["Payment Transaction ID"])==null?void 0:t.toString())||"",stripeToken:e.stripeToken||e["Stripe Token"]||"",saleReference:e.saleReference||((f=e["Sale Reference"])==null?void 0:f.toString())||"",soldBy:e.soldBy==="-"?"Online/System":e.soldBy||e["Sold By"]||"Unknown",location:e.calculatedLocation||e["Calculated Location"]||"",cleanedProduct:e.cleanedProduct||e["Cleaned Product"]||"",cleanedCategory:e.cleanedCategory||e["Cleaned Category"]||"",hostId:e.hostId||((h=e["Host Id"])==null?void 0:h.toString())||"",mrpPreTax:y(e.mrpPreTax||e["Mrp - Pre Tax"]||0),mrpPostTax:y(e.mrpPostTax||e["Mrp - Post Tax"]||0),discountAmount:m,discountPercentage:T,membershipType:e.membershipType||((o=e["Membership Type"])==null?void 0:o.trim())||""}});I(d)}catch(y){I([])}else I([])},[a]);const g=D.useMemo(()=>{if(!r.length)return{totalDiscountAmount:0,totalRevenueLost:0,totalTransactions:0,avgDiscountPercentage:0,totalPotentialRevenue:0,totalActualRevenue:0,discountEffectiveness:0,productBreakdown:[],monthlyBreakdown:[]};const y=r.reduce((t,f)=>t+(f.discountAmount||0),0),n=r.length,d=r.reduce((t,f)=>t+(f.mrpPostTax||f.paymentValue||0),0),e=r.reduce((t,f)=>t+(f.paymentValue||0),0),m=r.filter(t=>(t.discountAmount||0)>0),T=m.length>0?m.reduce((t,f)=>t+(f.discountPercentage||0),0)/m.length:0,p=r.reduce((t,f)=>{const h=f.cleanedProduct||"Unknown Product";return t[h]||(t[h]={product:h,transactions:0,totalDiscount:0,avgDiscountPercentage:0,revenue:0,totalMrp:0}),t[h].transactions+=1,t[h].totalDiscount+=f.discountAmount||0,t[h].revenue+=f.paymentValue||0,t[h].totalMrp+=f.mrpPostTax||f.paymentValue||0,t},{});Object.values(p).forEach(t=>{t.avgDiscountPercentage=t.totalMrp>0?t.totalDiscount/t.totalMrp*100:0});const l=r.reduce((t,f)=>{if(!f.paymentDate)return t;const h=f.paymentDate.substring(0,7);return t[h]||(t[h]={month:h,transactions:0,totalDiscount:0,revenue:0}),t[h].transactions+=1,t[h].totalDiscount+=f.discountAmount||0,t[h].revenue+=f.paymentValue||0,t},{});return{totalDiscountAmount:y,totalRevenueLost:y,totalTransactions:n,avgDiscountPercentage:T,totalPotentialRevenue:d,totalActualRevenue:e,discountEffectiveness:d>0?e/d*100:0,productBreakdown:Object.values(p),monthlyBreakdown:Object.values(l)}},[r]);return{data:r,metrics:g,loading:s,error:i}},rt=()=>{const[a,s]=D.useState(!1),i=(n,d)=>[d.join(","),...n.map(m=>d.map(T=>{const p=m[T];return p==null?"":typeof p=="string"&&p.includes(",")?`"${p.replace(/"/g,'""')}"`:p}).join(","))].join(`
`),r=(n,d)=>{const e=new Blob([n],{type:"text/csv;charset=utf-8;"}),m=document.createElement("a"),T=URL.createObjectURL(e);m.setAttribute("href",T),m.setAttribute("download",d),m.style.visibility="hidden",document.body.appendChild(m),m.click(),document.body.removeChild(m)},I=(n,d)=>{const e=new Ee("l","mm","a4"),m=e.internal.pageSize.getWidth();e.internal.pageSize.getHeight(),e.setFontSize(20),e.setTextColor(40,40,40),e.text("Complete Dashboard Export",m/2,20,{align:"center"}),e.setFontSize(10),e.setTextColor(100,100,100);const T=V(new Date,"PPP p");e.text(`Generated on: ${T}`,20,30),d.dateRange&&e.text(`Date Range: ${V(new Date(d.dateRange.start),"PP")} - ${V(new Date(d.dateRange.end),"PP")}`,20,35);let p=45;return n.salesData&&n.salesData.length>0&&(p=g(e,"Sales Analytics Data",n.salesData,p,["customerName","paymentDate","membershipType","paymentValue","calculatedLocation","soldBy","paymentMethod"])),n.sessionsData&&n.sessionsData.length>0&&(p=g(e,"Sessions Data",n.sessionsData,p,["date","classType","instructor","location","capacity","checkedIn","fillPercentage"])),n.newClientData&&n.newClientData.length>0&&(p=g(e,"Client Conversion Data",n.newClientData,p,["firstName","lastName","email","firstVisitDate","firstVisitLocation","conversionStatus","ltv"])),n.payrollData&&n.payrollData.length>0&&(p=g(e,"Trainer Performance Data",n.payrollData,p,["teacherName","location","totalSessions","totalCustomers","totalPaid","conversion","retention"])),n.lateCancellationsData&&n.lateCancellationsData.length>0&&(p=g(e,"Late Cancellations Data",n.lateCancellationsData,p,["firstName","lastName","sessionName","teacherName","location","dateIST","time"])),n.discountData&&n.discountData.length>0&&(p=g(e,"Discounts & Promotions Data",n.discountData,p,["firstName","lastName","cleanedProduct","mrpPostTax","discountAmount","discountPercentage","location"])),n.additionalData&&Object.entries(n.additionalData).forEach(([l,t])=>{if(t&&t.length>0){const f=Object.keys(t[0]).slice(0,7);p=g(e,l,t,p,f)}}),e},g=(n,d,e,m,T)=>{const p=n.internal.pageSize.getHeight();m>p-100&&(n.addPage(),m=20),n.setFontSize(14),n.setTextColor(60,60,60),n.text(d,20,m),m+=10;const l=e.slice(0,100).map(t=>T.map(f=>{const h=t[f];return h==null?"":typeof h=="number"?h.toLocaleString():String(h)}));return n.autoTable({head:[T.map(t=>t.charAt(0).toUpperCase()+t.slice(1).replace(/([A-Z])/g," $1"))],body:l,startY:m,styles:{fontSize:8,cellPadding:2},headStyles:{fillColor:[66,139,202],textColor:255,fontSize:9,fontStyle:"bold"},alternateRowStyles:{fillColor:[245,245,245]},margin:{left:20,right:20}}),n.lastAutoTable.finalY+15};return{exportAllData:(n,d)=>N(void 0,null,function*(){var e,m,T,p,l,t;s(!0);try{const f=d.fileName||`dashboard-export-${V(new Date,"yyyy-MM-dd-HH-mm")}`;if(d.format==="pdf")I(n,d).save(`${f}.pdf`);else if(d.format==="csv"){let h="";const o=[];if((e=n.salesData)!=null&&e.length){const E=Object.keys(n.salesData[0]);h+=`Sales Analytics Data
${i(n.salesData,E)}

`,o.push("Sales")}if((m=n.sessionsData)!=null&&m.length){const E=Object.keys(n.sessionsData[0]);h+=`Sessions Data
${i(n.sessionsData,E)}

`,o.push("Sessions")}if((T=n.newClientData)!=null&&T.length){const E=Object.keys(n.newClientData[0]);h+=`Client Conversion Data
${i(n.newClientData,E)}

`,o.push("Client Conversion")}if((p=n.payrollData)!=null&&p.length){const E=Object.keys(n.payrollData[0]);h+=`Trainer Performance Data
${i(n.payrollData,E)}

`,o.push("Trainer Performance")}if((l=n.lateCancellationsData)!=null&&l.length){const E=Object.keys(n.lateCancellationsData[0]);h+=`Late Cancellations Data
${i(n.lateCancellationsData,E)}

`,o.push("Late Cancellations")}if((t=n.discountData)!=null&&t.length){const E=Object.keys(n.discountData[0]);h+=`Discounts & Promotions Data
${i(n.discountData,E)}

`,o.push("Discounts")}n.additionalData&&Object.entries(n.additionalData).forEach(([E,c])=>{if(c!=null&&c.length){const P=Object.keys(c[0]);h+=`${E}
${i(c,P)}

`,o.push(E)}}),r(h,`${f}.csv`)}}catch(f){throw f}finally{s(!1)}}),isExporting:a}},ot=a=>{const{filters:s}=De();return{metrics:D.useMemo(()=>{if(!a||a.length===0)return[];const r=a,I=a.length,g=Math.floor(I/2),y=r.slice(0,g);r.slice(g);const n=r.reduce((S,C)=>S+(typeof C.paymentValue=="number"?C.paymentValue:0),0),d=r.reduce((S,C)=>S+(typeof C.discountAmount=="number"?C.discountAmount:0),0),e=r.length,m=new Set(r.map(S=>S.memberId||S.customerEmail).filter(Boolean)).size,T=r.length,p=e>0?n/e:0,l=m>0?n/m:0,t=r.length>0?r.reduce((S,C)=>S+(typeof C.discountPercentage=="number"?C.discountPercentage:0),0)/r.length:0,f=y.reduce((S,C)=>S+(typeof C.paymentValue=="number"?C.paymentValue:0),0),h=y.reduce((S,C)=>S+(typeof C.discountAmount=="number"?C.discountAmount:0),0),o=y.length,E=new Set(y.map(S=>S.memberId||S.customerEmail).filter(Boolean)).size,c=y.length,P=o>0?f/o:0,A=E>0?f/E:0,u=y.length>0?y.reduce((S,C)=>S+(typeof C.discountPercentage=="number"?C.discountPercentage:0),0)/y.length:0,R=(S,C)=>{if(C===0)return{rate:S>0?100:0,isSignificant:S>0,trend:"moderate"};const G=(S-C)/C*100,pe=Math.abs(G)>=5,fe=Math.abs(G)>=20?"strong":Math.abs(G)>=10?"moderate":"weak";return{rate:G,isSignificant:pe,trend:fe}},M=R(n,f),O=R(e,o),Q=R(m,E),W=R(T,c),J=R(p,P),ee=R(l,A),te=R(d,h),ae=R(t,u);return[{title:"Sales Revenue",value:k(n),rawValue:n,change:M.rate,changeDetails:M,icon:"DollarSign",color:"blue",description:"Total sales revenue across all transactions",previousValue:k(f),previousRawValue:f,comparison:{current:n,previous:f,difference:n-f}},{title:"Units Sold",value:w(T),rawValue:T,change:W.rate,changeDetails:W,icon:"ShoppingCart",color:"green",description:"Total number of units/items sold",previousValue:w(c),previousRawValue:c,comparison:{current:T,previous:c,difference:T-c}},{title:"Transactions",value:w(e),rawValue:e,change:O.rate,changeDetails:O,icon:"Activity",color:"purple",description:"Number of completed transactions",previousValue:w(o),previousRawValue:o,comparison:{current:e,previous:o,difference:e-o}},{title:"Unique Members",value:w(m),rawValue:m,change:Q.rate,changeDetails:Q,icon:"Users",color:"orange",description:"Individual customers who made purchases",previousValue:w(E),previousRawValue:E,comparison:{current:m,previous:E,difference:m-E}},{title:"Avg Transaction Value",value:k(p),rawValue:p,change:J.rate,changeDetails:J,icon:"Target",color:"cyan",description:"Average value per transaction",previousValue:k(P),previousRawValue:P,comparison:{current:p,previous:P,difference:p-P}},{title:"Avg Spend per Member",value:k(l),rawValue:l,change:ee.rate,changeDetails:ee,icon:"Calendar",color:"pink",description:"Average spending per unique customer",previousValue:k(A),previousRawValue:A,comparison:{current:l,previous:A,difference:l-A}},{title:"Discount Value",value:k(d),rawValue:d,change:te.rate,changeDetails:te,icon:"CreditCard",color:"red",description:"Total discount amount applied",previousValue:k(h),previousRawValue:h,comparison:{current:d,previous:h,difference:d-h}},{title:"Discount Percentage",value:le(t/100),rawValue:t,change:ae.rate,changeDetails:ae,icon:"ArrowDownRight",color:"amber",description:"Average discount rate applied",previousValue:le(u/100),previousRawValue:u,comparison:{current:t,previous:u,difference:t-u}}]},[a,s.dateRange])}},ct=a=>{let s=null;try{s=be().filters}catch(r){s=null}return D.useMemo(()=>a?a.filter(r=>{var g;const I=((g=r.sessionName)==null?void 0:g.toLowerCase())||"";if(I.includes("test")||I.includes("demo"))return!1;if(!s)return!0;if(s.trainers.length>0&&!s.trainers.includes(r.trainerName)||s.classTypes.length>0&&!s.classTypes.includes(r.cleanedClass)||s.dayOfWeek.length>0&&!s.dayOfWeek.includes(r.dayOfWeek)||s.timeSlots.length>0&&!s.timeSlots.includes(r.time))return!1;if(s.dateRange.start||s.dateRange.end){let y;if(r.date.includes("/")){const d=r.date.split("/");if(d.length===3){const e=parseInt(d[0]),m=parseInt(d[1]),T=parseInt(d[2]);y=new Date(T,m-1,e)}else y=new Date(r.date)}else y=new Date(r.date);if(isNaN(y.getTime()))return!0;const n=new Date(y.getFullYear(),y.getMonth(),y.getDate());if(s.dateRange.start){const d=new Date(s.dateRange.start.getFullYear(),s.dateRange.start.getMonth(),s.dateRange.start.getDate());if(n<d)return!1}if(s.dateRange.end){const d=new Date(s.dateRange.end.getFullYear(),s.dateRange.end.getMonth(),s.dateRange.end.getDate());if(n>d)return!1}}return!0}):[],[a,s])},Y={CLIENT_ID:"416630995185-007ermh3iidknbbtdmu5vct207mdlbaa.apps.googleusercontent.com",CLIENT_SECRET:"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",REFRESH_TOKEN:"1//04w4V2xMUIMzACgYIARAAGAQSNwF-L9Ir5__pXDmZVYaHKOSqyauTDVmTvrCvgaL2beep4gmp8_lVED0ppM9BPWDDimHyQKk50EY",TOKEN_URL:"https://oauth2.googleapis.com/token"},xe="1rGMDDvvTbZfNg1dueWtRN3LhOgGQOdLg3Fd7Sn1GCZo",it=()=>{const[a,s]=D.useState([]),[i,r]=D.useState(!0),[I,g]=D.useState(null),y=()=>N(void 0,null,function*(){try{return(yield(yield fetch(Y.TOKEN_URL,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:Y.CLIENT_ID,client_secret:Y.CLIENT_SECRET,refresh_token:Y.REFRESH_TOKEN,grant_type:"refresh_token"})})).json()).access_token}catch(d){throw d}}),n=()=>N(void 0,null,function*(){try{r(!0),g(null);const d=yield y(),e=["Expirations","Expiration","Members","Sheet1","Data"];let m,T="";for(const h of e)try{if(m=yield fetch(`https://sheets.googleapis.com/v4/spreadsheets/${xe}/values/${h}?alt=json`,{headers:{Authorization:`Bearer ${d}`}}),m.ok){T=h;break}}catch(o){continue}if(!m||!m.ok)throw new Error(`Failed to fetch expirations data from any sheet. Tried: ${e.join(", ")}`);const l=(yield m.json()).values||[];if(l.length<2){s([]);return}const t=l[0],f=[];for(let h=1;h<l.length;h++){const o=l[h];if(!o||o.length===0)continue;const E={uniqueId:o[t.findIndex(c=>c==="Unique Id")]||`exp-${Date.now()}-${h}`,memberId:o[t.findIndex(c=>c==="Member ID")]||"",firstName:o[t.findIndex(c=>c==="First Name")]||"",lastName:o[t.findIndex(c=>c==="Last Name")]||"",email:o[t.findIndex(c=>c==="Email")]||"",membershipName:o[t.findIndex(c=>c==="Membership Name")]||"",endDate:o[t.findIndex(c=>c==="End Date")]||"",homeLocation:o[t.findIndex(c=>c==="Home Location")]||"",currentUsage:o[t.findIndex(c=>c==="Current Usage")]||"",id:o[t.findIndex(c=>c==="Id")]||"",orderAt:o[t.findIndex(c=>c==="Order At")]||"",soldBy:o[t.findIndex(c=>c==="Sold By")]||"",membershipId:o[t.findIndex(c=>c==="Membership Id")]||"",frozen:o[t.findIndex(c=>c==="Frozen")]==="TRUE",paid:o[t.findIndex(c=>c==="Paid")]||"",status:o[t.findIndex(c=>c==="Status")]||""};f.push(E)}s(f),g(null)}catch(d){g(d instanceof Error?d.message:"Failed to load expirations data"),s([])}finally{r(!1)}});return D.useEffect(()=>{n()},[]),{data:a,loading:i,error:I||"",refetch:n}},K={CLIENT_ID:"416630995185-g7b0fm679lb4p45p5lou070cqscaalaf.apps.googleusercontent.com",CLIENT_SECRET:"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",REFRESH_TOKEN:"1//0gT2uoYBlNdGXCgYIARAAGBASNwF-L9IrBK_ijYwpce6-TdqDfji4GxYuc4uxIBKasdgoZBPm-tu_EU0xS34cNirqfLgXbJ8_NMk",TOKEN_URL:"https://oauth2.googleapis.com/token"},Me="1i5GcTahIchSF6pLn0c2ZgqtQVYBG-Fqt7rGxIzD7qrA",lt=()=>{const[a,s]=D.useState([]),[i,r]=D.useState(!0),[I,g]=D.useState(null),y=()=>N(void 0,null,function*(){try{return(yield(yield fetch(K.TOKEN_URL,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:K.CLIENT_ID,client_secret:K.CLIENT_SECRET,refresh_token:K.REFRESH_TOKEN,grant_type:"refresh_token"})})).json()).access_token}catch(e){throw e}}),n=e=>{if(typeof e=="number")return e;if(!e||e==="")return 0;const m=e.toString();if(m.includes("-")&&(m.includes("1899")||m.includes("1900")))return 0;const T=m.replace(/,/g,""),p=parseFloat(T);return isNaN(p)?0:p},d=()=>N(void 0,null,function*(){try{r(!0),g(null);const e=yield y(),m=yield fetch(`https://sheets.googleapis.com/v4/spreadsheets/${Me}/values/Checkins?alt=json`,{headers:{Authorization:`Bearer ${e}`}});if(!m.ok)throw new Error("Failed to fetch late cancellations data");const p=(yield m.json()).values||[];if(p.length<2){s([]);return}const l=[];if(p.length<2){s([]);return}const t=p[0],f=t.findIndex(h=>h==="Is Late Cancelled");if(f===-1){s([]);return}for(let h=1;h<p.length;h++){const o=p[h];if(!o||o.length===0||o[f]!=="TRUE")continue;const E={memberId:o[t.findIndex(c=>c==="Member ID")]||"",firstName:o[t.findIndex(c=>c==="First Name")]||"",lastName:o[t.findIndex(c=>c==="Last Name")]||"",email:o[t.findIndex(c=>c==="Email")]||"",location:o[t.findIndex(c=>c==="Location")]||"",sessionName:o[t.findIndex(c=>c==="Session Name")]||"",teacherName:o[t.findIndex(c=>c==="Teacher Name")]||"",cleanedProduct:o[t.findIndex(c=>c==="Cleaned Product")]||"",cleanedCategory:o[t.findIndex(c=>c==="Cleaned Category")]||"",cleanedClass:o[t.findIndex(c=>c==="Cleaned Class")]||"",paymentMethodName:o[t.findIndex(c=>c==="Payment Method Name")]||"",dateIST:o[t.findIndex(c=>c==="Date (IST)")]||"",dayOfWeek:o[t.findIndex(c=>c==="Day of Week")]||"",time:o[t.findIndex(c=>c==="Time")]||"",duration:n(o[t.findIndex(c=>c==="Duration (Minutes)")]||"0"),capacity:n(o[t.findIndex(c=>c==="Capacity")]||"0"),month:o[t.findIndex(c=>c==="Month")]||"",year:n(o[t.findIndex(c=>c==="Year")]||"0"),paidAmount:n(o[t.findIndex(c=>c==="Paid")]||"0"),isNew:o[t.findIndex(c=>c==="Is New")]||"",tableType:"checkins"};l.push(E)}s(l),g(null)}catch(e){g("Failed to load late cancellations data"),s([])}finally{r(!1)}});return D.useEffect(()=>{d()},[]),{data:a,loading:i,error:I,refetch:d}};export{Ye as a,le as b,w as c,ct as d,tt as e,k as f,ze as g,Qe as h,Ze as i,Ke as j,Je as k,at as l,nt as m,st as n,de as o,He as p,We as q,Xe as r,ot as s,me as t,et as u,it as v,lt as w,je as x,rt as y,qe as z};
