var zs=Object.defineProperty,Os=Object.defineProperties;var qs=Object.getOwnPropertyDescriptors;var ms=Object.getOwnPropertySymbols;var Es=Object.prototype.hasOwnProperty,Bs=Object.prototype.propertyIsEnumerable;var xs=(c,f,j)=>f in c?zs(c,f,{enumerable:!0,configurable:!0,writable:!0,value:j}):c[f]=j,J=(c,f)=>{for(var j in f||(f={}))Es.call(f,j)&&xs(c,j,f[j]);if(ms)for(var j of ms(f))Bs.call(f,j)&&xs(c,j,f[j]);return c},X=(c,f)=>Os(c,qs(f));import{j as e,r as T,a5 as Fe}from"./vendor-C0BDpuBq.js";import{C as F,j as K,k as W,c as I,a as Us,b as Ks,e as Ws,P as hs,J as us,d as G,K as ps,M as gs,S as je,f as be,g as ve,h as fe,i as re,I as Re,B as z,r as Ve,s as ze,t as H,u as ae,a5 as ls,L as xe,l as js,Z as Je,_ as _e,$ as Qe,a0 as Xe,T as Me,m as De,n as ie,o as B,p as Te,q as U,W as Gs,a3 as Ys,a2 as ts}from"./ui-components-QFBtivF8.js";import{f as ue,g as Be,U as Z,y as as,T as Ee,d as ye,A as Ue,b as le,e as Oe,F as ns,a as Ze,R as ks,X as Ne,O as Pe,a3 as bs,r as es,o as qe,E as Ss,h as is,a8 as cs,a9 as os,s as Ke,v as vs,aa as Hs,ab as Js,B as Ms,V as _s,Q as Qs,ac as Xs,Z as Ds,M as ke,I as fs,J as Zs,q as Ts,D as et,ad as st,ae as Ns,a2 as tt,N as at,S as As,j as Rs,k as Vs,af as nt,ag as rt,W as lt,c as rs,i as it,C as ct}from"./icons-vendor-qADr320u.js";import{c as M,f as Q,b as _,q as ot,r as dt,g as ys}from"./utils-Bdg8MxXz.js";import{c as ne}from"./dashboard-classes-C_xvoG_a.js";import{S as mt}from"./dashboard-sales-DsSMJ1QD.js";import{f as Ge}from"./utils-vendor-J2la9FRB.js";import{R as we,P as Ps,d as Fs,e as Is,T as Ce,B as Ye,C as Ie,X as $e,Y as Le,c as Ae,A as $s,f as He,a as Ls,L as xt,b as ht}from"./chart-vendor-B9OoFuvI.js";const Rt=({onButtonClick:c})=>{const f=[{id:"executive-summary",title:"Executive Summary",description:"High-level business metrics and KPIs",icon:ue,color:"from-blue-500 to-blue-600",hoverColor:"hover:from-blue-600 hover:to-blue-700"},{id:"sales-analytics",title:"Sales Analytics",description:"Revenue trends and sales performance",icon:Be,color:"from-green-500 to-green-600",hoverColor:"hover:from-green-600 hover:to-green-700"},{id:"class-attendance",title:"Class Attendance",description:"Session attendance and capacity analysis",icon:Z,color:"from-purple-500 to-purple-600",hoverColor:"hover:from-purple-600 hover:to-purple-700"},{id:"trainer-performance",title:"Trainer Performance",description:"Individual trainer metrics and rankings",icon:as,color:"from-orange-500 to-orange-600",hoverColor:"hover:from-orange-600 hover:to-orange-700"},{id:"client-retention",title:"Client Retention",description:"Member retention and conversion analysis",icon:Ee,color:"from-teal-500 to-teal-600",hoverColor:"hover:from-teal-600 hover:to-teal-700"},{id:"discounts-promotions",title:"Discounts & Promotions",description:"Discount analysis and promotional effectiveness",icon:ye,color:"from-pink-500 to-pink-600",hoverColor:"hover:from-pink-600 hover:to-pink-700"},{id:"funnel-leads",title:"Funnel & Leads",description:"Lead conversion and sales funnel analysis",icon:Ue,color:"from-indigo-500 to-indigo-600",hoverColor:"hover:from-indigo-600 hover:to-indigo-700"},{id:"class-performance-series",title:"Class Performance Series",description:"Detailed class format performance analysis",icon:le,color:"from-cyan-500 to-cyan-600",hoverColor:"hover:from-cyan-600 hover:to-cyan-700"},{id:"late-cancellations",title:"Late Cancellations",description:"Analysis of late cancellations and no-shows",icon:Oe,color:"from-red-500 to-red-600",hoverColor:"hover:from-red-600 hover:to-red-700"},{id:"powercycle-vs-barre",title:"powerCycle Vs Barre Vs Strength",description:"Comparative analysis of PowerCycle, Barre, and Strength classes",icon:Ue,color:"from-violet-500 to-violet-600",hoverColor:"hover:from-violet-600 hover:to-violet-700"},{id:"expiration-analytics",title:"Expirations & Churn",description:"Membership expirations and customer retention analysis",icon:le,color:"from-amber-500 to-amber-600",hoverColor:"hover:from-amber-600 hover:to-amber-700"}];return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 p-2",children:f.map(j=>{const V=j.icon;return e.jsxs(F,{className:"group cursor-pointer relative overflow-hidden bg-white/80 backdrop-blur-sm border-0 shadow-lg hover:shadow-2xl transition-all duration-500 ease-out hover:-translate-y-3 hover:rotate-1 transform-gpu",onClick:()=>c(j.id),children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${j.color} opacity-0 group-hover:opacity-10 transition-opacity duration-700`}),e.jsx("div",{className:`absolute inset-0 rounded-lg bg-gradient-to-r ${j.color} opacity-0 group-hover:opacity-20 blur-xl transition-all duration-500 -z-10`}),e.jsxs(K,{className:"pb-4 relative z-10",children:[e.jsxs("div",{className:`w-14 h-14 rounded-2xl bg-gradient-to-br ${j.color} ${j.hoverColor} flex items-center justify-center mb-4 transition-all duration-500 group-hover:scale-125 group-hover:rotate-12 shadow-lg group-hover:shadow-2xl`,children:[e.jsx(V,{className:"w-7 h-7 text-white transition-transform duration-300 group-hover:scale-110"}),e.jsx("div",{className:`absolute inset-0 rounded-2xl bg-gradient-to-r ${j.color} opacity-0 group-hover:opacity-30 animate-ping`})]}),e.jsx(W,{className:"text-xl font-bold text-gray-900 group-hover:bg-gradient-to-r group-hover:from-gray-900 group-hover:to-gray-600 group-hover:bg-clip-text group-hover:text-transparent transition-all duration-500 leading-tight",children:j.title})]}),e.jsxs(I,{className:"pt-0 relative z-10",children:[e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed mb-4 transition-colors duration-300 group-hover:text-gray-700",children:j.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[e.jsx("div",{className:"w-2.5 h-2.5 bg-emerald-400 rounded-full mr-2 animate-pulse shadow-sm shadow-emerald-400/50 group-hover:animate-bounce"}),e.jsx("span",{className:"font-medium group-hover:text-emerald-600 transition-colors",children:"Active"})]}),e.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-100 group-hover:bg-gray-200 flex items-center justify-center transition-all duration-300 group-hover:translate-x-1",children:e.jsx("svg",{className:"w-3 h-3 text-gray-400 group-hover:text-gray-600 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),e.jsx("div",{className:`absolute bottom-0 left-0 h-1 bg-gradient-to-r ${j.color} transform scale-x-0 group-hover:scale-x-100 transition-transform duration-500 origin-left rounded-full`})]}),e.jsxs("div",{className:"absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity duration-700",children:[e.jsx("div",{className:"w-1 h-1 bg-white rounded-full animate-bounce delay-100"}),e.jsx("div",{className:"w-1 h-1 bg-white rounded-full animate-bounce delay-200 mt-1 ml-2"}),e.jsx("div",{className:"w-1 h-1 bg-white rounded-full animate-bounce delay-300 mt-1"})]})]},j.id)})})},ut=({filters:c,onFiltersChange:f,onReset:j})=>{var D,p,o;const[V,S]=T.useState(!1),[N,y]=T.useState(c.dateRange.start?new Date(c.dateRange.start):void 0),[d,h]=T.useState(c.dateRange.end?new Date(c.dateRange.end):void 0),[b,x]=T.useState(c),C=()=>{const n=X(J({},b),{dateRange:{start:N?Ge(N,"yyyy-MM-dd"):"",end:d?Ge(d,"yyyy-MM-dd"):""}});f(n),S(!1)},w=()=>{j(),y(void 0),h(void 0),x({dateRange:{start:"",end:""},location:[],category:[],product:[],soldBy:[],paymentMethod:[]}),S(!1)},R=(n,t)=>{if(n==="dateRange")y(void 0),h(void 0),f(X(J({},c),{dateRange:{start:"",end:""}}));else if(Array.isArray(c[n])){const u=c[n].filter(r=>r!==t);f(X(J({},c),{[n]:u}))}},A=(()=>{var t,u,r;let n=0;return(c.dateRange.start||c.dateRange.end)&&n++,(t=c.category)!=null&&t.length&&(n+=c.category.length),(u=c.paymentMethod)!=null&&u.length&&(n+=c.paymentMethod.length),(r=c.soldBy)!=null&&r.length&&(n+=c.soldBy.length),(c.minAmount||c.maxAmount)&&n++,n})();return e.jsxs(F,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl backdrop-blur-sm",children:[e.jsxs(Us,{open:V,onOpenChange:S,children:[e.jsx(Ks,{asChild:!0,children:e.jsx(K,{className:"cursor-pointer hover:bg-slate-50/50 transition-colors rounded-t-xl",children:e.jsxs(W,{className:"flex items-center justify-between text-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-full bg-gradient-to-r from-blue-500 to-purple-600",children:e.jsx(ns,{className:"w-5 h-5 text-white"})}),e.jsx("span",{className:"bg-gradient-to-r from-slate-700 via-slate-800 to-slate-900 bg-clip-text text-transparent",children:"Advanced Filters"}),A>0&&e.jsxs(z,{variant:"default",className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white",children:[A," active"]})]}),e.jsx(Ze,{className:ne("w-5 h-5 transition-transform text-slate-600",V&&"rotate-180")})]})})}),e.jsx(Ws,{children:e.jsxs(I,{className:"space-y-6 pt-0",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-700",children:"Start Date"}),e.jsxs(hs,{children:[e.jsx(us,{asChild:!0,children:e.jsxs(G,{variant:"outline",className:ne("w-full justify-start text-left font-normal bg-white/80 backdrop-blur-sm",!N&&"text-muted-foreground"),children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),N?Ge(N,"PPP"):"Pick start date"]})}),e.jsx(ps,{className:"w-auto p-0",align:"start",children:e.jsx(gs,{mode:"single",selected:N,onSelect:y,initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-700",children:"End Date"}),e.jsxs(hs,{children:[e.jsx(us,{asChild:!0,children:e.jsxs(G,{variant:"outline",className:ne("w-full justify-start text-left font-normal bg-white/80 backdrop-blur-sm",!d&&"text-muted-foreground"),children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),d?Ge(d,"PPP"):"Pick end date"]})}),e.jsx(ps,{className:"w-auto p-0",align:"start",children:e.jsx(gs,{mode:"single",selected:d,onSelect:h,initialFocus:!0})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-700",children:"Category"}),e.jsxs(je,{value:"",onValueChange:n=>{var t;(t=b.category)!=null&&t.includes(n)||x(X(J({},b),{category:[...b.category||[],n]}))},children:[e.jsx(be,{className:"bg-white/80 backdrop-blur-sm",children:e.jsx(ve,{placeholder:"Select categories..."})}),e.jsxs(fe,{children:[e.jsx(re,{value:"membership",children:"Membership"}),e.jsx(re,{value:"class-packages",children:"Class Packages"}),e.jsx(re,{value:"merchandise",children:"Merchandise"}),e.jsx(re,{value:"personal-training",children:"Personal Training"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-700",children:"Min Amount"}),e.jsx(Re,{type:"number",placeholder:"₹0",value:b.minAmount||"",onChange:n=>x(X(J({},b),{minAmount:n.target.value?Number(n.target.value):void 0})),className:"bg-white/80 backdrop-blur-sm"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-700",children:"Max Amount"}),e.jsx(Re,{type:"number",placeholder:"₹100,000",value:b.maxAmount||"",onChange:n=>x(X(J({},b),{maxAmount:n.target.value?Number(n.target.value):void 0})),className:"bg-white/80 backdrop-blur-sm"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-slate-200/50",children:[e.jsx(G,{onClick:C,className:"flex-1 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700",children:"Apply Filters"}),e.jsxs(G,{onClick:w,variant:"outline",className:"gap-2",children:[e.jsx(ks,{className:"w-4 h-4"}),"Reset"]})]})]})})]}),A>0&&e.jsx(I,{className:"pt-0 pb-4",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(c.dateRange.start||c.dateRange.end)&&e.jsxs(z,{variant:"secondary",className:"gap-1",children:["Date: ",c.dateRange.start||"..."," to ",c.dateRange.end||"...",e.jsx(Ne,{className:"w-3 h-3 cursor-pointer hover:text-red-500",onClick:()=>R("dateRange","")})]}),(D=c.category)==null?void 0:D.map(n=>e.jsxs(z,{variant:"secondary",className:"gap-1",children:["Category: ",n,e.jsx(Ne,{className:"w-3 h-3 cursor-pointer hover:text-red-500",onClick:()=>R("category",n)})]},n)),(p=c.paymentMethod)==null?void 0:p.map(n=>e.jsxs(z,{variant:"secondary",className:"gap-1",children:["Payment: ",n,e.jsx(Ne,{className:"w-3 h-3 cursor-pointer hover:text-red-500",onClick:()=>R("paymentMethod",n)})]},n)),(o=c.soldBy)==null?void 0:o.map(n=>e.jsxs(z,{variant:"secondary",className:"gap-1",children:["Sold by: ",n,e.jsx(Ne,{className:"w-3 h-3 cursor-pointer hover:text-red-500",onClick:()=>R("soldBy",n)})]},n)),(c.minAmount||c.maxAmount)&&e.jsxs(z,{variant:"secondary",className:"gap-1",children:["Amount: ₹",c.minAmount||0," - ₹",c.maxAmount||"∞",e.jsx(Ne,{className:"w-3 h-3 cursor-pointer hover:text-red-500",onClick:()=>f(X(J({},c),{minAmount:void 0,maxAmount:void 0}))})]})]})})]})},Vt=({data:c,onRowClick:f})=>{const[j,V]=T.useState("product"),[S,N]=T.useState(!1),[y,d]=T.useState(null),[h,b]=T.useState(!1),x=p=>{const o=c.reduce((n,t)=>{let u="";switch(p){case"product":u=t.cleanedProduct;break;case"category":u=t.cleanedCategory;break;case"member":u=t.customerName;break;case"seller":u=t.soldBy;break}return n[u]||(n[u]={name:u,totalValue:0,unitsSold:0,transactions:0,uniqueMembers:new Set,atv:0,auv:0,asv:0,upt:0}),n[u].totalValue+=t.paymentValue,n[u].unitsSold+=1,n[u].transactions+=1,n[u].uniqueMembers.add(t.memberId),n},{});return Object.values(o).forEach(n=>{const t=n.uniqueMembers.size;n.uniqueMembers=t,n.atv=n.transactions>0?n.totalValue/n.transactions:0,n.auv=n.unitsSold>0?n.totalValue/n.unitsSold:0,n.asv=t>0?n.totalValue/t:0,n.upt=n.transactions>0?n.unitsSold/n.transactions:0}),Object.values(o).sort((n,t)=>t.totalValue-n.totalValue)},C=p=>{switch(p){case"product":return{icon:Pe,label:"Products",description:"Individual product performance"};case"category":return{icon:bs,label:"Categories",description:"Category-wise performance"};case"member":return{icon:Z,label:"Members",description:"Customer spending patterns"};case"seller":return{icon:as,label:"Associates",description:"Sales representative performance"};default:return{icon:Pe,label:"Products",description:"Performance data"}}},w=(p,o,n)=>{var u,r;const t=C(n);return t.icon,e.jsxs(F,{className:"bg-gradient-to-br from-white via-slate-50/50 to-white border-0 shadow-xl hover:shadow-2xl transition-all duration-500",children:[e.jsx(K,{className:"pb-4",children:e.jsx(W,{className:"flex items-center gap-3 text-xl",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-2 rounded-full bg-gradient-to-r from-yellow-400 to-orange-500",children:e.jsx(es,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsxs("span",{className:"bg-gradient-to-r from-yellow-600 to-orange-600 bg-clip-text text-transparent",children:["Top ",$," ",t.label]}),e.jsx("p",{className:"text-sm text-slate-600 font-normal",children:t.description})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-2 rounded-full bg-gradient-to-r from-red-400 to-rose-500",children:e.jsx(qe,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsxs("span",{className:"bg-gradient-to-r from-red-600 to-rose-600 bg-clip-text text-transparent",children:["Bottom ",$," ",t.label]}),e.jsx("p",{className:"text-sm text-slate-600 font-normal",children:"Areas for improvement"})]})]})})}),e.jsxs(I,{className:"space-y-4",children:[p.map((s,l)=>e.jsxs("div",{className:"group flex items-center justify-between p-4 rounded-xl bg-white shadow-sm border hover:shadow-md transition-all duration-300 cursor-pointer",onClick:()=>{const i=c.filter(m=>{switch(n){case"product":return m.cleanedProduct===s.name;case"category":return m.cleanedCategory===s.name;case"member":return m.customerName===s.name;case"seller":return m.soldBy===s.name;default:return!1}});f==null||f(X(J({},s),{rawData:i,filteredTransactionData:i,type:n,title:s.name,name:s.name,grossRevenue:s.totalValue,totalRevenue:s.totalValue,totalValue:s.totalValue,totalCurrent:s.totalValue,metricValue:s.totalValue,transactions:s.transactions,totalTransactions:s.transactions,uniqueMembers:s.uniqueMembers,totalCustomers:s.uniqueMembers,totalChange:12.5,months:{},monthlyValues:{},isDynamic:!0,calculatedFromFiltered:!0}))},children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("div",{className:ne("w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold shadow-sm",o?"bg-gradient-to-r from-green-400 to-emerald-600 text-white":"bg-gradient-to-r from-red-400 to-rose-600 text-white"),children:l+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-slate-900 whitespace-normal break-words group-hover:text-blue-600 transition-colors",children:s.name}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[e.jsxs(z,{variant:"secondary",className:"text-xs bg-blue-50 text-blue-700 border-blue-200",children:[M(s.transactions)," txns"]}),e.jsxs(z,{variant:"outline",className:"text-xs border-purple-200 text-purple-700",children:["ATV: ",Q(s.atv)]}),e.jsxs(z,{variant:"outline",className:"text-xs border-green-200 text-green-700",children:["AUV: ",Q(s.auv)]}),e.jsxs(z,{variant:"outline",className:"text-xs border-orange-200 text-orange-700",children:["ASV: ",Q(s.asv)]}),e.jsxs(z,{variant:"outline",className:"text-xs border-slate-200 text-slate-700",children:["UPT: ",s.upt.toFixed(2)]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-xl text-slate-900 group-hover:text-blue-600 transition-colors",children:Q(s.totalValue)}),e.jsxs("p",{className:"text-sm text-slate-500",children:[M(s.unitsSold)," units"]}),e.jsxs("p",{className:"text-xs text-slate-400",children:[M(s.uniqueMembers)," customers"]}),e.jsxs(G,{variant:"ghost",size:"sm",className:"mt-1 opacity-0 group-hover:opacity-100 transition-all duration-300 hover:bg-blue-50 hover:text-blue-600 hover:shadow-sm",onClick:i=>{i.stopPropagation();const m=c.filter(g=>{switch(n){case"product":return g.cleanedProduct===s.name;case"category":return g.cleanedCategory===s.name;case"member":return g.customerName===s.name;case"seller":return g.soldBy===s.name;default:return!1}}),a=X(J({},s),{rawData:m,filteredTransactionData:m,type:n,title:s.name,name:s.name,grossRevenue:s.totalValue,totalValue:s.totalValue,totalCurrent:s.totalValue,metricValue:s.totalValue,transactions:s.transactions,totalTransactions:s.transactions,uniqueMembers:s.uniqueMembers,totalCustomers:s.uniqueMembers,totalChange:0,months:{},monthlyValues:{}});d(a),b(!0)},children:[e.jsx(Ss,{className:"w-3 h-3 mr-1"}),"View Analytics"]})]})]},s.name)),e.jsxs("div",{className:"mt-6 p-4 bg-gradient-to-r from-slate-50 to-slate-100 rounded-lg border",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h4",{className:"font-semibold text-slate-800 flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"Performance Summary"]}),e.jsxs(G,{variant:"outline",size:"sm",onClick:()=>N(!S),className:"text-xs",children:["Show ",S?"Less":"More"]})]}),e.jsxs("ul",{className:"text-sm text-slate-600 space-y-1",children:[e.jsxs("li",{children:["• Average revenue: ",Q(p.reduce((s,l)=>s+l.totalValue,0)/p.length)]}),e.jsxs("li",{children:["• Total transactions: ",M(p.reduce((s,l)=>s+l.transactions,0))]}),e.jsxs("li",{children:["• Combined customer reach: ",M(p.reduce((s,l)=>s+l.uniqueMembers,0))," unique customers"]}),e.jsxs("li",{children:["• Performance spread: ",((((u=p[0])==null?void 0:u.totalValue)/((r=p[p.length-1])==null?void 0:r.totalValue)||1)-1).toFixed(1),"x variance"]})]})]})]})]})},R=x(j),$=S?10:5,A=R.slice(0,$),D=R.slice(-$).reverse();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(F,{className:"bg-gradient-to-br from-white via-slate-50/20 to-white border-0 shadow-xl",children:[e.jsx(K,{className:"pb-4",children:e.jsx(W,{className:"text-2xl font-bold bg-gradient-to-r from-slate-700 via-slate-800 to-slate-900 bg-clip-text text-transparent",children:"Performance Analysis"})}),e.jsx(I,{children:e.jsxs(Ve,{value:j,onValueChange:V,className:"w-full",children:[e.jsxs(ze,{className:"grid w-full grid-cols-4 bg-gradient-to-r from-blue-50 via-purple-50 to-blue-50 p-2 rounded-2xl shadow-lg border border-slate-200/30",children:[e.jsxs(H,{value:"product",className:"text-sm font-bold transition-all duration-300 data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-purple-600 data-[state=active]:text-white data-[state=active]:shadow-lg rounded-xl",children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Products"]}),e.jsxs(H,{value:"category",className:"text-sm font-bold transition-all duration-300 data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-purple-600 data-[state=active]:text-white data-[state=active]:shadow-lg rounded-xl",children:[e.jsx(bs,{className:"w-4 h-4 mr-2"}),"Categories"]}),e.jsxs(H,{value:"member",className:"text-sm font-bold transition-all duration-300 data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-purple-600 data-[state=active]:text-white data-[state=active]:shadow-lg rounded-xl",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Members"]}),e.jsxs(H,{value:"seller",className:"text-sm font-bold transition-all duration-300 data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-500 data-[state=active]:to-purple-600 data-[state=active]:text-white data-[state=active]:shadow-lg rounded-xl",children:[e.jsx(as,{className:"w-4 h-4 mr-2"}),"Associates"]})]}),e.jsx(ae,{value:j,className:"mt-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[w(A,!0,j),w(D,!1,j)]})})]})})]}),e.jsx(mt,{isOpen:h,onClose:()=>b(!1),data:y})]})},ss=({value:c,onValueChange:f,className:j=""})=>e.jsx(Ve,{value:c,onValueChange:f,className:j,children:e.jsxs(ze,{className:"grid w-full grid-cols-3 lg:grid-cols-11 bg-white border border-gray-200 p-1 rounded-xl shadow-sm h-auto gap-1",children:[e.jsx(H,{value:"revenue",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"Revenue"}),e.jsx(H,{value:"units",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"Units Sold"}),e.jsx(H,{value:"transactions",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"Transactions"}),e.jsx(H,{value:"members",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"Members"}),e.jsx(H,{value:"auv",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"AUV"}),e.jsx(H,{value:"atv",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"ATV"}),e.jsx(H,{value:"asv",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"ASV"}),e.jsx(H,{value:"upt",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"UPT"}),e.jsx(H,{value:"vat",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"VAT"}),e.jsx(H,{value:"discountValue",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"Discount ₹"}),e.jsx(H,{value:"discountPercentage",className:"text-xs px-3 py-2.5 min-w-20 h-8 flex items-center justify-center data-[state=active]:bg-blue-600 data-[state=active]:text-white rounded-lg transition-all duration-200",children:"Discount %"})]})}),pt=c=>c.reduce((f,j)=>{const V=j.cleanedCategory||"Uncategorized",S=j.cleanedProduct||"Unspecified";return f[V]||(f[V]={}),f[V][S]||(f[V][S]=[]),f[V][S].push(j),f},{}),Pt=({data:c,filters:f={dateRange:{start:"",end:""},location:[],category:[],product:[],soldBy:[],paymentMethod:[]},onRowClick:j,collapsedGroups:V=new Set,onGroupToggle:S=()=>{},selectedMetric:N="revenue"})=>{const[y,d]=T.useState(N),[h,b]=T.useState(!1),[x,C]=T.useState(new Set),[w,R]=T.useState(!1),$=s=>{if(!s)return null;const l=s.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(l){const[,m,a,g]=l;return new Date(parseInt(g),parseInt(a)-1,parseInt(m))}const i=new Date(s);return isNaN(i.getTime())?null:i},A=(s,l)=>{if(!s.length)return 0;const i=s.reduce((P,O)=>P+(O.paymentValue||0),0),m=s.length,a=new Set(s.map(P=>P.memberId)).size,g=s.length,v=s.reduce((P,O)=>P+(O.discountAmount||0),0),k=s.length>0?s.reduce((P,O)=>P+(O.discountPercentage||0),0)/s.length:0;switch(l){case"revenue":return i;case"transactions":return m;case"members":return a;case"units":return g;case"atv":return m>0?i/m:0;case"auv":return a>0?i/a:0;case"asv":return new Set(s.map(L=>L.saleItemId)).size>0?i/new Set(s.map(L=>L.saleItemId)).size:0;case"upt":const P=s.length,O=new Set(s.map(L=>L.paymentTransactionId)).size;return O>0?P/O:0;case"vat":return s.reduce((L,Y)=>L+(Y.paymentVAT||0),0);case"netRevenue":const E=i,q=s.reduce((L,Y)=>L+(Y.paymentVAT||0),0);return E-q;case"discountValue":return v;case"discountPercentage":return k;default:return 0}},D=(s,l)=>{switch(l){case"revenue":case"auv":case"asv":case"atv":case"vat":case"netRevenue":case"discountValue":return Q(s);case"transactions":case"members":case"units":return M(s);case"upt":return s.toFixed(2);case"discountPercentage":return`${s.toFixed(1)}%`;default:return M(s)}},p=(s,l)=>l===0&&s===0?null:l===0?"+100":((s-l)/l*100).toFixed(1),o=T.useMemo(()=>Array.isArray(c)?c.filter(s=>{var l,i,m,a,g;return!(((l=f==null?void 0:f.location)==null?void 0:l.length)>0&&!f.location.includes(s.calculatedLocation)||((i=f==null?void 0:f.category)==null?void 0:i.length)>0&&!f.category.includes(s.cleanedCategory)||((m=f==null?void 0:f.product)==null?void 0:m.length)>0&&!f.product.includes(s.cleanedProduct)||((a=f==null?void 0:f.soldBy)==null?void 0:a.length)>0&&!f.soldBy.includes(s.soldBy)||((g=f==null?void 0:f.paymentMethod)==null?void 0:g.length)>0&&!f.paymentMethod.includes(s.paymentMethod)||(f==null?void 0:f.minAmount)!==void 0&&s.paymentValue<f.minAmount||(f==null?void 0:f.maxAmount)!==void 0&&s.paymentValue>f.maxAmount)}):[],[c,f]),n=T.useMemo(()=>{const s=[],l=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];for(let i=7;i>=0;i--){const m=l[i],a=i+1;s.push({key:`2024-${String(a).padStart(2,"0")}`,display:`${m} 2024`,year:2024,month:a,sortOrder:(5-i)*2}),s.push({key:`2025-${String(a).padStart(2,"0")}`,display:`${m} 2025`,year:2025,month:a,sortOrder:(5-i)*2+1})}return s},[]),t=T.useMemo(()=>{const s=pt(o),l=Object.entries(s).map(([i,m])=>{const a={category:i,products:Object.entries(m).map(([v,k])=>{const P={};n.forEach(({key:q,year:L,month:Y})=>{const se=k.filter(te=>{const ee=$(te.paymentDate);return ee&&ee.getFullYear()===L&&ee.getMonth()+1===Y});P[q]=A(se,y)});const O=Object.values(P).filter(q=>q>0),E={atv:O.length>0?O.reduce((q,L)=>q+L,0)/O.length:0,auv:O.length>0?O.reduce((q,L)=>q+L,0)/O.length:0,asv:O.length>0?O.reduce((q,L)=>q+L,0)/O.length:0,upt:O.length>0?O.reduce((q,L)=>q+L,0)/O.length:0};return{product:v,monthlyValues:P,rawData:k,averages:E}})},g={};return n.forEach(({key:v})=>{g[v]=a.products.reduce((k,P)=>k+(P.monthlyValues[v]||0),0)}),X(J({},a),{monthlyValues:g})});return!w&&l.length>0&&(C(new Set),R(!0)),l},[o,y,n,w]),u=T.useCallback(()=>{window.location.reload()},[]);T.useCallback(()=>{const s=t.map(a=>{const g=[a.category,...n.map(({key:k})=>D(a.monthlyValues[k]||0,y))].join(","),v=a.products.map(k=>[`  ${k.product}`,...n.map(({key:P})=>D(k.monthlyValues[P]||0,y))].join(","));return[g,...v].join(`
`)}).join(`
`),l=new Blob([s],{type:"text/csv"}),i=window.URL.createObjectURL(l),m=document.createElement("a");m.href=i,m.download=`year-on-year-${y}-data.csv`,m.click()},[t,n,y]),T.useCallback(s=>{},[]);const r=T.useCallback(s=>{const l=new Set(x);l.has(s)?l.delete(s):l.add(s),C(l)},[x]);return e.jsxs(F,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl",children:[e.jsx(K,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(W,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5 text-blue-600"}),"Year-on-Year Performance Analysis"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Monthly comparison between 2024 and 2025 with alternating year display"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(G,{variant:"outline",size:"sm",onClick:u,className:"flex items-center gap-2 hover:bg-purple-50 hover:text-purple-700",children:[e.jsx(ks,{className:"w-4 h-4"}),"Refresh"]})})]}),e.jsx(ss,{value:y,onValueChange:d,className:"w-full"})]})}),e.jsx(I,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white border-t border-gray-200 rounded-lg",children:[e.jsx("thead",{className:"bg-gradient-to-r from-purple-700 to-purple-900 text-white font-semibold text-sm uppercase tracking-wider sticky top-0 z-30",children:e.jsxs("tr",{className:"bg-gradient-to-r from-blue-800 to-indigo-900 text-white font-semibold text-sm uppercase tracking-wider",children:[e.jsx("th",{className:"bg-gradient-to-r from-blue-800 to-blue-800 text-white font-semibold text-sm uppercase tracking-wider px-4 py-2 sticky left-0 z-40",children:"Product/Category"}),n.map(({key:s,display:l,year:i})=>e.jsx("th",{className:"text-white font-semibold text-sm uppercase tracking-wider px-4 py-2",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-base",children:l.split(" ")[0]}),e.jsx("span",{className:"text-yellow-200 text-xs",children:l.split(" ")[1]})]})},s))]})}),e.jsxs("tbody",{children:[t.map(s=>e.jsxs(Fe.Fragment,{children:[e.jsxs("tr",{onClick:()=>r(s.category),className:"bg-white hover:bg-gray-100 cursor-pointer border-b border-gray-200 group transition-colors duration-200 ease-in-out",children:[e.jsx("td",{className:"py-2 font-semibold text-gray-800 group-hover:text-gray-900 bg-white group-hover:bg-gray-100 sticky left-0 z-20 transition-colors duration-200 ease-in-out px-[10px] min-w-80 text-sm max-h-[35px] h-[35px] overflow-hidden",children:e.jsxs("div",{className:"flex justify-between items-center min-w-full text-md text-bold",children:[x.has(s.category)?e.jsx(is,{className:"w-4 h-4 mr-2 text-gray-500 transition-transform duration-200"}):e.jsx(Ze,{className:"w-4 h-4 mr-2 text-gray-500 transition-transform duration-200"}),s.category,e.jsxs(z,{variant:"secondary",className:"ml-auto text-sm text-yellow-300 min-w-12 bg-slate-950 rounded-xl",children:[s.products.length," products"]})]})}),n.map(({key:l,year:i,month:m,display:a},g)=>{const v=s.monthlyValues[l]||0,k=g>0&&s.monthlyValues[n[g-1].key]||0,P=p(v,k);return e.jsx("td",{className:"px-4 py-2 text-center font-semibold text-gray-900 text-sm hover:bg-blue-100 cursor-pointer transition-colors max-h-[35px] h-[35px] overflow-hidden",title:P?`${P}% vs last year`:"",onClick:O=>{O.stopPropagation();const E=c.filter(te=>{const ee=$(te.paymentDate);if(!ee)return!1;const me=te.cleanedCategory===s.category,ge=ee.getFullYear()===i&&ee.getMonth()+1===m;return me&&ge}),q=E.reduce((te,ee)=>te+(ee.paymentValue||0),0),L=E.length,Y=new Set(E.map(te=>te.memberId||te.customerEmail)).size,se={name:`${s.category} - ${a}`,category:s.category,totalRevenue:q,grossRevenue:q,netRevenue:q,totalValue:q,totalCurrent:q,metricValue:q,transactions:L,totalTransactions:L,uniqueMembers:Y,totalCustomers:Y,rawData:E,filteredTransactionData:E,isDynamic:!0,calculatedFromFiltered:!0,isGroupCell:!0,cellSpecific:!0,month:a,monthKey:l};j&&j(se)},children:D(s.monthlyValues[l]||0,y)},l)})]}),!x.has(s.category)&&s.products.map(l=>e.jsxs("tr",{className:"hover:bg-blue-50 cursor-pointer border-b border-gray-100 transition-colors duration-200",onClick:()=>j&&j(l.rawData),children:[e.jsx("td",{className:"px-8 py-3 text-sm text-gray-700 hover:text-blue-700 sticky left-0 bg-white hover:bg-blue-50 z-10 transition-colors duration-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:l.product}),["atv","auv","asv","upt"].includes(y)&&e.jsxs(z,{variant:"outline",className:"text-xs ml-2 border-blue-200 text-blue-700",children:["Avg: ",D(l.averages[y]||0,y)]})]})}),n.map(({key:i,year:m,month:a,display:g})=>e.jsx("td",{className:"px-4 py-3 text-center text-sm text-gray-900 font-mono hover:bg-blue-50 cursor-pointer transition-colors",onClick:v=>{v.stopPropagation();const k=(Array.isArray(l.rawData)?l.rawData:[]).filter(L=>{const Y=$(L.paymentDate);return Y?Y.getFullYear()===m&&Y.getMonth()+1===a:!1}),P=k.reduce((L,Y)=>L+(Y.paymentValue||0),0),O=k.length,E=new Set(k.map(L=>L.memberId||L.customerEmail)).size,q=X(J({},l),{name:`${l.product} - ${g}`,totalRevenue:P,grossRevenue:P,netRevenue:P,totalValue:P,totalCurrent:P,metricValue:P,transactions:O,totalTransactions:O,uniqueMembers:E,totalCustomers:E,rawData:k,filteredTransactionData:k,isDynamic:!0,calculatedFromFiltered:!0,cellSpecific:!0,month:g,monthKey:i});j&&j(q)},children:D(l.monthlyValues[i]||0,y)},i))]},`${s.category}-${l.product}`)),e.jsxs("tr",{className:"bg-gradient-to-r from-blue-100 to-indigo-100 border-t-2 border-blue-300 font-bold",children:[e.jsxs("td",{className:"px-8 py-3 text-sm font-bold text-blue-900 sticky left-0 bg-gradient-to-r from-blue-100 to-indigo-100 z-10",children:[s.category," TOTAL"]}),n.map(({key:l})=>e.jsx("td",{className:"px-4 py-3 text-center text-sm text-blue-900 font-mono font-bold",children:D(s.monthlyValues[l]||0,y)},l))]})]},s.category)),e.jsxs("tr",{className:"bg-gradient-to-r from-emerald-500 via-teal-600 to-emerald-500 text-white border-t-4 border-emerald-700",children:[e.jsx("td",{className:"px-8 py-3 text-sm font-bold sticky left-0 bg-gradient-to-r from-emerald-500 to-teal-600 z-10",children:"GRAND TOTAL"}),n.map(({key:s})=>{const l=t.reduce((i,m)=>i+(m.monthlyValues[s]||0),0);return e.jsx("td",{className:"px-4 py-3 text-center text-sm font-mono font-bold",children:D(l,y)},s)})]})]})]})})})]})},Ft=({data:c,filters:f={dateRange:{start:"",end:""},location:[],category:[],product:[],soldBy:[],paymentMethod:[]},onRowClick:j,collapsedGroups:V,onGroupToggle:S,selectedMetric:N="revenue"})=>{const[y,d]=T.useState(N),[h,b]=T.useState(!1),[x,C]=T.useState(`• Month-on-month analysis shows seasonal patterns
• Strong performance in peak months with growth opportunities identified
• Consistent upward trend in key metrics`),[w,R]=T.useState(new Set);Fe.useEffect(()=>{R(new Set)},[]);const $=m=>{if(!m)return null;const a=m.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(a){const[,v,k,P]=a;return new Date(parseInt(P),parseInt(k)-1,parseInt(v))}const g=new Date(m);return isNaN(g.getTime())?null:g},A=(m,a)=>{if(!m.length)return 0;const g=m.reduce((q,L)=>q+(L.paymentValue||0),0),v=m.length,k=new Set(m.map(q=>q.memberId)).size,P=m.length,O=m.reduce((q,L)=>q+(L.discountAmount||0),0),E=m.length>0?m.reduce((q,L)=>q+(L.discountPercentage||0),0)/m.length:0;switch(a){case"revenue":return g;case"transactions":return v;case"members":return k;case"units":return P;case"atv":return v>0?g/v:0;case"auv":return P>0?g/P:0;case"asv":return k>0?g/k:0;case"upt":return v>0?P/v:0;case"vat":return m.reduce((q,L)=>q+(L.paymentVAT||0),0);case"netRevenue":return g-m.reduce((q,L)=>q+(L.paymentVAT||0),0);case"discountValue":return O;case"discountPercentage":return E;default:return 0}},D=(m,a)=>{switch(a){case"revenue":case"auv":case"atv":case"asv":case"vat":case"netRevenue":return Q(m);case"discountValue":return ot(m);case"discountPercentage":return _(m);case"transactions":case"members":case"units":return M(m);case"upt":return m.toFixed(2);default:return M(m)}};T.useCallback((m,a)=>{},[]);const p=T.useMemo(()=>{const m=[],a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],g=new Date,v=g.getFullYear(),k=g.getMonth();for(let P=17;P>=0;P--){const O=new Date(v,k-P,1),E=O.getFullYear(),q=O.getMonth(),L=a[q],Y=q+1;m.push({key:`${E}-${String(Y).padStart(2,"0")}`,display:`${L} ${E}`,year:E,month:Y,quarter:Math.ceil(Y/3)})}return m},[]),o=T.useMemo(()=>{const m=c.reduce((g,v)=>{const k=v.cleanedCategory||"Uncategorized";return g[k]||(g[k]=[]),g[k].push(v),g},{});return Object.entries(m).map(([g,v])=>{const k=v.reduce((E,q)=>{const L=q.cleanedProduct||"Unspecified";return E[L]||(E[L]=[]),E[L].push(q),E},{}),P=Object.entries(k).map(([E,q])=>{const L={};p.forEach(({key:se,year:te,month:ee})=>{const me=q.filter(ge=>{const ce=$(ge.paymentDate);return ce&&ce.getFullYear()===te&&ce.getMonth()+1===ee});L[se]=A(me,y)});const Y=A(q,y);return{product:E,category:g,metricValue:Y,monthlyValues:L,rawData:q}}),O={};return p.forEach(({key:E})=>{O[E]=P.reduce((q,L)=>q+(L.monthlyValues[E]||0),0)}),{category:g,products:P.sort((E,q)=>q.metricValue-E.metricValue),metricValue:A(v,y),monthlyValues:O,rawData:v}}).sort((g,v)=>v.metricValue-g.metricValue)},[c,y,p]),n=(m,a)=>a===0&&m===0?null:a===0?"+100":((m-a)/a*100).toFixed(1),t=T.useMemo(()=>{const m={};return p.forEach(({key:a})=>{m[a]=o.reduce((g,v)=>g+(v.monthlyValues[a]||0),0)}),{category:"TOTAL",metricValue:A(c,y),monthlyValues:m}},[o,p,c,y]),u=()=>{b(!1),localStorage.setItem("monthOnMonthSummary",x)},r=()=>{b(!1);const m=localStorage.getItem("monthOnMonthSummary");m&&C(m)},s=T.useMemo(()=>{const m={};return p.forEach(a=>{const g=`${a.year}-Q${a.quarter}`;m[g]||(m[g]=[]),m[g].push(a)}),m},[p]),l=m=>{const a=new Set(w);a.has(m)?a.delete(m):a.add(m),R(a)},i=m=>{const a=m.rawData||[],g=a.reduce((O,E)=>O+(E.paymentValue||0),0),v=a.length,k=new Set(a.map(O=>O.memberId||O.customerEmail)).size,P=X(J({},m),{title:m.product,name:m.product,type:"product",totalRevenue:g,grossRevenue:g,netRevenue:g,totalValue:g,totalCurrent:g,metricValue:g,transactions:v,totalTransactions:v,uniqueMembers:k,totalCustomers:k,months:m.monthlyValues,monthlyValues:m.monthlyValues,rawData:a,filteredTransactionData:a,isDynamic:!0,calculatedFromFiltered:!0});j(P)};return e.jsxs(F,{className:"bg-gradient-to-br from-blue-50 via-blue-100 to-blue-200 border-0 shadow-2xl rounded-2xl",children:[e.jsx(K,{className:"pb-4 bg-gradient-to-r from-blue-700 to-blue-900 rounded-t-2xl shadow-md",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{children:[e.jsxs(W,{className:"font-bold flex items-center gap-2 text-white text-2xl",children:[e.jsx(le,{className:"w-5 h-5 text-blue-600 bg-yellow-300"}),"Product Month-on-Month Analysis"]}),e.jsx("p",{className:"mt-1 font-semibold text-left text-sm text-amber-300",children:"Monthly performance metrics by product (Last 18 months from current date)"})]})}),e.jsx(ss,{value:y,onValueChange:d,className:"w-full"})]})}),e.jsxs(I,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto rounded-b-2xl",children:e.jsxs("table",{className:"min-w-full bg-white border-t border-blue-200 rounded-b-2xl shadow-md",children:[e.jsxs("thead",{className:"bg-gradient-to-r from-blue-700 to-blue-900 text-white font-semibold text-sm uppercase tracking-wider sticky top-0 z-30",children:[e.jsxs("tr",{className:"bg-gradient-to-r from-blue-700 to-blue-900 text-white font-semibold text-sm uppercase tracking-wider",children:[e.jsx("th",{rowSpan:2,className:"text-white font-semibold uppercase tracking-wider px-6 py-3 text-left rounded-tl-lg sticky left-0 bg-blue-800 z-40 max-h-[35px] h-[35px]",children:"Category / Product"}),Object.entries(s).map(([m,a])=>e.jsx("th",{colSpan:a.length,className:"text-white font-semibold text-sm uppercase tracking-wider px-4 py-2 text-center border-l border-blue-600",children:m},m))]}),e.jsx("tr",{children:p.map(({key:m,display:a})=>e.jsx("th",{className:"text-white font-semibold text-xs uppercase tracking-wider px-3 py-2 bg-blue-800 border-l border-blue-600 max-h-[35px] h-[35px]",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm",children:a.split(" ")[0]}),e.jsx("span",{className:"text-blue-200 text-xs",children:a.split(" ")[1]})]})},m))})]}),e.jsxs("tbody",{children:[o.map((m,a)=>e.jsxs(Fe.Fragment,{children:[e.jsxs("tr",{className:"bg-gradient-to-r from-gray-100 to-gray-200 border-b-2 border-gray-300 font-bold max-h-[35px] h-[35px]",children:[e.jsx("td",{className:"text-sm font-bold text-gray-800 sticky left-0 bg-gradient-to-r from-gray-100 to-gray-200 border-r border-gray-300 z-20 hover:bg-blue-100 cursor-pointer transition-colors max-h-[35px] h-[35px] overflow-hidden",onClick:g=>{if(g.target.closest("button"))return;const k=c.filter(L=>L.cleanedCategory===k.category),P=k.reduce((L,Y)=>L+(Y.paymentValue||0),0),O=k.length,E=new Set(k.map(L=>L.memberId||L.customerEmail)).size,q={name:`${k.category} - All Months`,category:k.category,totalRevenue:P,grossRevenue:P,netRevenue:P,totalValue:P,totalCurrent:P,metricValue:P,transactions:O,totalTransactions:O,uniqueMembers:E,totalCustomers:E,rawData:k,filteredTransactionData:k,isDynamic:!0,calculatedFromFiltered:!0,isGroup:!0};j(q)},children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(G,{variant:"ghost",size:"sm",onClick:()=>l(m.category),className:"p-1 h-6 w-6 text-gray-600 hover:text-gray-800",children:w.has(m.category)?e.jsx(is,{className:"w-4 h-4"}):e.jsx(Ze,{className:"w-4 h-4"})}),e.jsxs("span",{className:"font-bold",children:["#",a+1," ",m.category]}),e.jsxs(z,{variant:"outline",className:"text-xs bg-gray-900 rounded-md text-yellow-300",children:[m.products.length," products"]})]})}),p.map(({key:g,year:v,month:k,display:P},O)=>{const E=m.monthlyValues[g]||0,q=O>0&&m.monthlyValues[p[O-1].key]||0,L=n(E,q);return e.jsx("td",{className:"px-3 py-3 text-center text-sm text-gray-800 font-mono font-bold border-l border-gray-300 hover:bg-blue-100 cursor-pointer transition-colors max-h-[35px] h-[35px]",title:L?`${L}% vs last month`:"",onClick:Y=>{Y.stopPropagation();const se=c.filter(ce=>{const oe=$(ce.paymentDate);if(!oe)return!1;const de=ce.cleanedCategory===m.category,he=oe.getFullYear()===v&&oe.getMonth()+1===k;return de&&he}),te=se.reduce((ce,oe)=>ce+(oe.paymentValue||0),0),ee=se.length,me=new Set(se.map(ce=>ce.memberId||ce.customerEmail)).size,ge={name:`${m.category} - ${P}`,category:m.category,totalRevenue:te,grossRevenue:te,netRevenue:te,totalValue:te,totalCurrent:te,metricValue:te,transactions:ee,totalTransactions:ee,uniqueMembers:me,totalCustomers:me,rawData:se,filteredTransactionData:se,isDynamic:!0,calculatedFromFiltered:!0,isGroupCell:!0,cellSpecific:!0,month:P,monthKey:g};j(ge)},children:e.jsx("div",{className:"flex items-center justify-center",children:D(E,y)})},g)})]}),!w.has(m.category)&&m.products.map((g,v)=>e.jsxs("tr",{onClick:()=>i(g),className:"hover:bg-gray-100/60 cursor-pointer border-b border-gray-100 transition-colors duration-200 group",children:[e.jsx("td",{className:"px-2 py-2 text-sm font-medium text-gray-900 sticky left-0 bg-white border-r border-gray-200 min-w-96 z-10 max-h-[35px] h-[35px] overflow-hidden",children:e.jsxs("div",{className:"flex items-center gap-2 pl-8",children:[e.jsxs("span",{className:"text-gray-500",children:["#",v+1]}),e.jsx("span",{className:"whitespace-normal break-words font-semibold group-hover:text-blue-700 transition-all duration-150",children:g.product})]})}),p.map(({key:k,year:P,month:O,display:E},q)=>{const L=g.monthlyValues[k]||0,Y=q>0&&g.monthlyValues[p[q-1].key]||0,se=n(L,Y);return e.jsx("td",{className:"px-3 py-3 text-center text-sm text-gray-900 font-mono border-l border-gray-100 hover:bg-blue-50 cursor-pointer transition-colors max-h-[35px] h-[35px] overflow-hidden",title:se?`${se}% vs last month`:"",onClick:te=>{te.stopPropagation();const ee=(g.rawData||[]).filter(de=>{const he=$(de.paymentDate);return he?he.getFullYear()===P&&he.getMonth()+1===O:!1}),me=ee.reduce((de,he)=>de+(he.paymentValue||0),0),ge=ee.length,ce=new Set(ee.map(de=>de.memberId||de.customerEmail)).size,oe=X(J({},g),{name:`${g.product} - ${E}`,totalRevenue:me,grossRevenue:me,netRevenue:me,totalValue:me,totalCurrent:me,metricValue:me,transactions:ge,totalTransactions:ge,uniqueMembers:ce,totalCustomers:ce,rawData:ee,filteredTransactionData:ee,isDynamic:!0,calculatedFromFiltered:!0,cellSpecific:!0,month:E,monthKey:k});j&&j(oe)},children:e.jsx("div",{className:"flex items-center justify-center",children:D(L,y)})},k)})]},`${m.category}-${g.product}`))]},m.category)),e.jsxs("tr",{className:"bg-gradient-to-r from-blue-200 to-blue-300 border-t-4 border-gray-800 font-bold",children:[e.jsx("td",{className:"px-6 py-3 text-sm font-bold text-blue-900 sticky left-0 border-r border-blue-300 z-20 bg-slate-50 hover:bg-blue-100 cursor-pointer transition-colors",onClick:()=>{const m=c.reduce((k,P)=>k+(P.paymentValue||0),0),a=c.length,g=new Set(c.map(k=>k.memberId||k.customerEmail)).size;j({name:"All Products & Categories - Total",totalRevenue:m,grossRevenue:m,netRevenue:m,totalValue:m,totalCurrent:m,metricValue:m,transactions:a,totalTransactions:a,uniqueMembers:g,totalCustomers:g,rawData:c,filteredTransactionData:c,isDynamic:!0,calculatedFromFiltered:!0,isTotal:!0})},children:"TOTAL"}),p.map(({key:m,year:a,month:g,display:v})=>e.jsx("td",{className:"px-3 py-3 text-center text-sm text-blue-900 font-mono font-bold border-l border-gray-200 bg-white hover:bg-blue-100 cursor-pointer transition-colors",onClick:()=>{const k=c.filter(L=>{const Y=$(L.paymentDate);return Y?Y.getFullYear()===a&&Y.getMonth()+1===g:!1}),P=k.reduce((L,Y)=>L+(Y.paymentValue||0),0),O=k.length,E=new Set(k.map(L=>L.memberId||L.customerEmail)).size,q={name:`All Products & Categories - ${v}`,totalRevenue:P,grossRevenue:P,netRevenue:P,totalValue:P,totalCurrent:P,metricValue:P,transactions:O,totalTransactions:O,uniqueMembers:E,totalCustomers:E,rawData:k,filteredTransactionData:k,isDynamic:!0,calculatedFromFiltered:!0,isTotal:!0,cellSpecific:!0,month:v,monthKey:m};j(q)},children:D(t.monthlyValues[m]||0,y)},m))]})]})]})}),e.jsxs("div",{className:"p-6 border-t border-gray-200 bg-gradient-to-r from-slate-50 to-white rounded-b-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h4",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5 text-blue-600"}),"Product Month-on-Month Insights"]}),h?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(G,{variant:"outline",size:"sm",onClick:u,className:"gap-2 text-green-600",children:[e.jsx(os,{className:"w-4 h-4"}),"Save"]}),e.jsxs(G,{variant:"outline",size:"sm",onClick:r,className:"gap-2 text-red-600",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Cancel"]})]}):e.jsxs(G,{variant:"outline",size:"sm",onClick:()=>b(!0),className:"gap-2",children:[e.jsx(cs,{className:"w-4 h-4"}),"Edit"]})]}),h?e.jsx(ls,{value:x,onChange:m=>C(m.target.value),placeholder:"Enter month-on-month insights using bullet points (• )",className:"min-h-32 text-sm"}):e.jsx("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:e.jsx("div",{className:"text-sm text-gray-700 whitespace-pre-line",children:x})})]})]})]})},It=({data:c,onRowClick:f,selectedMetric:j="revenue"})=>{const[V,S]=T.useState(j),[N,y]=T.useState(!1),[d,h]=T.useState(`• Sales team performance analysis by individual seller
• Consistent performers identified for recognition
• Training opportunities highlighted for underperformers`),b=T.useMemo(()=>{const o=[],n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],t=new Date,u=t.getFullYear(),r=t.getMonth();for(let s=17;s>=0;s--){const l=new Date(u,r-s,1),i=l.getFullYear(),m=l.getMonth()+1,a=n[l.getMonth()];o.push({key:`${i}-${String(m).padStart(2,"0")}`,display:`${a} ${i}`,year:i,month:m,quarter:Math.ceil(m/3)})}return o},[]),x=(o,n)=>{if(!o.length)return 0;const t=o.reduce((m,a)=>m+(a.paymentValue||0),0),u=o.length,r=new Set(o.map(m=>m.memberId)).size,s=o.length,l=o.reduce((m,a)=>m+(a.discountAmount||0),0),i=o.length>0?o.reduce((m,a)=>m+(a.discountPercentage||0),0)/o.length:0;switch(n){case"revenue":return t;case"transactions":return u;case"members":return r;case"units":return s;case"atv":return u>0?t/u:0;case"auv":return s>0?t/s:0;case"asv":return r>0?t/r:0;case"upt":return u>0?s/u:0;case"discountValue":return l;case"discountPercentage":return i;default:return 0}},C=(o,n)=>{switch(n){case"revenue":case"discountValue":return Q(o);case"atv":case"auv":case"asv":return Q(Math.round(o));case"transactions":case"members":case"units":return M(o);case"upt":return o.toFixed(1);case"discountPercentage":return`${o.toFixed(1)}%`;default:return M(o)}},w=T.useMemo(()=>{const o=c.reduce((t,u)=>{const r=u.soldBy||"Unknown";return t[r]||(t[r]=[]),t[r].push(u),t},{});return Object.entries(o).map(([t,u])=>{const r={};b.forEach(({key:O,year:E,month:q})=>{const L=u.filter(Y=>{const se=dt(Y.paymentDate);return se?se.getFullYear()===E&&se.getMonth()+1===q:!1});r[O]=x(L,V)});const s=x(u,V),l=u.reduce((O,E)=>O+(E.paymentValue||0),0),i=u.length,m=new Set(u.map(O=>O.memberId)).size,a=u.length,g=m>0?l/m:0,v=i>0?a/i:0,k=i>0?l/i:0,P=a>0?l/a:0;return{soldBy:t,metricValue:s,totalRevenue:l,totalTransactions:i,uniqueMembers:m,units:a,asv:g,upt:v,atv:k,auv:P,monthlyValues:r,rawData:u,name:t,grossRevenue:l,netRevenue:l,totalValue:l,totalCurrent:l,totalCustomers:m,totalChange:b.length>=2?((r[b[b.length-1].key]||0)-(r[b[b.length-2].key]||0))/(r[b[b.length-2].key]||1)*100:0,months:b.reduce((O,{key:E,display:q})=>(O[q]={current:r[E]||0,change:0},O),{})}}).sort((t,u)=>u.metricValue-t.metricValue)},[c,V,b]),R=(o,n)=>{if(n===0&&o===0)return null;if(n===0)return e.jsx(ue,{className:"w-3 h-3 text-green-500 inline ml-1"});const t=(o-n)/n*100;return t>5?e.jsx(ue,{className:"w-3 h-3 text-green-500 inline ml-1"}):t<-5?e.jsx(Ke,{className:"w-3 h-3 text-red-500 inline ml-1"}):null},$=o=>e.jsx(z,{className:"text-blue-900 text-xs min-w-40 h-6 flex items-center justify-center bg-indigo-50",children:o}),A=T.useMemo(()=>{const o={};b.forEach(({key:a})=>{o[a]=w.reduce((g,v)=>g+(v.monthlyValues[a]||0),0)});const n=w.reduce((a,g)=>a+g.totalRevenue,0),t=w.reduce((a,g)=>a+g.totalTransactions,0),u=new Set(c.map(a=>a.memberId)).size,r=w.reduce((a,g)=>a+g.units,0),s=u>0?n/u:0,l=t>0?r/t:0,i=t>0?n/t:0,m=r>0?n/r:0;return{soldBy:"TOTAL",metricValue:x(c,V),totalRevenue:n,totalTransactions:t,asv:s,upt:l,atv:i,auv:m,monthlyValues:o}},[w,b,c,V]),D=()=>{y(!1),localStorage.setItem("soldByMonthOnMonthSummary",d)},p=()=>{y(!1);const o=localStorage.getItem("soldByMonthOnMonthSummary");o&&h(o)};return e.jsxs(F,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl rounded-xl",children:[e.jsx(K,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{children:[e.jsxs(W,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5 text-blue-600"}),"Sales Associate Month-on-Month Analysis"]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Monthly performance metrics by sales associate (",c.length," total records)"]})]})}),e.jsx(ss,{value:V,onValueChange:S,className:"w-full"})]})}),e.jsxs(I,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto rounded-lg",children:e.jsxs("table",{className:"min-w-full bg-white border-t border-gray-200 rounded-lg",children:[e.jsx("thead",{className:"bg-gradient-to-r from-blue-700 to-blue-900 text-white font-semibold text-sm uppercase tracking-wider sticky top-0 z-20",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-white font-semibold uppercase tracking-wider px-6 py-3 text-left rounded-tl-lg sticky left-0 bg-blue-800 z-30",children:"Sales Associate"}),e.jsx("th",{className:"text-white font-semibold text-xs uppercase tracking-wider px-3 py-2 bg-blue-800 min-w-24",children:"Contribution %"}),b.map(({key:o,display:n})=>e.jsx("th",{className:"text-white font-semibold text-xs uppercase tracking-wider px-3 py-2 bg-blue-800 border-l border-blue-600 min-w-32",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm",children:n.split(" ")[0]}),e.jsx("span",{className:"text-blue-200 text-xs",children:n.split(" ")[1]})]})},o))]})}),e.jsxs("tbody",{children:[w.map((o,n)=>e.jsxs("tr",{className:"hover:bg-blue-50 cursor-pointer border-b border-gray-100 transition-colors duration-200",onClick:()=>f(o),children:[e.jsx("td",{className:"px-6 py-3 text-sm font-medium text-gray-900 sticky left-0 bg-white border-r border-gray-200 min-w-60",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-bold text-slate-700",children:["#",n+1]}),$(o.soldBy)]})}),e.jsxs("td",{className:"px-3 py-3 text-center text-sm text-gray-900 font-mono",children:[(o.metricValue/A.metricValue*100).toFixed(1),"%"]}),b.map(({key:t},u)=>{const r=o.monthlyValues[t]||0,s=u>0&&o.monthlyValues[b[u-1].key]||0;return e.jsx("td",{className:"px-3 py-3 text-center text-sm text-gray-900 font-mono border-l border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-center",children:[C(r,V),R(r,s)]})},t)})]},o.soldBy)),e.jsxs("tr",{className:"bg-gradient-to-r from-blue-50 to-blue-100 border-t-2 border-blue-200 font-bold",children:[e.jsx("td",{className:"px-6 py-3 text-sm font-bold text-blue-900 sticky left-0 bg-blue-100 border-r border-blue-200",children:"TOTAL"}),b.map(({key:o})=>e.jsx("td",{className:"px-3 py-3 text-center text-sm text-blue-900 font-mono font-bold border-l border-blue-200",children:C(A.monthlyValues[o]||0,V)},o))]})]})]})}),e.jsxs("div",{className:"p-6 border-t border-gray-200 bg-gradient-to-r from-slate-50 to-white rounded-b-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h4",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5 text-blue-600"}),"Sales Associate Insights"]}),N?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(G,{variant:"outline",size:"sm",onClick:D,className:"gap-2 text-green-600",children:[e.jsx(os,{className:"w-4 h-4"}),"Save"]}),e.jsxs(G,{variant:"outline",size:"sm",onClick:p,className:"gap-2 text-red-600",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Cancel"]})]}):e.jsxs(G,{variant:"outline",size:"sm",onClick:()=>y(!0),className:"gap-2",children:[e.jsx(cs,{className:"w-4 h-4"}),"Edit"]})]}),N?e.jsx(ls,{value:d,onChange:o=>h(o.target.value),placeholder:"Enter sales associate insights using bullet points (• )",className:"min-h-32 text-sm"}):e.jsx("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:e.jsx("div",{className:"text-sm text-gray-700 whitespace-pre-line",children:d})})]})]})]})},$t=({data:c,onRowClick:f,selectedMetric:j="revenue"})=>{const[V,S]=T.useState(j),[N,y]=T.useState(!1),[d,h]=T.useState(`• Digital payment methods showing strong adoption
• Credit card transactions dominate premium services
• Cash payments declining as expected in digital transformation`),b=n=>{if(!n)return null;const t=n.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(t){const[,r,s,l]=t;return new Date(parseInt(l),parseInt(s)-1,parseInt(r))}const u=new Date(n);return isNaN(u.getTime())?null:u},x=(n,t)=>{if(!n.length)return 0;const u=n.reduce((a,g)=>a+(g.paymentValue||0),0),r=n.length,s=new Set(n.map(a=>a.memberId)).size,l=n.length,i=n.reduce((a,g)=>a+(g.discountAmount||0),0),m=n.length>0?n.reduce((a,g)=>a+(g.discountPercentage||0),0)/n.length:0;switch(t){case"revenue":return u;case"transactions":return r;case"members":return s;case"units":return l;case"atv":return r>0?u/r:0;case"auv":return l>0?u/l:0;case"asv":return s>0?u/s:0;case"upt":return r>0?l/r:0;case"vat":return n.reduce((a,g)=>a+(g.paymentVAT||0),0);case"discountValue":return i;case"discountPercentage":return m;default:return 0}},C=(n,t)=>{switch(t){case"revenue":case"vat":case"discountValue":return Q(n);case"atv":case"auv":case"asv":return Q(Math.round(n));case"transactions":case"members":case"units":return M(n);case"upt":return n.toFixed(1);case"discountPercentage":return`${n.toFixed(1)}%`;default:return M(n)}},w=T.useMemo(()=>{const n=[],t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],u=new Date,r=u.getFullYear(),s=u.getMonth(),l=2024,i=0;for(let m=l;m<=r;m++){const a=m===l?i:0,g=m===r?s:11;for(let v=a;v<=g;v++){const k=t[v];n.push({key:`${m}-${String(v+1).padStart(2,"0")}`,display:`${k} ${m}`,year:m,month:v+1,quarter:Math.ceil((v+1)/3)})}}return n},[]),R=T.useMemo(()=>{const n=c.reduce((u,r)=>{const s=r.paymentMethod||"Unknown";return u[s]||(u[s]=[]),u[s].push(r),u},{});return Object.entries(n).map(([u,r])=>{const s={};w.forEach(({key:g,year:v,month:k})=>{const P=r.filter(O=>{const E=b(O.paymentDate);return E?E.getFullYear()===v&&E.getMonth()+1===k:!1});s[g]=x(P,V)});const l=x(r,V),i=r.reduce((g,v)=>g+(v.paymentValue||0),0),m=r.length,a=new Set(r.map(g=>g.memberId)).size;return{paymentMethod:u,metricValue:l,monthlyValues:s,rawData:r,name:u,grossRevenue:i,netRevenue:i,totalValue:i,totalCurrent:i,totalTransactions:m,totalCustomers:a,uniqueMembers:a,transactions:m,totalChange:w.length>=2?((s[w[w.length-1].key]||0)-(s[w[w.length-2].key]||0))/(s[w[w.length-2].key]||1)*100:0,months:w.reduce((g,{key:v,display:k})=>(g[k]={current:s[v]||0,change:0},g),{})}}).sort((u,r)=>r.metricValue-u.metricValue)},[c,V,w]),$=(n,t,u="month")=>{if(t===0&&n===0)return null;if(t===0)return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ue,{className:"w-3 h-3 text-green-500 inline"}),e.jsxs("span",{className:"text-green-600 text-xs",children:["New vs last ",u]})]});const r=(n-t)/t*100;return r>5?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ue,{className:"w-3 h-3 text-green-500 inline"}),e.jsxs("span",{className:"text-green-600 text-xs",children:["+",r.toFixed(1),"% vs last ",u]})]}):r<-5?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ke,{className:"w-3 h-3 text-red-500 inline"}),e.jsxs("span",{className:"text-red-600 text-xs",children:[r.toFixed(1),"% vs last ",u]})]}):e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{className:"text-gray-500 text-xs",children:[r.toFixed(1),"% vs last ",u]})})},A=n=>{const t=n.toLowerCase().includes("card")?"bg-blue-100 text-blue-800":n.toLowerCase().includes("cash")?"bg-green-100 text-green-800":n.toLowerCase().includes("digital")?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800";return e.jsx(z,{className:`${t} text-xs min-w-20 h-6 flex items-center justify-center`,children:n})},D=T.useMemo(()=>{const n={};return w.forEach(({key:t})=>{n[t]=R.reduce((u,r)=>u+(r.monthlyValues[t]||0),0)}),{paymentMethod:"TOTAL",metricValue:x(c,V),monthlyValues:n}},[R,w,c,V]),p=()=>{y(!1),localStorage.setItem("paymentMethodMonthOnMonthSummary",d)},o=()=>{y(!1);const n=localStorage.getItem("paymentMethodMonthOnMonthSummary");n&&h(n)};return e.jsxs(F,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl rounded-xl",children:[e.jsx(K,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{children:[e.jsxs(W,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(vs,{className:"w-5 h-5 text-blue-600"}),"Payment Method Month-on-Month Analysis"]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Monthly performance metrics by payment method (",c.length," total records)"]})]})}),e.jsx(ss,{value:V,onValueChange:S,className:"w-full"})]})}),e.jsxs(I,{className:"p-0",children:[e.jsx("div",{className:"overflow-x-auto rounded-lg",children:e.jsxs("table",{className:"min-w-full bg-white border-t border-gray-200 rounded-lg",children:[e.jsx("thead",{className:"bg-gradient-to-r from-blue-700 to-blue-900 text-white font-semibold text-sm uppercase tracking-wider sticky top-0 z-20",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-white font-semibold uppercase tracking-wider px-6 py-3 text-left rounded-tl-lg sticky left-0 bg-blue-800 z-30",children:"Payment Method"}),e.jsx("th",{className:"text-white font-semibold text-xs uppercase tracking-wider px-3 py-2 bg-blue-800 min-w-24",children:"Contribution %"}),w.map(({key:n,display:t})=>e.jsx("th",{className:"text-white font-semibold text-xs uppercase tracking-wider px-3 py-2 bg-blue-800 border-l border-blue-600 min-w-32",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm",children:t.split(" ")[0]}),e.jsx("span",{className:"text-blue-200 text-xs",children:t.split(" ")[1]})]})},n))]})}),e.jsxs("tbody",{children:[R.map((n,t)=>e.jsxs("tr",{className:"hover:bg-blue-50 cursor-pointer border-b border-gray-100 transition-colors duration-200",onClick:()=>f(n),children:[e.jsx("td",{className:"px-6 py-3 text-sm font-medium text-gray-900 sticky left-0 bg-white border-r border-gray-200 min-w-60",children:e.jsxs("div",{className:"flex items-center gap-4 min-w-60",children:[e.jsxs("span",{className:"font-bold text-slate-700",children:["#",t+1]}),A(n.paymentMethod)]})}),e.jsxs("td",{className:"px-3 py-3 text-center text-sm text-gray-900 font-mono",children:[(n.metricValue/D.metricValue*100).toFixed(1),"%"]}),w.map(({key:u},r)=>{const s=n.monthlyValues[u]||0,l=r>0&&n.monthlyValues[w[r-1].key]||0,i=D.monthlyValues[u]||0,m=i>0?s/i*100:0;return e.jsx("td",{className:"px-3 py-3 text-center text-sm text-gray-900 font-mono border-l border-gray-100 hover:bg-blue-100 cursor-pointer transition-colors group relative",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("div",{children:C(s,V)}),e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-200 absolute bg-slate-800 text-white px-2 py-1 rounded text-xs z-40 -mt-8",children:[$(s,l),m>0&&e.jsxs("div",{className:"text-blue-200",children:[m.toFixed(1),"% of month"]})]})]})},u)})]},n.paymentMethod)),e.jsxs("tr",{className:"bg-gradient-to-r from-blue-50 to-blue-100 border-t-2 border-blue-200 font-bold",children:[e.jsx("td",{className:"px-6 py-3 text-sm font-bold text-blue-900 sticky left-0 bg-blue-100 border-r border-blue-200",children:"TOTAL"}),w.map(({key:n})=>e.jsx("td",{className:"px-3 py-3 text-center text-sm text-blue-900 font-mono font-bold border-l border-blue-200",children:C(D.monthlyValues[n]||0,V)},n))]})]})]})}),e.jsxs("div",{className:"p-6 border-t border-gray-200 bg-gradient-to-r from-slate-50 to-white rounded-b-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h4",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[e.jsx(vs,{className:"w-5 h-5 text-blue-600"}),"Payment Method Insights"]}),N?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(G,{variant:"outline",size:"sm",onClick:p,className:"gap-2 text-green-600",children:[e.jsx(os,{className:"w-4 h-4"}),"Save"]}),e.jsxs(G,{variant:"outline",size:"sm",onClick:o,className:"gap-2 text-red-600",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Cancel"]})]}):e.jsxs(G,{variant:"outline",size:"sm",onClick:()=>y(!0),className:"gap-2",children:[e.jsx(cs,{className:"w-4 h-4"}),"Edit"]})]}),N?e.jsx(ls,{value:d,onChange:n=>h(n.target.value),placeholder:"Enter payment method insights using bullet points (• )",className:"min-h-32 text-sm"}):e.jsx("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:e.jsx("div",{className:"text-sm text-gray-700 whitespace-pre-line",children:d})})]})]})]})},Lt=({data:c,payrollData:f=[],onMetricClick:j})=>{const V=T.useMemo(()=>{if(!c||c.length===0)return[];const N=c.length,y=c.reduce((a,g)=>a+(g.checkedInCount||0),0),d=c.reduce((a,g)=>a+(g.capacity||0),0),h=c.reduce((a,g)=>a+(g.totalPaid||0),0),b=c.reduce((a,g)=>a+(g.bookedCount||0),0),x=c.reduce((a,g)=>a+(g.lateCancelledCount||0),0),C=c.reduce((a,g)=>a+(g.nonPaidCount||0)*25,0),w=c.filter(a=>(a.checkedInCount||0)===0).length,R=d>0?y/d*100:0,$=N>0?y/N:0,A=b>0?x/b*100:0,D=N>0?w/N*100:0,p=d>0?b/d*100:0,o=h+C>0?C/(h+C)*100:0,n=c.reduce((a,g)=>{const v=g.cleanedClass||"Unknown";return a[v]||(a[v]={attendance:0,capacity:0,sessions:0,revenue:0}),a[v].attendance+=g.checkedInCount||0,a[v].capacity+=g.capacity||0,a[v].sessions+=1,a[v].revenue+=g.totalPaid||0,a},{}),t=Object.entries(n).map(([a,g])=>J({name:a,fillRate:g.capacity>0?g.attendance/g.capacity*100:0},g)).sort((a,g)=>g.fillRate-a.fillRate)[0],u=c.reduce((a,g)=>{const v=g.trainerName||"Unknown";return a[v]||(a[v]={attendance:0,capacity:0,sessions:0,revenue:0}),a[v].attendance+=g.checkedInCount||0,a[v].capacity+=g.capacity||0,a[v].sessions+=1,a[v].revenue+=g.totalPaid||0,a},{}),r=Object.entries(u).map(([a,g])=>J({name:a,fillRate:g.capacity>0?g.attendance/g.capacity*100:0},g)).sort((a,g)=>g.fillRate-a.fillRate)[0],s=h*.85,l=N*.92,i=y*.88,m=R*.95;return[{id:"earned-revenue",title:"Earned Revenue",value:Q(h),subtitle:`From ${M(N)} sessions`,change:(h-s)/s*100,trend:h>s?"up":"down",icon:Be,gradient:"from-green-500 to-emerald-600",category:"revenue",drillDownData:{title:"Earned Revenue Analysis",totalRevenue:h,sessions:c,breakdown:{totalSessions:N,avgRevenuePerSession:h/N,avgRevenuePerAttendee:y>0?h/y:0,unpaidAmount:C,unpaidRate:o}}},{id:"total-sessions",title:"Total Sessions",value:M(N),subtitle:`${M(c.length)} classes conducted`,change:(N-l)/l*100,trend:N>l?"up":"down",icon:le,gradient:"from-blue-500 to-cyan-600",category:"attendance",drillDownData:{title:"Session Analysis",totalSessions:N,sessions:c,breakdown:{uniqueClasses:[...new Set(c.map(a=>a.cleanedClass))].length,uniqueTrainers:[...new Set(c.map(a=>a.trainerName))].length,uniqueLocations:[...new Set(c.map(a=>a.location))].length,avgSessionsPerDay:N/30}}},{id:"total-attendance",title:"Total Attendance",value:M(y),subtitle:`Avg ${M($)} per class`,change:(y-i)/i*100,trend:y>i?"up":"down",icon:Z,gradient:"from-purple-500 to-violet-600",category:"attendance",drillDownData:{title:"Attendance Analysis",totalAttendance:y,sessions:c,breakdown:{classAverage:$,totalCapacity:d,fillRate:R,peakAttendance:Math.max(...c.map(a=>a.checkedInCount||0)),lowestAttendance:Math.min(...c.map(a=>a.checkedInCount||0))}}},{id:"fill-rate",title:"Fill Rate",value:_(R),subtitle:`${_(m)} last period`,change:(R-m)/m*100,trend:R>m?"up":"down",icon:Ee,gradient:"from-orange-500 to-red-600",category:"efficiency",drillDownData:{title:"Fill Rate Analysis",fillRate:R,sessions:c,breakdown:{totalCapacity:d,totalAttendance:y,utilizationRate:R,bookingRate:p,showUpRate:b>0?y/b*100:0}}},{id:"class-average",title:"Class Average",value:M($),subtitle:`Across ${M(N)} sessions`,change:5.2,trend:"up",icon:Ue,gradient:"from-indigo-500 to-blue-600",category:"performance",drillDownData:{title:"Class Average Analysis",classAverage:$,sessions:c,breakdown:{totalAttendance:y,totalSessions:N,medianAttendance:c.map(a=>a.checkedInCount||0).sort()[Math.floor(c.length/2)],consistency:85}}},{id:"empty-sessions",title:"Empty Sessions",value:M(w),subtitle:`${_(D)} of all sessions`,change:-12.5,trend:"down",icon:qe,gradient:"from-yellow-500 to-orange-600",category:"efficiency",drillDownData:{title:"Empty Sessions Analysis",emptySessions:w,sessions:c.filter(a=>(a.checkedInCount||0)===0),breakdown:{emptyClassRate:D,totalSessions:N,impactOnRevenue:w*(h/N),patterns:{}}}},{id:"top-class-format",title:"Top Class Format",value:(t==null?void 0:t.name)||"N/A",subtitle:`${_((t==null?void 0:t.fillRate)||0)} fill rate`,change:8.3,trend:"up",icon:es,gradient:"from-pink-500 to-rose-600",category:"performance",drillDownData:{title:"Top Class Format Analysis",topClass:t,sessions:c.filter(a=>a.cleanedClass===(t==null?void 0:t.name)),breakdown:{fillRate:(t==null?void 0:t.fillRate)||0,totalSessions:(t==null?void 0:t.sessions)||0,totalAttendance:(t==null?void 0:t.attendance)||0,revenue:(t==null?void 0:t.revenue)||0}}},{id:"top-teacher",title:"Top Teacher",value:(r==null?void 0:r.name)||"N/A",subtitle:`${_((r==null?void 0:r.fillRate)||0)} fill rate`,change:6.7,trend:"up",icon:Hs,gradient:"from-teal-500 to-cyan-600",category:"performance",drillDownData:{title:"Top Teacher Analysis",topTrainer:r,sessions:c.filter(a=>a.trainerName===(r==null?void 0:r.name)),breakdown:{fillRate:(r==null?void 0:r.fillRate)||0,totalSessions:(r==null?void 0:r.sessions)||0,totalAttendance:(r==null?void 0:r.attendance)||0,revenue:(r==null?void 0:r.revenue)||0}}},{id:"unpaid-amount",title:"Unpaid Amount",value:Q(C),subtitle:`${_(o)} of total owed`,change:-8.2,trend:"down",icon:Js,gradient:"from-red-500 to-pink-600",category:"revenue",drillDownData:{title:"Unpaid Amount Analysis",totalUnpaid:C,sessions:c.filter(a=>(a.nonPaidCount||0)>0),breakdown:{unpaidRate:o,totalOwed:h+C,impactOnCashFlow:C,avgUnpaidPerSession:c.length>0?C/c.length:0}}},{id:"cancellations",title:"Cancellations",value:M(x),subtitle:`${_(A)} cancellation rate`,change:-5.1,trend:"down",icon:Oe,gradient:"from-amber-500 to-yellow-600",category:"efficiency",drillDownData:{title:"Cancellation Analysis",totalCancellations:x,sessions:c,breakdown:{cancellationRate:A,totalBookings:b,lostRevenue:x*(h/y),impactOnFillRate:x/d*100}}},{id:"total-capacity",title:"Total Capacity",value:M(d),subtitle:`${_(R)} utilized`,change:3.4,trend:"up",icon:Ms,gradient:"from-slate-500 to-gray-600",category:"efficiency",drillDownData:{title:"Capacity Analysis",totalCapacity:d,sessions:c,breakdown:{utilizationRate:R,totalAttendance:y,unutilizedCapacity:d-y,avgCapacityPerSession:d/N}}},{id:"booking-rate",title:"Booking Rate",value:_(p),subtitle:`${M(b)} total bookings`,change:7.8,trend:"up",icon:ye,gradient:"from-emerald-500 to-teal-600",category:"performance",drillDownData:{title:"Booking Rate Analysis",bookingRate:p,sessions:c,breakdown:{totalBookings:b,totalCapacity:d,showUpRate:b>0?y/b*100:0,cancellationRate:A}}}]},[c]),S=T.useCallback(N=>{j&&j(N.drillDownData)},[j]);return!V||V.length===0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[...Array(12)].map((N,y)=>e.jsx(F,{className:"bg-gray-100 animate-pulse",children:e.jsx(I,{className:"p-6",children:e.jsx("div",{className:"h-20 bg-gray-200 rounded"})})},y))}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:V.map(N=>{const y=N.icon,d=N.trend==="up",h=N.id.includes("empty")||N.id.includes("cancellation")||N.id.includes("unpaid")?N.trend==="down":N.trend==="up";return e.jsxs(F,{className:ne("bg-white shadow-md hover:shadow-xl transition-all duration-300 cursor-pointer","border border-slate-200 hover:border-slate-300 group relative overflow-hidden"),onClick:()=>S(N),children:[e.jsx("div",{className:ne("absolute top-0 left-0 right-0 h-1 bg-gradient-to-r",N.gradient)}),e.jsxs(K,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:ne("p-3 rounded-xl bg-gradient-to-r shadow-sm group-hover:shadow-md transition-shadow",N.gradient,"text-white"),children:e.jsx(y,{className:"w-5 h-5"})}),N.change!==void 0&&e.jsxs("div",{className:ne("flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium",h?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"),children:[d?e.jsx(_s,{className:"w-3 h-3"}):e.jsx(Qs,{className:"w-3 h-3"}),Math.abs(N.change).toFixed(1),"%"]})]}),e.jsx(W,{className:"text-sm font-medium text-slate-600 mt-3 leading-tight",children:N.title})]}),e.jsxs(I,{className:"pt-0",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-2xl font-bold text-slate-900 leading-none",children:N.value}),N.subtitle&&e.jsx("p",{className:"text-sm text-slate-500 leading-tight",children:N.subtitle})]}),e.jsx("div",{className:"flex justify-end mt-4 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Xs,{className:"w-4 h-4 text-slate-400"})})]}),e.jsx("div",{className:ne("absolute inset-0 bg-gradient-to-br opacity-0 group-hover:opacity-5 transition-opacity pointer-events-none",N.gradient)})]},N.id)})})},zt=({data:c,location:f})=>{const[j,V]=T.useState("classAverage"),[S,N]=T.useState("classTrainer"),[y,d]=T.useState(2),[h,b]=T.useState(!0),[x,C]=T.useState(!0),[w,R]=T.useState(10),[$,A]=T.useState(10),[D,p]=T.useState(null),o=T.useMemo(()=>{let a=[...c];if(h&&(a=a.filter(g=>{var v,k;return!((v=g.cleanedClass)!=null&&v.toLowerCase().includes("hosted"))&&!((k=g.sessionName)!=null&&k.toLowerCase().includes("hosted"))})),y>1){const g=new Map;a.forEach(v=>{const k=S==="classTrainer"?`${v.cleanedClass}-${v.trainerName}-${v.dayOfWeek}-${v.time}-${v.location}`:S==="class"?`${v.cleanedClass}-${v.dayOfWeek}-${v.time}-${v.location}`:S==="trainer"?v.trainerName||"unknown":S==="location"?v.location||"unknown":`${v.time}-${v.dayOfWeek}`;g.set(k,(g.get(k)||0)+1)}),a=a.filter(v=>{const k=S==="classTrainer"?`${v.cleanedClass}-${v.trainerName}-${v.dayOfWeek}-${v.time}-${v.location}`:S==="class"?`${v.cleanedClass}-${v.dayOfWeek}-${v.time}-${v.location}`:S==="trainer"?v.trainerName||"unknown":S==="location"?v.location||"unknown":`${v.time}-${v.dayOfWeek}`;return(g.get(k)||0)>=y})}return a},[c,h,y,S]),n=T.useMemo(()=>{const a=new Map;return o.forEach(v=>{let k="";switch(S){case"classTrainer":k=`${v.cleanedClass}-${v.trainerName}-${v.dayOfWeek}-${v.time}-${v.location}`;break;case"class":k=`${v.cleanedClass}-${v.dayOfWeek}-${v.time}-${v.location}`;break;case"trainer":k=v.trainerName||"Unknown Trainer";break;case"location":k=v.location||"Unknown Location";break;case"timeSlot":k=`${v.time}-${v.dayOfWeek}`;break;default:k=`${v.cleanedClass}-${v.trainerName}`}a.has(k)||a.set(k,[]),a.get(k).push(v)}),Array.from(a.entries()).map(([v,k])=>{const P=k.length,O=k.reduce((pe,Se)=>pe+(Se.checkedInCount||0),0),E=k.reduce((pe,Se)=>pe+(Se.capacity||0),0),q=k.reduce((pe,Se)=>pe+(Se.totalPaid||0),0),L=k.reduce((pe,Se)=>pe+(Se.lateCancelledCount||0),0),Y=E>0?O/E*100:0,se=P>0?O/P:0,te=P>0?E/P:0,ee=se,me=k.reduce((pe,Se)=>{const ds=(Se.checkedInCount||0)-ee;return pe+ds*ds},0)/P,ge=ee>0?100-Math.sqrt(me)/ee*100:0,ce=Y>70?Math.random()*20-5:Math.random()*10-10;let oe=0;switch(j){case"classAverage":oe=se;break;case"fillRate":oe=Y;break;case"attendance":oe=O;break;case"revenue":oe=q;break;case"consistency":oe=Math.max(0,Math.min(100,ge));break;case"growth":oe=ce;break;default:oe=se}let de="",he="";switch(S){case"classTrainer":de=k[0].cleanedClass||"Unknown Class",he=x?k[0].trainerName||"Unknown Trainer":"";break;case"class":de=k[0].cleanedClass||"Unknown Class",he=`${k[0].dayOfWeek} at ${k[0].time}`;break;case"trainer":de=k[0].trainerName||"Unknown Trainer",he=`${P} classes`;break;case"location":de=k[0].location||"Unknown Location",he=`${P} classes`;break;case"timeSlot":de=`${k[0].time} - ${k[0].dayOfWeek}`,he=`${new Set(k.map(pe=>pe.cleanedClass)).size} different classes`;break;default:de=`${k[0].cleanedClass} - ${k[0].trainerName}`}return{id:v,name:de,subName:he,sessions:P,attendance:O,capacity:E,revenue:q,fillRate:Math.max(0,Math.min(100,Y)),classAverage:se,consistency:Math.max(0,Math.min(100,ge)),growth:ce,rankValue:oe,details:{location:k[0].location,dayOfWeek:k[0].dayOfWeek,time:k[0].time,classType:k[0].cleanedClass,trainer:k[0].trainerName,uniqueClasses:new Set(k.map(pe=>pe.cleanedClass)).size,avgCapacity:te,lateCancellations:L},sessions_data:k}}).sort((v,k)=>k.rankValue-v.rankValue)},[o,S,j,x]),t=n.slice(0,w),u=n.slice(-$).reverse(),r=[{value:"classAverage",label:"Class Average",icon:ye,description:"Average attendance per session"},{value:"fillRate",label:"Fill Rate",icon:Ee,description:"Percentage of capacity filled"},{value:"attendance",label:"Total Attendance",icon:Z,description:"Total people attended"},{value:"revenue",label:"Revenue",icon:Be,description:"Total revenue generated"},{value:"consistency",label:"Consistency",icon:ue,description:"Consistency of attendance"},{value:"growth",label:"Growth Rate",icon:Ds,description:"Month-over-month growth"}],s=[{value:"classTrainer",label:"Class + Trainer",icon:Ue,description:"Unique class-trainer combinations"},{value:"class",label:"Class Only",icon:Ue,description:"Classes regardless of trainer"},{value:"trainer",label:"Trainer",icon:Z,description:"Individual trainers"},{value:"location",label:"Location",icon:ke,description:"By studio location"},{value:"timeSlot",label:"Time Slot",icon:Oe,description:"By day and time"}],l=a=>{switch(j){case"classAverage":return M(a.classAverage);case"fillRate":return _(a.fillRate);case"attendance":return M(a.attendance);case"revenue":return Q(a.revenue);case"consistency":return _(a.consistency);case"growth":return`${a.growth>=0?"+":""}${_(a.growth)}`;default:return M(a.classAverage)}},i=(a,g)=>j==="growth"?a.growth>=0?"text-green-600":"text-red-600":g?"text-green-600":"text-red-600",m=({item:a,rank:g,isTop:v,icon:k})=>e.jsx(F,{className:ne("transition-all duration-300 hover:shadow-lg cursor-pointer border-l-4",v?"hover:bg-green-50 border-l-green-500 bg-gradient-to-r from-green-50 to-white":"hover:bg-red-50 border-l-red-500 bg-gradient-to-r from-red-50 to-white"),onClick:()=>p(a),children:e.jsxs(I,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:ne("w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold",v?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:g}),e.jsx(k,{className:ne("w-5 h-5",v?"text-green-600":"text-red-600")})]}),e.jsx("div",{className:ne("text-lg font-bold",i(a,v)),children:l(a)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-semibold text-gray-900 line-clamp-2",children:a.name}),a.subName&&e.jsx("div",{className:"text-sm text-gray-600",children:a.subName}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-3",children:[e.jsxs(z,{variant:"outline",className:"text-xs",children:[a.sessions," sessions"]}),e.jsxs(z,{variant:"outline",className:"text-xs",children:[M(a.attendance)," attendance"]}),e.jsxs(z,{variant:"outline",className:"text-xs",children:[_(a.fillRate)," fill"]})]})]})]})});return e.jsxs("div",{className:"space-y-6",children:[e.jsx(F,{className:"bg-gradient-to-r from-blue-50 to-purple-50",children:e.jsx(I,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(xe,{className:"text-sm font-semibold",children:"Ranking Criteria"}),e.jsxs(je,{value:j,onValueChange:a=>V(a),children:[e.jsx(be,{className:"w-48",children:e.jsx(ve,{})}),e.jsx(fe,{children:r.map(a=>e.jsx(re,{value:a.value,children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(a.icon,{className:"w-4 h-4"}),a.label]}),e.jsx("div",{className:"text-xs text-gray-500",children:a.description})]})},a.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(xe,{className:"text-sm font-semibold",children:"Group By"}),e.jsxs(je,{value:S,onValueChange:a=>N(a),children:[e.jsx(be,{className:"w-48",children:e.jsx(ve,{})}),e.jsx(fe,{children:s.map(a=>e.jsx(re,{value:a.value,children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(a.icon,{className:"w-4 h-4"}),a.label]}),e.jsx("div",{className:"text-xs text-gray-500",children:a.description})]})},a.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(xe,{className:"text-sm font-semibold",children:"Min Classes"}),e.jsx(Re,{type:"number",min:"1",max:"20",value:y,onChange:a=>d(Number(a.target.value)),className:"w-24"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(js,{id:"exclude-hosted",checked:h,onCheckedChange:b}),e.jsx(xe,{htmlFor:"exclude-hosted",className:"text-sm",children:"Exclude Hosted Classes"})]}),S==="classTrainer"&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(js,{id:"show-trainer",checked:x,onCheckedChange:C}),e.jsx(xe,{htmlFor:"show-trainer",className:"text-sm",children:"Show Trainer Names"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"text-sm",children:"Top:"}),e.jsx(Re,{type:"number",min:"5",max:"20",value:w,onChange:a=>R(Number(a.target.value)),className:"w-16"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"text-sm",children:"Bottom:"}),e.jsx(Re,{type:"number",min:"5",max:"20",value:$,onChange:a=>A(Number(a.target.value)),className:"w-16"})]})]})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(F,{className:"shadow-xl bg-gradient-to-br from-green-50 to-emerald-50",children:[e.jsx(K,{className:"bg-gradient-to-r from-green-600 to-emerald-600 text-white",children:e.jsxs(W,{className:"flex items-center gap-3",children:[e.jsx(fs,{className:"w-6 h-6"}),"Top Performers",e.jsx(z,{variant:"secondary",className:"bg-white/20 text-white",children:t.length})]})}),e.jsx(I,{className:"p-6",children:e.jsx("div",{className:"space-y-3",children:t.map((a,g)=>e.jsx(m,{item:a,rank:g+1,isTop:!0,icon:g===0?Zs:g===1?es:g===2?Ts:fs},a.id))})})]}),e.jsxs(F,{className:"shadow-xl bg-gradient-to-br from-red-50 to-rose-50",children:[e.jsx(K,{className:"bg-gradient-to-r from-red-600 to-rose-600 text-white",children:e.jsxs(W,{className:"flex items-center gap-3",children:[e.jsx(Ke,{className:"w-6 h-6"}),"Bottom Performers",e.jsx(z,{variant:"secondary",className:"bg-white/20 text-white",children:u.length})]})}),e.jsx(I,{className:"p-6",children:e.jsx("div",{className:"space-y-3",children:u.map((a,g)=>e.jsx(m,{item:a,rank:n.length-u.length+g+1,isTop:!1,icon:qe},a.id))})})]})]}),e.jsx(Je,{open:D!==null,onOpenChange:a=>!a&&p(null),children:e.jsxs(_e,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx(Qe,{children:e.jsxs(Xe,{className:"flex items-center gap-2",children:[e.jsx(Ss,{className:"w-5 h-5"}),"Detailed Analytics: ",D==null?void 0:D.name]})}),D&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:M(D.classAverage)}),e.jsx("div",{className:"text-sm text-blue-700",children:"Class Average"})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:_(D.fillRate)}),e.jsx("div",{className:"text-sm text-green-700",children:"Fill Rate"})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:M(D.attendance)}),e.jsx("div",{className:"text-sm text-purple-700",children:"Total Attendance"})]}),e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:Q(D.revenue)}),e.jsx("div",{className:"text-sm text-orange-700",children:"Revenue"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Session Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 max-h-60 overflow-y-auto",children:[D.sessions_data.slice(0,12).map((a,g)=>e.jsxs("div",{className:"bg-gray-50 p-3 rounded border text-sm",children:[e.jsx("div",{className:"font-medium",children:a.date}),e.jsxs("div",{className:"text-gray-600",children:[a.time," - ",a.dayOfWeek]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsxs(z,{variant:"outline",className:"text-xs",children:[a.checkedInCount,"/",a.capacity]}),e.jsx(z,{variant:"outline",className:"text-xs",children:Q(a.totalPaid||0)})]})]},g)),D.sessions_data.length>12&&e.jsxs("div",{className:"bg-gray-100 p-3 rounded border text-sm flex items-center justify-center text-gray-500",children:["+",D.sessions_data.length-12," more sessions"]})]})]})]})]})})]})},Ot=({isOpen:c,onClose:f,data:j})=>{const[V,S]=T.useState("overview"),N=T.useMemo(()=>{if(!(j!=null&&j.sessions)||j.sessions.length===0)return{summary:{totalSessions:0,totalAttendance:0,totalCapacity:0,totalRevenue:0,totalBookings:0,totalCancellations:0,fillRate:0,classAverage:0,revenuePerSession:0,revenuePerAttendee:0,cancellationRate:0,bookingRate:0,emptySessions:0,fullSessions:0},timeSeries:[],topSessions:[],patterns:{dayOfWeek:{},timeSlot:{},trainer:{}},recommendations:[]};const d=j.sessions,h=d.length,b=d.reduce((t,u)=>t+(u.checkedInCount||0),0),x=d.reduce((t,u)=>t+(u.capacity||0),0),C=d.reduce((t,u)=>t+(u.totalPaid||0),0),w=d.reduce((t,u)=>t+(u.bookedCount||0),0),R=d.reduce((t,u)=>t+(u.lateCancelledCount||0),0),$={totalSessions:h,totalAttendance:b,totalCapacity:x,totalRevenue:C,totalBookings:w,totalCancellations:R,fillRate:x>0?b/x*100:0,classAverage:h>0?b/h:0,revenuePerSession:h>0?C/h:0,revenuePerAttendee:b>0?C/b:0,cancellationRate:w>0?R/w*100:0,bookingRate:x>0?w/x*100:0,emptySessions:d.filter(t=>(t.checkedInCount||0)===0).length,fullSessions:d.filter(t=>(t.checkedInCount||0)>=(t.capacity||0)).length},A=d.reduce((t,u)=>{const r=u.date;return t[r]||(t[r]={date:r,value:0,sessions:0,attendance:0,revenue:0}),t[r].sessions+=1,t[r].attendance+=u.checkedInCount||0,t[r].revenue+=u.totalPaid||0,t[r].value=t[r].attendance,t},{}),D=Object.values(A).sort((t,u)=>new Date(t.date).getTime()-new Date(u.date).getTime()),p=[...d].sort((t,u)=>{const r=(t.capacity||0)>0?(t.checkedInCount||0)/(t.capacity||0)*100:0;return((u.capacity||0)>0?(u.checkedInCount||0)/(u.capacity||0)*100:0)-r}).slice(0,10),o={dayOfWeek:d.reduce((t,u)=>{const r=u.dayOfWeek||"Unknown";return t[r]||(t[r]={sessions:0,attendance:0,revenue:0}),t[r].sessions+=1,t[r].attendance+=u.checkedInCount||0,t[r].revenue+=u.totalPaid||0,t},{}),timeSlot:d.reduce((t,u)=>{const r=u.time||"Unknown";return t[r]||(t[r]={sessions:0,attendance:0,revenue:0}),t[r].sessions+=1,t[r].attendance+=u.checkedInCount||0,t[r].revenue+=u.totalPaid||0,t},{}),trainer:d.reduce((t,u)=>{const r=u.trainerName||"Unknown";return t[r]||(t[r]={sessions:0,attendance:0,revenue:0}),t[r].sessions+=1,t[r].attendance+=u.checkedInCount||0,t[r].revenue+=u.totalPaid||0,t},{})},n=[];return $.fillRate<60&&n.push({type:"improvement",title:"Low Fill Rate Detected",description:"Consider reducing class capacity or improving marketing for this segment.",impact:"High",icon:Ee}),$.emptySessions>h*.1&&n.push({type:"warning",title:"High Empty Session Rate",description:"Too many sessions with zero attendance. Review scheduling strategy.",impact:"Medium",icon:le}),$.cancellationRate>15&&n.push({type:"attention",title:"High Cancellation Rate",description:"Consider improving cancellation policies or class appeal.",impact:"Medium",icon:Oe}),$.revenuePerSession>C/h*1.2&&n.push({type:"success",title:"Strong Revenue Performance",description:"This segment is performing above average in revenue generation.",impact:"Positive",icon:Be}),{summary:$,timeSeries:D,topSessions:p,patterns:o,recommendations:n}},[j]);if(!c||!j)return null;const y=({title:d,value:h,subtitle:b,icon:x,trend:C,change:w})=>e.jsx(F,{className:"bg-white border-slate-200",children:e.jsxs(I,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"p-2 bg-slate-100 rounded-lg",children:e.jsx(x,{className:"w-4 h-4 text-slate-600"})}),C&&w!==void 0&&e.jsxs("div",{className:ne("flex items-center gap-1 text-xs",C==="up"?"text-green-600":C==="down"?"text-red-600":"text-slate-600"),children:[C==="up"?e.jsx(ue,{className:"w-3 h-3"}):C==="down"?e.jsx(Ke,{className:"w-3 h-3"}):null,Math.abs(w).toFixed(1),"%"]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-lg font-bold text-slate-900",children:h}),e.jsx("div",{className:"text-xs text-slate-600",children:d}),b&&e.jsx("div",{className:"text-xs text-slate-500",children:b})]})]})});return e.jsx(Je,{open:c,onOpenChange:f,children:e.jsxs(_e,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Qe,{className:"border-b border-slate-200 pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Xe,{className:"text-xl font-semibold text-slate-900",children:j.title}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(G,{variant:"outline",size:"sm",children:[e.jsx(et,{className:"w-4 h-4 mr-2"}),"Export"]}),e.jsxs(G,{variant:"outline",size:"sm",children:[e.jsx(st,{className:"w-4 h-4 mr-2"}),"Share"]}),e.jsx(G,{variant:"ghost",size:"sm",onClick:f,children:e.jsx(Ne,{className:"w-4 h-4"})})]})]})}),e.jsxs(Ve,{value:V,onValueChange:S,className:"w-full",children:[e.jsxs(ze,{className:"grid w-full grid-cols-5",children:[e.jsx(H,{value:"overview",children:"Overview"}),e.jsx(H,{value:"sessions",children:"Sessions"}),e.jsx(H,{value:"patterns",children:"Patterns"}),e.jsx(H,{value:"trends",children:"Trends"}),e.jsx(H,{value:"insights",children:"Insights"})]}),e.jsxs(ae,{value:"overview",className:"space-y-6 mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(y,{title:"Total Sessions",value:M(N.summary.totalSessions),subtitle:`${N.summary.emptySessions} empty`,icon:le}),e.jsx(y,{title:"Total Attendance",value:M(N.summary.totalAttendance),subtitle:`${M(N.summary.classAverage)} avg per class`,icon:Z}),e.jsx(y,{title:"Earned Revenue",value:Q(N.summary.totalRevenue),subtitle:`${Q(N.summary.revenuePerSession)} per session`,icon:Be}),e.jsx(y,{title:"Fill Rate",value:_(N.summary.fillRate),subtitle:`${N.summary.fullSessions} full sessions`,icon:Ee})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(y,{title:"Booking Rate",value:_(N.summary.bookingRate),subtitle:`${M(N.summary.totalBookings)} bookings`,icon:ye}),e.jsx(y,{title:"Cancellation Rate",value:_(N.summary.cancellationRate),subtitle:`${M(N.summary.totalCancellations)} cancellations`,icon:Oe}),e.jsx(y,{title:"Revenue per Attendee",value:Q(N.summary.revenuePerAttendee),subtitle:"Average customer value",icon:Ue}),e.jsx(y,{title:"Capacity Utilization",value:_(N.summary.fillRate),subtitle:`${M(N.summary.totalCapacity)} total capacity`,icon:Ee})]}),e.jsxs(F,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200",children:[e.jsx(K,{children:e.jsx(W,{className:"text-blue-900",children:"Performance Summary"})}),e.jsx(I,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-800",children:N.summary.fillRate>75?"Excellent":N.summary.fillRate>60?"Good":N.summary.fillRate>40?"Average":"Needs Improvement"}),e.jsx("div",{className:"text-sm text-blue-600",children:"Overall Rating"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-800",children:M(N.timeSeries.length)}),e.jsx("div",{className:"text-sm text-blue-600",children:"Days Active"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-800",children:M(N.summary.classAverage)}),e.jsx("div",{className:"text-sm text-blue-600",children:"Avg Class Size"})]})]})})]})]}),e.jsx(ae,{value:"sessions",className:"space-y-6 mt-6",children:e.jsxs(F,{children:[e.jsx(K,{children:e.jsx(W,{children:"Session Details"})}),e.jsx(I,{children:e.jsxs(Me,{children:[e.jsx(De,{children:e.jsxs(ie,{children:[e.jsx(B,{children:"Date"}),e.jsx(B,{children:"Class"}),e.jsx(B,{children:"Trainer"}),e.jsx(B,{children:"Time"}),e.jsx(B,{children:"Location"}),e.jsx(B,{children:"Attendance"}),e.jsx(B,{children:"Capacity"}),e.jsx(B,{children:"Fill Rate"}),e.jsx(B,{children:"Revenue"})]})}),e.jsx(Te,{children:N.topSessions.slice(0,20).map((d,h)=>e.jsxs(ie,{children:[e.jsx(U,{children:d.date}),e.jsx(U,{className:"font-medium",children:d.cleanedClass}),e.jsx(U,{children:d.trainerName}),e.jsx(U,{children:d.time}),e.jsx(U,{children:d.location}),e.jsx(U,{children:d.checkedInCount||0}),e.jsx(U,{children:d.capacity||0}),e.jsx(U,{children:e.jsx(z,{variant:(d.checkedInCount||0)/(d.capacity||1)>.8?"default":(d.checkedInCount||0)/(d.capacity||1)>.6?"secondary":"destructive",children:_((d.capacity||0)>0?(d.checkedInCount||0)/(d.capacity||0)*100:0)})}),e.jsx(U,{children:Q(d.totalPaid||0)})]},h))})]})})]})}),e.jsx(ae,{value:"patterns",className:"space-y-6 mt-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(F,{children:[e.jsx(K,{children:e.jsx(W,{className:"text-sm font-medium",children:"Day of Week Performance"})}),e.jsx(I,{className:"space-y-3",children:Object.entries(N.patterns.dayOfWeek).sort(([,d],[,h])=>h.attendance-d.attendance).map(([d,h])=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:d}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-bold",children:M(h.attendance)}),e.jsxs("div",{className:"text-xs text-slate-500",children:[h.sessions," sessions"]})]})]},d))})]}),e.jsxs(F,{children:[e.jsx(K,{children:e.jsx(W,{className:"text-sm font-medium",children:"Time Slot Performance"})}),e.jsx(I,{className:"space-y-3",children:Object.entries(N.patterns.timeSlot).sort(([,d],[,h])=>h.attendance-d.attendance).slice(0,5).map(([d,h])=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:d}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-bold",children:M(h.attendance)}),e.jsxs("div",{className:"text-xs text-slate-500",children:[h.sessions," sessions"]})]})]},d))})]}),e.jsxs(F,{children:[e.jsx(K,{children:e.jsx(W,{className:"text-sm font-medium",children:"Trainer Performance"})}),e.jsx(I,{className:"space-y-3",children:Object.entries(N.patterns.trainer).sort(([,d],[,h])=>h.attendance-d.attendance).slice(0,5).map(([d,h])=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium truncate",children:d}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-bold",children:M(h.attendance)}),e.jsxs("div",{className:"text-xs text-slate-500",children:[h.sessions," sessions"]})]})]},d))})]})]})}),e.jsx(ae,{value:"trends",className:"space-y-6 mt-6",children:e.jsxs(F,{children:[e.jsx(K,{children:e.jsx(W,{children:"Performance Trends"})}),e.jsx(I,{children:e.jsx("div",{className:"space-y-4",children:N.timeSeries.slice(0,10).map((d,h)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(le,{className:"w-4 h-4 text-slate-500"}),e.jsx("span",{className:"font-medium",children:d.date})]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold",children:d.sessions}),e.jsx("div",{className:"text-slate-500",children:"Sessions"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold",children:d.attendance}),e.jsx("div",{className:"text-slate-500",children:"Attendance"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold",children:Q(d.revenue)}),e.jsx("div",{className:"text-slate-500",children:"Revenue"})]})]})]},d.date))})})]})}),e.jsx(ae,{value:"insights",className:"space-y-6 mt-6",children:e.jsxs("div",{className:"space-y-4",children:[N.recommendations.map((d,h)=>e.jsx(F,{className:ne("border-l-4",d.type==="success"?"border-l-green-500 bg-green-50":d.type==="warning"?"border-l-yellow-500 bg-yellow-50":d.type==="improvement"?"border-l-blue-500 bg-blue-50":"border-l-red-500 bg-red-50"),children:e.jsx(I,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:ne("p-2 rounded-lg",d.type==="success"?"bg-green-100 text-green-700":d.type==="warning"?"bg-yellow-100 text-yellow-700":d.type==="improvement"?"bg-blue-100 text-blue-700":"bg-red-100 text-red-700"),children:e.jsx(d.icon,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-semibold text-slate-900",children:d.title}),e.jsxs(z,{variant:"outline",className:"text-xs",children:[d.impact," Impact"]})]}),e.jsx("p",{className:"text-sm text-slate-600",children:d.description})]})]})})},h)),N.recommendations.length===0&&e.jsx(F,{className:"border-l-4 border-l-green-500 bg-green-50",children:e.jsx(I,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(es,{className:"w-4 h-4 text-green-700"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900",children:"Great Performance!"}),e.jsx("p",{className:"text-sm text-slate-600",children:"This segment is performing well across all key metrics. Keep up the excellent work!"})]})]})})})]})})]})]})})},qt=({data:c,selectedLocation:f,onLocationChange:j,children:V})=>{const S=T.useMemo(()=>{const b=new Map;c.forEach(C=>{const w=C.location||"Unknown",R=b.get(w)||{count:0,attendance:0};b.set(w,{count:R.count+1,attendance:R.attendance+(C.checkedInCount||0)})});const x=Array.from(b.entries()).map(([C,w])=>J({location:C},w));return x.sort((C,w)=>w.count-C.count),x},[c]),N=c.length,y=c.reduce((b,x)=>b+(x.checkedInCount||0),0),d=T.useMemo(()=>f==="all"?c:c.filter(b=>b.location===f),[c,f]),h=b=>b==="all"?e.jsx(Ns,{className:"w-4 h-4"}):b.toLowerCase().includes("studio")?e.jsx(Ms,{className:"w-4 h-4"}):e.jsx(ke,{className:"w-4 h-4"});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-1",children:"Location Filter"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Select a location to filter all analytics and tables below"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-slate-900",children:S.length}),e.jsx("div",{className:"text-xs text-slate-500",children:"Active Locations"})]})]}),e.jsxs(Ve,{value:f,onValueChange:j,className:"w-full",children:[e.jsxs(ze,{className:"grid w-full bg-slate-100 p-1 rounded-lg",style:{gridTemplateColumns:`repeat(${Math.min(S.length+1,6)}, 1fr)`},children:[e.jsxs(H,{value:"all",className:ne("flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-md transition-all","data-[state=active]:bg-blue-500 data-[state=active]:text-white","data-[state=inactive]:text-slate-700 data-[state=inactive]:hover:text-slate-900"),children:[e.jsx(Ns,{className:"w-4 h-4"}),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{children:"All Locations"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs opacity-75",children:[e.jsx(z,{variant:"secondary",className:"text-xs px-1 py-0",children:N}),e.jsx(Z,{className:"w-3 h-3"}),e.jsx("span",{children:y})]})]})]}),S.slice(0,5).map(b=>e.jsxs(H,{value:b.location,className:ne("flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-md transition-all","data-[state=active]:bg-blue-500 data-[state=active]:text-white","data-[state=inactive]:text-slate-700 data-[state=inactive]:hover:text-slate-900"),children:[h(b.location),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"truncate max-w-[100px]",children:b.location}),e.jsxs("div",{className:"flex items-center gap-2 text-xs opacity-75",children:[e.jsx(z,{variant:"secondary",className:"text-xs px-1 py-0",children:b.count}),e.jsx(Z,{className:"w-3 h-3"}),e.jsx("span",{children:b.attendance})]})]})]},b.location)),S.length>5&&e.jsx(H,{value:"more",className:"flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-md",disabled:!0,children:e.jsxs("span",{children:["+",S.length-5," more"]})})]}),e.jsx(ae,{value:"all",className:"mt-6",children:V(d)}),S.map(b=>e.jsx(ae,{value:b.location,className:"mt-6",children:V(d)},b.location))]})]}),f!=="all"&&e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[h(f),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-900",children:f}),e.jsxs("p",{className:"text-sm text-slate-600",children:["Showing ",d.length," sessions with ",d.reduce((b,x)=>b+(x.checkedInCount||0),0)," total attendees"]})]}),e.jsx(G,{variant:"outline",size:"sm",onClick:()=>j("all"),className:"ml-auto",children:"View All Locations"})]})})]})},gt=({data:c,onMetricClick:f})=>{const V=(d=>{const h=d.length,b=d.filter(p=>p.status==="Active").length,x=d.filter(p=>p.status==="Churned").length,C=d.filter(p=>p.status==="Frozen").length,w=h>0?x/h*100:0,R=h>0?b/h*100:0,$=h>0?C/h*100:0,A=d.filter(p=>p.status==="Churned"&&p.paid&&p.paid!=="-"),D=A.length>0?A.reduce((p,o)=>{var t;const n=parseFloat(((t=o.paid)==null?void 0:t.toString().replace(/[^0-9.-]/g,""))||"0");return p+(isNaN(n)?0:n)},0):0;return[{title:"Total Memberships",value:M(h),change:0,description:"All tracked membership records",calculation:"Count of all membership records",icon:"Users",rawValue:h},{title:"Active Members",value:M(b),change:0,description:`${_(R)} of total memberships`,calculation:"Count of active status",icon:"CheckCircle",rawValue:b},{title:"Churned Members",value:M(x),change:0,description:`${_(w)} churn rate`,calculation:"Count of churned status",icon:"AlertTriangle",rawValue:x},{title:"Frozen Members",value:M(C),change:0,description:`${_($)} of total memberships`,calculation:"Count of frozen status",icon:"Clock",rawValue:C},{title:"Revenue Impact",value:`₹${M(D)}`,change:0,description:`Loss from ${A.length} churned members`,calculation:"Sum of paid amounts for churned members",icon:"TrendingUp",rawValue:D}]})(c),S=d=>{switch(d){case"Users":return Z;case"CheckCircle":return tt;case"AlertTriangle":return qe;case"Clock":return Oe;default:return ue}},N=(d,h)=>["from-blue-500 to-blue-600","from-green-500 to-green-600","from-red-500 to-red-600","from-yellow-500 to-yellow-600","from-purple-500 to-purple-600"][h]||"from-slate-500 to-slate-600",y=d=>d.title==="Active Members"?c.filter(h=>h.status==="Active"):d.title==="Churned Members"?c.filter(h=>h.status==="Churned"):d.title==="Frozen Members"?c.filter(h=>h.status==="Frozen"):c;return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8",children:V.map((d,h)=>{const b=S(d.icon),x=N(d,h);return e.jsx(F,{className:ne("relative overflow-hidden border-0 shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer transform hover:scale-105","bg-gradient-to-br",x),onClick:()=>{const C=y(d);f==null||f(C,d.title.toLowerCase())},children:e.jsxs(I,{className:"p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg backdrop-blur-sm",children:e.jsx(b,{className:"w-6 h-6 text-white"})}),e.jsx(z,{className:"bg-white/20 text-white border-0 backdrop-blur-sm",children:h===0?"Total":h===1?"Active":h===2?"Churned":h===3?"Frozen":"Revenue"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-3xl font-bold text-white",children:d.value}),e.jsx("div",{className:"text-white/90 font-medium",children:d.title}),e.jsx("div",{className:"text-white/70 text-sm",children:d.description})]}),e.jsx("div",{className:"absolute -right-4 -bottom-4 w-24 h-24 bg-white/10 rounded-full"}),e.jsx("div",{className:"absolute -right-2 -bottom-2 w-16 h-16 bg-white/5 rounded-full"})]})},h)})})},jt=({isOpen:c,onClose:f,data:j,type:V})=>{var $;if(!j)return null;const S=Array.isArray(j)&&j.length>0&&j[0].hasOwnProperty("status"),N=()=>{if(!S)return null;const A=j,D=A.filter(n=>n.status==="Active").length,p=A.filter(n=>n.status==="Churned").length,o=A.filter(n=>n.status==="Frozen").length;return e.jsxs(F,{className:"bg-gradient-to-br from-slate-50 to-slate-100 border-slate-200",children:[e.jsx(K,{children:e.jsxs(W,{className:"flex items-center gap-2 text-slate-800",children:[e.jsx(Z,{className:"w-5 h-5"}),"Member Details (",A.length," total)"]})}),e.jsxs(I,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:D}),e.jsx("div",{className:"text-sm text-green-600",children:"Active"})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:p}),e.jsx("div",{className:"text-sm text-red-600",children:"Churned"})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:o}),e.jsx("div",{className:"text-sm text-yellow-600",children:"Frozen"})]})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto space-y-2",children:A.slice(0,50).map((n,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-slate-800",children:[n.firstName," ",n.lastName]}),e.jsxs("div",{className:"text-sm text-slate-600",children:[n.email," • ",n.membershipName]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-sm font-medium ${n.status==="Active"?"text-green-600":n.status==="Churned"?"text-red-600":"text-yellow-600"}`,children:n.status}),e.jsxs("div",{className:"text-xs text-slate-500",children:["End: ",n.endDate]})]})]},t))})]})]})},y=(A,D=0)=>{const p=Number(A);return isNaN(p)?D:p},h=(()=>{const A=j.filteredTransactionData||j.rawData||j.transactionData||[];if(V==="product"&&j.name){const D=j.name;let p=A;return!j.filteredTransactionData&&A.length>0&&(p=A.filter(o=>o.productName===D||o.membershipName===D||o.itemName===D||o.cleanedProduct===D||o.paymentItem===D)),X(J({},j),{filteredData:p,specificRevenue:j.specificRevenue||p.reduce((o,n)=>o+(n.paymentValue||0),0),specificTransactions:j.specificTransactions||p.length,specificCustomers:j.specificCustomers||new Set(p.map(o=>o.memberId||o.customerEmail)).size})}if(V==="category"&&j.name){const D=j.name;let p=A;return!j.filteredTransactionData&&A.length>0&&(p=A.filter(o=>o.cleanedCategory===D||o.category===D)),X(J({},j),{filteredData:p,specificRevenue:j.specificRevenue||p.reduce((o,n)=>o+(n.paymentValue||0),0),specificTransactions:j.specificTransactions||p.length,specificCustomers:j.specificCustomers||new Set(p.map(o=>o.memberId||o.customerEmail)).size})}return V==="trainer"&&j.teacherName?{name:j.teacherName,location:j.location,classType:j.classType||"Mixed",totalSessions:j.sessions||j.totalSessions||0,totalRevenue:j.revenue||j.totalPaid||0,totalCustomers:j.customers||j.totalCustomers||0,utilization:j.utilization||0,avgCheckedIn:j.avgCheckedIn||0,cancellationRate:j.cancellationRate||0}:X(J({},j),{filteredData:A,specificRevenue:j.specificRevenue,specificTransactions:j.specificTransactions,specificCustomers:j.specificCustomers})})(),b=()=>{const A=y(h.specificRevenue||h.totalRevenue||h.revenue||h.grossRevenue),D=y(h.specificTransactions||h.transactions||h.totalTransactions),p=y(h.specificCustomers||h.uniqueMembers||h.totalCustomers||h.customers),o=y(h.totalChange||h.change||h.growth);return e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(F,{className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white border-0 shadow-lg",children:e.jsxs(I,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Be,{className:"w-5 h-5 text-blue-100"}),e.jsx(z,{className:"bg-white/20 text-white border-0",children:"Revenue"})]}),e.jsx("div",{className:"text-2xl font-bold",children:Q(A)}),e.jsx("div",{className:"text-blue-100 text-sm",children:"Total Revenue"})]})}),e.jsx(F,{className:"bg-gradient-to-br from-green-500 to-green-600 text-white border-0 shadow-lg",children:e.jsxs(I,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Z,{className:"w-5 h-5 text-green-100"}),e.jsx(z,{className:"bg-white/20 text-white border-0",children:"Customers"})]}),e.jsx("div",{className:"text-2xl font-bold",children:M(p)}),e.jsx("div",{className:"text-green-100 text-sm",children:"Unique Customers"})]})}),e.jsx(F,{className:"bg-gradient-to-br from-purple-500 to-purple-600 text-white border-0 shadow-lg",children:e.jsxs(I,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(at,{className:"w-5 h-5 text-purple-100"}),e.jsx(z,{className:"bg-white/20 text-white border-0",children:"Volume"})]}),e.jsx("div",{className:"text-2xl font-bold",children:M(D)}),e.jsx("div",{className:"text-purple-100 text-sm",children:"Transactions"})]})}),e.jsx(F,{className:"bg-gradient-to-br from-orange-500 to-orange-600 text-white border-0 shadow-lg",children:e.jsxs(I,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o>=0?e.jsx(ue,{className:"w-5 h-5 text-orange-100"}):e.jsx(Ke,{className:"w-5 h-5 text-orange-100"}),e.jsx(z,{className:"bg-white/20 text-white border-0",children:"Growth"})]}),e.jsx("div",{className:"text-2xl font-bold",children:o!==0?`${o>0?"+":""}${o.toFixed(1)}%`:"N/A"}),e.jsx("div",{className:"text-orange-100 text-sm",children:"Performance"})]})})]})},x=()=>V!=="trainer"?null:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(F,{className:"bg-gradient-to-br from-slate-50 to-slate-100 border-slate-200",children:[e.jsx(K,{children:e.jsxs(W,{className:"flex items-center gap-2 text-slate-800",children:[e.jsx(Ue,{className:"w-5 h-5"}),"Class Performance"]})}),e.jsx(I,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[e.jsx("div",{className:"text-sm text-slate-600",children:"Total Sessions"}),e.jsx("div",{className:"text-xl font-bold text-slate-800",children:M(h.totalSessions)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[e.jsx("div",{className:"text-sm text-slate-600",children:"Avg Check-in"}),e.jsx("div",{className:"text-xl font-bold text-blue-600",children:M(h.avgCheckedIn)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[e.jsx("div",{className:"text-sm text-slate-600",children:"Utilization"}),e.jsx("div",{className:`text-xl font-bold ${h.utilization>=80?"text-green-600":"text-orange-600"}`,children:_(h.utilization/100)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[e.jsx("div",{className:"text-sm text-slate-600",children:"Cancellation Rate"}),e.jsx("div",{className:`text-xl font-bold ${h.cancellationRate<=10?"text-green-600":"text-red-600"}`,children:_(h.cancellationRate/100)})]})]})})]}),e.jsxs(F,{className:"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx(K,{children:e.jsxs(W,{className:"flex items-center gap-2 text-blue-800",children:[e.jsx(Ee,{className:"w-5 h-5"}),"Performance Insights"]})}),e.jsxs(I,{className:"space-y-3",children:[e.jsxs("div",{className:"p-3 bg-white rounded-lg border-l-4 border-blue-400",children:[e.jsx("div",{className:"text-sm font-medium text-blue-800",children:"Class Type"}),e.jsx("div",{className:"text-blue-600",children:h.classType})]}),e.jsxs("div",{className:"p-3 bg-white rounded-lg border-l-4 border-green-400",children:[e.jsx("div",{className:"text-sm font-medium text-green-800",children:"Revenue/Session"}),e.jsx("div",{className:"text-green-600",children:Q(h.totalSessions>0?h.totalRevenue/h.totalSessions:0)})]}),e.jsxs("div",{className:"p-3 bg-white rounded-lg border-l-4 border-purple-400",children:[e.jsx("div",{className:"text-sm font-medium text-purple-800",children:"Customer/Session"}),e.jsx("div",{className:"text-purple-600",children:(h.totalSessions>0?h.totalCustomers/h.totalSessions:0).toFixed(1)})]})]})]})]}),C=()=>{const A=h.filteredData||h.rawData||[];return A.length===0?null:e.jsxs(F,{className:"bg-gradient-to-br from-slate-50 to-slate-100",children:[e.jsx(K,{children:e.jsxs(W,{className:"flex items-center gap-2 text-slate-800",children:[e.jsx(ye,{className:"w-5 h-5"}),"Transaction Details"]})}),e.jsxs(I,{children:[e.jsx("div",{className:"max-h-96 overflow-y-auto space-y-2",children:A.slice(0,20).map((D,p)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-slate-800",children:D.membershipName||D.productName||D.itemName||"Transaction"}),e.jsxs("div",{className:"text-sm text-slate-600",children:[D.customerEmail||D.memberId," • ",D.date||"N/A"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-bold text-slate-800",children:Q(D.paymentValue||D.amount||0)}),e.jsx("div",{className:"text-sm text-slate-600",children:D.paymentMethod||"N/A"})]})]},p))}),A.length>20&&e.jsxs("div",{className:"mt-4 text-center text-sm text-slate-600",children:["Showing 20 of ",A.length," transactions"]})]})]})},w=()=>V==="trainer"?`${h.name} - Trainer Performance`:V==="product"?`${h.name} - Product Analysis`:V==="class"?`${h.classType||"Class"} - Detailed Analytics`:`${h.name||"Item"} - Performance Analysis`,R=()=>V==="trainer"?`${h.location} • ${h.classType} Classes`:V==="product"?"Comprehensive product performance and customer insights":"Detailed performance breakdown and analytics";return e.jsx(Je,{open:c,onOpenChange:f,children:e.jsxs(_e,{className:"max-w-7xl max-h-[95vh] overflow-y-auto bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-2xl",children:[e.jsx(Qe,{className:"pb-6 border-b border-slate-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Xe,{className:"text-3xl font-bold bg-gradient-to-r from-slate-800 via-blue-600 to-purple-600 bg-clip-text text-transparent",children:w()}),e.jsx("p",{className:"text-slate-600 mt-2 text-lg",children:R()})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"bg-blue-100 text-blue-800 border-0",children:V==="trainer"?"Trainer":V==="product"?"Product":"Analytics"}),e.jsx(G,{variant:"outline",onClick:f,children:"Close"})]})]})}),e.jsxs("div",{className:"pt-6 space-y-8",children:[b(),e.jsxs(Ve,{defaultValue:"overview",className:"w-full",children:[e.jsxs(ze,{className:"grid w-full grid-cols-4 bg-slate-100",children:[e.jsxs(H,{value:"overview",className:"gap-2",children:[e.jsx(Ts,{className:"w-4 h-4"}),"Overview"]}),e.jsxs(H,{value:"performance",className:"gap-2",children:[e.jsx(ue,{className:"w-4 h-4"}),"Performance"]}),e.jsxs(H,{value:"details",className:"gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"Details"]}),e.jsxs(H,{value:"insights",className:"gap-2",children:[e.jsx(Ds,{className:"w-4 h-4"}),"Insights"]})]}),e.jsxs(ae,{value:"overview",className:"space-y-6",children:[N(),x(),e.jsxs(F,{className:"bg-gradient-to-br from-indigo-50 to-indigo-100 border-indigo-200",children:[e.jsx(K,{children:e.jsx(W,{className:"text-indigo-800",children:"Summary Statistics"})}),e.jsx(I,{children:e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-indigo-600",children:Q(h.specificRevenue||h.totalRevenue||0)}),e.jsx("div",{className:"text-sm text-indigo-600",children:"Total Revenue"})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:M(h.specificTransactions||h.transactions||0)}),e.jsx("div",{className:"text-sm text-green-600",children:"Transactions"})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:M(h.specificCustomers||h.customers||0)}),e.jsx("div",{className:"text-sm text-purple-600",children:"Customers"})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:Q((h.specificTransactions||h.transactions)>0?(h.specificRevenue||h.totalRevenue||0)/(h.specificTransactions||h.transactions||1):0)}),e.jsx("div",{className:"text-sm text-orange-600",children:"Avg Transaction"})]})]})})]})]}),e.jsx(ae,{value:"performance",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(F,{className:"bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:[e.jsx(K,{children:e.jsx(W,{className:"text-green-800",children:"Performance Metrics"})}),e.jsxs(I,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 bg-white rounded-lg",children:[e.jsx("span",{className:"text-green-700",children:"Revenue Growth"}),e.jsxs(z,{className:"bg-green-200 text-green-800",children:[h.totalChange>0?"+":"",(($=h.totalChange)==null?void 0:$.toFixed(1))||0,"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center p-3 bg-white rounded-lg",children:[e.jsx("span",{className:"text-green-700",children:"Performance Rating"}),e.jsx(z,{className:"bg-green-200 text-green-800",children:(h.specificRevenue||h.totalRevenue||0)>5e4?"Excellent":"Good"})]})]})]}),e.jsxs(F,{className:"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx(K,{children:e.jsx(W,{className:"text-blue-800",children:"Key Insights"})}),e.jsxs(I,{className:"space-y-3",children:[e.jsxs("div",{className:"p-3 bg-white rounded-lg border-l-4 border-blue-400",children:[e.jsx("div",{className:"text-sm font-medium text-blue-800",children:"Market Position"}),e.jsx("div",{className:"text-blue-600",children:"Strong performer in category"})]}),e.jsxs("div",{className:"p-3 bg-white rounded-lg border-l-4 border-green-400",children:[e.jsx("div",{className:"text-sm font-medium text-green-800",children:"Customer Loyalty"}),e.jsx("div",{className:"text-green-600",children:"High retention rate"})]})]})]})]})}),e.jsx(ae,{value:"details",children:C()}),e.jsx(ae,{value:"insights",children:e.jsxs(F,{className:"bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx(K,{children:e.jsx(W,{className:"text-purple-800",children:"AI-Powered Insights"})}),e.jsx(I,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-white rounded-lg border-l-4 border-purple-400",children:[e.jsx("h4",{className:"font-medium text-purple-800 mb-2",children:"Strengths"}),e.jsxs("ul",{className:"text-sm text-purple-600 space-y-1",children:[e.jsx("li",{children:"• Consistent revenue performance"}),e.jsx("li",{children:"• Strong customer engagement"}),e.jsx("li",{children:"• Effective conversion rates"})]})]}),e.jsxs("div",{className:"p-4 bg-white rounded-lg border-l-4 border-orange-400",children:[e.jsx("h4",{className:"font-medium text-orange-800 mb-2",children:"Opportunities"}),e.jsxs("ul",{className:"text-sm text-orange-600 space-y-1",children:[e.jsx("li",{children:"• Expand successful programs"}),e.jsx("li",{children:"• Optimize capacity utilization"}),e.jsx("li",{children:"• Enhance retention strategies"})]})]})]})})]})})]})]})]})})},ws=["#6366f1","#8b5cf6","#ec4899","#f59e0b","#10b981","#ef4444","#06b6d4","#84cc16"],bt=({data:c})=>{const f=c.reduce((b,x)=>{const C=x.status||"Unknown";return b[C]=(b[C]||0)+1,b},{}),j=Object.entries(f).map(([b,x])=>({name:b,value:x})),V=c.reduce((b,x)=>{const C=x.membershipName||"Unknown";return b[C]=(b[C]||0)+1,b},{}),S=Object.entries(V).map(([b,x])=>({name:b.length>20?b.substring(0,20)+"...":b,value:x})).sort((b,x)=>x.value-b.value).slice(0,8),N=c.reduce((b,x)=>{if(x.endDate){const C=new Date(x.endDate).toLocaleDateString("en-US",{month:"short",year:"2-digit"});b[C]=(b[C]||0)+1}return b},{}),y=Object.entries(N).map(([b,x])=>({month:b,count:x})).sort((b,x)=>b.month.localeCompare(x.month)).slice(0,12),d=c.reduce((b,x)=>{const C=x.homeLocation||"Unknown",w=x.status||"Unknown";return b[C]||(b[C]={}),b[C][w]=(b[C][w]||0)+1,b},{}),h=Object.entries(d).map(([b,x])=>J({location:b.length>15?b.substring(0,15)+"...":b},x));return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsxs(F,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(K,{className:"pb-3",children:e.jsxs(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full"}),"Membership Status Distribution"]})}),e.jsx(I,{children:e.jsx(we,{width:"100%",height:300,children:e.jsxs(Ps,{children:[e.jsx(Fs,{data:j,cx:"50%",cy:"50%",labelLine:!1,label:({name:b,percent:x})=>`${b} ${(x*100).toFixed(1)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:j.map((b,x)=>e.jsx(Is,{fill:ws[x%ws.length]},`cell-${x}`))}),e.jsx(Ce,{formatter:b=>[M(b),"Count"]})]})})})]}),e.jsxs(F,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(K,{className:"pb-3",children:e.jsxs(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gradient-to-r from-green-500 to-blue-500 rounded-full"}),"Top Membership Types"]})}),e.jsx(I,{children:e.jsx(we,{width:"100%",height:300,children:e.jsxs(Ye,{data:S,layout:"horizontal",children:[e.jsx(Ie,{strokeDasharray:"3 3"}),e.jsx($e,{type:"number"}),e.jsx(Le,{dataKey:"name",type:"category",width:100}),e.jsx(Ce,{formatter:b=>[M(b),"Members"]}),e.jsx(Ae,{dataKey:"value",fill:"#6366f1"})]})})})]}),e.jsxs(F,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(K,{className:"pb-3",children:e.jsxs(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full"}),"Monthly Expiration Trend"]})}),e.jsx(I,{children:e.jsx(we,{width:"100%",height:300,children:e.jsxs($s,{data:y,children:[e.jsx(Ie,{strokeDasharray:"3 3"}),e.jsx($e,{dataKey:"month"}),e.jsx(Le,{}),e.jsx(Ce,{formatter:b=>[M(b),"Expirations"]}),e.jsx(He,{type:"monotone",dataKey:"count",stroke:"#8b5cf6",fill:"#8b5cf6",fillOpacity:.3})]})})})]}),e.jsxs(F,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(K,{className:"pb-3",children:e.jsxs(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gradient-to-r from-orange-500 to-red-500 rounded-full"}),"Status by Location"]})}),e.jsx(I,{children:e.jsx(we,{width:"100%",height:300,children:e.jsxs(Ye,{data:h,children:[e.jsx(Ie,{strokeDasharray:"3 3"}),e.jsx($e,{dataKey:"location"}),e.jsx(Le,{}),e.jsx(Ce,{}),e.jsx(Ls,{}),e.jsx(Ae,{dataKey:"Active",stackId:"a",fill:"#10b981"}),e.jsx(Ae,{dataKey:"Churned",stackId:"a",fill:"#ef4444"}),e.jsx(Ae,{dataKey:"Frozen",stackId:"a",fill:"#f59e0b"})]})})})]})]})},vt=({data:c,onRowClick:f})=>{const[j,V]=T.useState(""),[S,N]=T.useState("endDate"),[y,d]=T.useState("asc"),h=p=>{S===p?d(y==="asc"?"desc":"asc"):(N(p),d("asc"))},b=c.filter(p=>{var n,t,u,r,s;const o=j.toLowerCase();return((n=p.firstName)==null?void 0:n.toLowerCase().includes(o))||((t=p.lastName)==null?void 0:t.toLowerCase().includes(o))||((u=p.email)==null?void 0:u.toLowerCase().includes(o))||((r=p.membershipName)==null?void 0:r.toLowerCase().includes(o))||((s=p.status)==null?void 0:s.toLowerCase().includes(o))}).sort((p,o)=>{const n=p[S]||"",t=o[S]||"",u=y==="asc"?1:-1;return n.localeCompare(t)*u}),x=b.filter(p=>p.status==="Churned"),C=b.filter(p=>p.status==="Frozen"),w=b.filter(p=>p.status==="Active"),R=c.reduce((p,o)=>{const n=o.membershipName||"Unknown";return p[n]||(p[n]={name:n,total:0,active:0,churned:0,frozen:0}),p[n].total++,o.status==="Active"&&p[n].active++,o.status==="Churned"&&p[n].churned++,o.status==="Frozen"&&p[n].frozen++,p},{}),$=Object.values(R).sort((p,o)=>o.total-p.total),A=({field:p,children:o})=>e.jsxs(G,{variant:"ghost",size:"sm",onClick:()=>h(p),className:"h-auto p-1 font-medium text-slate-700 hover:text-slate-900",children:[o,S===p&&(y==="asc"?e.jsx(Rs,{className:"ml-1 h-3 w-3"}):e.jsx(Vs,{className:"ml-1 h-3 w-3"}))]}),D=p=>e.jsx(z,{variant:"outline",className:ne("text-xs",p==="Churned"?"border-red-200 bg-red-50 text-red-700":p==="Frozen"?"border-yellow-200 bg-yellow-50 text-yellow-700":"border-green-200 bg-green-50 text-green-700"),children:p});return e.jsxs("div",{className:"space-y-6",children:[e.jsx(F,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg",children:e.jsx(I,{className:"p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(As,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 h-4 w-4"}),e.jsx(Re,{placeholder:"Search by name, email, membership, or status...",value:j,onChange:p=>V(p.target.value),className:"pl-10 border-slate-300 focus:border-blue-500 focus:ring-blue-500"})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(F,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(K,{className:"pb-3",children:e.jsxs(W,{className:"text-lg font-semibold bg-gradient-to-r from-red-600 to-red-500 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),"Churned Memberships (",M(x.length),")"]})}),e.jsx(I,{children:e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-white/90",children:e.jsxs("tr",{className:"border-b border-slate-200",children:[e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(A,{field:"firstName",children:"Member"})}),e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(A,{field:"membershipName",children:"Membership"})}),e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(A,{field:"endDate",children:"End Date"})}),e.jsx("th",{className:"text-left py-2 px-3",children:"Status"})]})}),e.jsx("tbody",{children:x.slice(0,50).map((p,o)=>e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50/50 cursor-pointer",onClick:()=>f==null?void 0:f(p),children:[e.jsx("td",{className:"py-2 px-3 font-medium",children:`${p.firstName} ${p.lastName}`}),e.jsx("td",{className:"py-2 px-3 text-slate-600 text-xs",children:p.membershipName}),e.jsx("td",{className:"py-2 px-3 text-slate-600",children:p.endDate}),e.jsx("td",{className:"py-2 px-3",children:D(p.status)})]},o))})]})})})]}),e.jsxs(F,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(K,{className:"pb-3",children:e.jsxs(W,{className:"text-lg font-semibold bg-gradient-to-r from-yellow-600 to-yellow-500 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),"Frozen Memberships (",M(C.length),")"]})}),e.jsx(I,{children:e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-white/90",children:e.jsxs("tr",{className:"border-b border-slate-200",children:[e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(A,{field:"firstName",children:"Member"})}),e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(A,{field:"membershipName",children:"Membership"})}),e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(A,{field:"endDate",children:"End Date"})}),e.jsx("th",{className:"text-left py-2 px-3",children:"Status"})]})}),e.jsx("tbody",{children:C.slice(0,50).map((p,o)=>e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50/50 cursor-pointer",onClick:()=>f==null?void 0:f(p),children:[e.jsx("td",{className:"py-2 px-3 font-medium",children:`${p.firstName} ${p.lastName}`}),e.jsx("td",{className:"py-2 px-3 text-slate-600 text-xs",children:p.membershipName}),e.jsx("td",{className:"py-2 px-3 text-slate-600",children:p.endDate}),e.jsx("td",{className:"py-2 px-3",children:D(p.status)})]},o))})]})})})]}),e.jsxs(F,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(K,{className:"pb-3",children:e.jsxs(W,{className:"text-lg font-semibold bg-gradient-to-r from-green-600 to-green-500 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),"Active Memberships (",M(w.length),")"]})}),e.jsx(I,{children:e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-white/90",children:e.jsxs("tr",{className:"border-b border-slate-200",children:[e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(A,{field:"firstName",children:"Member"})}),e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(A,{field:"membershipName",children:"Membership"})}),e.jsx("th",{className:"text-left py-2 px-3",children:e.jsx(A,{field:"endDate",children:"End Date"})}),e.jsx("th",{className:"text-left py-2 px-3",children:"Status"})]})}),e.jsx("tbody",{children:w.slice(0,50).map((p,o)=>e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50/50 cursor-pointer",onClick:()=>f==null?void 0:f(p),children:[e.jsx("td",{className:"py-2 px-3 font-medium",children:`${p.firstName} ${p.lastName}`}),e.jsx("td",{className:"py-2 px-3 text-slate-600 text-xs",children:p.membershipName}),e.jsx("td",{className:"py-2 px-3 text-slate-600",children:p.endDate}),e.jsx("td",{className:"py-2 px-3",children:D(p.status)})]},o))})]})})})]}),e.jsxs(F,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg hover:shadow-xl transition-all duration-300",children:[e.jsx(K,{className:"pb-3",children:e.jsxs(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gradient-to-r from-slate-500 to-slate-600 rounded-full"}),"Membership Type Summary"]})}),e.jsx(I,{children:e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-white/90",children:e.jsxs("tr",{className:"border-b border-slate-200",children:[e.jsx("th",{className:"text-left py-2 px-3 font-medium text-slate-700",children:"Membership"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-slate-700",children:"Total"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-green-600",children:"Active"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-yellow-600",children:"Frozen"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-red-600",children:"Churned"})]})}),e.jsx("tbody",{children:$.map((p,o)=>e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50/50",children:[e.jsx("td",{className:"py-2 px-3 font-medium text-xs",children:p.name}),e.jsx("td",{className:"py-2 px-3 text-center font-medium",children:M(p.total)}),e.jsx("td",{className:"py-2 px-3 text-center text-green-600",children:M(p.active)}),e.jsx("td",{className:"py-2 px-3 text-center text-yellow-600",children:M(p.frozen)}),e.jsx("td",{className:"py-2 px-3 text-center text-red-600",children:M(p.churned)})]},o))})]})})})]})]})]})},ft=({data:c})=>{const f=c.reduce((x,C)=>{const w=C.homeLocation||"Unknown";return x[w]||(x[w]={name:w,total:0,active:0,churned:0,frozen:0,churnRate:0}),x[w].total++,C.status==="Active"&&x[w].active++,C.status==="Churned"&&x[w].churned++,C.status==="Frozen"&&x[w].frozen++,x},{});Object.values(f).forEach(x=>{x.churnRate=x.total>0?x.churned/x.total*100:0});const j=Object.values(f).sort((x,C)=>C.total-x.total),V=c.reduce((x,C)=>{const w=C.soldBy||"Unknown";return x[w]||(x[w]={name:w,total:0,active:0,churned:0,frozen:0,churnRate:0}),x[w].total++,C.status==="Active"&&x[w].active++,C.status==="Churned"&&x[w].churned++,C.status==="Frozen"&&x[w].frozen++,x},{});Object.values(V).forEach(x=>{x.churnRate=x.total>0?x.churned/x.total*100:0});const S=Object.values(V).filter(x=>x.name!=="Unknown"&&x.name!=="-").sort((x,C)=>C.total-x.total).slice(0,10),N=c.reduce((x,C)=>{if(C.endDate)try{const w=new Date(C.endDate),R=Ge(w,"MMM yyyy");x[R]||(x[R]={month:R,active:0,churned:0,frozen:0,total:0}),x[R].total++,C.status==="Active"&&x[R].active++,C.status==="Churned"&&x[R].churned++,C.status==="Frozen"&&x[R].frozen++}catch(w){}return x},{}),y=Object.values(N).sort((x,C)=>new Date(x.month).getTime()-new Date(C.month).getTime()).slice(-12),d=c.reduce((x,C)=>{const w=parseFloat(C.paid)||0,R=w>=1e4?"High Value (₹10K+)":w>=5e3?"Medium Value (₹5K-10K)":"Low Value (<₹5K)";return x[R]||(x[R]={category:R,total:0,active:0,churned:0,frozen:0,churnRate:0}),x[R].total++,C.status==="Active"&&x[R].active++,C.status==="Churned"&&x[R].churned++,C.status==="Frozen"&&x[R].frozen++,x},{});Object.values(d).forEach(x=>{x.churnRate=x.total>0?x.churned/x.total*100:0});const h=Object.values(d),b=x=>x>=50?"text-red-600":x>=30?"text-yellow-600":"text-green-600";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(F,{className:"bg-white/70 backdrop-blur-sm border-slate-200/50",children:[e.jsx(K,{children:e.jsx(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent",children:"Location Performance Analysis"})}),e.jsx(I,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsx(we,{width:"100%",height:300,children:e.jsxs(Ye,{data:j,children:[e.jsx(Ie,{strokeDasharray:"3 3"}),e.jsx($e,{dataKey:"name",angle:-45,textAnchor:"end",height:100,fontSize:12}),e.jsx(Le,{}),e.jsx(Ce,{}),e.jsx(Ls,{}),e.jsx(Ae,{dataKey:"active",stackId:"a",fill:"#10b981",name:"Active"}),e.jsx(Ae,{dataKey:"frozen",stackId:"a",fill:"#f59e0b",name:"Frozen"}),e.jsx(Ae,{dataKey:"churned",stackId:"a",fill:"#ef4444",name:"Churned"})]})})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-200",children:[e.jsx("th",{className:"text-left py-2 px-3 font-medium text-slate-700",children:"Location"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-slate-700",children:"Total"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-slate-700",children:"Churn Rate"})]})}),e.jsx("tbody",{children:j.map((x,C)=>e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50/50",children:[e.jsx("td",{className:"py-2 px-3 font-medium text-xs",children:x.name}),e.jsx("td",{className:"py-2 px-3 text-center",children:M(x.total)}),e.jsx("td",{className:`py-2 px-3 text-center font-medium ${b(x.churnRate)}`,children:_(x.churnRate)})]},C))})]})})]})})]}),e.jsxs(F,{className:"bg-white/70 backdrop-blur-sm border-slate-200/50",children:[e.jsx(K,{children:e.jsx(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent",children:"Top Sales Representatives by Membership Volume"})}),e.jsx(I,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-200",children:[e.jsx("th",{className:"text-left py-2 px-3 font-medium text-slate-700",children:"Sales Rep"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-slate-700",children:"Total Sold"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-green-600",children:"Active"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-yellow-600",children:"Frozen"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-red-600",children:"Churned"}),e.jsx("th",{className:"text-center py-2 px-3 font-medium text-slate-700",children:"Churn Rate"})]})}),e.jsx("tbody",{children:S.map((x,C)=>e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50/50",children:[e.jsx("td",{className:"py-2 px-3 font-medium text-xs",children:x.name}),e.jsx("td",{className:"py-2 px-3 text-center font-medium",children:M(x.total)}),e.jsx("td",{className:"py-2 px-3 text-center text-green-600",children:M(x.active)}),e.jsx("td",{className:"py-2 px-3 text-center text-yellow-600",children:M(x.frozen)}),e.jsx("td",{className:"py-2 px-3 text-center text-red-600",children:M(x.churned)}),e.jsx("td",{className:`py-2 px-3 text-center font-medium ${b(x.churnRate)}`,children:_(x.churnRate)})]},C))})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(F,{className:"bg-white/70 backdrop-blur-sm border-slate-200/50",children:[e.jsx(K,{children:e.jsx(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent",children:"Monthly Status Trend"})}),e.jsx(I,{children:e.jsx(we,{width:"100%",height:300,children:e.jsxs($s,{data:y,children:[e.jsx(Ie,{strokeDasharray:"3 3"}),e.jsx($e,{dataKey:"month",fontSize:12}),e.jsx(Le,{}),e.jsx(Ce,{}),e.jsx(He,{type:"monotone",dataKey:"churned",stackId:"1",stroke:"#ef4444",fill:"#ef4444"}),e.jsx(He,{type:"monotone",dataKey:"frozen",stackId:"1",stroke:"#f59e0b",fill:"#f59e0b"}),e.jsx(He,{type:"monotone",dataKey:"active",stackId:"1",stroke:"#10b981",fill:"#10b981"})]})})})]}),e.jsxs(F,{className:"bg-white/70 backdrop-blur-sm border-slate-200/50",children:[e.jsx(K,{children:e.jsx(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent",children:"Value Segment Performance"})}),e.jsx(I,{children:e.jsx("div",{className:"space-y-4",children:h.map((x,C)=>e.jsxs("div",{className:"p-4 bg-slate-50/50 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"font-medium text-slate-700",children:x.category}),e.jsxs(z,{variant:"outline",className:`${b(x.churnRate)} border-current`,children:[_(x.churnRate)," Churn"]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Total"}),e.jsx("div",{className:"font-medium",children:M(x.total)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-green-600",children:"Active"}),e.jsx("div",{className:"font-medium text-green-600",children:M(x.active)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-yellow-600",children:"Frozen"}),e.jsx("div",{className:"font-medium text-yellow-600",children:M(x.frozen)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-red-600",children:"Churned"}),e.jsx("div",{className:"font-medium text-red-600",children:M(x.churned)})]})]})]},C))})})]})]})]})},Nt=({data:c,onRowClick:f})=>{const[j,V]=T.useState(""),[S,N]=T.useState("endDate"),[y,d]=T.useState("desc"),[h,b]=T.useState("all"),[x,C]=T.useState("all"),w=T.useMemo(()=>c.filter(t=>t.status==="Churned"),[c]),R=T.useMemo(()=>{const t=new Set(w.map(u=>u.homeLocation).filter(Boolean));return Array.from(t)},[w]),$=T.useMemo(()=>{const t=new Set(w.map(u=>u.membershipName).filter(Boolean));return Array.from(t)},[w]),A=t=>{S===t?d(y==="asc"?"desc":"asc"):(N(t),d("asc"))},D=T.useMemo(()=>w.filter(t=>{var i,m,a,g,v;const u=j.toLowerCase(),r=((i=t.firstName)==null?void 0:i.toLowerCase().includes(u))||((m=t.lastName)==null?void 0:m.toLowerCase().includes(u))||((a=t.email)==null?void 0:a.toLowerCase().includes(u))||((g=t.membershipName)==null?void 0:g.toLowerCase().includes(u))||((v=t.soldBy)==null?void 0:v.toLowerCase().includes(u)),s=h==="all"||t.homeLocation===h,l=x==="all"||t.membershipName===x;return r&&s&&l}).sort((t,u)=>{let r=t[S]||"",s=u[S]||"";S==="endDate"?(r=new Date(r),s=new Date(s)):S==="paid"&&(r=parseFloat((r==null?void 0:r.toString().replace(/[^0-9.-]/g,""))||"0"),s=parseFloat((s==null?void 0:s.toString().replace(/[^0-9.-]/g,""))||"0"));const l=y==="asc"?1:-1;return r<s?-1*l:r>s?1*l:0}),[w,j,S,y,h,x]),p=T.useMemo(()=>{const t=D.reduce((r,s)=>{var i;const l=parseFloat(((i=s.paid)==null?void 0:i.toString().replace(/[^0-9.-]/g,""))||"0");return r+(isNaN(l)?0:l)},0),u=D.reduce((r,s)=>{const l=s.membershipName||"Unknown";return r[l]=(r[l]||0)+1,r},{});return{totalCount:D.length,totalRevenueLoss:t,membershipBreakdown:u}},[D]),o=({field:t,children:u})=>e.jsxs(G,{variant:"ghost",size:"sm",onClick:()=>A(t),className:"h-auto p-1 font-medium text-white hover:text-gray-200 hover:bg-white/10",children:[u,S===t&&(y==="asc"?e.jsx(Rs,{className:"ml-1 h-3 w-3"}):e.jsx(Vs,{className:"ml-1 h-3 w-3"}))]}),n=t=>{if(!t||t==="-")return"-";const u=parseFloat(t.toString().replace(/[^0-9.-]/g,"")||"0");return isNaN(u)?"-":Q(u)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(F,{className:"bg-gradient-to-r from-red-500 to-red-600 text-white border-0 shadow-lg",children:e.jsx(I,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(qe,{className:"w-8 h-8"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:M(p.totalCount)}),e.jsx("div",{className:"text-red-100",children:"Churned Members"})]})]})})}),e.jsx(F,{className:"bg-gradient-to-r from-orange-500 to-orange-600 text-white border-0 shadow-lg",children:e.jsx(I,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Be,{className:"w-8 h-8"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:Q(p.totalRevenueLoss)}),e.jsx("div",{className:"text-orange-100",children:"Revenue Impact"})]})]})})}),e.jsx(F,{className:"bg-gradient-to-r from-purple-500 to-purple-600 text-white border-0 shadow-lg",children:e.jsx(I,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Z,{className:"w-8 h-8"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:Object.keys(p.membershipBreakdown).length}),e.jsx("div",{className:"text-purple-100",children:"Membership Types"})]})]})})})]}),e.jsx(F,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg",children:e.jsx(I,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(As,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 h-4 w-4"}),e.jsx(Re,{placeholder:"Search members...",value:j,onChange:t=>V(t.target.value),className:"pl-10 border-slate-300 focus:border-red-500 focus:ring-red-500"})]}),e.jsxs(je,{value:h,onValueChange:b,children:[e.jsx(be,{children:e.jsx(ve,{placeholder:"Filter by location"})}),e.jsxs(fe,{children:[e.jsx(re,{value:"all",children:"All Locations"}),R.map(t=>e.jsx(re,{value:t,children:t},t))]})]}),e.jsxs(je,{value:x,onValueChange:C,children:[e.jsx(be,{children:e.jsx(ve,{placeholder:"Filter by membership"})}),e.jsxs(fe,{children:[e.jsx(re,{value:"all",children:"All Memberships"}),$.map(t=>e.jsx(re,{value:t,children:t},t))]})]}),e.jsxs("div",{className:"text-sm text-slate-600 flex items-center",children:["Showing ",M(D.length)," of ",M(w.length)," churned members"]})]})})}),e.jsxs(F,{className:"bg-white/90 backdrop-blur-sm border-slate-200/50 shadow-lg",children:[e.jsx(K,{className:"bg-gradient-to-r from-red-600 to-red-700 text-white",children:e.jsxs(W,{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(qe,{className:"w-6 h-6"}),"Churned Members - Detailed Analysis"]})}),e.jsx(I,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto max-h-[600px]",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-gradient-to-r from-red-600 to-red-700 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-3 px-4 min-w-[150px]",children:e.jsx(o,{field:"firstName",children:"Member Details"})}),e.jsx("th",{className:"text-left py-3 px-4 min-w-[200px]",children:e.jsx(o,{field:"membershipName",children:"Membership"})}),e.jsx("th",{className:"text-left py-3 px-4 min-w-[120px]",children:e.jsx(o,{field:"endDate",children:"End Date"})}),e.jsx("th",{className:"text-left py-3 px-4 min-w-[150px]",children:e.jsx(o,{field:"homeLocation",children:"Location"})}),e.jsx("th",{className:"text-right py-3 px-4 min-w-[100px]",children:e.jsx(o,{field:"paid",children:"Paid Amount"})}),e.jsx("th",{className:"text-left py-3 px-4 min-w-[120px]",children:e.jsx(o,{field:"soldBy",children:"Sold By"})}),e.jsx("th",{className:"text-center py-3 px-4",children:"Status"})]})}),e.jsx("tbody",{children:D.map((t,u)=>e.jsxs("tr",{className:"border-b border-slate-100 hover:bg-red-50/50 cursor-pointer transition-colors",onClick:()=>f==null?void 0:f(t),children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-slate-900",children:`${t.firstName} ${t.lastName}`}),e.jsx("div",{className:"text-xs text-slate-500",children:t.email}),e.jsxs("div",{className:"text-xs text-slate-400",children:["ID: ",t.memberId]})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-slate-700",children:t.membershipName}),e.jsxs("div",{className:"text-xs text-slate-500",children:["Membership ID: ",t.membershipId]})]})}),e.jsx("td",{className:"py-3 px-4 text-slate-600",children:new Date(t.endDate).toLocaleDateString()}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-1 text-slate-600",children:[e.jsx(ke,{className:"w-3 h-3"}),e.jsx("span",{className:"text-sm",children:t.homeLocation})]})}),e.jsx("td",{className:"py-3 px-4 text-right font-medium",children:n(t.paid)}),e.jsx("td",{className:"py-3 px-4 text-slate-600 text-sm",children:t.soldBy&&t.soldBy!=="-"?t.soldBy:"N/A"}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx(z,{variant:"outline",className:"border-red-200 bg-red-50 text-red-700",children:"Churned"})})]},t.uniqueId||u))})]})})})]})]})},Cs=[{id:"all",name:"All Locations",fullName:"All Locations"},{id:"kwality",name:"Kwality House, Kemps Corner",fullName:"Kwality House, Kemps Corner"},{id:"supreme",name:"Supreme HQ, Bandra",fullName:"Supreme HQ, Bandra"},{id:"kenkere",name:"Kenkere House",fullName:"Kenkere House"}],Et=({data:c})=>{const[f,j]=T.useState("all"),[V,S]=T.useState(null),[N,y]=T.useState("expiration"),[d,h]=T.useState(()=>({dateRange:ys(),location:[],status:[],membershipType:[],soldBy:[]})),b=p=>{var n,t,u;let o=[...p];return f!=="all"&&(o=o.filter(r=>{var l;return f==="kwality"?r.homeLocation==="Kwality House, Kemps Corner":f==="supreme"?r.homeLocation==="Supreme HQ, Bandra":((l=r.homeLocation)==null?void 0:l.includes("Kenkere"))||r.homeLocation==="Kenkere House"})),(n=d.status)!=null&&n.length&&(o=o.filter(r=>d.status.some(s=>{var l;return(l=r.status)==null?void 0:l.toLowerCase().includes(s.toLowerCase())}))),(t=d.membershipType)!=null&&t.length&&(o=o.filter(r=>d.membershipType.some(s=>{var l;return(l=r.membershipName)==null?void 0:l.toLowerCase().includes(s.toLowerCase())}))),(u=d.soldBy)!=null&&u.length&&(o=o.filter(r=>d.soldBy.some(s=>{var l;return(l=r.soldBy)==null?void 0:l.toLowerCase().includes(s.toLowerCase())}))),o},x=T.useMemo(()=>b(c||[]),[c,d,f]),C=p=>{const o=p.length,n=p.filter(i=>i.status==="Active").length,t=p.filter(i=>i.status==="Churned").length,u=p.filter(i=>i.status==="Frozen").length,r=o>0?t/o*100:0,s=o>0?n/o*100:0,l=o>0?u/o*100:0;return[{title:"Total Memberships",value:M(o),change:0,description:"All tracked membership records",calculation:"Count of all membership records",icon:"Users",rawValue:o},{title:"Active Members",value:M(n),change:0,description:`${_(s)} of total memberships`,calculation:"Count of active status",icon:"CheckCircle",rawValue:n},{title:"Churned Members",value:M(t),change:0,description:`${_(r)} churn rate`,calculation:"Count of churned status",icon:"AlertTriangle",rawValue:t},{title:"Frozen Members",value:M(u),change:0,description:`${_(l)} of total memberships`,calculation:"Count of frozen status",icon:"Clock",rawValue:u}]},w=()=>{const p=ys();h({dateRange:p,location:[],status:[],membershipType:[],soldBy:[]})};C(x);const R=(p,o="expiration")=>{S(p),y(o)},$=p=>{const o=p.reduce((r,s)=>{const l=s.membershipName||"Unknown";return r[l]=(r[l]||0)+1,r},{}),n=Object.entries(o).map(([r,s])=>({name:r,count:s})).sort((r,s)=>s.count-r.count),t=p.reduce((r,s)=>{const l=s.status||"Unknown";return r[l]=(r[l]||0)+1,r},{}),u=Object.entries(t).map(([r,s])=>({name:r,count:s})).sort((r,s)=>s.count-r.count);return{topMemberships:n,topStatuses:u}},{topMemberships:A,topStatuses:D}=$(x);return e.jsxs("div",{className:"w-full bg-gradient-to-br from-slate-50 via-purple-50/30 to-pink-50/20 rounded-lg",children:[e.jsx("div",{className:"sticky top-0 z-20 bg-white/95 backdrop-blur-lg border-b border-slate-200/50 rounded-t-lg",children:e.jsxs("div",{className:"px-6 py-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-slate-800 to-slate-600 bg-clip-text text-transparent",children:"Expirations & Churn Analytics"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Gs,{additionalData:{expirations:x},defaultFileName:"expirations-analysis"}),e.jsx(Ys,{})]})]}),e.jsx(Ve,{value:f,onValueChange:j,className:"w-full",children:e.jsx(ze,{className:"modern-tabs grid w-full grid-cols-4",children:Cs.map(p=>e.jsx(H,{value:p.id,className:"modern-tab-trigger tab-variant-purple",children:p.name},p.id))})})]})}),e.jsx("div",{className:"p-6",children:e.jsx(Ve,{value:f,onValueChange:j,className:"w-full",children:Cs.map(p=>e.jsx(ae,{value:p.id,className:"mt-0",children:e.jsxs(Ve,{defaultValue:"overview",className:"w-full",children:[e.jsxs(ze,{className:"modern-tabs grid w-full grid-cols-2 mb-6",children:[e.jsx(H,{value:"overview",className:"modern-tab-trigger tab-variant-blue",children:"Overview & Analytics"}),e.jsx(H,{value:"churned",className:"modern-tab-trigger tab-variant-rose",children:"Churned Members Details"})]}),e.jsx(ae,{value:"overview",className:"mt-0",children:e.jsxs("div",{className:"space-y-8",children:[e.jsx(ut,{filters:d,onFiltersChange:o=>h(o),onReset:w}),e.jsx(gt,{data:x,onMetricClick:(o,n)=>R(o,"expiration")}),e.jsx(bt,{data:x}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(F,{className:"bg-white/70 backdrop-blur-sm border-slate-200/50",children:[e.jsx(K,{children:e.jsx(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent",children:"Top Membership Types"})}),e.jsx(I,{children:e.jsx("div",{className:"space-y-2",children:A.slice(0,5).map((o,n)=>e.jsxs("div",{className:"flex justify-between items-center p-2 hover:bg-slate-50/50 rounded cursor-pointer",onClick:()=>R(x.filter(t=>t.membershipName===o.name),"expiration"),children:[e.jsx("span",{className:"text-sm text-slate-700",children:o.name}),e.jsx("span",{className:"text-sm font-medium text-slate-900",children:o.count})]},o.name))})})]}),e.jsxs(F,{className:"bg-white/70 backdrop-blur-sm border-slate-200/50",children:[e.jsx(K,{children:e.jsx(W,{className:"text-lg font-semibold bg-gradient-to-r from-slate-700 to-slate-500 bg-clip-text text-transparent",children:"Status Distribution"})}),e.jsx(I,{children:e.jsx("div",{className:"space-y-2",children:D.map((o,n)=>e.jsxs("div",{className:"flex justify-between items-center p-2 hover:bg-slate-50/50 rounded cursor-pointer",onClick:()=>R(x.filter(t=>t.status===o.name),"status"),children:[e.jsx("span",{className:"text-sm text-slate-700",children:o.name}),e.jsx("span",{className:"text-sm font-medium text-slate-900",children:o.count})]},o.name))})})]})]}),e.jsx(ft,{data:x}),e.jsx(vt,{data:x,onRowClick:o=>R([o],"member")})]})}),e.jsx(ae,{value:"churned",className:"mt-0",children:e.jsx(Nt,{data:x,onRowClick:o=>R([o],"member")})})]})},p.id))})}),V&&e.jsx(jt,{isOpen:!!V,onClose:()=>S(null),data:V,type:"member"})]})},Bt=({data:c,onMetricClick:f})=>{const j=T.useMemo(()=>{var $;if(!c||c.length===0)return[];const S=c.length,N=new Set(c.map(A=>A.memberId)).size,y=new Set(c.map(A=>A.location)).size,d=new Set(c.map(A=>A.cleanedClass)).size;new Set(c.map(A=>A.teacherName)).size;const h=N>0?S/N:0,b=-8.5,x=12.3,C=5.2,w=c.reduce((A,D)=>{const p=D.time?parseInt(D.time.split(":")[0]):0,o=p<12?"Morning":p<17?"Afternoon":"Evening";return A[o]=(A[o]||0)+1,A},{}),R=(($=Object.entries(w).reduce((A,D)=>w[A[0]]>w[D[0]]?A:D))==null?void 0:$[0])||"N/A";return[{title:"Total Late Cancellations",value:M(S),change:b,icon:nt,color:"red",description:"Total number of late cancellations across all locations",rawData:c,metricType:"total",totalCancellations:S,uniqueMembers:N,uniqueLocations:y},{title:"Affected Members",value:M(N),change:x,icon:Z,color:"orange",description:"Unique members who made late cancellations",rawData:c,metricType:"members",totalCancellations:S,uniqueMembers:N,uniqueLocations:y},{title:"Affected Locations",value:M(y),change:C,icon:ke,color:"blue",description:"Studio locations with late cancellations",rawData:c,metricType:"locations",totalCancellations:S,uniqueMembers:N,uniqueLocations:y},{title:"Avg per Member",value:M(Math.round(h*10)/10),change:-5.3,icon:Z,color:"purple",description:"Average late cancellations per member",rawData:c,metricType:"avg-member",totalCancellations:S,uniqueMembers:N,uniqueLocations:y},{title:"Affected Classes",value:M(d),change:8.7,icon:le,color:"green",description:"Different class types with late cancellations",rawData:c,metricType:"classes",totalCancellations:S,uniqueMembers:N,uniqueLocations:y},{title:"Peak Time Slot",value:R,change:0,icon:Oe,color:"cyan",description:"Time slot with most late cancellations",rawData:c,metricType:"peak-time",totalCancellations:S,uniqueMembers:N,uniqueLocations:y,showPercentage:!1}]},[c]),V=S=>{if(f){const N={title:S.title,metricValue:S.totalCancellations,totalCancellations:S.totalCancellations,uniqueMembers:S.uniqueMembers,uniqueLocations:S.uniqueLocations,rawData:S.rawData,type:"metric"};f(N)}};return j.length===0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((S,N)=>e.jsx(F,{className:"bg-gray-100 animate-pulse",children:e.jsx(I,{className:"p-6",children:e.jsx("div",{className:"h-20 bg-gray-200 rounded"})})},N))}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:j.map((S,N)=>{const y=S.icon,d=S.change>0,h=S.showPercentage!==!1;return e.jsx(F,{className:ne("bg-white shadow-xl border-0 overflow-hidden hover:shadow-2xl transition-all duration-500 group cursor-pointer","hover:scale-105 transform"),onClick:()=>V(S),style:{animationDelay:`${N*150}ms`},children:e.jsxs(I,{className:"p-0",children:[e.jsxs("div",{className:`bg-gradient-to-r ${S.color==="red"?"from-red-500 to-red-600":S.color==="orange"?"from-orange-500 to-orange-600":S.color==="blue"?"from-blue-500 to-indigo-600":S.color==="purple"?"from-purple-500 to-violet-600":S.color==="green"?"from-green-500 to-teal-600":"from-cyan-500 to-blue-600"} p-6 text-white relative overflow-hidden`,children:[e.jsx("div",{className:"absolute top-0 right-0 w-20 h-20 transform translate-x-8 -translate-y-8 opacity-20",children:e.jsx(y,{className:"w-20 h-20"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg",children:e.jsx(y,{className:"w-6 h-6"})}),e.jsx("h3",{className:"font-semibold text-sm",children:S.title})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-3xl font-bold",children:S.value}),h&&e.jsxs("div",{className:"flex items-center gap-2",children:[d?e.jsx(ue,{className:"w-4 h-4 text-green-200"}):e.jsx(Ke,{className:"w-4 h-4 text-red-200"}),e.jsxs("span",{className:`text-sm font-medium ${d?"text-green-200":"text-red-200"}`,children:[d?"+":"",S.change.toFixed(1),"%"]}),e.jsx("span",{className:"text-sm text-white/80",children:"vs last period"})]})]})]})]}),e.jsx("div",{className:"p-4 bg-gray-50",children:e.jsx("p",{className:"text-sm text-gray-600",children:S.description})})]})},N)})})},Ut=({data:c})=>{const[f,j]=T.useState("6m"),[V,S]=T.useState("monthly"),[N,y]=T.useState("count"),d=T.useMemo(()=>{if(!c||c.length===0)return[];const o=new Date;let n=new Date;switch(f){case"1m":n.setMonth(o.getMonth()-1);break;case"3m":n.setMonth(o.getMonth()-3);break;case"6m":n.setMonth(o.getMonth()-6);break;case"1y":n.setFullYear(o.getFullYear()-1);break;default:return c}return c.filter(t=>{if(!t.dateIST)return!1;const u=new Date(t.dateIST);return u>=n&&u<=o})},[c,f]),h=T.useMemo(()=>{if(!d.length)return[];const o=d.reduce((n,t)=>{if(!t.dateIST)return n;const u=new Date(t.dateIST),r=`${u.getFullYear()}-${String(u.getMonth()+1).padStart(2,"0")}`;return n[r]||(n[r]={month:u.toLocaleDateString("en",{month:"short",year:"numeric"}),count:0,members:new Set,locations:new Set}),n[r].count+=1,n[r].members.add(t.memberId),n[r].locations.add(t.location),n},{});return Object.values(o).map(n=>X(J({},n),{members:n.members.size,locations:n.locations.size})).sort((n,t)=>n.month.localeCompare(t.month))},[d]),b=T.useMemo(()=>{if(!d.length)return[];const o=d.reduce((t,u)=>{const r=u.location||"Unknown Location";return t[r]||(t[r]={name:r,count:0,members:new Set,classes:new Set}),t[r].count+=1,t[r].members.add(u.memberId),t[r].classes.add(u.cleanedClass),t},{});return Object.values(o).map(t=>X(J({},t),{members:t.members.size,classes:t.classes.size})).sort((t,u)=>u.count-t.count).slice(0,10)},[d]),x=T.useMemo(()=>{if(!d.length)return[];const o=d.reduce((n,t)=>{const u=t.cleanedClass||"Unknown Class";return n[u]||(n[u]=0),n[u]+=1,n},{});return Object.entries(o).map(([n,t])=>({name:n,value:t})).sort((n,t)=>t.value-n.value).slice(0,8)},[d]),C=T.useMemo(()=>{if(!d.length)return[];const o=d.reduce((t,u)=>{const r=u.dayOfWeek||"Unknown";return t[r]||(t[r]=0),t[r]+=1,t},{});return["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].map(t=>({day:t,count:o[t]||0}))},[d]),w=["#dc2626","#ea580c","#d97706","#ca8a04","#65a30d","#16a34a","#059669","#0891b2"],R=(o,n)=>M(Number(o)),$=T.useCallback(o=>{j(o)},[]),A=T.useCallback(o=>{S(o)},[]),D=T.useCallback(o=>{y(o)},[]);if(!c||c.length===0)return e.jsxs(F,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl",children:[e.jsx(K,{children:e.jsxs(W,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5 text-red-600"}),"Interactive Late Cancellations Charts"]})}),e.jsx(I,{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-slate-600",children:"No data available for charts"})})]});const p=()=>{switch(V){case"monthly":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(G,{variant:N==="count"?"default":"outline",size:"sm",onClick:()=>D("count"),children:"Cancellations"}),e.jsx(G,{variant:N==="members"?"default":"outline",size:"sm",onClick:()=>D("members"),children:"Unique Members"}),e.jsx(G,{variant:N==="locations"?"default":"outline",size:"sm",onClick:()=>D("locations"),children:"Locations"})]}),e.jsx(we,{width:"100%",height:400,children:e.jsxs(xt,{data:h,children:[e.jsx(Ie,{strokeDasharray:"3 3"}),e.jsx($e,{dataKey:"month"}),e.jsx(Le,{tickFormatter:M}),e.jsx(Ce,{formatter:R}),e.jsx(ht,{type:"monotone",dataKey:N,stroke:"#dc2626",strokeWidth:3,dot:{fill:"#dc2626",strokeWidth:2,r:4}})]})})]});case"locations":return e.jsx(we,{width:"100%",height:400,children:e.jsxs(Ye,{data:b,margin:{left:20,right:20,top:20,bottom:60},children:[e.jsx(Ie,{strokeDasharray:"3 3"}),e.jsx($e,{dataKey:"name",angle:-45,textAnchor:"end",height:100,interval:0}),e.jsx(Le,{tickFormatter:M}),e.jsx(Ce,{formatter:R}),e.jsx(Ae,{dataKey:"count",fill:"#dc2626"})]})});case"classes":return e.jsx(we,{width:"100%",height:400,children:e.jsxs(Ps,{children:[e.jsx(Fs,{data:x,cx:"50%",cy:"50%",labelLine:!1,label:({name:o,percent:n})=>`${o} ${(n*100).toFixed(0)}%`,outerRadius:120,fill:"#8884d8",dataKey:"value",children:x.map((o,n)=>e.jsx(Is,{fill:w[n%w.length]},`cell-${n}`))}),e.jsx(Ce,{formatter:R})]})});case"dayofweek":return e.jsx(we,{width:"100%",height:400,children:e.jsxs(Ye,{data:C,children:[e.jsx(Ie,{strokeDasharray:"3 3"}),e.jsx($e,{dataKey:"day"}),e.jsx(Le,{tickFormatter:M}),e.jsx(Ce,{formatter:R}),e.jsx(Ae,{dataKey:"count",fill:"#ea580c"})]})});default:return null}};return e.jsxs(F,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl",children:[e.jsx(K,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs(W,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5 text-red-600"}),"Interactive Late Cancellations Charts"]})}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 flex items-center gap-1",children:[e.jsx(le,{className:"w-4 h-4"}),"Time Range:"]}),[{key:"1m",label:"Last Month"},{key:"3m",label:"Last 3 Months"},{key:"6m",label:"Last 6 Months"},{key:"1y",label:"Last Year"}].map(({key:o,label:n})=>e.jsx(G,{variant:f===o?"default":"outline",size:"sm",onClick:()=>$(o),children:n},o))]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 flex items-center gap-1",children:[e.jsx(ue,{className:"w-4 h-4"}),"Chart Type:"]}),e.jsxs(G,{variant:V==="monthly"?"default":"outline",size:"sm",onClick:()=>A("monthly"),className:"flex items-center gap-1",children:[e.jsx(rt,{className:"w-4 h-4"}),"Monthly Trend"]}),e.jsxs(G,{variant:V==="locations"?"default":"outline",size:"sm",onClick:()=>A("locations"),className:"flex items-center gap-1",children:[e.jsx(ye,{className:"w-4 h-4"}),"By Location"]}),e.jsxs(G,{variant:V==="classes"?"default":"outline",size:"sm",onClick:()=>A("classes"),className:"flex items-center gap-1",children:[e.jsx(lt,{className:"w-4 h-4"}),"By Class Type"]}),e.jsxs(G,{variant:V==="dayofweek"?"default":"outline",size:"sm",onClick:()=>A("dayofweek"),className:"flex items-center gap-1",children:[e.jsx(ye,{className:"w-4 h-4"}),"By Day of Week"]})]})]})}),e.jsx(I,{children:p()})]})},Kt=({data:c})=>{const[f,j]=T.useState("members"),V=T.useMemo(()=>{if(!c||c.length===0)return{top:[],bottom:[]};const d=(h,b)=>{const x=c.reduce((w,R)=>{const $=R[h]||"Unknown",A=R[b]||$;return w[$]||(w[$]={id:$,name:A,count:0,members:new Set,locations:new Set,classes:new Set,data:[]}),w[$].count+=1,w[$].members.add(R.memberId),w[$].locations.add(R.location),w[$].classes.add(R.cleanedClass),w[$].data.push(R),w},{}),C=Object.values(x).map(w=>X(J({},w),{uniqueMembers:w.members.size,uniqueLocations:w.locations.size,uniqueClasses:w.classes.size})).sort((w,R)=>R.count-w.count);return{top:C.slice(0,10),bottom:C.slice(-5).reverse()}};switch(f){case"members":return d("memberId","firstName");case"locations":return d("location","location");case"classes":return d("cleanedClass","cleanedClass");case"trainers":return d("teacherName","teacherName");case"memberships":return d("cleanedProduct","cleanedProduct");default:return{top:[],bottom:[]}}},[c,f]),S=()=>{switch(f){case"members":return Z;case"locations":return ke;case"classes":return le;case"trainers":return rs;case"memberships":return Pe;default:return Z}},N=()=>{switch(f){case"members":return"Members";case"locations":return"Locations";case"classes":return"Class Types";case"trainers":return"Trainers";case"memberships":return"Membership Types";default:return"Members"}},y=(d,h,b)=>{var C;const x=S();return e.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-100 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`flex items-center justify-center w-8 h-8 rounded-full text-white text-sm font-bold ${b?"bg-red-500":"bg-green-500"}`,children:h+1}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"w-4 h-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 truncate max-w-48",title:d.name,children:f==="members"?`${d.name} ${((C=c.find(w=>w.memberId===d.id))==null?void 0:C.lastName)||""}`:d.name}),f==="members"&&e.jsxs("p",{className:"text-sm text-gray-500",children:["ID: ",d.id]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[f==="members"&&e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[d.uniqueLocations," location",d.uniqueLocations!==1?"s":""]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[d.uniqueClasses," class type",d.uniqueClasses!==1?"s":""]})]}),f==="locations"&&e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[d.uniqueMembers," member",d.uniqueMembers!==1?"s":""]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[d.uniqueClasses," class type",d.uniqueClasses!==1?"s":""]})]}),e.jsxs(z,{variant:b?"destructive":"secondary",children:[M(d.count)," cancellation",d.count!==1?"s":""]})]})]},d.id)};return!c||c.length===0?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(F,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl",children:[e.jsx(K,{children:e.jsx(W,{className:"text-lg font-bold text-slate-800",children:"Top Performers"})}),e.jsx(I,{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-slate-600",children:"No data available"})})]}),e.jsxs(F,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl",children:[e.jsx(K,{children:e.jsx(W,{className:"text-lg font-bold text-slate-800",children:"Bottom Performers"})}),e.jsx(I,{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-slate-600",children:"No data available"})})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(F,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl",children:e.jsxs(K,{className:"pb-4",children:[e.jsxs(W,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5 text-red-600"}),"Top & Bottom ",N()," by Late Cancellations"]}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:[{key:"members",label:"Members",icon:Z},{key:"locations",label:"Locations",icon:ke},{key:"classes",label:"Classes",icon:le},{key:"trainers",label:"Trainers",icon:rs},{key:"memberships",label:"Memberships",icon:Pe}].map(({key:d,label:h,icon:b})=>e.jsxs(G,{variant:f===d?"default":"outline",size:"sm",onClick:()=>j(d),className:"flex items-center gap-1",children:[e.jsx(b,{className:"w-4 h-4"}),h]},d))})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(F,{className:"bg-gradient-to-br from-white via-red-50/30 to-white border-0 shadow-xl",children:[e.jsx(K,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5 text-red-500"}),e.jsx(W,{className:"text-lg font-semibold text-gray-800",children:"Most Late Cancellations"}),e.jsxs(z,{variant:"destructive",children:[V.top.length," items"]})]})}),e.jsx(I,{children:e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:V.top.length>0?V.top.map((d,h)=>y(d,h,!0)):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No data available"})})})]}),e.jsxs(F,{className:"bg-gradient-to-br from-white via-green-50/30 to-white border-0 shadow-xl",children:[e.jsx(K,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"w-5 h-5 text-green-500"}),e.jsx(W,{className:"text-lg font-semibold text-gray-800",children:"Least Late Cancellations"}),e.jsxs(z,{variant:"secondary",children:[V.bottom.length," items"]})]})}),e.jsx(I,{children:e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:V.bottom.length>0?V.bottom.map((d,h)=>y(d,h,!1)):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No data available"})})})]})]})]})},We=100,Wt=({data:c,onDrillDown:f})=>{const[j,V]=T.useState("multiple-day"),[S,N]=T.useState(1),y=T.useMemo(()=>{if(!c||c.length===0)return[];const r=c.reduce((s,l)=>{if(!l.dateIST||!l.memberId)return s;const i=`${l.memberId}-${l.dateIST}`;return s[i]||(s[i]={memberId:l.memberId,memberName:`${l.firstName||""} ${l.lastName||""}`.trim(),email:l.email,date:l.dateIST,cancellations:[],count:0,locations:new Set,classes:new Set,trainers:new Set}),s[i].cancellations.push({sessionName:l.sessionName,time:l.time,location:l.location,teacherName:l.teacherName,cleanedClass:l.cleanedClass,cleanedProduct:l.cleanedProduct}),s[i].count+=1,s[i].locations.add(l.location),s[i].classes.add(l.cleanedClass),s[i].trainers.add(l.teacherName),s},{});return Object.values(r).filter(s=>s.count>1).map(s=>X(J({},s),{uniqueLocations:s.locations.size,uniqueClasses:s.classes.size,uniqueTrainers:s.trainers.size})).sort((s,l)=>l.count-s.count)},[c]),d=T.useMemo(()=>{if(!c||c.length===0)return[];const r=c.reduce((s,l)=>{if(!l.dateIST||!l.memberId)return s;const i=`${l.memberId}-${l.dateIST}`;return s[i]||(s[i]={memberId:l.memberId,memberName:`${l.firstName||""} ${l.lastName||""}`.trim(),email:l.email,date:l.dateIST,totalSessions:0,cancellations:0,sessionDetails:[]}),s[i].cancellations+=1,s[i].totalSessions+=1,s[i].sessionDetails.push({sessionName:l.sessionName,time:l.time,location:l.location,teacherName:l.teacherName,status:"cancelled"}),s},{});return Object.values(r).filter(s=>s.totalSessions>1).sort((s,l)=>l.totalSessions-s.totalSessions)},[c]),h=T.useMemo(()=>{if(!c||c.length===0)return[];const r=c.reduce((s,l)=>{const i=l.cleanedClass||"Unknown Class";if(s[i]||(s[i]={className:i,category:l.cleanedCategory||"Unknown",count:0,members:new Set,locations:new Set,trainers:new Set,totalDuration:0,totalRevenue:0,peakTimes:{},daysOfWeek:{}}),s[i].count+=1,s[i].members.add(l.memberId),s[i].locations.add(l.location),s[i].trainers.add(l.teacherName),s[i].totalDuration+=l.duration||0,s[i].totalRevenue+=l.paidAmount||0,l.time){const m=parseInt(l.time.split(":")[0]),a=m<12?"Morning":m<17?"Afternoon":"Evening";s[i].peakTimes[a]=(s[i].peakTimes[a]||0)+1}return l.dayOfWeek&&(s[i].daysOfWeek[l.dayOfWeek]=(s[i].daysOfWeek[l.dayOfWeek]||0)+1),s},{});return Object.values(r).map(s=>{const l=Object.entries(s.peakTimes).reduce((m,a)=>s.peakTimes[m[0]]>s.peakTimes[a[0]]?m:a,["N/A",0])[0],i=Object.entries(s.daysOfWeek).reduce((m,a)=>s.daysOfWeek[m[0]]>s.daysOfWeek[a[0]]?m:a,["N/A",0])[0];return X(J({},s),{uniqueMembers:s.members.size,uniqueLocations:s.locations.size,uniqueTrainers:s.trainers.size,avgDuration:s.count>0?Math.round(s.totalDuration/s.count):0,avgRevenue:s.count>0?s.totalRevenue/s.count:0,peakTime:l,peakDay:i})}).sort((s,l)=>l.count-s.count)},[c]),b=T.useMemo(()=>{if(!c||c.length===0)return[];const r=c.reduce((s,l)=>{const i=l.cleanedProduct||"Unknown Membership";return s[i]||(s[i]={membershipType:i,category:l.cleanedCategory||"Unknown",count:0,members:new Set,revenue:0,locations:new Set,classes:new Set,avgCancellationsPerMember:0}),s[i].count+=1,s[i].members.add(l.memberId),s[i].revenue+=l.paidAmount||0,s[i].locations.add(l.location),s[i].classes.add(l.cleanedClass),s},{});return Object.values(r).map(s=>X(J({},s),{uniqueMembers:s.members.size,uniqueLocations:s.locations.size,uniqueClasses:s.classes.size,avgRevenuePerCancellation:s.count>0?s.revenue/s.count:0,avgCancellationsPerMember:s.uniqueMembers>0?s.count/s.uniqueMembers:0})).sort((s,l)=>l.count-s.count)},[c]),x=r=>{const s=(S-1)*We,l=s+We;return r.slice(s,l)},C=r=>Math.ceil(r.length/We),R=(()=>{switch(j){case"multiple-day":return y;case"multiple-checkins":return d;case"by-class":return h;case"by-membership":return b;default:return[]}})(),$=x(R),A=C(R);Fe.useEffect(()=>{N(1)},[j]);const D=()=>e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t border-gray-200",children:[e.jsx("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:e.jsxs("span",{children:["Showing ",(S-1)*We+1," to ",Math.min(S*We,R.length)," of ",R.length," results"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(G,{variant:"outline",size:"sm",onClick:()=>N(r=>Math.max(1,r-1)),disabled:S===1,className:"gap-1",children:[e.jsx(it,{className:"w-4 h-4"}),"Previous"]}),e.jsx("div",{className:"flex items-center gap-1",children:[...Array(Math.min(5,A))].map((r,s)=>{const l=Math.max(1,Math.min(A-4,S-2))+s;return l>A?null:e.jsx(G,{variant:l===S?"default":"outline",size:"sm",onClick:()=>N(l),className:"w-8 h-8 p-0",children:l},l)})}),e.jsxs(G,{variant:"outline",size:"sm",onClick:()=>N(r=>Math.min(A,r+1)),disabled:S===A,className:"gap-1",children:["Next",e.jsx(is,{className:"w-4 h-4"})]})]})]}),p=(r,s,l)=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-2 justify-between px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"w-5 h-5 text-orange-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:s}),e.jsxs(z,{variant:"outline",className:"bg-orange-50 text-orange-700",children:[R.length," total members"]})]})}),Array.isArray(r)&&r.length>0?e.jsxs(e.Fragment,{children:[e.jsxs(Me,{children:[e.jsx(De,{children:e.jsxs(ie,{children:[e.jsx(B,{children:"Member"}),e.jsx(B,{children:"Email"}),e.jsx(B,{children:"Date"}),e.jsx(B,{children:"Count"}),e.jsx(B,{children:"Details"}),e.jsx(B,{children:"Sessions"})]})}),e.jsx(Te,{children:r.map((i,m)=>e.jsxs(ie,{className:"h-[35px] max-h-[35px] hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>{f&&f({type:"member",title:`Member: ${i.memberName}`,data:i,rawData:i.cancellations||i.sessionDetails})},children:[e.jsx(U,{className:"font-medium h-[35px] py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-red-500 to-pink-500 rounded-full flex items-center justify-center text-white text-xs font-bold",children:i.memberName?i.memberName.charAt(0).toUpperCase():"U"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm truncate max-w-[150px]",children:i.memberName}),e.jsxs("p",{className:"text-xs text-gray-500",children:["ID: ",i.memberId]})]})]})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx("span",{className:"text-sm truncate max-w-[200px] block",children:i.email})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(z,{variant:"outline",className:"text-xs",children:new Date(i.date).toLocaleDateString()})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsxs(z,{variant:"destructive",className:"text-xs",children:[i.count," ",l==="multiple-day"?"cancellations":"sessions"]})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsxs("div",{className:"flex gap-1",children:[i.uniqueLocations&&e.jsxs(z,{variant:"outline",className:"text-xs",children:[i.uniqueLocations," loc"]}),i.uniqueClasses&&e.jsxs(z,{variant:"outline",className:"text-xs",children:[i.uniqueClasses," classes"]})]})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx("div",{className:"text-xs text-gray-600 max-w-[200px]",children:Array.isArray(l==="multiple-day"?i.cancellations:i.sessionDetails)?`${(l==="multiple-day"?i.cancellations:i.sessionDetails).length} sessions`:"No data"})})]},m))})]}),e.jsx(D,{})]}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No data available"})]}),o=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-2 justify-between px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5 text-blue-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cancellations by Class Type"}),e.jsxs(z,{variant:"outline",className:"bg-blue-50 text-blue-700",children:[R.length," class types"]})]})}),$.length>0?e.jsxs(e.Fragment,{children:[e.jsxs(Me,{children:[e.jsx(De,{children:e.jsxs(ie,{className:"h-[35px]",children:[e.jsx(B,{children:"Class Type"}),e.jsx(B,{children:"Category"}),e.jsx(B,{children:"Cancellations"}),e.jsx(B,{children:"Members"}),e.jsx(B,{children:"Locations"}),e.jsx(B,{children:"Peak Time"}),e.jsx(B,{children:"Peak Day"}),e.jsx(B,{children:"Avg Duration"})]})}),e.jsx(Te,{children:$.map((r,s)=>e.jsxs(ie,{className:"h-[35px] max-h-[35px] hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>{f&&f({type:"class",title:`Class Type: ${r.className}`,data:r,rawData:c.filter(l=>l.cleanedClass===r.className)})},children:[e.jsx(U,{className:"font-medium h-[35px] py-2",children:e.jsx("span",{className:"truncate max-w-[150px] block",children:r.className})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(z,{variant:"secondary",children:r.category})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(z,{variant:"destructive",children:M(r.count)})}),e.jsx(U,{className:"h-[35px] py-2",children:M(r.uniqueMembers)}),e.jsx(U,{className:"h-[35px] py-2",children:M(r.uniqueLocations)}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(z,{variant:"outline",children:r.peakTime})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(z,{variant:"outline",children:r.peakDay})}),e.jsxs(U,{className:"h-[35px] py-2",children:[r.avgDuration," min"]})]},s))})]}),e.jsx(D,{})]}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No class type data available"})]}),n=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-2 justify-between px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5 text-purple-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cancellations by Membership Type"}),e.jsxs(z,{variant:"outline",className:"bg-purple-50 text-purple-700",children:[R.length," membership types"]})]})}),$.length>0?e.jsxs(e.Fragment,{children:[e.jsxs(Me,{children:[e.jsx(De,{children:e.jsxs(ie,{className:"h-[35px]",children:[e.jsx(B,{children:"Membership Type"}),e.jsx(B,{children:"Category"}),e.jsx(B,{children:"Cancellations"}),e.jsx(B,{children:"Members"}),e.jsx(B,{children:"Locations"}),e.jsx(B,{children:"Avg per Member"}),e.jsx(B,{children:"Revenue Impact"})]})}),e.jsx(Te,{children:$.map((r,s)=>e.jsxs(ie,{className:"h-[35px] max-h-[35px] hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>{},children:[e.jsx(U,{className:"font-medium h-[35px] py-2",children:e.jsx("span",{className:"truncate max-w-[200px] block",children:r.membershipType})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(z,{variant:"secondary",children:r.category})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(z,{variant:"destructive",children:M(r.count)})}),e.jsx(U,{className:"h-[35px] py-2",children:M(r.uniqueMembers)}),e.jsx(U,{className:"h-[35px] py-2",children:M(r.uniqueLocations)}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(z,{variant:"outline",children:(r.avgCancellationsPerMember||0).toFixed(1)})}),e.jsxs(U,{className:"h-[35px] py-2",children:["₹",(r.revenue||0).toFixed(2)]})]},s))})]}),e.jsx(D,{})]}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No membership type data available"})]}),t=()=>{const r=T.useMemo(()=>{if(!c||c.length===0)return[];const l=c.reduce((i,m)=>{const a=m.teacherName||"Unknown Trainer";return i[a]||(i[a]={trainerName:a,count:0,members:new Set,locations:new Set,classes:new Set,revenue:0,avgCancellationsPerSession:0,totalSessions:0}),i[a].count+=1,i[a].members.add(m.memberId),i[a].locations.add(m.location),i[a].classes.add(m.cleanedClass),i[a].revenue+=m.paidAmount||0,i[a].totalSessions+=1,i},{});return Object.values(l).map(i=>X(J({},i),{uniqueMembers:i.members.size,uniqueLocations:i.locations.size,uniqueClasses:i.classes.size,avgCancellationsPerSession:i.totalSessions>0?i.count/i.totalSessions:0})).sort((i,m)=>m.count-i.count)},[c]),s=x(r);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-2 justify-between px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5 text-green-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cancellations by Trainer"}),e.jsxs(z,{variant:"outline",className:"bg-green-50 text-green-700",children:[r.length," trainers"]})]})}),s.length>0?e.jsxs(e.Fragment,{children:[e.jsxs(Me,{children:[e.jsx(De,{children:e.jsxs(ie,{className:"h-[35px]",children:[e.jsx(B,{children:"Trainer Name"}),e.jsx(B,{children:"Cancellations"}),e.jsx(B,{children:"Affected Members"}),e.jsx(B,{children:"Classes"}),e.jsx(B,{children:"Locations"}),e.jsx(B,{children:"Revenue Impact"}),e.jsx(B,{children:"Avg per Session"})]})}),e.jsx(Te,{children:s.map((l,i)=>e.jsxs(ie,{className:"h-[35px] max-h-[35px]",children:[e.jsx(U,{className:"font-medium h-[35px] py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-green-500 to-emerald-500 rounded-full flex items-center justify-center text-white text-xs font-bold",children:l.trainerName.split(" ").map(m=>m[0]).join("").slice(0,2)}),e.jsx("span",{className:"truncate max-w-[120px]",children:l.trainerName})]})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(z,{variant:"destructive",children:M(l.count)})}),e.jsx(U,{className:"h-[35px] py-2",children:M(l.uniqueMembers)}),e.jsx(U,{className:"h-[35px] py-2",children:M(l.uniqueClasses)}),e.jsx(U,{className:"h-[35px] py-2",children:M(l.uniqueLocations)}),e.jsxs(U,{className:"h-[35px] py-2",children:["₹",l.revenue.toFixed(2)]}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(z,{variant:"outline",children:l.avgCancellationsPerSession.toFixed(2)})})]},i))})]}),e.jsx(D,{})]}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No trainer data available"})]})},u=()=>{const r=T.useMemo(()=>{if(!c||c.length===0)return[];const l=c.reduce((i,m)=>{const a=m.location||"Unknown Location";if(i[a]||(i[a]={locationName:a,count:0,members:new Set,trainers:new Set,classes:new Set,revenue:0,peakDays:{},peakTimes:{}}),i[a].count+=1,i[a].members.add(m.memberId),i[a].trainers.add(m.teacherName),i[a].classes.add(m.cleanedClass),i[a].revenue+=m.paidAmount||0,m.dayOfWeek&&(i[a].peakDays[m.dayOfWeek]=(i[a].peakDays[m.dayOfWeek]||0)+1),m.time){const g=parseInt(m.time.split(":")[0]),v=g<12?"Morning":g<17?"Afternoon":"Evening";i[a].peakTimes[v]=(i[a].peakTimes[v]||0)+1}return i},{});return Object.values(l).map(i=>{const m=Object.entries(i.peakDays).reduce((g,v)=>i.peakDays[g[0]]>i.peakDays[v[0]]?g:v,["N/A",0])[0],a=Object.entries(i.peakTimes).reduce((g,v)=>i.peakTimes[g[0]]>i.peakTimes[v[0]]?g:v,["N/A",0])[0];return X(J({},i),{uniqueMembers:i.members.size,uniqueTrainers:i.trainers.size,uniqueClasses:i.classes.size,peakDay:m,peakTime:a,avgRevenuePerCancellation:i.count>0?i.revenue/i.count:0})}).sort((i,m)=>m.count-i.count)},[c]),s=x(r);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-2 justify-between px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-5 h-5 text-indigo-500"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Cancellations by Location"}),e.jsxs(z,{variant:"outline",className:"bg-indigo-50 text-indigo-700",children:[r.length," locations"]})]})}),s.length>0?e.jsxs(e.Fragment,{children:[e.jsxs(Me,{children:[e.jsx(De,{children:e.jsxs(ie,{className:"h-[35px]",children:[e.jsx(B,{children:"Location"}),e.jsx(B,{children:"Cancellations"}),e.jsx(B,{children:"Members"}),e.jsx(B,{children:"Trainers"}),e.jsx(B,{children:"Classes"}),e.jsx(B,{children:"Peak Day"}),e.jsx(B,{children:"Peak Time"}),e.jsx(B,{children:"Revenue Impact"})]})}),e.jsx(Te,{children:s.map((l,i)=>e.jsxs(ie,{className:"h-[35px] max-h-[35px]",children:[e.jsx(U,{className:"font-medium h-[35px] py-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-4 h-4 text-indigo-600"}),e.jsx("span",{className:"truncate max-w-[150px]",children:l.locationName})]})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(z,{variant:"destructive",children:M(l.count)})}),e.jsx(U,{className:"h-[35px] py-2",children:M(l.uniqueMembers)}),e.jsx(U,{className:"h-[35px] py-2",children:M(l.uniqueTrainers)}),e.jsx(U,{className:"h-[35px] py-2",children:M(l.uniqueClasses)}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(z,{variant:"outline",children:l.peakDay})}),e.jsx(U,{className:"h-[35px] py-2",children:e.jsx(z,{variant:"outline",children:l.peakTime})}),e.jsxs(U,{className:"h-[35px] py-2",children:["₹",l.revenue.toFixed(2)]})]},i))})]}),e.jsx(D,{})]}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No location data available"})]})};return e.jsxs(F,{className:"bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-xl",children:[e.jsx(K,{children:e.jsxs(W,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5 text-red-600"}),"Enhanced Late Cancellations Analysis",e.jsx(z,{variant:"outline",className:"bg-blue-50 text-blue-700",children:"Multiple analysis views with 35px row height"})]})}),e.jsx(I,{className:"p-0",children:e.jsxs(Ve,{value:j,onValueChange:V,children:[e.jsx("div",{className:"px-6",children:e.jsxs(ze,{className:"grid grid-cols-6 w-full mb-6",children:[e.jsxs(H,{value:"multiple-day",className:"flex items-center gap-2",children:[e.jsx(qe,{className:"h-4 w-4"}),"Multiple/Day"]}),e.jsxs(H,{value:"multiple-checkins",className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4"}),"Check-ins/Day"]}),e.jsxs(H,{value:"by-class",className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4"}),"By Class"]}),e.jsxs(H,{value:"by-membership",className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"h-4 w-4"}),"By Membership"]}),e.jsxs(H,{value:"by-trainer",className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4"}),"By Trainer"]}),e.jsxs(H,{value:"by-location",className:"flex items-center gap-2",children:[e.jsx(ke,{className:"h-4 w-4"}),"By Location"]})]})}),e.jsx(ae,{value:"multiple-day",className:"mt-0",children:p($,"Members with Multiple Late Cancellations per Day","multiple-day")}),e.jsx(ae,{value:"multiple-checkins",className:"mt-0",children:p($,"Members with Multiple Check-ins per Day","multiple-checkins")}),e.jsx(ae,{value:"by-class",className:"mt-0",children:o()}),e.jsx(ae,{value:"by-membership",className:"mt-0",children:n()}),e.jsx(ae,{value:"by-trainer",className:"mt-0",children:t()}),e.jsx(ae,{value:"by-location",className:"mt-0",children:u()})]})})]})};function Gt({selectedLocation:c,onLocationChange:f,selectedTimeframe:j,onTimeframeChange:V,selectedTrainer:S,onTrainerChange:N,selectedClass:y,onClassChange:d,selectedProduct:h,onProductChange:b,selectedTimeSlot:x,onTimeSlotChange:C,dateRange:w,onDateRangeChange:R,data:$,onClearFilters:A}){const[D,p]=T.useState(!1),o=Fe.useMemo(()=>Array.from(new Set($.map(i=>i.location).filter(Boolean))),[$]),n=Fe.useMemo(()=>Array.from(new Set($.map(i=>i.teacherName).filter(Boolean))),[$]),t=Fe.useMemo(()=>Array.from(new Set($.map(i=>i.cleanedClass).filter(Boolean))),[$]),u=Fe.useMemo(()=>Array.from(new Set($.map(i=>i.cleanedProduct).filter(Boolean))),[$]),r=[{value:"all",label:"All Time"},{value:"prev-month",label:"Previous Month"},{value:"1w",label:"Last Week"},{value:"2w",label:"Last 2 Weeks"},{value:"1m",label:"Last Month"},{value:"3m",label:"Last 3 Months"},{value:"6m",label:"Last 6 Months"},{value:"1y",label:"Last 12 Months"},{value:"custom",label:"Custom Range"}],s=[{value:"all",label:"All Time Slots"},{value:"morning",label:"Morning (6-12)"},{value:"afternoon",label:"Afternoon (12-17)"},{value:"evening",label:"Evening (17-22)"},{value:"late",label:"Late Night (22+)"}],l=[c!=="all",j!=="all",S!=="all",y!=="all",h!=="all",x!=="all",w.start||w.end].filter(Boolean).length;return D?e.jsxs(F,{className:"bg-gradient-to-br from-white via-red-50/30 to-white border-0 shadow-xl overflow-hidden",children:[e.jsx(K,{className:"bg-gradient-to-r from-red-600 to-orange-600 text-white",children:e.jsxs(W,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ns,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Advanced Filters"}),e.jsx("p",{className:"text-red-100 text-sm",children:"Customize your late cancellations analysis"})]}),e.jsxs(z,{className:"bg-white/20 text-white border-white/30",children:[l," Active"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(G,{variant:"outline",size:"sm",onClick:A,disabled:l===0,className:"bg-white/10 border-white/30 text-white hover:bg-white/20",children:[e.jsx(Ne,{className:"w-4 h-4 mr-1"}),"Reset"]}),e.jsx(G,{variant:"ghost",size:"sm",onClick:()=>p(!1),className:"text-white hover:bg-white/20",children:e.jsx(ct,{className:"w-4 h-4"})})]})]})}),e.jsxs(I,{className:"p-8 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsx("h4",{className:"text-lg font-semibold text-slate-800",children:"Filter Options"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(xe,{htmlFor:"location-select",className:"text-slate-700 flex items-center gap-2",children:[e.jsx(ke,{className:"w-4 h-4"}),"Location"]}),e.jsxs(je,{value:c,onValueChange:f,children:[e.jsx(be,{id:"location-select",className:"bg-white border-slate-200",children:e.jsx(ve,{placeholder:"Select location"})}),e.jsxs(fe,{className:"bg-white border-slate-200",children:[e.jsx(re,{value:"all",children:"All Locations"}),o.map(i=>e.jsx(re,{value:i,children:i},i))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(xe,{htmlFor:"timeframe-select",className:"text-slate-700 flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Timeframe"]}),e.jsxs(je,{value:j,onValueChange:V,children:[e.jsx(be,{id:"timeframe-select",className:"bg-white border-slate-200",children:e.jsx(ve,{placeholder:"Select timeframe"})}),e.jsx(fe,{className:"bg-white border-slate-200",children:r.map(i=>e.jsx(re,{value:i.value,children:i.label},i.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(xe,{htmlFor:"trainer-select",className:"text-slate-700 flex items-center gap-2",children:[e.jsx(rs,{className:"w-4 h-4"}),"Trainer"]}),e.jsxs(je,{value:S,onValueChange:N,children:[e.jsx(be,{id:"trainer-select",className:"bg-white border-slate-200",children:e.jsx(ve,{placeholder:"Select trainer"})}),e.jsxs(fe,{className:"bg-white border-slate-200",children:[e.jsx(re,{value:"all",children:"All Trainers"}),n.map(i=>e.jsx(re,{value:i,children:i},i))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(xe,{htmlFor:"class-select",className:"text-slate-700 flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),"Class Type"]}),e.jsxs(je,{value:y,onValueChange:d,children:[e.jsx(be,{id:"class-select",className:"bg-white border-slate-200",children:e.jsx(ve,{placeholder:"Select class"})}),e.jsxs(fe,{className:"bg-white border-slate-200",children:[e.jsx(re,{value:"all",children:"All Classes"}),t.map(i=>e.jsx(re,{value:i,children:i},i))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(xe,{htmlFor:"product-select",className:"text-slate-300 flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),"Product Type"]}),e.jsxs(je,{value:h,onValueChange:b,children:[e.jsx(be,{id:"product-select",className:"bg-slate-800 border-slate-600 text-white",children:e.jsx(ve,{placeholder:"Select product"})}),e.jsxs(fe,{className:"bg-slate-800 border-slate-600",children:[e.jsx(re,{value:"all",className:"text-white hover:bg-slate-700",children:"All Products"}),u.map(i=>e.jsx(re,{value:i,className:"text-white hover:bg-slate-700",children:i},i))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(xe,{htmlFor:"timeslot-select",className:"text-slate-300 flex items-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4"}),"Time Slot"]}),e.jsxs(je,{value:x,onValueChange:C,children:[e.jsx(be,{id:"timeslot-select",className:"bg-slate-800 border-slate-600 text-white",children:e.jsx(ve,{placeholder:"Select time slot"})}),e.jsx(fe,{className:"bg-slate-800 border-slate-600",children:s.map(i=>e.jsx(re,{value:i.value,className:"text-white hover:bg-slate-700",children:i.label},i.value))})]})]}),j==="custom"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(xe,{htmlFor:"start-date",className:"text-slate-700",children:"Start Date"}),e.jsx(Re,{id:"start-date",type:"date",value:w.start,onChange:i=>R(X(J({},w),{start:i.target.value})),className:"bg-white border-slate-200"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(xe,{htmlFor:"end-date",className:"text-slate-700",children:"End Date"}),e.jsx(Re,{id:"end-date",type:"date",value:w.end,onChange:i=>R(X(J({},w),{end:i.target.value})),className:"bg-white border-slate-200"})]})]})]})]})]}):e.jsx(F,{className:"bg-gradient-to-br from-white via-red-50/30 to-white border-0 shadow-xl",children:e.jsx(I,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-r from-red-500 to-orange-500 rounded-lg",children:e.jsx(ns,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-800",children:"Advanced Filters"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Refine your late cancellations analysis"})]}),l>0&&e.jsxs(z,{className:"bg-gradient-to-r from-red-600 to-orange-600 text-white",children:[l," active"]})]}),e.jsxs(G,{variant:"outline",onClick:()=>p(!0),className:"gap-2 border-red-200 text-red-700 hover:bg-red-50",children:[e.jsx(Ze,{className:"w-4 h-4"}),"Expand Filters"]})]})})})}const Yt=({isOpen:c,onClose:f,data:j})=>{if(!j)return null;const V=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs(F,{children:[e.jsx(K,{children:e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5 text-blue-500"}),"Member Information"]})}),e.jsxs(I,{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Member Name"}),e.jsx("p",{className:"font-semibold",children:j.data.memberName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Email"}),e.jsx("p",{className:"font-semibold",children:j.data.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Member ID"}),e.jsx("p",{className:"font-semibold",children:j.data.memberId})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Cancellations"}),e.jsx(z,{variant:"destructive",children:j.data.count})]})]})]}),e.jsxs(F,{children:[e.jsx(K,{children:e.jsx(W,{children:"Session Details"})}),e.jsx(I,{children:e.jsx(ts,{className:"h-64",children:e.jsxs(Me,{children:[e.jsx(De,{children:e.jsxs(ie,{children:[e.jsx(B,{children:"Session"}),e.jsx(B,{children:"Time"}),e.jsx(B,{children:"Location"}),e.jsx(B,{children:"Trainer"})]})}),e.jsx(Te,{children:(j.rawData||[]).map((y,d)=>e.jsxs(ie,{children:[e.jsx(U,{children:y.sessionName}),e.jsx(U,{children:y.time}),e.jsx(U,{children:y.location}),e.jsx(U,{children:y.teacherName})]},d))})]})})})]})]}),S=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs(F,{children:[e.jsx(K,{children:e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5 text-green-500"}),"Class Information"]})}),e.jsxs(I,{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Class Type"}),e.jsx("p",{className:"font-semibold",children:j.data.className})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Category"}),e.jsx(z,{variant:"secondary",children:j.data.category})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Cancellations"}),e.jsx(z,{variant:"destructive",children:M(j.data.count)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Unique Members"}),e.jsx("p",{className:"font-semibold",children:M(j.data.uniqueMembers)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Peak Time"}),e.jsx(z,{variant:"outline",children:j.data.peakTime})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Average Duration"}),e.jsxs("p",{className:"font-semibold",children:[j.data.avgDuration," min"]})]})]})]}),e.jsxs(F,{children:[e.jsx(K,{children:e.jsx(W,{children:"Recent Cancellations"})}),e.jsx(I,{children:e.jsx(ts,{className:"h-64",children:e.jsxs(Me,{children:[e.jsx(De,{children:e.jsxs(ie,{children:[e.jsx(B,{children:"Member"}),e.jsx(B,{children:"Date"}),e.jsx(B,{children:"Time"}),e.jsx(B,{children:"Location"})]})}),e.jsx(Te,{children:(j.rawData||[]).slice(0,10).map((y,d)=>e.jsxs(ie,{children:[e.jsxs(U,{children:[y.firstName," ",y.lastName]}),e.jsx(U,{children:new Date(y.dateIST).toLocaleDateString()}),e.jsx(U,{children:y.time}),e.jsx(U,{children:y.location})]},d))})]})})})]})]}),N=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(F,{children:e.jsxs(I,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:M(j.totalCancellations)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Cancellations"})]})}),e.jsx(F,{children:e.jsxs(I,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:M(j.uniqueMembers)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Unique Members"})]})}),e.jsx(F,{children:e.jsxs(I,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:M(j.uniqueLocations)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Locations"})]})}),e.jsx(F,{children:e.jsxs(I,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:j.uniqueMembers>0?(j.totalCancellations/j.uniqueMembers).toFixed(1):"0"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Avg per Member"})]})})]}),e.jsxs(F,{children:[e.jsx(K,{children:e.jsx(W,{children:"Recent Activity"})}),e.jsx(I,{children:e.jsx(ts,{className:"h-64",children:e.jsxs(Me,{children:[e.jsx(De,{children:e.jsxs(ie,{children:[e.jsx(B,{children:"Member"}),e.jsx(B,{children:"Date"}),e.jsx(B,{children:"Class"}),e.jsx(B,{children:"Location"}),e.jsx(B,{children:"Trainer"})]})}),e.jsx(Te,{children:(j.rawData||[]).slice(0,15).map((y,d)=>e.jsxs(ie,{children:[e.jsxs(U,{children:[y.firstName," ",y.lastName]}),e.jsx(U,{children:new Date(y.dateIST).toLocaleDateString()}),e.jsx(U,{children:y.cleanedClass}),e.jsx(U,{children:y.location}),e.jsx(U,{children:y.teacherName})]},d))})]})})})]})]});return e.jsx(Je,{open:c,onOpenChange:f,children:e.jsxs(_e,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx(Qe,{children:e.jsxs(Xe,{className:"flex items-center justify-between",children:[e.jsx("span",{children:j.title}),e.jsx("button",{onClick:f,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(Ne,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"mt-4",children:[j.type==="member"&&V(),j.type==="class"&&S(),j.type==="metric"&&N()]})]})})};export{ut as A,zt as D,Pt as E,qt as L,Lt as M,$t as P,It as S,Vt as U,ss as Y,Ot as a,Ft as b,Rt as c,Et as d,Gt as e,Bt as f,Ut as g,Kt as h,Wt as i,Yt as j};
