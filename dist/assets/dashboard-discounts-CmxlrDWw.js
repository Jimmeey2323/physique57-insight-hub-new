var Ue=Object.defineProperty,Ie=Object.defineProperties;var Oe=Object.getOwnPropertyDescriptors;var De=Object.getOwnPropertySymbols;var Fe=Object.prototype.hasOwnProperty,Ee=Object.prototype.propertyIsEnumerable;var we=(m,i,w)=>i in m?Ue(m,i,{enumerable:!0,configurable:!0,writable:!0,value:w}):m[i]=w,F=(m,i)=>{for(var w in i||(i={}))Fe.call(i,w)&&we(m,w,i[w]);if(De)for(var w of De(i))Ee.call(i,w)&&we(m,w,i[w]);return m},E=(m,i)=>Ie(m,Oe(i));import{r as M,i as he,w as re,P as le,_ as be,$ as q,U as ge,j as e,E as ae,M as ye,d as ve,c as ce,a0 as Me,J as ie,T as Be,g as fe,a1 as ze,a2 as ke,e as Ae,W as He,a3 as qe,S as Ye,D as We,h as Ge}from"./react-vendor-BrAkf1Ej.js";import{C as B,j as K,k as L,d as G,c as $,B as U,T as ee,m as te,n as O,o as A,p as se,q as u,r as de,s as ue,t as z,u as H,I as Qe,a1 as oe,Z as Xe,_ as _e,$ as Je,a0 as Ze,a2 as et,a3 as tt,a4 as st,W as nt}from"./ui-components-_bEsYxhv.js";import{f as x,b as V,c as C}from"./utils-hni-AijI.js";import{R as Y,L as Ne,C as X,X as _,Y as Q,T as W,b as ne,B as xe,c as J,a as me,P as $e,d as Ve,e as Ke,S as at,g as ot}from"./chart-vendor-CfJT7qML.js";import{c as pe}from"./dashboard-classes-CN6A505j.js";import{A as rt}from"./dashboard-misc-Bo2H3bQp.js";const bt=({data:m,selectedLocation:i})=>{const[w,h]=M.useState("overview"),[P,g]=M.useState(!1),b=M.useMemo(()=>!m||m.length===0?[]:!i||i==="all"?m:m.filter(t=>t.calculatedLocation===i),[m,i]),o=M.useMemo(()=>{if(!b||b.length===0)return{totalTransactions:0,discountedTransactions:0,totalRevenue:0,totalDiscounts:0,avgDiscountPercent:0,topDiscountedProducts:[],monthlyTrends:[],locationBreakdown:[],categoryBreakdown:[],customerSegments:[],staffPerformance:[]};const t=b.filter(r=>{const v=(r.discountAmount||0)>0,y=(r.discountPercentage||0)>0,Z=r.isPromotional===!0,je=r.discountType&&r.discountType!=="";return v||y||Z||je}),l=b.length,k=t.length,f=b.reduce((r,v)=>r+(v.paymentValue||0),0),n=b.reduce((r,v)=>r+(v.discountAmount||0),0),a=t.length>0?t.reduce((r,v)=>{let y=v.discountPercentage||0;if(y===0&&v.discountAmount&&v.paymentValue){const Z=v.paymentValue+v.discountAmount;y=Z>0?v.discountAmount/Z*100:0}return r+y},0)/t.length:0,j=b.reduce((r,v)=>{const y=v.cleanedProduct||"Unknown";return r[y]||(r[y]={name:y,category:v.cleanedCategory||"Unknown",totalDiscount:0,transactions:0,discountedTransactions:0,revenue:0,customers:new Set}),r[y].totalDiscount+=v.discountAmount||0,r[y].transactions+=1,r[y].revenue+=v.paymentValue||0,r[y].customers.add(v.customerEmail),((v.discountAmount||0)>0||(v.discountPercentage||0)>0)&&(r[y].discountedTransactions+=1),r},{}),D=Object.values(j).map(r=>E(F({},r),{uniqueCustomers:r.customers.size,discountRate:r.transactions>0?r.discountedTransactions/r.transactions*100:0})).sort((r,v)=>v.totalDiscount-r.totalDiscount).slice(0,10),R=b.reduce((r,v)=>{if(!v.paymentDate)return r;let y;try{if(v.paymentDate.includes("/")){const[Z,je,Le]=v.paymentDate.split(" ")[0].split("/");y=`${Le}-${je.padStart(2,"0")}`}else y=v.paymentDate.substring(0,7)}catch(Z){y="Unknown"}return r[y]||(r[y]={month:y,revenue:0,discounts:0,transactions:0,discountedTransactions:0,discountRate:0}),r[y].revenue+=v.paymentValue||0,r[y].discounts+=v.discountAmount||0,r[y].transactions+=1,((v.discountAmount||0)>0||(v.discountPercentage||0)>0)&&(r[y].discountedTransactions+=1),r},{}),I=Object.values(R).map(r=>E(F({},r),{discountRate:r.transactions>0?r.discountedTransactions/r.transactions*100:0})).sort((r,v)=>r.month.localeCompare(v.month)),N=b.reduce((r,v)=>{const y=v.calculatedLocation||"Unknown";return r[y]||(r[y]={location:y,revenue:0,discounts:0,transactions:0,discountedTransactions:0,customers:new Set}),r[y].revenue+=v.paymentValue||0,r[y].discounts+=v.discountAmount||0,r[y].transactions+=1,r[y].customers.add(v.customerEmail),(v.discountAmount||0)>0&&(r[y].discountedTransactions+=1),r},{}),S=Object.values(N).map(r=>E(F({},r),{uniqueCustomers:r.customers.size,discountRate:r.transactions>0?r.discountedTransactions/r.transactions*100:0,avgDiscountPerTransaction:r.discountedTransactions>0?r.discounts/r.discountedTransactions:0})),c=b.reduce((r,v)=>{const y=v.cleanedCategory||"Unknown";return r[y]||(r[y]={category:y,revenue:0,discounts:0,transactions:0,discountedTransactions:0}),r[y].revenue+=v.paymentValue||0,r[y].discounts+=v.discountAmount||0,r[y].transactions+=1,(v.discountAmount||0)>0&&(r[y].discountedTransactions+=1),r},{}),p=Object.values(c).map(r=>E(F({},r),{discountRate:r.transactions>0?r.discountedTransactions/r.transactions*100:0})).sort((r,v)=>v.discounts-r.discounts),d=b.reduce((r,v)=>{const y=v.soldBy||"Unknown";return r[y]||(r[y]={name:y,totalDiscounts:0,transactions:0,discountedTransactions:0,revenue:0}),r[y].totalDiscounts+=v.discountAmount||0,r[y].transactions+=1,r[y].revenue+=v.paymentValue||0,(v.discountAmount||0)>0&&(r[y].discountedTransactions+=1),r},{}),T=Object.values(d).map(r=>E(F({},r),{discountRate:r.transactions>0?r.discountedTransactions/r.transactions*100:0,avgDiscountPerTransaction:r.discountedTransactions>0?r.totalDiscounts/r.discountedTransactions:0})).sort((r,v)=>v.totalDiscounts-r.totalDiscounts).slice(0,10);return{totalTransactions:l,discountedTransactions:k,totalRevenue:f,totalDiscounts:n,avgDiscountPercent:a,topDiscountedProducts:D,monthlyTrends:I,locationBreakdown:S,categoryBreakdown:p,staffPerformance:T}},[b]),s=[{title:"Total Revenue",value:x(o.totalRevenue),icon:he,gradient:"from-green-500 to-emerald-600",description:"Total sales revenue",change:12.5},{title:"Total Discounts",value:x(o.totalDiscounts),icon:re,gradient:"from-red-500 to-rose-600",description:"Amount saved by customers",change:-8.3},{title:"Discount Rate",value:V(o.totalRevenue>0?o.totalDiscounts/o.totalRevenue*100:0),icon:le,gradient:"from-blue-500 to-indigo-600",description:"Discount as % of revenue",change:-2.1},{title:"Discounted Sales",value:`${C(o.discountedTransactions)} / ${C(o.totalTransactions)}`,icon:be,gradient:"from-purple-500 to-violet-600",description:"Sales with discounts applied",change:5.7},{title:"Avg Discount %",value:V(o.avgDiscountPercent),icon:q,gradient:"from-orange-500 to-red-600",description:"Average discount percentage",change:-1.2},{title:"Penetration Rate",value:V(o.totalTransactions>0?o.discountedTransactions/o.totalTransactions*100:0),icon:ge,gradient:"from-cyan-500 to-blue-600",description:"Percentage of discounted sales",change:3.4}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(B,{className:"border-0 shadow-xl bg-gradient-to-r from-orange-50 to-red-50",children:e.jsx(K,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-orange-500 to-red-500 rounded-xl flex items-center justify-center",children:e.jsx(le,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx(L,{className:"text-2xl font-bold text-gray-900",children:"Discounts & Promotions Analytics"}),e.jsxs("p",{className:"text-gray-600",children:["Comprehensive discount impact analysis",i!=="all"&&` for ${i}`]})]})]}),e.jsx("div",{className:"flex gap-2",children:["overview","details","analytics"].map(t=>e.jsx(G,{variant:w===t?"default":"outline",onClick:()=>h(t),className:"capitalize",children:t},t))})]})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-6",children:s.map((t,l)=>e.jsx(B,{className:"bg-white shadow-xl border-0 overflow-hidden hover:shadow-2xl transition-all duration-300 group cursor-pointer",children:e.jsx($,{className:"p-0",children:e.jsxs("div",{className:`bg-gradient-to-r ${t.gradient} p-6 text-white relative overflow-hidden`,children:[e.jsx("div",{className:"absolute top-0 right-0 w-20 h-20 transform translate-x-8 -translate-y-8 opacity-20",children:e.jsx(t.icon,{className:"w-20 h-20"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(t.icon,{className:"w-6 h-6"}),e.jsx("h3",{className:"font-semibold text-sm",children:t.title})]}),e.jsx("p",{className:"text-3xl font-bold mb-1",children:t.value}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:`text-sm ${t.change>=0?"text-green-200":"text-red-200"}`,children:[t.change>=0?"+":"",t.change.toFixed(1),"%"]}),e.jsx("span",{className:"text-sm opacity-90",children:"vs last period"})]})]})]})})},t.title))}),w==="overview"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(B,{className:"bg-white shadow-xl border-0",children:[e.jsx(K,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-blue-600"}),"Monthly Discount Trends"]})}),e.jsx($,{children:e.jsx(Y,{width:"100%",height:300,children:e.jsxs(Ne,{data:o.monthlyTrends,children:[e.jsx(X,{strokeDasharray:"3 3"}),e.jsx(_,{dataKey:"month"}),e.jsx(Q,{}),e.jsx(W,{formatter:(t,l)=>[l==="discounts"||l==="revenue"?x(t):l==="discountRate"?V(t):C(t),l]}),e.jsx(ne,{type:"monotone",dataKey:"revenue",stroke:"#8884d8",name:"Revenue"}),e.jsx(ne,{type:"monotone",dataKey:"discounts",stroke:"#82ca9d",name:"Discounts"}),e.jsx(ne,{type:"monotone",dataKey:"discountRate",stroke:"#ffc658",name:"Discount Rate %"})]})})})]}),e.jsxs(B,{className:"bg-white shadow-xl border-0",children:[e.jsx(K,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5 text-green-600"}),"Top Discounted Products"]})}),e.jsx($,{children:e.jsx("div",{className:"space-y-4 max-h-80 overflow-y-auto",children:o.topDiscountedProducts.slice(0,8).map((t,l)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-orange-500 to-red-500 rounded-full flex items-center justify-center text-white font-bold text-sm",children:l+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 truncate max-w-[200px]",children:t.name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(U,{variant:"outline",className:"text-xs",children:t.category}),e.jsxs(U,{variant:"secondary",className:"text-xs",children:[V(t.discountRate)," discount rate"]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-red-600",children:x(t.totalDiscount)}),e.jsxs("p",{className:"text-sm text-gray-600",children:[C(t.transactions)," sales"]})]})]},t.name))})})]})]}),w==="details"&&e.jsxs(B,{className:"bg-white shadow-xl border-0",children:[e.jsx(K,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-blue-600"}),"Detailed Discount Transactions"]})}),e.jsx($,{children:e.jsx("div",{className:"overflow-x-auto max-h-96",children:e.jsxs(ee,{children:[e.jsx(te,{children:e.jsxs(O,{children:[e.jsx(A,{children:"Date"}),e.jsx(A,{children:"Customer"}),e.jsx(A,{children:"Product"}),e.jsx(A,{children:"Location"}),e.jsx(A,{children:"Revenue"}),e.jsx(A,{children:"Discount"}),e.jsx(A,{children:"Discount %"}),e.jsx(A,{children:"Sold By"})]})}),e.jsx(se,{children:b.filter(t=>(t.discountAmount||0)>0).slice(0,50).map((t,l)=>e.jsxs(O,{children:[e.jsx(u,{children:t.paymentDate}),e.jsx(u,{className:"font-medium",children:t.customerName}),e.jsx(u,{children:e.jsx(U,{variant:"outline",children:t.cleanedProduct})}),e.jsx(u,{children:t.calculatedLocation}),e.jsx(u,{children:e.jsx(U,{className:"bg-green-100 text-green-800",children:x(t.paymentValue||0)})}),e.jsx(u,{children:e.jsx(U,{className:"bg-red-100 text-red-800",children:x(t.discountAmount||0)})}),e.jsx(u,{children:e.jsx(U,{className:"bg-blue-100 text-blue-800",children:V(t.discountPercentage||0)})}),e.jsx(u,{children:t.soldBy})]},l))})]})})})]}),w==="analytics"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(B,{className:"bg-white shadow-xl border-0",children:[e.jsx(K,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5 text-purple-600"}),"Location Discount Performance"]})}),e.jsx($,{children:e.jsx(Y,{width:"100%",height:300,children:e.jsxs(xe,{data:o.locationBreakdown,children:[e.jsx(X,{strokeDasharray:"3 3"}),e.jsx(_,{dataKey:"location"}),e.jsx(Q,{}),e.jsx(W,{formatter:t=>x(t)}),e.jsx(J,{dataKey:"discounts",fill:"#8884d8",name:"Discounts"})]})})})]}),e.jsxs(B,{className:"bg-white shadow-xl border-0",children:[e.jsx(K,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5 text-orange-600"}),"Category Discount Analysis"]})}),e.jsx($,{children:e.jsx("div",{className:"space-y-3 max-h-80 overflow-y-auto",children:o.categoryBreakdown.map((t,l)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.category}),e.jsxs("p",{className:"text-sm text-gray-600",children:[C(t.transactions)," transactions • ",V(t.discountRate)," discount rate"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-red-600",children:x(t.discounts)}),e.jsxs("p",{className:"text-sm text-gray-600",children:[x(t.revenue)," revenue"]})]})]},t.category))})})]}),e.jsxs(B,{className:"bg-white shadow-xl border-0",children:[e.jsx(K,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-5 h-5 text-green-600"}),"Staff Discount Performance"]})}),e.jsx($,{children:e.jsx("div",{className:"space-y-3 max-h-80 overflow-y-auto",children:o.staffPerformance.map((t,l)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-green-500 to-blue-500 rounded-full flex items-center justify-center text-white font-bold text-sm",children:l+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[C(t.discountedTransactions)," discounted sales • ",V(t.discountRate)," rate"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold text-red-600",children:x(t.totalDiscounts)}),e.jsxs("p",{className:"text-sm text-gray-600",children:[x(t.avgDiscountPerTransaction)," avg"]})]})]},t.name))})})]}),e.jsxs(B,{className:"bg-white shadow-xl border-0",children:[e.jsx(K,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5 text-blue-600"}),"Monthly Discount Rate Trends"]})}),e.jsx($,{children:e.jsx(Y,{width:"100%",height:300,children:e.jsxs(xe,{data:o.monthlyTrends,children:[e.jsx(X,{strokeDasharray:"3 3"}),e.jsx(_,{dataKey:"month"}),e.jsx(Q,{}),e.jsx(W,{formatter:(t,l)=>[l==="discountRate"?V(t):C(t),l]}),e.jsx(J,{dataKey:"discountRate",fill:"#ffc658",name:"Discount Rate %"})]})})})]})]})]})},lt={DollarSign:he,ShoppingCart:be,Activity:fe,Users:ge,Target:Be,Percent:le,CreditCard:ie,ArrowDownRight:Me},ct=({data:m,onMetricClick:i})=>{const w=M.useMemo(()=>{const n=m.reduce((T,r)=>T+(r.discountAmount||0),0),a=m.reduce((T,r)=>T+(r.paymentValue||0),0),j=m.length,D=m.filter(T=>(T.discountAmount||0)>0).length,R=new Set(m.map(T=>T.memberId||T.customerEmail)).size,I=new Set(m.filter(T=>(T.discountAmount||0)>0).map(T=>T.memberId||T.customerEmail)).size,N=a>0?n/(a+n)*100:0,S=j>0?D/j*100:0,c=R>0?I/R*100:0,p=D>0?n/D:0,d=I>0?n/I:0;return{metrics:[{title:"Total Discounts",value:x(n),description:"Total amount saved by customers",icon:"DollarSign",change:null,trend:"neutral",color:"orange"},{title:"Discount Rate",value:V(N),description:"Percentage of gross revenue",icon:"Percent",change:null,trend:"neutral",color:"orange"},{title:"Transactions with Discounts",value:C(D),description:`${V(S)} of all transactions`,icon:"ShoppingCart",change:null,trend:"neutral",color:"orange"},{title:"Customers with Discounts",value:C(I),description:`${V(c)} of all customers`,icon:"Users",change:null,trend:"neutral",color:"orange"},{title:"Avg Discount per Transaction",value:x(p),description:"Average savings per discounted purchase",icon:"Target",change:null,trend:"neutral",color:"orange"},{title:"Avg Discount per Customer",value:x(d),description:"Average savings per customer",icon:"Activity",change:null,trend:"neutral",color:"orange"}],totalRevenue:a,totalDiscounts:n,totalTransactions:j,discountedTransactions:D,uniqueCustomers:R,customersWithDiscounts:I,discountRate:N,discountPenetration:S}},[m]),{metrics:h,totalRevenue:P,totalDiscounts:g,totalTransactions:b,discountedTransactions:o,uniqueCustomers:s,customersWithDiscounts:t,discountRate:l,discountPenetration:k}=w,f=n=>{if(i){const a={title:n.title,name:n.title,type:"metric",totalRevenue:P,totalDiscounts:g,transactions:b,discountedTransactions:o,uniqueCustomers:s,customersWithDiscounts:t,discountRate:l,discountPenetration:k,rawData:m,filteredTransactionData:m,isDynamic:!0,calculatedFromFiltered:!0};i(a)}};return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[h.map((n,a)=>{const j=lt[n.icon]||he;return e.jsxs(B,{className:pe("group relative overflow-hidden border-0 shadow-lg hover:shadow-xl transition-all duration-300 ease-out cursor-pointer","bg-gradient-to-br from-white via-orange-50/30 to-orange-100/50","hover:scale-105 hover:-translate-y-1"),onClick:()=>f(n),style:{animationDelay:`${a*100}ms`,animation:"slideInUp 0.6s ease-out forwards"},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-orange-500/5 via-transparent to-orange-600/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsxs($,{className:"relative p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-1",children:n.title}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 mb-1",children:n.value}),e.jsx("p",{className:"text-xs text-gray-500 leading-relaxed",children:n.description})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx("div",{className:pe("p-2 rounded-lg transition-colors duration-300","bg-orange-100 text-orange-600","group-hover:bg-orange-200 group-hover:scale-110"),children:e.jsx(j,{className:"w-5 h-5"})}),n.change&&e.jsxs(U,{className:pe("text-xs font-medium px-2 py-1",n.trend==="up"?"bg-green-100 text-green-700 border-green-200":n.trend==="down"?"bg-red-100 text-red-700 border-red-200":"bg-gray-100 text-gray-700 border-gray-200"),children:[n.trend==="up"&&e.jsx(ze,{className:"w-3 h-3 mr-1"}),n.trend==="down"&&e.jsx(Me,{className:"w-3 h-3 mr-1"}),n.change]})]})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-orange-400 to-orange-600 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-300 origin-left"})]})]},n.title)}),e.jsx("style",{children:`
        @keyframes slideInUp {
          from {
            opacity: 0;
            transform: translateY(30px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
      `})]})},Pe=["#8b5cf6","#06b6d4","#10b981","#f59e0b","#ef4444","#6366f1","#ec4899","#84cc16"],Te=({data:m,filters:i})=>{const[w,h]=M.useState("trends"),P=M.useMemo(()=>{let g=m.filter(n=>(n.discountAmount||0)>0);i&&(g=g.filter(n=>{var a,j;if(i.location&&n.calculatedLocation!==i.location||i.category&&n.cleanedCategory!==i.category||i.product&&n.cleanedProduct!==i.product||i.soldBy&&(n.soldBy==="-"?"Online/System":n.soldBy)!==i.soldBy||i.paymentMethod&&n.paymentMethod!==i.paymentMethod||i.minDiscountAmount&&(n.discountAmount||0)<i.minDiscountAmount||i.maxDiscountAmount&&(n.discountAmount||0)>i.maxDiscountAmount||i.minDiscountPercent&&(n.discountPercentage||0)<i.minDiscountPercent||i.maxDiscountPercent&&(n.discountPercentage||0)>i.maxDiscountPercent)return!1;if((a=i.dateRange)!=null&&a.from||(j=i.dateRange)!=null&&j.to){const D=new Date(n.paymentDate);if(i.dateRange.from&&D<i.dateRange.from||i.dateRange.to&&D>i.dateRange.to)return!1}return!0}));const b=g.reduce((n,a)=>{const j=new Date(a.paymentDate),D=`${j.getFullYear()}-${(j.getMonth()+1).toString().padStart(2,"0")}`;return n[D]||(n[D]={month:D,transactions:0,totalDiscount:0,totalRevenue:0,avgDiscount:0}),n[D].transactions+=1,n[D].totalDiscount+=a.discountAmount||0,n[D].totalRevenue+=a.paymentValue||0,n},{}),o=Object.values(b).map(n=>E(F({},n),{avgDiscount:n.transactions>0?n.totalDiscount/n.transactions:0,discountRate:n.totalRevenue>0?n.totalDiscount/(n.totalRevenue+n.totalDiscount)*100:0})).sort((n,a)=>n.month.localeCompare(a.month)),s=g.reduce((n,a)=>{const j=a.cleanedCategory||"Unknown";return n[j]||(n[j]={name:j,value:0,transactions:0}),n[j].value+=a.discountAmount||0,n[j].transactions+=1,n},{}),t=Object.values(s).sort((n,a)=>a.value-n.value).slice(0,8),k=[{min:0,max:100,label:"₹0-100"},{min:100,max:500,label:"₹100-500"},{min:500,max:1e3,label:"₹500-1K"},{min:1e3,max:2500,label:"₹1K-2.5K"},{min:2500,max:5e3,label:"₹2.5K-5K"},{min:5e3,max:1/0,label:"₹5K+"}].map(n=>{const a=g.filter(j=>{const D=j.discountAmount||0;return D>=n.min&&D<n.max});return{range:n.label,transactions:a.length,totalDiscount:a.reduce((j,D)=>j+(D.discountAmount||0),0),avgDiscount:a.length>0?a.reduce((j,D)=>j+(D.discountAmount||0),0)/a.length:0,totalRevenue:a.reduce((j,D)=>j+(D.paymentValue||0),0)}}),f=g.slice(0,200).map(n=>({discountAmount:n.discountAmount||0,discountPercent:n.discountPercentage||0,revenue:n.paymentValue||0,category:n.cleanedCategory||"Unknown"}));return{monthlyTrends:o,categoryDistribution:t,rangeAnalysis:k,scatterData:f}},[m,i]);return e.jsx("div",{className:"space-y-6",children:e.jsxs(de,{value:w,onValueChange:h,className:"w-full",children:[e.jsxs(ue,{className:"grid w-full grid-cols-4 bg-white border border-slate-200 p-1 rounded-xl shadow-sm h-auto",children:[e.jsxs(z,{value:"trends",className:"text-sm px-4 py-3 data-[state=active]:bg-blue-600 data-[state=active]:text-white",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Trends"]}),e.jsxs(z,{value:"distribution",className:"text-sm px-4 py-3 data-[state=active]:bg-purple-600 data-[state=active]:text-white",children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Distribution"]}),e.jsxs(z,{value:"ranges",className:"text-sm px-4 py-3 data-[state=active]:bg-green-600 data-[state=active]:text-white",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Ranges"]}),e.jsxs(z,{value:"correlation",className:"text-sm px-4 py-3 data-[state=active]:bg-orange-600 data-[state=active]:text-white",children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"Correlation"]})]}),e.jsx(H,{value:"trends",className:"space-y-6",children:e.jsxs(B,{className:"bg-gradient-to-br from-white via-blue-50/30 to-indigo-50/20 border-0 shadow-xl",children:[e.jsx(K,{children:e.jsxs(L,{className:"text-xl font-bold bg-gradient-to-r from-blue-700 to-indigo-700 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx(ce,{className:"w-6 h-6 text-blue-600"}),"Monthly Discount Trends"]})}),e.jsx($,{children:e.jsx(Y,{width:"100%",height:400,children:e.jsxs(Ne,{data:P.monthlyTrends,children:[e.jsx(X,{strokeDasharray:"3 3"}),e.jsx(_,{dataKey:"month"}),e.jsx(Q,{yAxisId:"left",tickFormatter:g=>x(g)}),e.jsx(Q,{yAxisId:"right",orientation:"right",tickFormatter:g=>`${g}%`}),e.jsx(W,{formatter:(g,b)=>[b==="discountRate"?`${g.toFixed(1)}%`:x(g),b==="totalDiscount"?"Total Discount":b==="totalRevenue"?"Revenue":"Discount Rate"]}),e.jsx(me,{}),e.jsx(J,{yAxisId:"left",dataKey:"totalDiscount",fill:"#3b82f6",name:"Total Discount"}),e.jsx(ne,{yAxisId:"right",type:"monotone",dataKey:"discountRate",stroke:"#ef4444",strokeWidth:3,name:"Discount Rate %"})]})})})]})}),e.jsx(H,{value:"distribution",className:"space-y-6",children:e.jsxs(B,{className:"bg-gradient-to-br from-white via-purple-50/30 to-violet-50/20 border-0 shadow-xl",children:[e.jsx(K,{children:e.jsxs(L,{className:"text-xl font-bold bg-gradient-to-r from-purple-700 to-violet-700 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx(ke,{className:"w-6 h-6 text-purple-600"}),"Discount Distribution by Category"]})}),e.jsx($,{children:e.jsx(Y,{width:"100%",height:400,children:e.jsxs($e,{children:[e.jsx(Ve,{data:P.categoryDistribution,cx:"50%",cy:"50%",labelLine:!1,label:({name:g,value:b})=>`${g}: ${x(b)}`,outerRadius:120,fill:"#8884d8",dataKey:"value",children:P.categoryDistribution.map((g,b)=>e.jsx(Ke,{fill:Pe[b%Pe.length]},`cell-${b}`))}),e.jsx(W,{formatter:g=>x(g)})]})})})]})}),e.jsx(H,{value:"ranges",className:"space-y-6",children:e.jsxs(B,{className:"bg-gradient-to-br from-white via-green-50/30 to-emerald-50/20 border-0 shadow-xl",children:[e.jsx(K,{children:e.jsxs(L,{className:"text-xl font-bold bg-gradient-to-r from-green-700 to-emerald-700 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx(Ae,{className:"w-6 h-6 text-green-600"}),"Discount Range Analysis"]})}),e.jsx($,{children:e.jsx(Y,{width:"100%",height:400,children:e.jsxs(xe,{data:P.rangeAnalysis,children:[e.jsx(X,{strokeDasharray:"3 3"}),e.jsx(_,{dataKey:"range"}),e.jsx(Q,{tickFormatter:g=>x(g)}),e.jsx(W,{formatter:(g,b)=>[x(g),b==="totalDiscount"?"Total Discount":"Average Discount"]}),e.jsx(me,{}),e.jsx(J,{dataKey:"totalDiscount",fill:"#10b981",name:"Total Discount"}),e.jsx(J,{dataKey:"avgDiscount",fill:"#06b6d4",name:"Average Discount"})]})})})]})}),e.jsx(H,{value:"correlation",className:"space-y-6",children:e.jsxs(B,{className:"bg-gradient-to-br from-white via-orange-50/30 to-amber-50/20 border-0 shadow-xl",children:[e.jsx(K,{children:e.jsxs(L,{className:"text-xl font-bold bg-gradient-to-r from-orange-700 to-amber-700 bg-clip-text text-transparent flex items-center gap-2",children:[e.jsx(fe,{className:"w-6 h-6 text-orange-600"}),"Discount Amount vs Percentage Correlation"]})}),e.jsx($,{children:e.jsx(Y,{width:"100%",height:400,children:e.jsxs(at,{data:P.scatterData,children:[e.jsx(X,{strokeDasharray:"3 3"}),e.jsx(_,{dataKey:"discountPercent",name:"Discount %",tickFormatter:g=>`${g}%`}),e.jsx(Q,{dataKey:"discountAmount",name:"Discount Amount",tickFormatter:g=>x(g)}),e.jsx(W,{formatter:(g,b)=>[b==="discountPercent"?`${g}%`:x(g),b==="discountPercent"?"Discount %":"Discount Amount"]}),e.jsx(ot,{dataKey:"discountAmount",fill:"#f59e0b"})]})})})]})})]})})},it=({data:m,filters:i,onDrillDown:w})=>{const[h,P]=M.useState("desc"),g=M.useMemo(()=>{const o=m.reduce((f,n)=>{const a=n.cleanedCategory||"Unknown";return f[a]||(f[a]={totalDiscount:0,count:0,totalRevenue:0,avgPercent:0}),f[a].totalDiscount+=n.discountAmount||0,f[a].count+=1,f[a].totalRevenue+=n.paymentValue||0,f[a].avgPercent+=n.discountPercentage||0,f},{}),s=m.reduce((f,n)=>{const a=n.cleanedProduct||"Unknown";return f[a]||(f[a]={totalDiscount:0,count:0,totalRevenue:0,avgPercent:0}),f[a].totalDiscount+=n.discountAmount||0,f[a].count+=1,f[a].totalRevenue+=n.paymentValue||0,f[a].avgPercent+=n.discountPercentage||0,f},{}),t=m.reduce((f,n)=>{const a=n.soldBy==="-"?"Online/System":n.soldBy;return f[a]||(f[a]={totalDiscount:0,count:0,totalRevenue:0,avgPercent:0}),f[a].totalDiscount+=n.discountAmount||0,f[a].count+=1,f[a].totalRevenue+=n.paymentValue||0,f[a].avgPercent+=n.discountPercentage||0,f},{}),l=m.reduce((f,n)=>{const a=n.paymentMethod||"Unknown";return f[a]||(f[a]={totalDiscount:0,count:0,totalRevenue:0,avgPercent:0}),f[a].totalDiscount+=n.discountAmount||0,f[a].count+=1,f[a].totalRevenue+=n.paymentValue||0,f[a].avgPercent+=n.discountPercentage||0,f},{}),k=f=>Object.entries(f).map(([n,a])=>({name:n,totalDiscount:a.totalDiscount,count:a.count,totalRevenue:a.totalRevenue,avgPercent:a.count>0?a.avgPercent/a.count:0,avgDiscount:a.count>0?a.totalDiscount/a.count:0})).sort((n,a)=>h==="desc"?a.totalDiscount-n.totalDiscount:n.totalDiscount-a.totalDiscount);return{categories:k(o),products:k(s),soldBy:k(t),paymentMethods:k(l)}},[m,h]),b=(o,s,t,l)=>{const k=o.slice(0,5),f=o.slice(-5).reverse();return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(B,{className:"bg-gradient-to-br from-white via-green-50/30 to-emerald-50/20 border-0 shadow-lg",children:[e.jsx(K,{className:"pb-3",children:e.jsxs(L,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(He,{className:"w-5 h-5 text-yellow-600"}),"Top ",t," by Discount",e.jsx(G,{variant:"ghost",size:"sm",onClick:()=>P(h==="desc"?"asc":"desc"),className:"ml-auto",children:e.jsx(qe,{className:"w-4 h-4"})})]})}),e.jsx($,{className:"space-y-3",children:k.map((n,a)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/60 rounded-lg hover:bg-white/80 transition-all duration-300 cursor-pointer hover:scale-102 group",onClick:()=>w==null?void 0:w(`${n.name} - Discount Details`,m.filter(j=>(l==="category"?j.cleanedCategory:l==="product"?j.cleanedProduct:l==="soldBy"?j.soldBy==="-"?"Online/System":j.soldBy:j.paymentMethod)===n.name),l),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-sm ${a===0?"bg-gradient-to-r from-yellow-500 to-amber-500":a===1?"bg-gradient-to-r from-gray-400 to-gray-500":a===2?"bg-gradient-to-r from-orange-500 to-amber-600":"bg-gradient-to-r from-blue-500 to-purple-600"}`,children:["#",a+1]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm text-slate-800 truncate group-hover:text-slate-900",children:n.name}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-600",children:[e.jsxs("span",{children:[C(n.count)," transactions"]}),e.jsxs(U,{variant:"outline",className:"text-xs bg-green-50 text-green-700 border-green-200",children:[n.avgPercent.toFixed(1),"% avg"]})]})]})]}),e.jsxs("div",{className:"text-right space-y-1",children:[e.jsx("div",{className:"font-bold text-red-600 text-sm",children:x(n.totalDiscount)}),e.jsxs("div",{className:"text-xs text-slate-500",children:[x(n.avgDiscount),"/txn"]})]})]},n.name))})]}),e.jsxs(B,{className:"bg-gradient-to-br from-white via-blue-50/30 to-indigo-50/20 border-0 shadow-lg",children:[e.jsx(K,{className:"pb-3",children:e.jsxs(L,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(Be,{className:"w-5 h-5 text-blue-600"}),"Lowest ",t," by Discount"]})}),e.jsx($,{className:"space-y-3",children:f.map((n,a)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/60 rounded-lg hover:bg-white/80 transition-all duration-300 cursor-pointer hover:scale-102 group",onClick:()=>w==null?void 0:w(`${n.name} - Discount Details`,m.filter(j=>(l==="category"?j.cleanedCategory:l==="product"?j.cleanedProduct:l==="soldBy"?j.soldBy==="-"?"Online/System":j.soldBy:j.paymentMethod)===n.name),l),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-10 h-10 bg-gradient-to-r from-slate-500 to-gray-600 rounded-full flex items-center justify-center text-white font-bold text-sm",children:["#",f.length-a]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-sm text-slate-800 truncate group-hover:text-slate-900",children:n.name}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-slate-600",children:[e.jsxs("span",{children:[C(n.count)," transactions"]}),e.jsxs(U,{variant:"outline",className:"text-xs bg-blue-50 text-blue-700 border-blue-200",children:[n.avgPercent.toFixed(1),"% avg"]})]})]})]}),e.jsxs("div",{className:"text-right space-y-1",children:[e.jsx("div",{className:"font-bold text-blue-600 text-sm",children:x(n.totalDiscount)}),e.jsxs("div",{className:"text-xs text-slate-500",children:[x(n.avgDiscount),"/txn"]})]})]},n.name))})]})]})};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Top & Bottom Performers"}),e.jsxs(U,{variant:"outline",className:"text-sm",children:[C(m.length)," total discounted transactions"]})]}),e.jsxs(de,{defaultValue:"categories",className:"w-full",children:[e.jsxs(ue,{className:"grid w-full grid-cols-4 mb-6 bg-white shadow-sm",children:[e.jsxs(z,{value:"categories",className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4"}),"Categories"]}),e.jsxs(z,{value:"products",className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4"}),"Products"]}),e.jsxs(z,{value:"soldBy",className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),"Sold By"]}),e.jsxs(z,{value:"payment",className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"Payment Method"]})]}),e.jsx(H,{value:"categories",children:b(g.categories,e.jsx(q,{className:"w-5 h-5"}),"Categories","category")}),e.jsx(H,{value:"products",children:b(g.products,e.jsx(q,{className:"w-5 h-5"}),"Products","product")}),e.jsx(H,{value:"soldBy",children:b(g.soldBy,e.jsx(ve,{className:"w-5 h-5"}),"Staff","soldBy")}),e.jsx(H,{value:"payment",children:b(g.paymentMethods,e.jsx(ie,{className:"w-5 h-5"}),"Payment Methods","paymentMethod")})]})]})},dt=({data:m,onRowClick:i})=>{const[w,h]=M.useState(""),[P,g]=M.useState("paymentDate"),[b,o]=M.useState("desc"),[s,t]=M.useState(1),l=50,k=M.useMemo(()=>{let N=m.filter(S=>{var p,d,T,r,v,y;const c=w.toLowerCase();return((p=S.customerName)==null?void 0:p.toLowerCase().includes(c))||((d=S.customerEmail)==null?void 0:d.toLowerCase().includes(c))||((T=S.cleanedProduct)==null?void 0:T.toLowerCase().includes(c))||((r=S.cleanedCategory)==null?void 0:r.toLowerCase().includes(c))||((v=S.calculatedLocation)==null?void 0:v.toLowerCase().includes(c))||((y=S.soldBy)==null?void 0:y.toLowerCase().includes(c))});return N.sort((S,c)=>{let p=S[P],d=c[P];return typeof p=="number"&&typeof d=="number"?b==="asc"?p-d:d-p:typeof p=="string"&&typeof d=="string"?b==="asc"?p.localeCompare(d):d.localeCompare(p):0}),N},[m,w,P,b]),f=Math.ceil(k.length/l),n=k.slice((s-1)*l,s*l),a=M.useMemo(()=>{const N=k.reduce((d,T)=>d+(T.discountAmount||0),0),S=k.reduce((d,T)=>d+(T.paymentValue||0),0),c=k.reduce((d,T)=>d+(T.mrpPostTax||0),0),p=k.length>0?k.reduce((d,T)=>d+(T.discountPercentage||0),0)/k.length:0;return{totalDiscount:N,totalRevenue:S,totalMrp:c,avgDiscountPercentage:p,totalTransactions:k.length}},[k]),j=N=>{P===N?o(b==="asc"?"desc":"asc"):(g(N),o("desc"))},D=N=>{i&&i(`Transaction Details - ${N.customerName}`,[N],"transaction-detail")},R=N=>P!==N?null:b==="asc"?e.jsx(Ge,{className:"w-4 h-4"}):e.jsx(re,{className:"w-4 h-4"}),I=N=>N>=50?"destructive":N>=25?"secondary":"default";return e.jsxs(B,{className:"shadow-xl border-0 bg-gradient-to-br from-white via-slate-50 to-blue-50/30",children:[e.jsx(K,{className:"bg-gradient-to-r from-slate-800 via-slate-700 to-slate-600 text-white rounded-t-lg",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/10 rounded-lg backdrop-blur-sm",children:e.jsx(le,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx(L,{className:"text-2xl font-bold",children:"Detailed Discount Analysis"}),e.jsx("p",{className:"text-slate-200 mt-1",children:"Comprehensive transaction-level discount data with advanced filtering"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ye,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),e.jsx(Qe,{placeholder:"Search transactions...",value:w,onChange:N=>h(N.target.value),className:"pl-10 bg-white/10 border-white/20 text-white placeholder:text-slate-300"})]}),e.jsxs(G,{variant:"outline",size:"sm",className:"bg-white/10 border-white/20 text-white hover:bg-white/20",children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),"Export"]})]})]})}),e.jsxs($,{className:"p-0",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-4 p-6 bg-gradient-to-r from-blue-50 to-indigo-50 border-b",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-slate-700",children:C(a.totalTransactions)}),e.jsx("div",{className:"text-sm text-slate-500",children:"Total Transactions"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:x(a.totalDiscount)}),e.jsx("div",{className:"text-sm text-slate-500",children:"Total Discount"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:x(a.totalRevenue)}),e.jsx("div",{className:"text-sm text-slate-500",children:"Total Revenue"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:x(a.totalMrp)}),e.jsx("div",{className:"text-sm text-slate-500",children:"Total MRP"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:V(a.avgDiscountPercentage)}),e.jsx("div",{className:"text-sm text-slate-500",children:"Avg Discount %"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ee,{children:[e.jsx(te,{className:"bg-gradient-to-br from-indigo-800 to-blue-900 ",children:e.jsxs(O,{className:"bg-gradient-to-br from-gray-800 to-indigo-900",children:[e.jsx(A,{className:"cursor-pointer",onClick:()=>j("paymentDate"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Date ",R("paymentDate")]})}),e.jsx(A,{className:"cursor-pointer",onClick:()=>j("customerName"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Customer ",R("customerName")]})}),e.jsx(A,{onClick:()=>j("cleanedProduct"),className:"cursor-pointer bg-gradient-to-br from-gray-800 to-indigo-900 ",children:e.jsxs("div",{className:"flex items-center gap-2",children:["Product ",R("cleanedProduct")]})}),e.jsx(A,{className:"cursor-pointer text-right",onClick:()=>j("mrpPostTax"),children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:["MRP ",R("mrpPostTax")]})}),e.jsx(A,{className:"cursor-pointer text-right",onClick:()=>j("discountAmount"),children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:["Discount ",R("discountAmount")]})}),e.jsx(A,{className:"cursor-pointer text-right",onClick:()=>j("discountPercentage"),children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:["Discount % ",R("discountPercentage")]})}),e.jsx(A,{className:"cursor-pointer text-right",onClick:()=>j("paymentValue"),children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:["Final Amount ",R("paymentValue")]})}),e.jsx(A,{children:"Location"}),e.jsx(A,{children:"Sold By"}),e.jsx(A,{className:"text-center",children:"Actions"})]})}),e.jsx(se,{children:n.map((N,S)=>e.jsxs(O,{className:"hover:cursor-pointer",children:[e.jsx(u,{className:"font-medium",children:new Date(N.paymentDate).toLocaleDateString()}),e.jsx(u,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-700",children:N.customerName}),e.jsx("div",{className:"text-sm text-slate-500",children:N.customerEmail})]})}),e.jsx(u,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-700",children:N.cleanedProduct}),e.jsx("div",{className:"text-sm text-slate-500",children:N.cleanedCategory})]})}),e.jsx(u,{className:"text-right font-medium",children:x(N.mrpPostTax||0)}),e.jsx(u,{className:"text-right",children:e.jsxs("span",{className:"font-semibold text-red-600",children:["-",x(N.discountAmount||0)]})}),e.jsx(u,{className:"text-right",children:e.jsx(U,{variant:I(N.discountPercentage||0),children:V(N.discountPercentage||0)})}),e.jsx(u,{className:"text-right font-semibold text-green-600",children:x(N.paymentValue||0)}),e.jsx(u,{children:e.jsx("span",{className:"text-sm text-slate-600",children:N.calculatedLocation})}),e.jsx(u,{children:e.jsx("span",{className:"text-sm text-slate-600",children:N.soldBy})}),e.jsx(u,{className:"text-center",children:e.jsx(G,{variant:"outline",size:"sm",onClick:()=>D(N),className:"hover:bg-blue-50",children:e.jsx(ae,{className:"w-4 h-4"})})})]},`${N.saleItemId}-${S}`))}),e.jsx(oe,{children:e.jsxs(O,{children:[e.jsxs(u,{colSpan:3,className:"font-bold",children:["Summary (",C(a.totalTransactions)," transactions)"]}),e.jsx(u,{className:"text-right font-bold",children:x(a.totalMrp)}),e.jsxs(u,{className:"text-right font-bold text-red-600",children:["-",x(a.totalDiscount)]}),e.jsx(u,{className:"text-right font-bold",children:V(a.avgDiscountPercentage)}),e.jsx(u,{className:"text-right font-bold text-green-600",children:x(a.totalRevenue)}),e.jsx(u,{colSpan:3})]})})]})}),f>1&&e.jsxs("div",{className:"flex items-center justify-between p-4 border-t bg-slate-50",children:[e.jsxs("div",{className:"text-sm text-slate-600",children:["Showing ",(s-1)*l+1," to ",Math.min(s*l,k.length)," of ",k.length," results"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{variant:"outline",size:"sm",onClick:()=>t(Math.max(1,s-1)),disabled:s===1,children:"Previous"}),e.jsxs("span",{className:"text-sm text-slate-600",children:["Page ",s," of ",f]}),e.jsx(G,{variant:"outline",size:"sm",onClick:()=>t(Math.min(f,s+1)),disabled:s===f,children:"Next"})]})]})]})]})},ut=({data:m,onDrillDown:i})=>{const w=M.useMemo(()=>{const o=m.reduce((s,t)=>{const l=t.cleanedProduct||"Unknown Product";return s[l]||(s[l]={product:l,category:t.cleanedCategory||"Unknown",transactions:0,totalDiscount:0,totalRevenue:0,totalMrp:0,avgDiscountPercentage:0,data:[]}),s[l].transactions+=1,s[l].totalDiscount+=t.discountAmount||0,s[l].totalRevenue+=t.paymentValue||0,s[l].totalMrp+=t.mrpPostTax||0,s[l].data.push(t),s},{});return Object.values(o).map(s=>E(F({},s),{avgDiscountPercentage:s.totalMrp>0?s.totalDiscount/s.totalMrp*100:0,discountRate:s.transactions>0?s.totalDiscount/s.transactions:0})).sort((s,t)=>t.totalDiscount-s.totalDiscount)},[m]),h=M.useMemo(()=>{const o=m.reduce((s,t)=>{const l=t.calculatedLocation||"Unknown Location";return s[l]||(s[l]={location:l,transactions:0,totalDiscount:0,totalRevenue:0,totalMrp:0,uniqueCustomers:new Set,data:[]}),s[l].transactions+=1,s[l].totalDiscount+=t.discountAmount||0,s[l].totalRevenue+=t.paymentValue||0,s[l].totalMrp+=t.mrpPostTax||0,s[l].uniqueCustomers.add(t.customerEmail),s[l].data.push(t),s},{});return Object.values(o).map(s=>E(F({},s),{uniqueCustomers:s.uniqueCustomers.size,avgDiscountPercentage:s.totalMrp>0?s.totalDiscount/s.totalMrp*100:0,avgDiscountPerTransaction:s.transactions>0?s.totalDiscount/s.transactions:0})).sort((s,t)=>t.totalDiscount-s.totalDiscount)},[m]),P=M.useMemo(()=>{const o=m.reduce((s,t)=>{const l=t.soldBy||"Unknown";return s[l]||(s[l]={staff:l,transactions:0,totalDiscount:0,totalRevenue:0,totalMrp:0,data:[]}),s[l].transactions+=1,s[l].totalDiscount+=t.discountAmount||0,s[l].totalRevenue+=t.paymentValue||0,s[l].totalMrp+=t.mrpPostTax||0,s[l].data.push(t),s},{});return Object.values(o).map(s=>E(F({},s),{avgDiscountPercentage:s.totalMrp>0?s.totalDiscount/s.totalMrp*100:0,discountRate:s.transactions>0?s.totalDiscount/s.transactions:0})).sort((s,t)=>t.totalDiscount-s.totalDiscount)},[m]),g=(o,s,t)=>{i&&i(o,s,t)},b=o=>o>=40?{variant:"destructive",label:"High"}:o>=20?{variant:"secondary",label:"Medium"}:{variant:"default",label:"Low"};return e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(B,{className:"shadow-xl border-0 bg-gradient-to-br from-white via-orange-50/30 to-amber-50/20",children:[e.jsx(K,{className:"bg-gradient-to-r from-slate-800 via-slate-700 to-slate-600 text-white rounded-t-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/10 rounded-lg backdrop-blur-sm",children:e.jsx(q,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx(L,{className:"text-2xl font-bold",children:"Product-wise Discount Breakdown"}),e.jsx("p",{className:"text-slate-200 mt-1",children:"Discount performance analysis by product category"})]})]})}),e.jsx($,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ee,{children:[e.jsx(te,{children:e.jsxs(O,{children:[e.jsx(A,{children:"Product"}),e.jsx(A,{children:"Category"}),e.jsx(A,{className:"text-center",children:"Transactions"}),e.jsx(A,{className:"text-right",children:"Total Discount"}),e.jsx(A,{className:"text-right",children:"Avg Discount %"}),e.jsx(A,{className:"text-right",children:"Total Revenue"}),e.jsx(A,{className:"text-right",children:"Discount Impact"}),e.jsx(A,{className:"text-center",children:"Actions"})]})}),e.jsx(se,{children:w.slice(0,10).map((o,s)=>{const t=b(o.avgDiscountPercentage);return e.jsxs(O,{children:[e.jsx(u,{className:"font-medium",children:e.jsx("div",{className:"max-w-[200px] truncate",title:o.product,children:o.product})}),e.jsx(u,{children:e.jsx("span",{className:"text-sm text-slate-600",children:o.category})}),e.jsx(u,{className:"text-center",children:e.jsx(U,{variant:"outline",children:C(o.transactions)})}),e.jsx(u,{className:"text-right font-semibold text-red-600",children:x(o.totalDiscount)}),e.jsx(u,{className:"text-right",children:e.jsx(U,{variant:t.variant,children:V(o.avgDiscountPercentage)})}),e.jsx(u,{className:"text-right font-semibold text-green-600",children:x(o.totalRevenue)}),e.jsx(u,{className:"text-right",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:x(o.discountRate)}),e.jsx("div",{className:"text-slate-500",children:"per transaction"})]})}),e.jsx(u,{className:"text-center",children:e.jsx(G,{variant:"outline",size:"sm",onClick:()=>g(`${o.product} - Discount Analysis`,o.data,"product-discount"),className:"hover:bg-orange-50",children:e.jsx(ae,{className:"w-4 h-4"})})})]},s)})}),e.jsx(oe,{children:e.jsxs(O,{children:[e.jsx(u,{colSpan:2,className:"font-bold",children:"Total (Top 10)"}),e.jsx(u,{className:"text-center font-bold",children:C(w.slice(0,10).reduce((o,s)=>o+s.transactions,0))}),e.jsx(u,{className:"text-right font-bold text-red-600",children:x(w.slice(0,10).reduce((o,s)=>o+s.totalDiscount,0))}),e.jsx(u,{className:"text-right font-bold",children:V(w.slice(0,10).reduce((o,s)=>o+s.avgDiscountPercentage,0)/Math.min(10,w.length))}),e.jsx(u,{className:"text-right font-bold text-green-600",children:x(w.slice(0,10).reduce((o,s)=>o+s.totalRevenue,0))}),e.jsx(u,{colSpan:2})]})})]})})})]}),e.jsxs(B,{className:"shadow-xl border-0 bg-gradient-to-br from-white via-blue-50/30 to-indigo-50/20",children:[e.jsx(K,{className:"bg-gradient-to-r from-slate-800 via-slate-700 to-slate-600 text-white rounded-t-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/10 rounded-lg backdrop-blur-sm",children:e.jsx(ye,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx(L,{className:"text-2xl font-bold",children:"Location-wise Discount Breakdown"}),e.jsx("p",{className:"text-slate-200 mt-1",children:"Geographic analysis of discount utilization patterns"})]})]})}),e.jsx($,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ee,{children:[e.jsx(te,{children:e.jsxs(O,{children:[e.jsx(A,{children:"Location"}),e.jsx(A,{className:"text-center",children:"Transactions"}),e.jsx(A,{className:"text-center",children:"Customers"}),e.jsx(A,{className:"text-right",children:"Total Discount"}),e.jsx(A,{className:"text-right",children:"Avg Discount %"}),e.jsx(A,{className:"text-right",children:"Avg per Transaction"}),e.jsx(A,{className:"text-right",children:"Total Revenue"}),e.jsx(A,{className:"text-center",children:"Actions"})]})}),e.jsx(se,{children:h.map((o,s)=>{const t=b(o.avgDiscountPercentage);return e.jsxs(O,{children:[e.jsx(u,{className:"font-medium",children:o.location}),e.jsx(u,{className:"text-center",children:e.jsx(U,{variant:"outline",children:C(o.transactions)})}),e.jsx(u,{className:"text-center",children:e.jsx(U,{variant:"secondary",children:C(o.uniqueCustomers)})}),e.jsx(u,{className:"text-right font-semibold text-red-600",children:x(o.totalDiscount)}),e.jsx(u,{className:"text-right",children:e.jsx(U,{variant:t.variant,children:V(o.avgDiscountPercentage)})}),e.jsx(u,{className:"text-right font-medium",children:x(o.avgDiscountPerTransaction)}),e.jsx(u,{className:"text-right font-semibold text-green-600",children:x(o.totalRevenue)}),e.jsx(u,{className:"text-center",children:e.jsx(G,{variant:"outline",size:"sm",onClick:()=>g(`${o.location} - Discount Analysis`,o.data,"location-discount"),className:"hover:bg-blue-50",children:e.jsx(ae,{className:"w-4 h-4"})})})]},s)})}),e.jsx(oe,{children:e.jsxs(O,{children:[e.jsx(u,{className:"font-bold",children:"Total"}),e.jsx(u,{className:"text-center font-bold",children:C(h.reduce((o,s)=>o+s.transactions,0))}),e.jsx(u,{className:"text-center font-bold",children:C(h.reduce((o,s)=>o+s.uniqueCustomers,0))}),e.jsx(u,{className:"text-right font-bold text-red-600",children:x(h.reduce((o,s)=>o+s.totalDiscount,0))}),e.jsx(u,{className:"text-right font-bold",children:V(h.reduce((o,s)=>o+s.avgDiscountPercentage,0)/h.length)}),e.jsx(u,{className:"text-right font-bold",children:x(h.reduce((o,s)=>o+s.avgDiscountPerTransaction,0)/h.length)}),e.jsx(u,{className:"text-right font-bold text-green-600",children:x(h.reduce((o,s)=>o+s.totalRevenue,0))}),e.jsx(u,{})]})})]})})})]}),e.jsxs(B,{className:"shadow-xl border-0 bg-gradient-to-br from-white via-purple-50/30 to-pink-50/20",children:[e.jsx(K,{className:"bg-gradient-to-r from-slate-800 via-slate-700 to-slate-600 text-white rounded-t-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/10 rounded-lg backdrop-blur-sm",children:e.jsx(ge,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx(L,{className:"text-2xl font-bold",children:"Staff-wise Discount Breakdown"}),e.jsx("p",{className:"text-slate-200 mt-1",children:"Analysis of discount authorization by sales staff"})]})]})}),e.jsx($,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ee,{children:[e.jsx(te,{children:e.jsxs(O,{children:[e.jsx(A,{children:"Staff Member"}),e.jsx(A,{className:"text-center",children:"Transactions"}),e.jsx(A,{className:"text-right",children:"Total Discount"}),e.jsx(A,{className:"text-right",children:"Avg Discount %"}),e.jsx(A,{className:"text-right",children:"Discount per Sale"}),e.jsx(A,{className:"text-right",children:"Total Revenue"}),e.jsx(A,{className:"text-center",children:"Performance"}),e.jsx(A,{className:"text-center",children:"Actions"})]})}),e.jsx(se,{children:P.map((o,s)=>{const t=b(o.avgDiscountPercentage);return e.jsxs(O,{children:[e.jsx(u,{className:"font-medium",children:o.staff}),e.jsx(u,{className:"text-center",children:e.jsx(U,{variant:"outline",children:C(o.transactions)})}),e.jsx(u,{className:"text-right font-semibold text-red-600",children:x(o.totalDiscount)}),e.jsx(u,{className:"text-right",children:e.jsx(U,{variant:t.variant,children:V(o.avgDiscountPercentage)})}),e.jsx(u,{className:"text-right font-medium",children:x(o.discountRate)}),e.jsx(u,{className:"text-right font-semibold text-green-600",children:x(o.totalRevenue)}),e.jsx(u,{className:"text-center",children:e.jsx(U,{variant:t.variant,children:t.label})}),e.jsx(u,{className:"text-center",children:e.jsx(G,{variant:"outline",size:"sm",onClick:()=>g(`${o.staff} - Discount Analysis`,o.data,"staff-discount"),className:"hover:bg-purple-50",children:e.jsx(ae,{className:"w-4 h-4"})})})]},s)})}),e.jsx(oe,{children:e.jsxs(O,{children:[e.jsx(u,{className:"font-bold",children:"Total"}),e.jsx(u,{className:"text-center font-bold",children:C(P.reduce((o,s)=>o+s.transactions,0))}),e.jsx(u,{className:"text-right font-bold text-red-600",children:x(P.reduce((o,s)=>o+s.totalDiscount,0))}),e.jsx(u,{className:"text-right font-bold",children:V(P.reduce((o,s)=>o+s.avgDiscountPercentage,0)/P.length)}),e.jsx(u,{className:"text-right font-bold",children:x(P.reduce((o,s)=>o+s.discountRate,0)/P.length)}),e.jsx(u,{className:"text-right font-bold text-green-600",children:x(P.reduce((o,s)=>o+s.totalRevenue,0))}),e.jsx(u,{colSpan:2})]})})]})})})]})]})},Re=["#8b5cf6","#06b6d4","#10b981","#f59e0b","#ef4444","#6366f1","#ec4899","#84cc16"],xt=({isOpen:m,onClose:i,title:w,data:h,type:P})=>{const g=M.useMemo(()=>{if(!h||h.length===0)return null;const t=h.reduce((c,p)=>c+(p.discountAmount||0),0),l=h.reduce((c,p)=>c+(p.paymentValue||0),0),k=h.length,f=new Set(h.map(c=>c.customerEmail)).size,n=t/h.length,a=h.reduce((c,p)=>c+(p.discountPercentage||0),0)/h.length,j=h.reduce((c,p)=>{const d=p.cleanedCategory||"Unknown";return c[d]||(c[d]={discountAmount:0,revenue:0,units:0,customers:new Set}),c[d].discountAmount+=p.discountAmount||0,c[d].revenue+=p.paymentValue||0,c[d].units+=1,c[d].customers.add(p.customerEmail),c},{}),D=h.reduce((c,p)=>{const d=p.cleanedProduct||"Unknown";return c[d]||(c[d]={discountAmount:0,revenue:0,units:0,customers:new Set}),c[d].discountAmount+=p.discountAmount||0,c[d].revenue+=p.paymentValue||0,c[d].units+=1,c[d].customers.add(p.customerEmail),c},{}),R=h.reduce((c,p)=>{const d=p.calculatedLocation||"Unknown";return c[d]||(c[d]={discountAmount:0,revenue:0,units:0,customers:new Set}),c[d].discountAmount+=p.discountAmount||0,c[d].revenue+=p.paymentValue||0,c[d].units+=1,c[d].customers.add(p.customerEmail),c},{}),I=h.reduce((c,p)=>{const d=p.paymentMethod||"Unknown";return c[d]||(c[d]={discountAmount:0,revenue:0,units:0,customers:new Set}),c[d].discountAmount+=p.discountAmount||0,c[d].revenue+=p.paymentValue||0,c[d].units+=1,c[d].customers.add(p.customerEmail),c},{}),N=h.reduce((c,p)=>{if(!p.paymentDate)return c;const d=new Date(p.paymentDate),T=`${d.getFullYear()}-${(d.getMonth()+1).toString().padStart(2,"0")}`,r=d.toLocaleDateString("en-US",{month:"short",year:"numeric"});return c[T]||(c[T]={month:r,discountAmount:0,revenue:0,units:0,customers:new Set}),c[T].discountAmount+=p.discountAmount||0,c[T].revenue+=p.paymentValue||0,c[T].units+=1,c[T].customers.add(p.customerEmail),c},{}),S=c=>Object.entries(c).map(([p,d])=>({name:p,discountAmount:d.discountAmount,revenue:d.revenue,units:d.units,customers:d.customers.size,avgDiscount:d.units>0?d.discountAmount/d.units:0,discountRate:d.revenue>0?d.discountAmount/d.revenue*100:0})).sort((p,d)=>d.discountAmount-p.discountAmount);return{summary:{totalDiscount:t,totalRevenue:l,totalUnits:k,uniqueCustomers:f,avgDiscount:n,avgDiscountPercent:a,discountRate:l>0?t/l*100:0},categoryBreakdown:S(j),productBreakdown:S(D),locationBreakdown:S(R),paymentBreakdown:S(I),monthlyTrend:Object.values(N).map(c=>E(F({},c),{customers:c.customers.size,avgDiscount:c.units>0?c.discountAmount/c.units:0,discountRate:c.revenue>0?c.discountAmount/c.revenue*100:0})).sort((c,p)=>c.month.localeCompare(p.month))}},[h]);if(!g)return null;const b=()=>e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(B,{className:"bg-gradient-to-br from-red-50 to-rose-50 border-red-200",children:e.jsxs($,{className:"p-4 text-center",children:[e.jsx(re,{className:"w-8 h-8 text-red-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-red-700",children:"Total Discount"}),e.jsx("p",{className:"text-xl font-bold text-red-800",children:x(g.summary.totalDiscount)})]})}),e.jsx(B,{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-200",children:e.jsxs($,{className:"p-4 text-center",children:[e.jsx(be,{className:"w-8 h-8 text-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-blue-700",children:"Units Sold"}),e.jsx("p",{className:"text-xl font-bold text-blue-800",children:C(g.summary.totalUnits)})]})}),e.jsx(B,{className:"bg-gradient-to-br from-green-50 to-emerald-50 border-green-200",children:e.jsxs($,{className:"p-4 text-center",children:[e.jsx(he,{className:"w-8 h-8 text-green-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-green-700",children:"Revenue"}),e.jsx("p",{className:"text-xl font-bold text-green-800",children:x(g.summary.totalRevenue)})]})}),e.jsx(B,{className:"bg-gradient-to-br from-purple-50 to-violet-50 border-purple-200",children:e.jsxs($,{className:"p-4 text-center",children:[e.jsx(ge,{className:"w-8 h-8 text-purple-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm font-medium text-purple-700",children:"Customers"}),e.jsx("p",{className:"text-xl font-bold text-purple-800",children:C(g.summary.uniqueCustomers)})]})})]}),o=()=>{switch(P){case"categories":return e.jsx(Y,{width:"100%",height:300,children:e.jsxs(xe,{data:g.categoryBreakdown.slice(0,10),children:[e.jsx(X,{strokeDasharray:"3 3"}),e.jsx(_,{dataKey:"name"}),e.jsx(Q,{}),e.jsx(W,{formatter:t=>x(t)}),e.jsx(me,{}),e.jsx(J,{dataKey:"discountAmount",fill:"#ef4444",name:"Discount Amount"}),e.jsx(J,{dataKey:"revenue",fill:"#10b981",name:"Revenue"})]})});case"monthly-trend":return e.jsx(Y,{width:"100%",height:300,children:e.jsxs(Ne,{data:g.monthlyTrend,children:[e.jsx(X,{strokeDasharray:"3 3"}),e.jsx(_,{dataKey:"month"}),e.jsx(Q,{}),e.jsx(W,{formatter:t=>x(t)}),e.jsx(me,{}),e.jsx(ne,{type:"monotone",dataKey:"discountAmount",stroke:"#ef4444",name:"Discount Amount"}),e.jsx(ne,{type:"monotone",dataKey:"revenue",stroke:"#10b981",name:"Revenue"})]})});case"payment-methods":return e.jsx(Y,{width:"100%",height:300,children:e.jsxs($e,{children:[e.jsx(Ve,{data:g.paymentBreakdown.slice(0,8),cx:"50%",cy:"50%",labelLine:!1,label:({name:t,percent:l})=>`${t} ${(l*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"discountAmount",children:g.paymentBreakdown.slice(0,8).map((t,l)=>e.jsx(Ke,{fill:Re[l%Re.length]},`cell-${l}`))}),e.jsx(W,{formatter:t=>x(t)})]})});default:return null}},s=()=>{let t=[],l=[];switch(P){case"categories":t=g.categoryBreakdown,l=[{key:"name",label:"Category",icon:q},{key:"discountAmount",label:"Discount Amount",format:x},{key:"revenue",label:"Revenue",format:x},{key:"units",label:"Units Sold",format:C},{key:"customers",label:"Customers",format:C},{key:"discountRate",label:"Discount Rate",format:k=>`${k.toFixed(1)}%`}];break;case"locations":t=g.locationBreakdown,l=[{key:"name",label:"Location",icon:ye},{key:"discountAmount",label:"Discount Amount",format:x},{key:"revenue",label:"Revenue",format:x},{key:"units",label:"Units Sold",format:C},{key:"customers",label:"Customers",format:C},{key:"discountRate",label:"Discount Rate",format:k=>`${k.toFixed(1)}%`}];break;case"payment-methods":t=g.paymentBreakdown,l=[{key:"name",label:"Payment Method",icon:ie},{key:"discountAmount",label:"Discount Amount",format:x},{key:"revenue",label:"Revenue",format:x},{key:"units",label:"Units Sold",format:C},{key:"customers",label:"Customers",format:C},{key:"discountRate",label:"Discount Rate",format:k=>`${k.toFixed(1)}%`}];break;case"monthly-trend":t=g.monthlyTrend,l=[{key:"month",label:"Month",icon:ce},{key:"discountAmount",label:"Discount Amount",format:x},{key:"revenue",label:"Revenue",format:x},{key:"units",label:"Units Sold",format:C},{key:"customers",label:"Customers",format:C},{key:"discountRate",label:"Discount Rate",format:k=>`${k.toFixed(1)}%`}];break;default:return null}return e.jsxs(B,{children:[e.jsx(K,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5"}),"Detailed Breakdown"]})}),e.jsx($,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(ee,{children:[e.jsx(te,{children:e.jsx(O,{children:l.map(k=>e.jsx(A,{className:"font-semibold",children:e.jsxs("div",{className:"flex items-center gap-2",children:[k.icon&&e.jsx(k.icon,{className:"w-4 h-4"}),k.label]})},k.key))})}),e.jsx(se,{children:t.slice(0,20).map((k,f)=>e.jsx(O,{className:"hover:bg-gray-50",children:l.map(n=>e.jsx(u,{children:n.format?n.format(k[n.key]):k[n.key]},n.key))},f))})]})})})]})};return e.jsx(Xe,{open:m,onOpenChange:i,children:e.jsxs(_e,{className:"max-w-6xl max-h-[90vh]",children:[e.jsx(Je,{children:e.jsxs(Ze,{className:"text-xl font-bold text-gray-900",children:[w," - Detailed Analysis"]})}),e.jsx(et,{className:"max-h-[calc(90vh-120px)]",children:e.jsxs("div",{className:"space-y-6 pr-4",children:[b(),o()&&e.jsxs(B,{children:[e.jsx(K,{children:e.jsx(L,{children:"Visual Analysis"})}),e.jsx($,{children:o()})]}),s()]})})]})})},Ce=[{id:"all",name:"All Locations"},{id:"kwality",name:"Kwality House, Kemps Corner"},{id:"supreme",name:"Supreme HQ, Bandra"},{id:"kenkere",name:"Kenkere House"}],Se=()=>{const m=new Date,i=new Date(m.getFullYear(),m.getMonth(),1),w=new Date(m.getFullYear(),m.getMonth()+1,0),h=P=>P.toISOString().split("T")[0];return{start:h(i),end:h(w)}},yt=({data:m})=>{const[i,w]=M.useState("all"),[h,P]=M.useState({dateRange:{start:null,end:null},category:[],product:[],soldBy:[],paymentMethod:[]}),[g,b]=M.useState({isOpen:!1,title:"",data:[],type:""});M.useEffect(()=>{const a=Se();P(j=>E(F({},j),{dateRange:{start:a.start,end:a.end}}))},[]);const o=(a,j=!1)=>{let D=a.slice();if(i!=="all"&&(D=D.filter(R=>{var N;return i==="kwality"?R.calculatedLocation==="Kwality House, Kemps Corner":i==="supreme"?R.calculatedLocation==="Supreme HQ, Bandra":((N=R.calculatedLocation)==null?void 0:N.includes("Kenkere"))||R.calculatedLocation==="Kenkere House"})),!j&&(h.dateRange.start||h.dateRange.end)){const R=h.dateRange.start?new Date(h.dateRange.start):null,I=h.dateRange.end?(()=>{const N=new Date(h.dateRange.end);return N.setHours(23,59,59,999),N})():null;(R||I)&&(D=D.filter(N=>{if(!N.paymentDate)return!1;let S;if(N.paymentDate.includes("/"))if(N.paymentDate.includes(" ")){const[p]=N.paymentDate.split(" "),[d,T,r]=p.split("/");S=new Date(parseInt(d),parseInt(T)-1,parseInt(r))}else{const[p,d,T]=N.paymentDate.split("/");S=new Date(parseInt(T),parseInt(d)-1,parseInt(p))}else S=new Date(N.paymentDate);return!S||isNaN(S.getTime())?!1:(!R||S>=R)&&(!I||S<=I)}))}return h.category&&h.category.length>0&&(D=D.filter(R=>h.category.includes(R.cleanedCategory||"Uncategorized"))),h.product&&h.product.length>0&&(D=D.filter(R=>h.product.includes(R.cleanedProduct||R.paymentItem||"Unknown"))),h.soldBy&&h.soldBy.length>0&&(D=D.filter(R=>h.soldBy.includes(R.soldBy||"Unknown"))),h.paymentMethod&&h.paymentMethod.length>0&&(D=D.filter(R=>h.paymentMethod.includes(R.paymentMethod||"Unknown"))),D},s=M.useMemo(()=>o(m),[m,h,i]),t=M.useMemo(()=>o(m,!0),[m,i]),l=M.useMemo(()=>s,[s]);M.useMemo(()=>s.filter(j=>(j.discountAmount||0)>0),[s]);const k=a=>{b({isOpen:!0,title:`${a.title} Analysis`,data:a.rawData||s,type:"metric"})},f=(a,j,D)=>{b({isOpen:!0,title:a,data:j,type:D})},n=()=>{const a=Se();P({dateRange:{start:a.start,end:a.end},category:[],product:[],soldBy:[],paymentMethod:[]})};return e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"container mx-auto px-6",children:e.jsx(tt,{})}),e.jsx("div",{className:"container mx-auto px-6 space-y-6",children:e.jsxs(de,{value:i,onValueChange:w,className:"w-full",children:[e.jsx("div",{className:"flex justify-center mb-8",children:e.jsx(ue,{className:"bg-white/90 backdrop-blur-sm p-2 rounded-2xl shadow-xl border-0 grid grid-cols-4 w-full max-w-7xl min-h-24 overflow-hidden",children:Ce.map(a=>{var j;return e.jsx(z,{value:a.id,className:"relative px-6 py-4 font-semibold text-gray-800 transition-all duration-300 ease-out hover:scale-105 data-[state=active]:bg-gradient-to-r data-[state=active]:from-orange-600 data-[state=active]:to-amber-600 data-[state=active]:text-white data-[state=active]:shadow-lg hover:bg-gray-50 text-2xl rounded-2xl",children:e.jsxs("div",{className:"relative z-10 text-center",children:[e.jsx("div",{className:"font-bold",children:a.name.split(",")[0]}),e.jsx("div",{className:"text-xs opacity-80",children:(j=a.name.split(",")[1])==null?void 0:j.trim()})]})},a.id)})})}),Ce.map(a=>e.jsxs(H,{value:a.id,className:"space-y-8",children:[e.jsx("div",{className:"w-full",children:e.jsx(rt,{filters:h,onFiltersChange:P,onReset:n})}),e.jsx(ct,{data:l,onMetricClick:k}),e.jsx(Te,{data:t}),e.jsx(it,{data:l,onDrillDown:f}),e.jsxs(de,{defaultValue:"detailed",className:"space-y-6",children:[e.jsxs(ue,{className:"grid w-full grid-cols-3 bg-gradient-to-r from-orange-100 via-amber-100 to-yellow-100 p-1 rounded-xl shadow-lg border border-orange-200/50",children:[e.jsx(z,{value:"detailed",className:"data-[state=active]:bg-white data-[state=active]:shadow-lg data-[state=active]:text-orange-800 font-semibold transition-all duration-300",children:"Data Tables"}),e.jsx(z,{value:"breakdown",className:"data-[state=active]:bg-white data-[state=active]:shadow-lg data-[state=active]:text-orange-800 font-semibold transition-all duration-300",children:"Breakdowns"}),e.jsx(z,{value:"analytics",className:"data-[state=active]:bg-white data-[state=active]:shadow-lg data-[state=active]:text-orange-800 font-semibold transition-all duration-300",children:"Analytics"})]}),e.jsx(H,{value:"analytics",className:"space-y-6",children:e.jsx(Te,{data:l})}),e.jsx(H,{value:"detailed",className:"space-y-6",children:e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl shadow-xl p-6 border border-orange-200/50",children:e.jsx(dt,{data:l,onRowClick:(j,D,R)=>f(j,D,R)})})}),e.jsx(H,{value:"breakdown",className:"space-y-6",children:e.jsx(ut,{data:l,onDrillDown:f})})]})]},a.id))]})}),e.jsx(xt,{isOpen:g.isOpen,onClose:()=>b({isOpen:!1,title:"",data:[],type:""}),title:g.title,data:g.data,type:g.type})]})},Nt=({data:m})=>{const i=m.reduce((s,t)=>s+(t.discountAmount||0),0),w=m.length,h=m.filter(s=>(s.discountAmount||0)>0).length,P=m.reduce((s,t)=>s+(t.paymentValue||0),0),g=P>0?i/(P+i)*100:0,b=[{location:"Total Discounts",label:"Amount saved by customers",value:x(i)},{location:"Discount Rate",label:"Percentage of gross revenue",value:V(g)},{location:"Transactions",label:`${h} of ${w} had discounts`,value:C(h)}],o=e.jsx(nt,{salesData:m,defaultFileName:"discounts-promotions-filtered",size:"sm",variant:"ghost"});return e.jsx(st,{title:"Discounts & Promotions",subtitle:"Comprehensive analysis of discount strategies, promotional effectiveness, and customer savings patterns",variant:"discounts",metrics:b,exportButton:o})};export{Nt as D,bt as E,yt as a};
