var fe=Object.defineProperty,we=Object.defineProperties;var Ne=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var je=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable;var ie=(d,p,f)=>p in d?fe(d,p,{enumerable:!0,configurable:!0,writable:!0,value:f}):d[p]=f,V=(d,p)=>{for(var f in p||(p={}))je.call(p,f)&&ie(d,f,p[f]);if(oe)for(var f of oe(p))ye.call(p,f)&&ie(d,f,p[f]);return d},L=(d,p)=>we(d,Ne(p));import{r as A,M as re,U as Y,T as K,J as Me,j as e,F as le,b as Te,K as Ce,C as Re,c as _,S as Ve,i as F,N as Le,v as J,O as Se,h as I,f as ke,Q as ce,R as S,V as Q,u as ve,W as de,s as me,g as De,e as ne,w as se,Y as xe,X as $e,Z as Ye}from"./react-vendor-BrAkf1Ej.js";import{C as M,c as T,B as j,d as P,j as D,k as $,D as Ae,I as Z,Y as X,T as be,m as ge,n as B,o as R,p as ue,q as N,Z as Fe,_ as Pe,$ as Ie,a0 as Ke,r as Ee,s as Ge,t as q,u as ee}from"./ui-components-_bEsYxhv.js";import{c as w,f as k,a as Ue}from"./utils-hni-AijI.js";import{R as G,P as Oe,d as ze,e as He,T as U,A as Be,C as O,X as z,Y as H,f as _e,B as te,c as W,L as We,b as he}from"./chart-vendor-CfJT7qML.js";import{m as pe}from"./animation-vendor-Cz-8KeDB.js";const tt=({filters:d,onFiltersChange:p,locations:f,trainers:g,membershipTypes:x})=>{const[a,o]=A.useState(!1),[m,r]=A.useState(""),l=(t,v)=>{const b=[...d[t]],y=b.includes(v)?b.filter(C=>C!==v):[...b,v];p(L(V({},d),{[t]:y}))},c=t=>{const v=b=>{const y=b.getFullYear(),C=String(b.getMonth()+1).padStart(2,"0"),E=String(b.getDate()).padStart(2,"0");return`${y}-${C}-${E}`};p(L(V({},d),{dateRange:{start:t.from?v(t.from):"",end:t.to?v(t.to):""}}))},n=()=>{p({dateRange:{start:"",end:""},location:[],homeLocation:[],trainer:[],paymentMethod:[],retentionStatus:[],conversionStatus:[],isNew:[],minLTV:void 0,maxLTV:void 0}),r("")},s=d.location.length+d.trainer.length+d.retentionStatus.length+d.conversionStatus.length+d.paymentMethod.length+d.isNew.length+(d.dateRange.start||d.dateRange.end?1:0)+(d.minLTV?1:0)+(d.maxLTV?1:0),h=["Kwality House, Kemps Corner","Supreme HQ, Bandra","Kenkere House, Bengaluru"],u=f.filter(t=>h.includes(t)),i=[{title:"Location & Geography",icon:re,filters:[{key:"location",label:"Visit Locations",options:u,values:d.location}]},{title:"Trainer & Service",icon:Y,filters:[{key:"trainer",label:"Trainers",options:g.slice(0,12),values:d.trainer}]},{title:"Conversion & Status",icon:K,filters:[{key:"conversionStatus",label:"Conversion Status",options:["Converted","Not Converted","Pending"],values:d.conversionStatus},{key:"retentionStatus",label:"Retention Status",options:["Retained","Not Retained","At Risk"],values:d.retentionStatus},{key:"isNew",label:"Client Type",options:["New","Existing","Returning"],values:d.isNew}]},{title:"Payment & Membership",icon:Me,filters:[{key:"paymentMethod",label:"Payment Methods",options:["Online","Cash","Card","UPI","Bank Transfer"],values:d.paymentMethod}]}];return a?e.jsxs(M,{className:"bg-gradient-to-br from-white via-blue-50/30 to-indigo-50/20 border-0 shadow-xl overflow-hidden",children:[e.jsx(D,{className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white",children:e.jsxs($,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(le,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Advanced Client Filters"}),e.jsx("p",{className:"text-blue-100 text-sm",children:"Customize your analysis view"})]}),e.jsxs(j,{className:"bg-white/20 text-white border-white/30",children:[s," Active"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(P,{variant:"outline",size:"sm",onClick:n,disabled:s===0,className:"bg-white/10 border-white/30 text-white hover:bg-white/20",children:[e.jsx(Ce,{className:"w-4 h-4 mr-1"}),"Reset"]}),e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>o(!1),className:"text-white hover:bg-white/20",children:e.jsx(Re,{className:"w-4 h-4"})})]})]})}),e.jsxs(T,{className:"p-8 space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"text-sm font-bold text-slate-700 flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5 text-blue-600"}),"Date Range"]}),e.jsx(Ae,{value:{from:d.dateRange.start?new Date(d.dateRange.start):void 0,to:d.dateRange.end?new Date(d.dateRange.end):void 0},onChange:c})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"text-sm font-bold text-slate-700 flex items-center gap-2",children:[e.jsx(Ve,{className:"w-5 h-5 text-blue-600"}),"Quick Search"]}),e.jsx(Z,{placeholder:"Search trainers, locations...",value:m,onChange:t=>r(t.target.value),className:"bg-white border-slate-200"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"text-sm font-bold text-slate-700 flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5 text-blue-600"}),"Lifetime Value Range"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Z,{type:"number",placeholder:"Min LTV (₹)",value:d.minLTV||"",onChange:t=>p(L(V({},d),{minLTV:t.target.value?parseFloat(t.target.value):void 0})),className:"bg-white border-slate-200"}),e.jsx(Z,{type:"number",placeholder:"Max LTV (₹)",value:d.maxLTV||"",onChange:t=>p(L(V({},d),{maxLTV:t.target.value?parseFloat(t.target.value):void 0})),className:"bg-white border-slate-200"})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:i.map(t=>e.jsxs(M,{className:"bg-white/70 border-slate-200 shadow-lg",children:[e.jsx(D,{className:"pb-4",children:e.jsxs($,{className:"text-lg font-bold text-slate-800 flex items-center gap-2",children:[e.jsx(t.icon,{className:"w-5 h-5 text-blue-600"}),t.title]})}),e.jsx(T,{className:"space-y-4",children:t.filters.map(v=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"text-sm font-medium text-slate-700",children:[v.label,v.values.length>0&&e.jsxs(j,{variant:"secondary",className:"ml-2 text-xs bg-blue-100 text-blue-700",children:[v.values.length," selected"]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 max-h-32 overflow-y-auto",children:v.options.filter(b=>!m||b.toLowerCase().includes(m.toLowerCase())).map(b=>e.jsx(P,{variant:v.values.includes(b)?"default":"outline",size:"sm",onClick:()=>l(v.key,b),className:`text-xs transition-all duration-200 ${v.values.includes(b)?"bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-md":"hover:bg-blue-50 border-slate-200 hover:border-blue-300"}`,children:b},b))})]},v.key))})]},t.title))})]})]}):e.jsx(M,{className:"bg-gradient-to-br from-white via-blue-50/30 to-indigo-50/20 border-0 shadow-xl",children:e.jsx(T,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-lg",children:e.jsx(le,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-800",children:"Advanced Filters"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Refine your client analysis"})]}),s>0&&e.jsxs(j,{className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white",children:[s," active"]})]}),e.jsxs(P,{variant:"outline",onClick:()=>o(!0),className:"gap-2 border-blue-200 text-blue-700 hover:bg-blue-50",children:[e.jsx(Te,{className:"w-4 h-4"}),"Expand Filters"]})]})})})},st=({data:d,onCardClick:p})=>{const f=d.length,g=d.filter(i=>String(i.isNew||"").toLowerCase().includes("new")).length,x=d.filter(i=>i.conversionStatus==="Converted").length,a=d.filter(i=>i.retentionStatus==="Retained").length,o=d.length,m=o>0?x/o*100:0,r=g>0?x/g*100:0,l=g>0?a/g*100:0,c=d.reduce((i,t)=>i+(t.ltv||0),0),n=f>0?c/f:0,s=d.filter(i=>i.conversionStatus==="Converted"&&i.conversionSpan&&i.conversionSpan>0),h=s.length>0?s.reduce((i,t)=>i+t.conversionSpan,0)/s.length:0,u=[{title:"New Members",value:w(g),icon:Le,gradient:"from-blue-500 to-indigo-600",description:"Recently acquired clients",change:12.5,isPositive:!0,previousValue:w(g-Math.round(g*.125)),period:"vs last month",metricType:"new_members",filterData:()=>d.filter(i=>String(i.isNew||"").toLowerCase().includes("new"))},{title:"Converted Members",value:w(x),icon:J,gradient:"from-green-500 to-teal-600",description:"Trial to paid conversions",change:8.3,isPositive:!0,previousValue:w(x-Math.round(x*.083)),period:"vs last month",metricType:"converted_members",filterData:()=>d.filter(i=>i.conversionStatus==="Converted")},{title:"Retained Members",value:w(a),icon:Se,gradient:"from-purple-500 to-violet-600",description:"Active retained clients",change:15.2,isPositive:!0,previousValue:w(a-Math.round(a*.152)),period:"vs last month",metricType:"retained_members",filterData:()=>d.filter(i=>i.retentionStatus==="Retained")},{title:"Conversion Rate",value:`${r.toFixed(1)}%`,icon:I,gradient:"from-orange-500 to-red-600",description:"New to converted rate",change:4.8,isPositive:!0,previousValue:`${(r-4.8).toFixed(1)}%`,period:"vs last month",metricType:"conversion_rate",filterData:()=>d.filter(i=>String(i.isNew||"").includes("New")||i.conversionStatus==="Converted")},{title:"Retention Rate",value:`${l.toFixed(1)}%`,icon:K,gradient:"from-cyan-500 to-blue-600",description:"Member retention rate",change:"+3.1%",isPositive:!0,metricType:"retention_rate",filterData:()=>d.filter(i=>i.retentionStatus==="Retained")},{title:"Avg LTV",value:k(n),icon:F,gradient:"from-pink-500 to-rose-600",description:"Average lifetime value",change:"+7.2%",isPositive:!0,metricType:"avg_ltv",filterData:()=>d.filter(i=>(i.ltv||0)>0)},{title:"Avg Conv. Time",value:`${h.toFixed(0)} days`,icon:ke,gradient:"from-emerald-500 to-green-600",description:"Average conversion time",change:"-2.1 days",isPositive:!0,metricType:"avg_conv_time",filterData:()=>d.filter(i=>i.conversionStatus==="Converted"&&i.firstPurchase&&i.firstVisitDate)},{title:"Trial → Member",value:`${m.toFixed(1)}%`,icon:ce,gradient:"from-indigo-500 to-purple-600",description:"Trial conversion rate",change:"+5.4%",isPositive:!0,metricType:"trial_to_member",filterData:()=>d.filter(i=>(i.visitsPostTrial||0)>0)}];return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:u.map((i,t)=>e.jsxs(M,{className:"group relative overflow-hidden bg-white border border-slate-200 shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-1 cursor-pointer",onClick:()=>p==null?void 0:p(i.title,i.filterData(),i.metricType),style:{backgroundColor:"white"},children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${i.gradient} opacity-3 group-hover:opacity-8 transition-opacity duration-300`}),e.jsxs(T,{className:"relative p-6 z-10 bg-white",style:{backgroundColor:"white",color:"#1e293b"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:`p-3 rounded-xl bg-gradient-to-br ${i.gradient} shadow-lg group-hover:scale-110 transition-transform duration-300`,children:e.jsx(i.icon,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"text-right",children:[e.jsxs(j,{className:`text-xs px-3 py-1 font-medium transition-all duration-300 mb-1 ${i.isPositive?"bg-green-100 text-green-800 border-green-200 group-hover:bg-green-200":"bg-red-100 text-red-800 border-red-200 group-hover:bg-red-200"}`,children:[i.isPositive?"+":"",i.change]}),i.previousValue&&e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[e.jsxs("div",{children:["From: ",i.previousValue]}),e.jsx("div",{className:"text-xs opacity-75",children:i.period})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-700 group-hover:text-slate-800 transition-colors",style:{color:"#334155"},children:i.title}),e.jsx("div",{className:"flex items-baseline gap-2",children:e.jsx("span",{className:"text-3xl font-bold text-slate-900 group-hover:text-slate-800 transition-colors",style:{color:"#0f172a"},children:i.value})}),e.jsx("p",{className:"text-xs text-slate-500 group-hover:text-slate-600 transition-colors leading-relaxed",style:{color:"#64748b"},children:i.description}),e.jsx("div",{className:"pt-3 border-t border-slate-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`flex-1 h-1 bg-gradient-to-r ${i.gradient} rounded-full opacity-30 group-hover:opacity-50 transition-opacity`}),e.jsx(ce,{className:"w-4 h-4 text-slate-400 ml-3 group-hover:text-slate-600 transition-colors"})]})})]})]})]},i.title))})},rt=({data:d})=>{const[p,f]=A.useState("trainer-conversion"),g=S.useMemo(()=>{const i=new Map;return d.forEach(t=>{const v=t.trainerName||"Unknown";i.has(v)||i.set(v,{name:v,totalClients:0,newMembers:0,converted:0,retained:0,totalLTV:0,trialsCompleted:0});const b=i.get(v);b.totalClients++,b.totalLTV+=t.ltv||0,String(t.isNew||"").includes("New")&&b.newMembers++,t.conversionStatus==="Converted"&&b.converted++,t.retentionStatus==="Retained"&&b.retained++,(t.visitsPostTrial||0)>0&&b.trialsCompleted++}),Array.from(i.values()).map(t=>L(V({},t),{conversionRate:t.newMembers>0?t.converted/t.newMembers*100:0,retentionRate:t.converted>0?t.retained/t.converted*100:0,avgLTV:t.totalClients>0?t.totalLTV/t.totalClients:0,trialConversionRate:t.trialsCompleted>0?t.converted/t.trialsCompleted*100:0}))},[d]),x=S.useMemo(()=>{const i=new Map;return d.forEach(t=>{const v=t.firstVisitLocation||t.homeLocation||"Unknown";i.has(v)||i.set(v,{name:v,totalClients:0,newMembers:0,converted:0,retained:0,totalLTV:0,trialsCompleted:0});const b=i.get(v);b.totalClients++,b.totalLTV+=t.ltv||0,String(t.isNew||"").includes("New")&&b.newMembers++,t.conversionStatus==="Converted"&&b.converted++,t.retentionStatus==="Retained"&&b.retained++,(t.visitsPostTrial||0)>0&&b.trialsCompleted++}),Array.from(i.values()).map(t=>L(V({},t),{conversionRate:t.newMembers>0?t.converted/t.newMembers*100:0,retentionRate:t.converted>0?t.retained/t.converted*100:0,avgLTV:t.totalClients>0?t.totalLTV/t.totalClients:0,trialConversionRate:t.trialsCompleted>0?t.converted/t.trialsCompleted*100:0}))},[d]),a=S.useMemo(()=>{const i=new Map;return d.forEach(t=>{const v=t.firstVisitEntityName||"Unknown Class";i.has(v)||i.set(v,{name:v,totalClients:0,newMembers:0,converted:0,retained:0,totalLTV:0,trialsCompleted:0});const b=i.get(v);b.totalClients++,b.totalLTV+=t.ltv||0,String(t.isNew||"").includes("New")&&b.newMembers++,t.conversionStatus==="Converted"&&b.converted++,t.retentionStatus==="Retained"&&b.retained++,(t.visitsPostTrial||0)>0&&b.trialsCompleted++}),Array.from(i.values()).map(t=>L(V({},t),{conversionRate:t.newMembers>0?t.converted/t.newMembers*100:0,retentionRate:t.converted>0?t.retained/t.converted*100:0,avgLTV:t.totalClients>0?t.totalLTV/t.totalClients:0,trialConversionRate:t.trialsCompleted>0?t.converted/t.trialsCompleted*100:0}))},[d]),o=S.useMemo(()=>{const i=new Map;return d.forEach(t=>{const v=t.membershipUsed||"Unknown Membership";i.has(v)||i.set(v,{name:v,totalClients:0,newMembers:0,converted:0,retained:0,totalLTV:0,trialsCompleted:0});const b=i.get(v);b.totalClients++,b.totalLTV+=t.ltv||0,String(t.isNew||"").includes("New")&&b.newMembers++,t.conversionStatus==="Converted"&&b.converted++,t.retentionStatus==="Retained"&&b.retained++,(t.visitsPostTrial||0)>0&&b.trialsCompleted++}),Array.from(i.values()).map(t=>L(V({},t),{conversionRate:t.newMembers>0?t.converted/t.newMembers*100:0,retentionRate:t.converted>0?t.retained/t.converted*100:0,avgLTV:t.totalClients>0?t.totalLTV/t.totalClients:0,trialConversionRate:t.trialsCompleted>0?t.converted/t.trialsCompleted*100:0}))},[d]),m=S.useMemo(()=>{const i=new Map;return d.forEach(t=>{const v=`${t.trainerName||"Unknown"} - ${t.firstVisitEntityName||"Unknown Class"}`;i.has(v)||i.set(v,{name:v,trainer:t.trainerName||"Unknown",className:t.firstVisitEntityName||"Unknown Class",totalClients:0,newMembers:0,converted:0,retained:0,totalLTV:0,trialsCompleted:0});const b=i.get(v);b.totalClients++,b.totalLTV+=t.ltv||0,String(t.isNew||"").includes("New")&&b.newMembers++,t.conversionStatus==="Converted"&&b.converted++,t.retentionStatus==="Retained"&&b.retained++,(t.visitsPostTrial||0)>0&&b.trialsCompleted++}),Array.from(i.values()).map(t=>L(V({},t),{conversionRate:t.newMembers>0?t.converted/t.newMembers*100:0,retentionRate:t.converted>0?t.retained/t.converted*100:0,avgLTV:t.totalClients>0?t.totalLTV/t.totalClients:0,trialConversionRate:t.trialsCompleted>0?t.converted/t.trialsCompleted*100:0}))},[d]),r=[{id:"trainer-conversion",label:"Trainer Conversion",icon:Q,type:"trainer",metric:"conversionRate"},{id:"trainer-retention",label:"Trainer Retention",icon:K,type:"trainer",metric:"retentionRate"},{id:"trainer-ltv",label:"Trainer LTV",icon:F,type:"trainer",metric:"avgLTV"},{id:"trainer-volume",label:"Trainer Volume",icon:Y,type:"trainer",metric:"totalClients"},{id:"location-conversion",label:"Location Conversion",icon:re,type:"location",metric:"conversionRate"},{id:"location-retention",label:"Location Retention",icon:J,type:"location",metric:"retentionRate"},{id:"location-ltv",label:"Location LTV",icon:I,type:"location",metric:"avgLTV"},{id:"location-volume",label:"Location Volume",icon:Y,type:"location",metric:"totalClients"},{id:"class-conversion",label:"Class Conversion",icon:_,type:"class",metric:"conversionRate"},{id:"class-retention",label:"Class Retention",icon:ve,type:"class",metric:"retentionRate"},{id:"class-ltv",label:"Class LTV",icon:F,type:"class",metric:"avgLTV"},{id:"class-volume",label:"Class Volume",icon:Y,type:"class",metric:"totalClients"},{id:"membership-conversion",label:"Membership Conversion",icon:J,type:"membership",metric:"conversionRate"},{id:"membership-retention",label:"Membership Retention",icon:K,type:"membership",metric:"retentionRate"},{id:"membership-ltv",label:"Membership LTV",icon:F,type:"membership",metric:"avgLTV"},{id:"membership-volume",label:"Membership Volume",icon:Y,type:"membership",metric:"totalClients"},{id:"hosted-conversion",label:"Hosted Class Conversion",icon:Q,type:"hosted",metric:"conversionRate"},{id:"hosted-retention",label:"Hosted Class Retention",icon:K,type:"hosted",metric:"retentionRate"},{id:"hosted-ltv",label:"Hosted Class LTV",icon:F,type:"hosted",metric:"avgLTV"},{id:"hosted-volume",label:"Hosted Class Volume",icon:Y,type:"hosted",metric:"totalClients"}],l=()=>{const i=r.find(C=>C.id===p);if(!i)return{top:[],bottom:[]};let t;switch(i.type){case"trainer":t=g;break;case"location":t=x;break;case"class":t=a;break;case"membership":t=o;break;case"hosted":t=m;break;default:t=g}const v=i.type==="hosted"?1:i.type==="trainer"?3:1,y=[...t.filter(C=>i.metric==="totalClients"?C.totalClients>=1:C.newMembers>=v)].sort((C,E)=>E[i.metric]-C[i.metric]);return{top:y.slice(0,5),bottom:y.slice(-5).reverse()}},{top:c,bottom:n}=l(),s=r.find(i=>i.id===p),h=(i,t)=>t==="avgLTV"?k(i):t==="totalClients"?w(i):`${i.toFixed(1)}%`,u=({title:i,data:t,isTop:v=!0})=>e.jsxs(M,{className:"group bg-white shadow-lg border-0 overflow-hidden hover:shadow-2xl transition-all duration-500 hover:scale-105",children:[e.jsxs(D,{className:`bg-gradient-to-r ${v?"from-emerald-500 to-teal-600":"from-orange-500 to-red-600"} text-white relative overflow-hidden`,children:[e.jsx("div",{className:"absolute top-0 right-0 w-20 h-20 transform translate-x-8 -translate-y-8 opacity-20",children:v?e.jsx(de,{className:"w-20 h-20"}):e.jsx(me,{className:"w-20 h-20"})}),e.jsxs($,{className:"flex items-center gap-3 relative z-10",children:[v?e.jsx(de,{className:"w-6 h-6"}):e.jsx(me,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold",children:i}),e.jsx("p",{className:"text-sm opacity-90 font-normal",children:v?"Top performers":"Needs attention"})]})]})]}),e.jsx(T,{className:"p-6 space-y-4",children:t.map((b,y)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-slate-50 to-slate-100 rounded-xl hover:from-slate-100 hover:to-slate-200 transition-all duration-300 group-hover:scale-105",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`flex items-center justify-center w-10 h-10 rounded-full font-bold text-sm transition-all duration-300 ${y===0&&v?"bg-gradient-to-r from-yellow-400 to-yellow-600 text-white shadow-lg":y===1&&v?"bg-gradient-to-r from-gray-300 to-gray-500 text-white shadow-lg":y===2&&v?"bg-gradient-to-r from-orange-400 to-orange-600 text-white shadow-lg":"bg-gradient-to-r from-slate-200 to-slate-300 text-slate-600"}`,children:y+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-900 truncate max-w-[140px]",title:b.name,children:b.name}),e.jsxs("p",{className:"text-sm text-slate-500",children:[w(b.totalClients)," clients",b.trainer&&e.jsxs("span",{className:"block text-xs",children:["by ",b.trainer]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(j,{className:`font-bold text-sm px-3 py-1 ${v?"bg-emerald-100 text-emerald-800 border border-emerald-200":"bg-orange-100 text-orange-800 border border-orange-200"}`,children:h(b[(s==null?void 0:s.metric)||"conversionRate"],(s==null?void 0:s.metric)||"conversionRate")}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:[k(b.avgLTV)," LTV"]})]})]},b.name))})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(M,{className:"bg-white shadow-lg border-0",children:[e.jsx(D,{children:e.jsxs($,{className:"flex items-center gap-3 text-slate-800",children:[e.jsx(Q,{className:"w-6 h-6 text-yellow-600"}),"Performance Rankings"]})}),e.jsx(T,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-3",children:r.map(i=>e.jsxs(P,{variant:p===i.id?"default":"ghost",size:"sm",onClick:()=>f(i.id),className:`flex flex-col items-center gap-2 h-auto py-3 px-2 transition-all duration-300 hover:scale-105 ${p===i.id?"bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg":"hover:bg-slate-100"}`,children:[e.jsx(i.icon,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium text-center leading-tight",children:i.label})]},i.id))})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(u,{title:`Top ${(s==null?void 0:s.label)||"Performance"}`,data:c,isTop:!0}),e.jsx(u,{title:`Bottom ${(s==null?void 0:s.label)||"Performance"}`,data:n,isTop:!1})]})]})},nt=({data:d})=>{const[p,f]=A.useState("monthly-trends"),g=[{id:"monthly-trends",label:"Monthly Trends",icon:I,type:"line"},{id:"conversion-funnel",label:"Conversion Funnel",icon:K,type:"bar"},{id:"location-performance",label:"Location Performance",icon:re,type:"bar"},{id:"trainer-performance",label:"Trainer Performance",icon:Y,type:"bar"},{id:"retention-analysis",label:"Retention Analysis",icon:De,type:"area"},{id:"ltv-distribution",label:"LTV Distribution",icon:F,type:"pie"}],x=S.useMemo(()=>{const c=new Map;return d.forEach(n=>{if(!n.firstVisitDate)return;let s;if(n.firstVisitDate.includes("/")){const[i,t,v]=n.firstVisitDate.split(" ")[0].split("/");s=new Date(parseInt(v),parseInt(t)-1,parseInt(i))}else s=new Date(n.firstVisitDate);if(isNaN(s.getTime()))return;const h=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}`;c.has(h)||c.set(h,{month:h,newMembers:0,converted:0,retained:0,revenue:0});const u=c.get(h);String(n.isNew||"").includes("New")&&u.newMembers++,n.conversionStatus==="Converted"&&u.converted++,n.retentionStatus==="Retained"&&u.retained++,u.revenue+=n.ltv||0}),Array.from(c.values()).sort((n,s)=>n.month.localeCompare(s.month)).map(n=>L(V({},n),{conversionRate:n.newMembers>0?n.converted/n.newMembers*100:0,retentionRate:n.converted>0?n.retained/n.converted*100:0}))},[d]),a=S.useMemo(()=>{const c=new Map;return d.forEach(n=>{const s=n.firstVisitLocation||n.homeLocation||"Unknown";c.has(s)||c.set(s,{location:s,newMembers:0,converted:0,retained:0,revenue:0});const h=c.get(s);String(n.isNew||"").includes("New")&&h.newMembers++,n.conversionStatus==="Converted"&&h.converted++,n.retentionStatus==="Retained"&&h.retained++,h.revenue+=n.ltv||0}),Array.from(c.values()).map(n=>L(V({},n),{conversionRate:n.newMembers>0?n.converted/n.newMembers*100:0,retentionRate:n.converted>0?n.retained/n.converted*100:0})).sort((n,s)=>s.revenue-n.revenue)},[d]),o=S.useMemo(()=>{const c=new Map;return d.forEach(n=>{const s=n.trainerName||"Unknown";c.has(s)||c.set(s,{trainer:s,newMembers:0,converted:0,retained:0,revenue:0});const h=c.get(s);String(n.isNew||"").includes("New")&&h.newMembers++,n.conversionStatus==="Converted"&&h.converted++,n.retentionStatus==="Retained"&&h.retained++,h.revenue+=n.ltv||0}),Array.from(c.values()).filter(n=>n.newMembers>=3).map(n=>L(V({},n),{conversionRate:n.newMembers>0?n.converted/n.newMembers*100:0,retentionRate:n.converted>0?n.retained/n.converted*100:0})).sort((n,s)=>s.conversionRate-n.conversionRate).slice(0,10)},[d]),m=S.useMemo(()=>{const c=[{name:"₹0-5K",min:0,max:5e3,count:0,color:"#ef4444"},{name:"₹5K-15K",min:5e3,max:15e3,count:0,color:"#f97316"},{name:"₹15K-30K",min:15e3,max:3e4,count:0,color:"#eab308"},{name:"₹30K-50K",min:3e4,max:5e4,count:0,color:"#22c55e"},{name:"₹50K+",min:5e4,max:1/0,count:0,color:"#3b82f6"}];return d.forEach(n=>{const s=n.ltv||0,h=c.find(u=>s>=u.min&&s<u.max);h&&h.count++}),c.filter(n=>n.count>0)},[d]),r=()=>{switch(g.find(c=>c.id===p),p){case"monthly-trends":return e.jsx(G,{width:"100%",height:400,children:e.jsxs(We,{data:x,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(O,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(z,{dataKey:"month",stroke:"#64748b",fontSize:12,tickFormatter:n=>{const[s,h]=n.split("-");return`${h}/${s.slice(2)}`}}),e.jsx(H,{stroke:"#64748b",fontSize:12}),e.jsx(U,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:(n,s)=>[s.includes("Rate")?`${n.toFixed(1)}%`:w(n),s]}),e.jsx(he,{type:"monotone",dataKey:"newMembers",stroke:"#3b82f6",strokeWidth:3,dot:{fill:"#3b82f6",strokeWidth:2,r:6},name:"New Members"}),e.jsx(he,{type:"monotone",dataKey:"conversionRate",stroke:"#22c55e",strokeWidth:3,dot:{fill:"#22c55e",strokeWidth:2,r:6},name:"Conversion Rate"})]})});case"conversion-funnel":const c=[{name:"New Members",value:d.filter(n=>String(n.isNew||"").includes("New")).length,color:"#3b82f6"},{name:"Trials Completed",value:d.filter(n=>(n.visitsPostTrial||0)>0).length,color:"#8b5cf6"},{name:"Converted",value:d.filter(n=>n.conversionStatus==="Converted").length,color:"#22c55e"},{name:"Retained",value:d.filter(n=>n.retentionStatus==="Retained").length,color:"#f97316"}];return e.jsx(G,{width:"100%",height:400,children:e.jsxs(te,{data:c,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(O,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(z,{dataKey:"name",stroke:"#64748b",fontSize:12}),e.jsx(H,{stroke:"#64748b",fontSize:12}),e.jsx(U,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:n=>[w(n),"Count"]}),e.jsx(W,{dataKey:"value",fill:"#3b82f6",radius:[4,4,0,0]})]})});case"location-performance":return e.jsx(G,{width:"100%",height:400,children:e.jsxs(te,{data:a,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(O,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(z,{dataKey:"location",stroke:"#64748b",fontSize:12,angle:-45,textAnchor:"end",height:80,tickFormatter:n=>n.length>15?`${n.slice(0,15)}...`:n}),e.jsx(H,{stroke:"#64748b",fontSize:12}),e.jsx(U,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:(n,s)=>[s.includes("Rate")?`${n.toFixed(1)}%`:w(n),s]}),e.jsx(W,{dataKey:"conversionRate",fill:"#22c55e",radius:[4,4,0,0],name:"Conversion Rate"})]})});case"trainer-performance":return e.jsx(G,{width:"100%",height:400,children:e.jsxs(te,{data:o,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(O,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(z,{dataKey:"trainer",stroke:"#64748b",fontSize:12,angle:-45,textAnchor:"end",height:80,tickFormatter:n=>n.length>10?`${n.slice(0,10)}...`:n}),e.jsx(H,{stroke:"#64748b",fontSize:12}),e.jsx(U,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:(n,s)=>[s.includes("Rate")?`${n.toFixed(1)}%`:w(n),s]}),e.jsx(W,{dataKey:"conversionRate",fill:"#8b5cf6",radius:[4,4,0,0],name:"Conversion Rate"}),e.jsx(W,{dataKey:"retentionRate",fill:"#06b6d4",radius:[4,4,0,0],name:"Retention Rate"})]})});case"retention-analysis":return e.jsx(G,{width:"100%",height:400,children:e.jsxs(Be,{data:x,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(O,{strokeDasharray:"3 3",stroke:"#e2e8f0"}),e.jsx(z,{dataKey:"month",stroke:"#64748b",fontSize:12,tickFormatter:n=>{const[s,h]=n.split("-");return`${h}/${s.slice(2)}`}}),e.jsx(H,{stroke:"#64748b",fontSize:12}),e.jsx(U,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:(n,s)=>[s.includes("Rate")?`${n.toFixed(1)}%`:w(n),s]}),e.jsx(_e,{type:"monotone",dataKey:"retentionRate",stackId:"1",stroke:"#f97316",fill:"url(#retentionGradient)",name:"Retention Rate"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"retentionGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#f97316",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#f97316",stopOpacity:.1})]})})]})});case"ltv-distribution":return e.jsx(G,{width:"100%",height:400,children:e.jsxs(Oe,{children:[e.jsx(ze,{data:m,cx:"50%",cy:"50%",outerRadius:150,fill:"#8884d8",dataKey:"count",label:({name:n,percent:s})=>`${n} (${(s*100).toFixed(1)}%)`,children:m.map((n,s)=>e.jsx(He,{fill:n.color},`cell-${s}`))}),e.jsx(U,{contentStyle:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},formatter:n=>[w(n),"Clients"]})]})});default:return null}},l=g.find(c=>c.id===p);return e.jsxs(M,{className:"bg-white shadow-lg border-0 overflow-hidden",children:[e.jsx(D,{className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white",children:e.jsxs($,{className:"flex items-center gap-3",children:[e.jsx(ne,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Analytics Dashboard"}),e.jsx("p",{className:"text-sm opacity-90",children:"Interactive charts and visualizations"})]})]})}),e.jsxs(T,{className:"p-6",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3 mb-6",children:g.map(c=>e.jsxs(P,{variant:p===c.id?"default":"ghost",size:"sm",onClick:()=>f(c.id),className:`flex flex-col items-center gap-2 h-auto py-4 px-3 transition-all duration-300 hover:scale-105 ${p===c.id?"bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg":"hover:bg-slate-100"}`,children:[e.jsx(c.icon,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-medium text-center leading-tight",children:c.label})]},c.id))}),e.jsxs("div",{className:"bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[l&&e.jsx(l.icon,{className:"w-5 h-5 text-slate-600"}),e.jsx("h4",{className:"text-lg font-semibold text-slate-800",children:l==null?void 0:l.label})]}),e.jsxs(j,{className:"bg-blue-100 text-blue-800",children:[d.length," records"]})]}),r()]})]})]})},at=({activeTable:d,onTableChange:p,dataLength:f})=>{const g=[{key:"monthonmonthbytype",label:"By Client Type",description:"Monthly breakdown by client type",icon:Y,gradient:"from-purple-500 to-pink-600"},{key:"monthonmonth",label:"Month on Month",description:"Monthly trends and comparisons",icon:_,gradient:"from-blue-500 to-indigo-600"},{key:"yearonyear",label:"Year on Year",description:"Annual performance comparison",icon:I,gradient:"from-green-500 to-emerald-600"},{key:"hostedclasses",label:"Hosted Classes",description:"Class performance metrics",icon:Y,gradient:"from-purple-500 to-violet-600"},{key:"memberships",label:"Membership Analysis",description:"Membership type breakdown",icon:ne,gradient:"from-orange-500 to-red-600"}];return e.jsxs("div",{className:"bg-gradient-to-r from-slate-50 to-gray-100 p-6 rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Data Analysis Tables"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Select a table to view detailed metrics"})]}),e.jsxs(j,{className:"bg-blue-100 text-blue-800 border-blue-200",children:[f," Records"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:g.map(x=>e.jsxs(P,{variant:d===x.key?"default":"outline",className:`h-auto p-4 flex-col items-start gap-2 transition-all duration-300 ${d===x.key?`bg-gradient-to-r ${x.gradient} text-white shadow-lg hover:shadow-xl`:"bg-white hover:bg-gray-50 border-gray-200 hover:border-gray-300"}`,onClick:()=>p(x.key),children:[e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsx(x.icon,{className:`w-5 h-5 ${d===x.key?"text-white":"text-gray-600"}`}),e.jsx("span",{className:`font-semibold text-sm ${d===x.key?"text-white":"text-gray-900"}`,children:x.label})]}),e.jsx("p",{className:`text-xs text-left w-full ${d===x.key?"text-white/90":"text-gray-500"}`,children:x.description})]},x.key))})]})},ot=({data:d,visitsSummary:p,onRowClick:f})=>{const g=S.useMemo(()=>{const r=(()=>{const c=[],n=new Date,s=n.getMonth(),h=n.getFullYear();for(let u=h;u>=2024;u--){const i=u===h?s:11,t=0;for(let v=i;v>=t;v--){const b=`${u}-${(v+1).toString().padStart(2,"0")}`,y=new Date(u,v).toLocaleDateString("en-US",{month:"short",year:"numeric"});c.push({key:b,name:y})}}return c})().reduce((c,n)=>(c[n.key]={month:n.name,sortKey:n.key,totalMembers:0,newMembers:0,converted:0,retained:0,totalLTV:0,conversionIntervals:[],visitsPostTrial:[],clients:[]},c),{});return d.forEach(c=>{const n=c.firstVisitDate;let s;if(n.includes("/")){const u=n.split(" ")[0].split("/");if(u.length===3){const[i,t,v]=u;s=new Date(parseInt(v),parseInt(t)-1,parseInt(i)),isNaN(s.getTime())&&(s=new Date(parseInt(v),parseInt(i)-1,parseInt(t)))}else s=new Date(n)}else s=new Date(n);if(isNaN(s.getTime()))return;const h=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}`;r[h]&&(r[h].totalMembers++,r[h].clients.push(c),(c.isNew||"").toLowerCase().includes("new")&&r[h].newMembers++,c.conversionStatus==="Converted"&&r[h].converted++,c.retentionStatus==="Retained"&&r[h].retained++,r[h].totalLTV+=c.ltv||0,c.conversionSpan&&c.conversionSpan>0&&r[h].conversionIntervals.push(c.conversionSpan),c.visitsPostTrial&&c.visitsPostTrial>0&&r[h].visitsPostTrial.push(c.visitsPostTrial))}),p&&Object.keys(r).forEach(c=>{const n=r[c],[s,h]=c.split("-"),t=`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(h)-1]} ${s}`;n.visits=p[t]||0}),Object.values(r).map(c=>L(V({},c),{trialsCompleted:c.visitsPostTrial.length,conversionRate:c.newMembers>0?c.converted/c.newMembers*100:0,retentionRate:c.newMembers>0?c.retained/c.newMembers*100:0,avgLTV:c.totalMembers>0?c.totalLTV/c.totalMembers:0,avgConversionInterval:c.conversionIntervals.length>0?c.conversionIntervals.reduce((n,s)=>n+s,0)/c.conversionIntervals.length:0,avgVisitsPostTrial:c.visitsPostTrial.length>0?c.visitsPostTrial.reduce((n,s)=>n+s,0)/c.visitsPostTrial.length:0})).sort((c,n)=>n.sortKey.localeCompare(c.sortKey))},[d]),x=[{key:"month",header:"Month",className:"font-semibold min-w-[100px]",render:o=>e.jsx("div",{className:"font-bold text-slate-800 bg-gradient-to-r from-blue-50 to-purple-50 px-3 py-2 rounded-lg",children:o})},{key:"totalMembers",header:"Trials",align:"center",render:o=>e.jsx("span",{className:"text-base font-bold text-blue-600",children:w(o)})},{key:"newMembers",header:"New Members",align:"center",render:o=>e.jsx("span",{className:"text-base font-bold text-green-600",children:w(o)})},{key:"retained",header:"Retained",align:"center",render:o=>e.jsx("span",{className:"text-base font-bold text-purple-600",children:w(o)})},{key:"retentionRate",header:"Retention %",align:"center",render:o=>e.jsxs("span",{className:`text-base font-bold ${o>70?"text-purple-600":o<40?"text-red-600":"text-slate-600"}`,children:[o.toFixed(1),"%"]})},{key:"converted",header:"Converted",align:"center",render:o=>e.jsx("span",{className:"text-base font-bold text-emerald-600",children:w(o)})},{key:"conversionRate",header:"Conversion %",align:"center",render:o=>e.jsxs("span",{className:`text-base font-bold ${o>25?"text-green-600":o<10?"text-red-600":"text-slate-600"}`,children:[o.toFixed(1),"%"]})},{key:"avgLTV",header:"Avg LTV",align:"right",render:o=>e.jsx("span",{className:"text-base font-bold text-teal-600",children:k(o)})},{key:"avgConversionInterval",header:"Avg Conv Days",align:"center",render:o=>e.jsx("span",{className:"text-base font-bold text-orange-600",children:Math.round(o)})},{key:"avgVisitsPostTrial",header:"Avg Visits",align:"center",render:o=>e.jsx("span",{className:"text-base font-bold text-blue-600",children:o.toFixed(1)})}],a={month:"TOTAL",totalMembers:g.reduce((o,m)=>o+m.totalMembers,0),newMembers:g.reduce((o,m)=>o+m.newMembers,0),converted:g.reduce((o,m)=>o+m.converted,0),conversionRate:0,retained:g.reduce((o,m)=>o+m.retained,0),retentionRate:0,totalLTV:g.reduce((o,m)=>o+m.totalLTV,0),avgLTV:g.reduce((o,m)=>o+m.totalLTV,0)/Math.max(g.reduce((o,m)=>o+m.totalMembers,0),1),avgConversionInterval:g.reduce((o,m)=>o+m.avgConversionInterval*m.totalMembers,0)/Math.max(g.reduce((o,m)=>o+m.totalMembers,0),1),avgVisitsPostTrial:g.reduce((o,m)=>o+m.avgVisitsPostTrial*m.totalMembers,0)/Math.max(g.reduce((o,m)=>o+m.totalMembers,0),1)};return a.conversionRate=a.newMembers>0?a.converted/a.newMembers*100:0,a.retentionRate=a.newMembers>0?a.retained/a.newMembers*100:0,e.jsx(pe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:e.jsxs(M,{className:"bg-white shadow-xl border-0 overflow-hidden hover:shadow-2xl transition-all duration-300",children:[e.jsx(D,{className:"border-b border-gray-100 bg-gradient-to-r from-blue-600 to-cyan-600 text-white",children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5"}),"Month-on-Month Client Conversion Analysis",e.jsxs(j,{variant:"secondary",className:"bg-white/20 text-white",children:[g.length," Months"]})]})}),e.jsx(T,{className:"p-0",children:e.jsx(X,{data:g,columns:x,headerGradient:"from-blue-600 to-cyan-600",showFooter:!0,footerData:a,maxHeight:"600px",onRowClick:f})})]})})},it=({data:d,checkins:p,visitsSummary:f,onRowClick:g})=>{const x=A.useMemo(()=>{if(!d||d.length===0)return[];[...new Set(d.map(l=>l.isNew||"Unknown").filter(Boolean))],p&&p.forEach(l=>{l.month&&l.year&&l.isNew&&(`${l.year}${String(new Date(Date.parse(l.month+" 1, "+l.year)).getMonth()+1).padStart(2,"0")}`,`${l.isNew}`)});const r={};return d.forEach(l=>{var b;const c=l.firstVisitDate;if(!c)return;let n;if(c.includes("/")){const y=c.split(" ")[0].split("/");if(y.length===3){const[C,E,ae]=y;n=new Date(parseInt(ae),parseInt(E)-1,parseInt(C)),isNaN(n.getTime())&&(n=new Date(parseInt(ae),parseInt(C)-1,parseInt(E)))}else n=new Date(c)}else n=new Date(c);if(isNaN(n.getTime()))return;const s=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}`,h=n.toLocaleDateString("en-US",{month:"short",year:"numeric"}),u=l.isNew||"Unknown",i=`${s}-${u}`;if(!r[i]){const y=`${(b=l.firstVisitDate)==null?void 0:b.split("T")[0].substring(0,7)}`,C=(f==null?void 0:f[y])||0;r[i]={month:h,sortKey:s,type:u,visits:C,totalTrials:0,newMembers:0,converted:0,retained:0,totalLTV:0,conversionIntervals:[],visitsPostTrial:[],clients:[]}}const t=r[i];t.totalTrials++,t.clients.push(l),(l.isNew||"").toLowerCase().includes("new")&&t.newMembers++,l.conversionStatus==="Converted"&&t.converted++,l.retentionStatus==="Retained"&&t.retained++,t.totalLTV+=l.ltv||0,l.conversionSpan&&l.conversionSpan>0&&t.conversionIntervals.push(l.conversionSpan),l.visitsPostTrial&&l.visitsPostTrial>0&&t.visitsPostTrial.push(l.visitsPostTrial)}),Object.values(r).sort((l,c)=>{const n=l.sortKey.localeCompare(c.sortKey);return n!==0?n:l.type.toLowerCase().includes("new")&&!c.type.toLowerCase().includes("new")?-1:!l.type.toLowerCase().includes("new")&&c.type.toLowerCase().includes("new")?1:l.type.localeCompare(c.type)})},[d,p]),a=A.useMemo(()=>x.map(r=>{const l=r.newMembers>0?r.converted/r.newMembers*100:0,c=r.newMembers>0?r.retained/r.newMembers*100:0,n=r.totalTrials>0?r.totalLTV/r.totalTrials:0,s=r.conversionIntervals.length>0?r.conversionIntervals.reduce((u,i)=>u+i,0)/r.conversionIntervals.length:0,h=r.visitsPostTrial.length>0?r.visitsPostTrial.reduce((u,i)=>u+i,0)/r.visitsPostTrial.length:0;return L(V({},r),{conversionRate:l,retentionRate:c,avgLTV:n,avgConversionDays:s,avgVisits:h})}),[x]),o=A.useMemo(()=>a.reduce((r,l)=>({visits:r.visits+(l.visits||0),totalTrials:r.totalTrials+l.totalTrials,newMembers:r.newMembers+l.newMembers,converted:r.converted+l.converted,retained:r.retained+l.retained,totalLTV:r.totalLTV+l.totalLTV,conversionIntervals:[...r.conversionIntervals,...l.conversionIntervals],visitsPostTrial:[...r.visitsPostTrial,...l.visitsPostTrial]}),{visits:0,totalTrials:0,newMembers:0,converted:0,retained:0,totalLTV:0,conversionIntervals:[],visitsPostTrial:[]}),[a]),m=A.useMemo(()=>{const r=o.newMembers>0?o.converted/o.newMembers*100:0,l=o.newMembers>0?o.retained/o.newMembers*100:0,c=o.totalTrials>0?o.totalLTV/o.totalTrials:0,n=o.conversionIntervals.length>0?o.conversionIntervals.reduce((h,u)=>h+u,0)/o.conversionIntervals.length:0,s=o.visitsPostTrial.length>0?o.visitsPostTrial.reduce((h,u)=>h+u,0)/o.visitsPostTrial.length:0;return{month:"TOTALS",type:"All Types",visits:o.visits,totalTrials:o.totalTrials,newMembers:o.newMembers,converted:o.converted,retained:o.retained,conversionRate:r,retentionRate:l,avgLTV:c,avgConversionDays:n,avgVisits:s}},[o]);return e.jsxs(M,{className:"bg-white shadow-lg border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx(D,{className:"bg-gradient-to-r from-indigo-700 to-purple-900 text-white pb-4",children:e.jsxs($,{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5"}),"Month-on-Month Analysis by Client Type",e.jsxs(j,{variant:"secondary",className:"ml-2 bg-white/20 text-white border-white/30",children:[Object.keys(x).length," Entries"]})]})}),e.jsx(T,{className:"p-0 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto max-h-[600px]",children:e.jsxs(be,{className:"w-full",children:[e.jsx(ge,{className:"sticky top-0 z-20",children:e.jsxs(B,{className:`border-b h-12 ${Ue("retention")}`,children:[e.jsx(R,{className:"font-bold text-white text-xs px-4 sticky left-0 z-10 min-w-[100px]",children:"Month"}),e.jsx(R,{className:"font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Type"}),e.jsx(R,{className:"font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Trials"}),e.jsx(R,{className:"font-bold text-white text-xs px-3 text-center min-w-[90px]",children:"New Members"}),e.jsx(R,{className:"font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Retained"}),e.jsx(R,{className:"font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Retention %"}),e.jsx(R,{className:"font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Converted"}),e.jsx(R,{className:"font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Conversion %"}),e.jsx(R,{className:"font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Avg LTV"}),e.jsx(R,{className:"font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Avg Conv Days"}),e.jsx(R,{className:"font-bold text-white text-xs px-3 text-center min-w-[80px]",children:"Avg Visits"})]})}),e.jsxs(ue,{children:[a.map((r,l)=>e.jsxs(B,{className:"hover:bg-gray-50 transition-colors cursor-pointer border-b border-gray-100 h-10",onClick:()=>g==null?void 0:g(r),children:[e.jsx(N,{className:"font-semibold text-gray-900 text-xs px-4 sticky left-0 bg-slate-100 z-10 border-r",children:r.month}),e.jsx(N,{className:"text-xs px-3 text-left",children:e.jsx(j,{variant:r.type.toLowerCase().includes("new")?"default":"secondary",className:"text-xs rounded-t rounded-b py-2 min-w-52 bg-indigo-900 text-white font-medium rounded-lg",children:r.type})}),e.jsx(N,{className:"text-xs px-3 text-center font-medium",children:w(r.totalTrials)}),e.jsx(N,{className:"text-xs px-3 text-center font-medium",children:w(r.newMembers)}),e.jsx(N,{className:"text-xs px-3 text-center font-medium",children:w(r.retained)}),e.jsx(N,{className:"text-xs px-3 text-center",children:e.jsxs("span",{className:`font-semibold ${r.retentionRate>=70?"text-green-600":r.retentionRate>=50?"text-orange-600":"text-red-600"}`,children:[r.retentionRate.toFixed(1),"%"]})}),e.jsx(N,{className:"text-xs px-3 text-center font-medium",children:w(r.converted)}),e.jsx(N,{className:"text-xs px-3 text-center",children:e.jsxs("span",{className:`font-semibold ${r.conversionRate>=50?"text-green-600":r.conversionRate>=30?"text-orange-600":"text-red-600"}`,children:[r.conversionRate.toFixed(1),"%"]})}),e.jsx(N,{className:"text-xs px-3 text-right font-semibold text-emerald-600",children:k(r.avgLTV)}),e.jsxs(N,{className:"text-xs px-3 text-center font-medium",children:[r.avgConversionDays.toFixed(0)," days"]}),e.jsx(N,{className:"text-xs px-3 text-center font-medium",children:r.avgVisits.toFixed(1)})]},`${r.month}-${r.type}`)),e.jsxs(B,{className:"border-t-4 border-gray-800 text-gray-900",children:[e.jsx(N,{className:"border-t-4 border-gray-800 text-gray-900",children:m.month}),e.jsx(N,{className:"text-xs px-3 text-center",children:e.jsx(j,{variant:"outline",className:"text-xs font-bold",children:m.type})}),e.jsx(N,{className:"text-xs px-3 text-center font-bold",children:w(m.totalTrials)}),e.jsx(N,{className:"text-xs px-3 text-center font-bold",children:w(m.newMembers)}),e.jsx(N,{className:"text-xs px-3 text-center font-bold",children:w(m.retained)}),e.jsx(N,{className:"text-xs px-3 text-center",children:e.jsxs("span",{className:`font-bold ${m.retentionRate>=70?"text-green-600":m.retentionRate>=50?"text-orange-600":"text-red-600"}`,children:[m.retentionRate.toFixed(1),"%"]})}),e.jsx(N,{className:"text-xs px-3 text-center font-bold",children:w(m.converted)}),e.jsx(N,{className:"text-xs px-3 text-center",children:e.jsxs("span",{className:`font-bold ${m.conversionRate>=50?"text-green-600":m.conversionRate>=30?"text-orange-600":"text-red-600"}`,children:[m.conversionRate.toFixed(1),"%"]})}),e.jsx(N,{className:"text-xs px-3 text-right font-bold text-emerald-600",children:k(m.avgLTV)}),e.jsxs(N,{className:"text-xs px-3 text-center font-bold",children:[m.avgConversionDays.toFixed(0)," days"]}),e.jsx(N,{className:"text-xs px-3 text-center font-bold",children:m.avgVisits.toFixed(1)})]})]})]})})})]})},lt=({data:d,visitsSummary:p,onRowClick:f})=>{const g=S.useMemo(()=>{const r=new Date().getFullYear(),l=r-1,n=Array.from({length:12},(s,h)=>{const u=h+1,i=new Date(2024,h).toLocaleDateString("en-US",{month:"short"});return{monthName:i,monthNumber:u,key:i}}).reduce((s,h)=>(s[h.key]={month:h.monthName,sortOrder:h.monthNumber,currentYear:{totalMembers:0,visits:0,newMembers:0,converted:0,retained:0,totalLTV:0,clients:[]},previousYear:{totalMembers:0,visits:0,newMembers:0,converted:0,retained:0,totalLTV:0,clients:[]}},s),{});return d.forEach(s=>{const h=s.firstVisitDate;let u;if(h.includes("/")){const v=h.split(" ")[0].split("/");if(v.length===3){const[b,y,C]=v;u=new Date(parseInt(C),parseInt(y)-1,parseInt(b)),isNaN(u.getTime())&&(u=new Date(parseInt(C),parseInt(b)-1,parseInt(y)))}else u=new Date(h)}else u=new Date(h);if(isNaN(u.getTime()))return;const i=u.getFullYear();u.getMonth()+1;const t=u.toLocaleDateString("en-US",{month:"short"});if((i===r||i===l)&&n[t]){const v=i===r?n[t].currentYear:n[t].previousYear;v.totalMembers++,v.clients.push(s),(s.isNew||"").toLowerCase().includes("new")&&v.newMembers++,s.conversionStatus==="Converted"&&v.converted++,s.retentionStatus==="Retained"&&v.retained++,v.totalLTV+=s.ltv||0}}),p&&Object.values(n).forEach(s=>{const h=new Date().getFullYear(),u=h-1,i=`${s.month} ${h}`,t=`${s.month} ${u}`;s.currentYear.visits=p[i]||0,s.previousYear.visits=p[t]||0}),Object.values(n).map(s=>{const h=s.currentYear.newMembers>0?s.currentYear.converted/s.currentYear.newMembers*100:0,u=s.previousYear.newMembers>0?s.previousYear.converted/s.previousYear.newMembers*100:0,i=s.currentYear.newMembers>0?s.currentYear.retained/s.currentYear.newMembers*100:0,t=s.previousYear.newMembers>0?s.previousYear.retained/s.previousYear.newMembers*100:0,v=s.currentYear.totalMembers>0?s.currentYear.totalLTV/s.currentYear.totalMembers:0,b=s.previousYear.totalMembers>0?s.previousYear.totalLTV/s.previousYear.totalMembers:0;return{month:s.month,sortOrder:s.sortOrder,currentVisits:s.currentYear.visits,previousVisits:s.previousYear.visits,visitsGrowth:s.previousYear.visits>0?(s.currentYear.visits-s.previousYear.visits)/s.previousYear.visits*100:0,currentTotalMembers:s.currentYear.totalMembers,previousTotalMembers:s.previousYear.totalMembers,totalMembersGrowth:s.previousYear.totalMembers>0?(s.currentYear.totalMembers-s.previousYear.totalMembers)/s.previousYear.totalMembers*100:0,currentNewMembers:s.currentYear.newMembers,previousNewMembers:s.previousYear.newMembers,newMembersGrowth:s.previousYear.newMembers>0?(s.currentYear.newMembers-s.previousYear.newMembers)/s.previousYear.newMembers*100:0,currentConverted:s.currentYear.converted,previousConverted:s.previousYear.converted,currentConversionRate:h,previousConversionRate:u,conversionRateGrowth:u>0?h-u:0,currentRetained:s.currentYear.retained,previousRetained:s.previousYear.retained,currentRetentionRate:i,previousRetentionRate:t,retentionRateGrowth:t>0?i-t:0,currentTotalLTV:s.currentYear.totalLTV,previousTotalLTV:s.previousYear.totalLTV,currentAvgLTV:v,previousAvgLTV:b,avgLTVGrowth:b>0?(v-b)/b*100:0,currentClients:s.currentYear.clients,previousClients:s.previousYear.clients}}).sort((s,h)=>s.sortOrder-h.sortOrder)},[d]),x=[{key:"month",header:"Month",className:"font-semibold min-w-[80px]"},{key:"currentTotalMembers",header:`${new Date().getFullYear()} Trials`,align:"center",render:r=>e.jsx("span",{className:"text-base font-bold text-blue-600",children:w(r)})},{key:"previousTotalMembers",header:`${new Date().getFullYear()-1} Trials`,align:"center",render:r=>e.jsx("span",{className:"text-base font-bold text-slate-600",children:w(r)})},{key:"totalMembersGrowth",header:"Trials Growth %",align:"center",render:r=>e.jsxs("span",{className:`text-base font-bold ${(r||0)>0?"text-green-600":(r||0)<0?"text-red-600":"text-slate-600"}`,children:[(r||0)>0?"+":"",(r||0).toFixed(1),"%"]})},{key:"currentNewMembers",header:`${new Date().getFullYear()} New Members`,align:"center",render:r=>e.jsx("span",{className:"text-base font-bold text-green-600",children:w(r)})},{key:"previousNewMembers",header:`${new Date().getFullYear()-1} New Members`,align:"center",render:r=>e.jsx("span",{className:"text-base font-bold text-slate-600",children:w(r)})},{key:"newMembersGrowth",header:"New Members Growth %",align:"center",render:r=>e.jsxs("span",{className:`text-base font-bold ${(r||0)>0?"text-green-600":(r||0)<0?"text-red-600":"text-slate-600"}`,children:[(r||0)>0?"+":"",(r||0).toFixed(1),"%"]})},{key:"currentConversionRate",header:`${new Date().getFullYear()} Conversion %`,align:"center",render:r=>e.jsxs("span",{className:"text-base font-bold text-green-600",children:[(r||0).toFixed(1),"%"]})},{key:"previousConversionRate",header:`${new Date().getFullYear()-1} Conversion %`,align:"center",render:r=>e.jsxs("span",{className:"text-base font-bold text-slate-600",children:[(r||0).toFixed(1),"%"]})},{key:"conversionRateGrowth",header:"Conv. Growth",align:"center",render:r=>e.jsxs("span",{className:`text-base font-bold ${(r||0)>0?"text-green-600":(r||0)<0?"text-red-600":"text-slate-600"}`,children:[(r||0)>0?"+":"",(r||0).toFixed(1),"pp"]})},{key:"currentAvgLTV",header:`${new Date().getFullYear()} Avg LTV`,align:"right",render:r=>e.jsx("span",{className:"text-base font-bold text-purple-600",children:k(r||0)})},{key:"previousAvgLTV",header:`${new Date().getFullYear()-1} Avg LTV`,align:"right",render:r=>e.jsx("span",{className:"text-base font-bold text-slate-600",children:k(r||0)})},{key:"avgLTVGrowth",header:"LTV Growth %",align:"center",render:r=>e.jsxs("span",{className:`text-base font-bold ${(r||0)>0?"text-green-600":(r||0)<0?"text-red-600":"text-slate-600"}`,children:[(r||0)>0?"+":"",(r||0).toFixed(1),"%"]})}],a={month:"TOTAL",currentTotalMembers:g.reduce((r,l)=>r+(l.currentTotalMembers||0),0),previousTotalMembers:g.reduce((r,l)=>r+(l.previousTotalMembers||0),0),totalMembersGrowth:0,currentNewMembers:g.reduce((r,l)=>r+(l.currentNewMembers||0),0),previousNewMembers:g.reduce((r,l)=>r+(l.previousNewMembers||0),0),newMembersGrowth:0,currentConversionRate:0,previousConversionRate:0,conversionRateGrowth:0,currentAvgLTV:g.reduce((r,l)=>r+(l.currentTotalLTV||0),0)/Math.max(g.reduce((r,l)=>r+(l.currentTotalMembers||0),0),1),previousAvgLTV:g.reduce((r,l)=>r+(l.previousTotalLTV||0),0)/Math.max(g.reduce((r,l)=>r+(l.previousTotalMembers||0),0),1),avgLTVGrowth:0},o=g.reduce((r,l)=>r+(l.currentConverted||0),0),m=g.reduce((r,l)=>r+(l.previousConverted||0),0);return a.totalMembersGrowth=a.previousTotalMembers>0?(a.currentTotalMembers-a.previousTotalMembers)/a.previousTotalMembers*100:0,a.newMembersGrowth=a.previousNewMembers>0?(a.currentNewMembers-a.previousNewMembers)/a.previousNewMembers*100:0,a.currentConversionRate=a.currentNewMembers>0?o/a.currentNewMembers*100:0,a.previousConversionRate=a.previousNewMembers>0?m/a.previousNewMembers*100:0,a.conversionRateGrowth=a.previousConversionRate>0?a.currentConversionRate-a.previousConversionRate:0,a.avgLTVGrowth=a.previousAvgLTV>0?(a.currentAvgLTV-a.previousAvgLTV)/a.previousAvgLTV*100:0,e.jsxs(M,{className:"bg-white shadow-lg border-0",children:[e.jsx(D,{className:"border-b border-gray-100 bg-gradient-to-r from-emerald-600 to-teal-600 text-white",children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5"}),"Year-on-Year Client Conversion Comparison",e.jsxs(j,{variant:"secondary",className:"bg-white/20 text-white",children:[new Date().getFullYear()," vs ",new Date().getFullYear()-1]})]})}),e.jsx(T,{className:"p-0",children:e.jsx(X,{data:g,columns:x,headerGradient:"from-emerald-600 to-teal-600",showFooter:!0,footerData:a,maxHeight:"600px",onRowClick:f})})]})},ct=({data:d})=>{const p=S.useMemo(()=>{const x=d.reduce((a,o)=>{const m=o.membershipUsed||"No Membership";return a[m]||(a[m]={membershipType:m,totalMembers:0,newMembers:0,converted:0,retained:0,totalLTV:0,totalVisits:0,conversionSpans:[]}),a[m].totalMembers++,(o.isNew||"").includes("New")&&a[m].newMembers++,o.conversionStatus==="Converted"&&a[m].converted++,o.retentionStatus==="Retained"&&a[m].retained++,a[m].totalLTV+=o.ltv||0,a[m].totalVisits+=o.visitsPostTrial||0,o.conversionSpan&&o.conversionSpan>0&&a[m].conversionSpans.push(o.conversionSpan),a},{});return Object.values(x).map(a=>L(V({},a),{conversionRate:a.newMembers>0?a.converted/a.newMembers*100:0,retentionRate:a.totalMembers>0?a.retained/a.totalMembers*100:0,avgLTV:a.totalMembers>0?a.totalLTV/a.totalMembers:0,avgVisits:a.totalMembers>0?a.totalVisits/a.totalMembers:0,avgConversionSpan:a.conversionSpans.length>0?a.conversionSpans.reduce((o,m)=>o+m,0)/a.conversionSpans.length:0})).filter(a=>a.totalMembers>0).sort((a,o)=>o.totalMembers-a.totalMembers)},[d]),f=[{key:"membershipType",header:"Membership Type",className:"font-medium text-xs min-w-[200px]",render:x=>e.jsx("span",{className:"text-xs font-medium text-gray-800 truncate max-w-[200px]",title:x,children:x.length>25?`${x.substring(0,25)}...`:x})},{key:"totalMembers",header:"Trials",align:"center",render:x=>e.jsx("span",{className:"text-xs font-semibold text-blue-600",children:w(x)})},{key:"newMembers",header:"New Members",align:"center",render:x=>e.jsx("span",{className:"text-xs font-semibold text-green-600",children:w(x)})},{key:"retained",header:"Retained",align:"center",render:x=>e.jsx("span",{className:"text-xs font-semibold text-purple-600",children:w(x)})},{key:"retentionRate",header:"Retention %",align:"center",render:x=>e.jsxs("span",{className:"text-xs font-semibold",children:[x.toFixed(1),"%"]})},{key:"converted",header:"Converted",align:"center",render:x=>e.jsx("span",{className:"text-xs font-semibold text-green-600",children:w(x)})},{key:"conversionRate",header:"Conversion %",align:"center",render:x=>e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[x>50?e.jsx(I,{className:"w-3 h-3 text-green-500"}):x<20?e.jsx(se,{className:"w-3 h-3 text-red-500"}):null,e.jsxs("span",{className:`text-xs font-semibold ${x>50?"text-green-600":x<20?"text-red-600":"text-gray-600"}`,children:[x.toFixed(1),"%"]})]})},{key:"avgLTV",header:"Avg LTV",align:"right",render:x=>e.jsx("span",{className:"text-xs font-semibold",children:k(x)})}],g={membershipType:"TOTAL",totalMembers:p.reduce((x,a)=>x+a.totalMembers,0),newMembers:p.reduce((x,a)=>x+a.newMembers,0),converted:p.reduce((x,a)=>x+a.converted,0),conversionRate:0,retained:p.reduce((x,a)=>x+a.retained,0),retentionRate:0,avgLTV:p.reduce((x,a)=>x+a.totalLTV,0)/Math.max(p.reduce((x,a)=>x+a.totalMembers,0),1)};return g.conversionRate=g.newMembers>0?g.converted/g.newMembers*100:0,g.retentionRate=g.totalMembers>0?g.retained/g.totalMembers*100:0,e.jsxs(M,{className:"bg-white shadow-lg border-0",children:[e.jsx(D,{className:"border-b border-gray-100 bg-gradient-to-r from-purple-600 to-indigo-600 text-white",children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5"}),"Membership Type Performance Analysis",e.jsxs(j,{variant:"secondary",className:"bg-white/20 text-white",children:[p.length," Types"]})]})}),e.jsx(T,{className:"p-0",children:e.jsx(X,{data:p,columns:f,headerGradient:"from-purple-600 to-indigo-600",showFooter:!0,footerData:g,maxHeight:"500px"})})]})},dt=({data:d,onRowClick:p})=>{if(!d||d.length===0)return e.jsxs(M,{className:"bg-white shadow-xl border-0 overflow-hidden",children:[e.jsx(D,{className:"border-b border-gray-100 bg-gradient-to-r from-purple-600 to-pink-600 text-white",children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5"}),"Hosted Classes Performance Analysis",e.jsx(j,{variant:"secondary",className:"bg-white/20 text-white",children:"0 Classes"})]})}),e.jsx(T,{className:"p-6",children:e.jsx("p",{className:"text-gray-500 text-center",children:"No class data available for analysis."})})]});const f=S.useMemo(()=>{const o=d.filter(m=>{if(!m||!m.firstVisitEntityName)return!1;const r=m.firstVisitEntityName.toLowerCase(),l=r.includes("host")||r.includes("hosted")||r.includes("sign up"),c=/\bx\b/.test(r);return l||c}).reduce((m,r)=>{if(!r)return m;const l=r.firstVisitEntityName||"Unknown Class";let c="Unknown";if(r.firstVisitDate)try{let s;if(r.firstVisitDate.includes("/")){const h=r.firstVisitDate.split(",")[0].trim(),[u,i,t]=h.split("/");s=new Date(parseInt(t),parseInt(i)-1,parseInt(u))}else s=new Date(r.firstVisitDate);isNaN(s.getTime())||(c=s.toLocaleDateString("en-US",{month:"short",year:"numeric"}))}catch(s){}const n=`${c}-${l}`;if(m[n]||(m[n]={month:c,className:l,totalMembers:0,newMembers:0,converted:0,retained:0,totalLTV:0,conversionIntervals:[],clients:[]}),m[n].totalMembers++,m[n].clients.push(r),(r.isNew||"").toLowerCase().includes("new")&&m[n].newMembers++,r.conversionStatus==="Converted"&&m[n].converted++,r.retentionStatus==="Retained"&&m[n].retained++,m[n].totalLTV+=r.ltv||0,r.firstPurchase&&r.firstVisitDate)try{const s=new Date(r.firstVisitDate),h=new Date(r.firstPurchase);if(!isNaN(s.getTime())&&!isNaN(h.getTime())){const u=Math.ceil((h.getTime()-s.getTime())/864e5);u>=0&&m[n].conversionIntervals.push(u)}}catch(s){}return m},{});return Object.values(o).map(m=>L(V({},m),{conversionRate:m.newMembers>0?m.converted/m.newMembers*100:0,retentionRate:m.converted>0?m.retained/m.converted*100:0,avgLTV:m.totalMembers>0?m.totalLTV/m.totalMembers:0,avgConversionInterval:m.conversionIntervals.length>0?m.conversionIntervals.reduce((r,l)=>r+l,0)/m.conversionIntervals.length:0})).sort((m,r)=>r.totalMembers-m.totalMembers)},[d]),g=[{key:"month",header:"Month",className:"font-semibold min-w-[100px]",render:a=>e.jsx("div",{className:"font-bold text-slate-800 bg-gradient-to-r from-purple-50 to-pink-50 px-3 py-2 rounded-lg",children:a})},{key:"className",header:"Class Name",className:"font-medium min-w-[200px]",render:a=>e.jsx("div",{className:"font-semibold text-slate-700 truncate",title:a,children:a.length>30?`${a.substring(0,30)}...`:a})},{key:"totalMembers",header:"Trials",align:"center",render:a=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:w(a)}),e.jsx("div",{className:"text-xs text-slate-500",children:"trials"})]})},{key:"newMembers",header:"New Members",align:"center",render:a=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:w(a)}),e.jsx("div",{className:"text-xs text-slate-500",children:"new"})]})},{key:"retained",header:"Retained",align:"center",render:a=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-purple-600",children:w(a)}),e.jsx("div",{className:"text-xs text-slate-500",children:"retained"})]})},{key:"retentionRate",header:"Retention %",align:"center",render:a=>{const o=a!=null?a:0;return e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[o>70?e.jsx(I,{className:"w-3 h-3 text-green-500"}):o<50?e.jsx(se,{className:"w-3 h-3 text-red-500"}):null,e.jsxs(j,{className:`font-bold ${o>70?"bg-green-100 text-green-800":o<50?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:[o.toFixed(1),"%"]})]})}},{key:"converted",header:"Converted",align:"center",render:a=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:w(a)}),e.jsx("div",{className:"text-xs text-slate-500",children:"converted"})]})},{key:"conversionRate",header:"Conversion %",align:"center",render:a=>{const o=a!=null?a:0;return e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[o>25?e.jsx(I,{className:"w-3 h-3 text-green-500"}):o<10?e.jsx(se,{className:"w-3 h-3 text-red-500"}):null,e.jsxs(j,{className:`font-bold ${o>25?"bg-green-100 text-green-800":o<10?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:[o.toFixed(1),"%"]})]})}},{key:"avgLTV",header:"Avg LTV",align:"right",render:a=>e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg font-bold text-emerald-600",children:k(a)}),e.jsx("div",{className:"text-xs text-slate-500",children:"per client"})]})},{key:"avgConversionInterval",header:"Avg Conv Days",align:"center",render:a=>{const o=a!=null?a:0;return e.jsxs(j,{variant:"outline",className:"bg-orange-50 text-orange-700 border-orange-200 font-bold",children:[Math.round(o)," days"]})}}],x={month:"TOTAL",className:`${f.length} Classes`,totalMembers:f.reduce((a,o)=>a+o.totalMembers,0),newMembers:f.reduce((a,o)=>a+o.newMembers,0),converted:f.reduce((a,o)=>a+o.converted,0),conversionRate:0,retained:f.reduce((a,o)=>a+o.retained,0),avgLTV:f.reduce((a,o)=>a+o.totalLTV,0)/Math.max(f.reduce((a,o)=>a+o.totalMembers,0),1),avgConversionInterval:f.reduce((a,o)=>a+o.avgConversionInterval*o.totalMembers,0)/Math.max(f.reduce((a,o)=>a+o.totalMembers,0),1)};return x.conversionRate=x.newMembers>0?x.converted/x.newMembers*100:0,e.jsx(pe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:e.jsxs(M,{className:"bg-white shadow-xl border-0 overflow-hidden hover:shadow-2xl transition-all duration-300",children:[e.jsx(D,{className:"border-b border-gray-100 bg-gradient-to-r from-purple-600 to-pink-600 text-white",children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5"}),"Hosted Classes Performance Analysis",e.jsxs(j,{variant:"secondary",className:"bg-white/20 text-white",children:[f.length," Classes"]})]})}),e.jsx(T,{className:"p-0",children:e.jsx(X,{data:f,columns:g,headerGradient:"from-purple-600 to-pink-600",showFooter:!0,footerData:x,maxHeight:"600px",onRowClick:p})})]})})},mt=({isOpen:d,onClose:p,title:f,data:g,type:x})=>{if(!g)return null;const a=S.useMemo(()=>g?x==="metric"&&g.clients||(x==="month"||x==="year")&&g.clients?g.clients:Array.isArray(g)?g:[]:[],[g,x]),o=S.useMemo(()=>{const l=a.length,c=a.filter(t=>(t.isNew||"").toLowerCase().includes("new")).length,n=a.filter(t=>(t.conversionStatus||"").toLowerCase().includes("converted")).length,s=a.filter(t=>(t.retentionStatus||"").toLowerCase().includes("retained")).length,h=a.reduce((t,v)=>t+(v.ltv||0),0),u=a.filter(t=>t.conversionSpan>0).reduce((t,v)=>t+(v.conversionSpan||0),0),i=a.filter(t=>t.conversionSpan>0).length;return{totalMembers:l,newMembers:c,convertedMembers:n,retainedMembers:s,conversionRate:c>0?n/c*100:0,retentionRate:l>0?s/l*100:0,avgLTV:l>0?h/l:0,totalLTV:h,avgConversionTime:i>0?u/i:0}},[a]),m=()=>e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(M,{className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white border-0 shadow-lg",children:e.jsxs(T,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Y,{className:"w-5 h-5 text-blue-100"}),e.jsx(j,{className:"bg-white/20 text-white border-0",children:"Total"})]}),e.jsx("div",{className:"text-2xl font-bold",children:w(o.totalMembers)}),e.jsx("div",{className:"text-blue-100 text-sm",children:"Total Members"})]})}),e.jsx(M,{className:"bg-gradient-to-br from-green-500 to-green-600 text-white border-0 shadow-lg",children:e.jsxs(T,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(K,{className:"w-5 h-5 text-green-100"}),e.jsx(j,{className:"bg-white/20 text-white border-0",children:"New"})]}),e.jsx("div",{className:"text-2xl font-bold",children:w(o.newMembers)}),e.jsx("div",{className:"text-green-100 text-sm",children:"New Members"})]})}),e.jsx(M,{className:"bg-gradient-to-br from-purple-500 to-purple-600 text-white border-0 shadow-lg",children:e.jsxs(T,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(I,{className:"w-5 h-5 text-purple-100"}),e.jsx(j,{className:"bg-white/20 text-white border-0",children:"Rate"})]}),e.jsxs("div",{className:"text-2xl font-bold",children:[o.conversionRate.toFixed(1),"%"]}),e.jsx("div",{className:"text-purple-100 text-sm",children:"Conversion Rate"})]})}),e.jsx(M,{className:"bg-gradient-to-br from-orange-500 to-orange-600 text-white border-0 shadow-lg",children:e.jsxs(T,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(F,{className:"w-5 h-5 text-orange-100"}),e.jsx(j,{className:"bg-white/20 text-white border-0",children:"LTV"})]}),e.jsx("div",{className:"text-2xl font-bold",children:k(o.avgLTV)}),e.jsx("div",{className:"text-orange-100 text-sm",children:"Avg LTV"})]})})]}),r=()=>a.length===0?e.jsx(M,{children:e.jsxs(T,{className:"p-8 text-center",children:[e.jsx(Y,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No client data available for this selection."})]})}):e.jsxs(M,{children:[e.jsx(D,{children:e.jsxs($,{className:"text-lg",children:["Client Details (",w(a.length)," members)"]})}),e.jsx(T,{className:"p-0",children:e.jsxs("div",{className:"max-h-96 overflow-y-auto",children:[e.jsxs(be,{children:[e.jsx(ge,{className:"sticky top-0 bg-gray-50 z-10",children:e.jsxs(B,{children:[e.jsx(R,{className:"font-semibold text-gray-900 text-xs px-3",children:"Name"}),e.jsx(R,{className:"font-semibold text-gray-900 text-xs px-3",children:"Email"}),e.jsx(R,{className:"font-semibold text-gray-900 text-xs px-3 text-center",children:"Type"}),e.jsx(R,{className:"font-semibold text-gray-900 text-xs px-3 text-center",children:"Status"}),e.jsx(R,{className:"font-semibold text-gray-900 text-xs px-3 text-center",children:"Conversion"}),e.jsx(R,{className:"font-semibold text-gray-900 text-xs px-3 text-right",children:"LTV"}),e.jsx(R,{className:"font-semibold text-gray-900 text-xs px-3 text-center",children:"Location"})]})}),e.jsx(ue,{children:a.slice(0,50).map((l,c)=>{var n,s,h,u,i;return e.jsxs(B,{className:"hover:bg-gray-50 transition-colors h-10",children:[e.jsxs(N,{className:"text-xs px-3 font-medium",children:[l.firstName," ",l.lastName]}),e.jsx(N,{className:"text-xs px-3 text-gray-600 truncate max-w-[150px]",title:l.email,children:l.email}),e.jsx(N,{className:"text-xs px-3 text-left rounded-t rounded-none",children:e.jsx(j,{variant:(n=l.isNew)!=null&&n.toLowerCase().includes("new")?"default":"secondary",className:"text-xs rounded min-w-44",children:l.isNew||"Unknown"})}),e.jsx(N,{className:"text-xs px-3 text-center",children:e.jsx(j,{variant:(s=l.retentionStatus)!=null&&s.toLowerCase().includes("retained")?"default":"secondary",className:`text-xs ${(h=l.retentionStatus)!=null&&h.toLowerCase().includes("retained")?"bg-purple-100 text-purple-800":""}`,children:l.retentionStatus||"Pending"})}),e.jsx(N,{className:"text-xs px-3 text-center",children:e.jsx(j,{variant:(u=l.conversionStatus)!=null&&u.toLowerCase().includes("converted")?"default":"secondary",className:`text-xs ${(i=l.conversionStatus)!=null&&i.toLowerCase().includes("converted")?"bg-green-100 text-green-800":""}`,children:l.conversionStatus||"Pending"})}),e.jsx(N,{className:"text-xs px-3 text-right font-semibold text-emerald-600",children:k(l.ltv||0)}),e.jsx(N,{className:"text-xs px-3 text-center text-gray-600 truncate max-w-[120px]",title:l.firstVisitLocation,children:l.firstVisitLocation||"Unknown"})]},c)})})]}),a.length>50&&e.jsxs("div",{className:"p-4 text-center text-sm text-gray-600 bg-gray-50 border-t",children:["Showing 50 of ",a.length," clients. Drill down shows only targeted data for this selection."]})]})})]});return e.jsx(Fe,{open:d,onOpenChange:p,children:e.jsxs(Pe,{className:"max-w-7xl max-h-[95vh] overflow-y-auto bg-gradient-to-br from-white via-slate-50/30 to-white border-0 shadow-2xl",children:[e.jsx(Ie,{className:"pb-6 border-b border-slate-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(Ke,{className:"text-3xl font-bold bg-gradient-to-r from-slate-800 via-blue-600 to-purple-600 bg-clip-text text-transparent",children:[f," - Detailed Analysis"]}),e.jsx("p",{className:"text-slate-600 mt-2 text-lg",children:"Targeted client conversion and retention analysis"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"bg-blue-100 text-blue-800 border-0",children:x==="month"?"Monthly":x==="year"?"Yearly":x==="metric"?"Metric Analysis":"Analytics"}),e.jsx(P,{variant:"outline",onClick:p,children:e.jsx($e,{className:"w-4 h-4"})})]})]})}),e.jsxs("div",{className:"pt-6 space-y-8",children:[m(),e.jsxs(Ee,{defaultValue:"overview",className:"w-full",children:[e.jsxs(Ge,{className:"grid w-full grid-cols-3 bg-slate-100",children:[e.jsxs(q,{value:"overview",className:"gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),"Overview"]}),e.jsxs(q,{value:"clients",className:"gap-2",children:[e.jsx(Y,{className:"w-4 h-4"}),"Client Details"]}),e.jsxs(q,{value:"insights",className:"gap-2",children:[e.jsx(Ye,{className:"w-4 h-4"}),"Insights"]})]}),e.jsx(ee,{value:"overview",className:"space-y-6",children:e.jsxs(M,{className:"bg-gradient-to-br from-indigo-50 to-indigo-100 border-indigo-200",children:[e.jsx(D,{children:e.jsx($,{className:"text-indigo-800",children:"Summary Statistics"})}),e.jsx(T,{children:e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-indigo-600",children:w(o.totalMembers)}),e.jsx("div",{className:"text-sm text-indigo-600",children:"Total Members"})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:w(o.convertedMembers)}),e.jsx("div",{className:"text-sm text-green-600",children:"Converted"})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[o.conversionRate.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-purple-600",children:"Conversion Rate"})]}),e.jsxs("div",{className:"text-center p-4 bg-white rounded-lg border",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:o.avgConversionTime>0?`${o.avgConversionTime.toFixed(0)} days`:"N/A"}),e.jsx("div",{className:"text-sm text-orange-600",children:"Avg Conv. Time"})]})]})})]})}),e.jsx(ee,{value:"clients",children:r()}),e.jsx(ee,{value:"insights",children:e.jsxs(M,{className:"bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx(D,{children:e.jsx($,{className:"text-purple-800",children:"AI-Powered Insights"})}),e.jsx(T,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-white rounded-lg border-l-4 border-purple-400",children:[e.jsx("h4",{className:"font-medium text-purple-800 mb-2",children:"Key Metrics"}),e.jsxs("ul",{className:"text-sm text-purple-600 space-y-1",children:[e.jsxs("li",{children:["• Total Revenue: ",k(o.totalLTV)]}),e.jsxs("li",{children:["• Conversion Rate: ",o.conversionRate.toFixed(1),"%"]}),e.jsxs("li",{children:["• Retention Rate: ",o.retentionRate.toFixed(1),"%"]}),e.jsxs("li",{children:["• Average Customer Value: ",k(o.avgLTV)]})]})]}),e.jsxs("div",{className:"p-4 bg-white rounded-lg border-l-4 border-orange-400",children:[e.jsx("h4",{className:"font-medium text-orange-800 mb-2",children:"Performance Analysis"}),e.jsxs("ul",{className:"text-sm text-orange-600 space-y-1",children:[e.jsxs("li",{children:["• ",o.conversionRate>30?"Strong":o.conversionRate>15?"Moderate":"Needs improvement"," conversion performance"]}),e.jsxs("li",{children:["• ",o.retentionRate>70?"Excellent":o.retentionRate>50?"Good":"Needs attention"," retention rate"]}),e.jsxs("li",{children:["• Customer lifetime value is ",o.avgLTV>1e4?"high":o.avgLTV>5e3?"moderate":"developing"]}),e.jsx("li",{children:"• This selection shows targeted analytics for clicked data only"})]})]})]})})]})})]})]})]})})};export{st as C,tt as E,rt as a,nt as b,at as c,it as d,ot as e,lt as f,dt as g,ct as h,mt as i};
